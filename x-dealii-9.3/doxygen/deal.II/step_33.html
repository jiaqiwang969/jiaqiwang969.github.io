<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_33.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-33 tutorial program 。</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.3.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.3.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-33 tutorial program 。 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>本教程取决于 <a class="el" href="step_12.html">step-12</a> 。</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Eulerflow">Euler flow</a><a href="#Eulerflow">Euler flow</a>
        <li><a href="#Discretization">Discretization</a><a href="#Discretization">Discretization</a>
        <li><a href="#Automaticdifferentiation"> Automatic differentiation </a><a href="#Automaticdifferentiation"> Automatic differentiation </a>
        <li><a href="#Trilinossolvers"> Trilinos solvers </a><a href="#Trilinossolvers"> Trilinos solvers </a>
        <li><a href="#Adaptivity"> Adaptivity </a><a href="#Adaptivity"> Adaptivity </a>
        <li><a href="#Inputdeckinitialandboundaryconditions">Input deck, initial and boundary conditions</a><a href="#Inputdeckinitialandboundaryconditions">Input deck, initial and boundary conditions</a>
        <li><a href="#Implementation">Implementation</a><a href="#Implementation">Implementation</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a><a href="#Includefiles">Include files</a>
        <li><a href="#Eulerequationspecifics">Euler equation specifics</a><a href="#Eulerequationspecifics">Euler equation specifics</a>
      <ul>
        <li><a href="#Componentdescription">Component description</a><a href="#Componentdescription">Component description</a>
        <li><a href="#Transformationsbetweenvariables">Transformations between variables</a><a href="#Transformationsbetweenvariables">Transformations between variables</a>
        <li><a href="#EulerEquationscompute_flux_matrix">EulerEquations::compute_flux_matrix</a><a href="#EulerEquationscompute_flux_matrix">EulerEquations::compute_flux_matrix</a>
        <li><a href="#EulerEquationscompute_normal_flux">EulerEquations::compute_normal_flux</a><a href="#EulerEquationscompute_normal_flux">EulerEquations::compute_normal_flux</a>
        <li><a href="#EulerEquationscompute_forcing_vector">EulerEquations::compute_forcing_vector</a><a href="#EulerEquationscompute_forcing_vector">EulerEquations::compute_forcing_vector</a>
        <li><a href="#Dealingwithboundaryconditions">Dealing with boundary conditions</a><a href="#Dealingwithboundaryconditions">Dealing with boundary conditions</a>
        <li><a href="#EulerEquationscompute_refinement_indicators">EulerEquations::compute_refinement_indicators</a><a href="#EulerEquationscompute_refinement_indicators">EulerEquations::compute_refinement_indicators</a>
        <li><a href="#EulerEquationsPostprocessor">EulerEquations::Postprocessor</a><a href="#EulerEquationsPostprocessor">EulerEquations::Postprocessor</a>
      </ul>
        <li><a href="#Runtimeparameterhandling">Run time parameter handling</a><a href="#Runtimeparameterhandling">Run time parameter handling</a>
      <ul>
        <li><a href="#ParametersSolver">Parameters::Solver</a><a href="#ParametersSolver">Parameters::Solver</a>
        <li><a href="#ParametersRefinement">Parameters::Refinement</a><a href="#ParametersRefinement">Parameters::Refinement</a>
        <li><a href="#ParametersFlux">Parameters::Flux</a> ]<a href="#ParametersFlux">Parameters::Flux</a>
        <li><a href="#ParametersOutput">Parameters::Output</a><a href="#ParametersOutput">Parameters::Output</a>
        <li><a href="#ParametersAllParameters">Parameters::AllParameters</a><a href="#ParametersAllParameters">Parameters::AllParameters</a>
      </ul>
        <li><a href="#Conservationlawclass">Conservation law class</a><a href="#Conservationlawclass">Conservation law class</a>
      <ul>
        <li><a href="#ConservationLawConservationLaw">ConservationLaw::ConservationLaw</a><a href="#ConservationLawConservationLaw">ConservationLaw::ConservationLaw</a>
        <li><a href="#ConservationLawsetup_system">ConservationLaw::setup_system</a><a href="#ConservationLawsetup_system">ConservationLaw::setup_system</a>
        <li><a href="#ConservationLawassemble_system">ConservationLaw::assemble_system</a><a href="#ConservationLawassemble_system">ConservationLaw::assemble_system</a>
        <li><a href="#ConservationLawassemble_cell_term">ConservationLaw::assemble_cell_term</a><a href="#ConservationLawassemble_cell_term">ConservationLaw::assemble_cell_term</a>
        <li><a href="#ConservationLawassemble_face_term">ConservationLaw::assemble_face_term</a><a href="#ConservationLawassemble_face_term">ConservationLaw::assemble_face_term</a>
        <li><a href="#ConservationLawsolve">ConservationLaw::solve</a><a href="#ConservationLawsolve">ConservationLaw::solve</a>
        <li><a href="#ConservationLawcompute_refinement_indicators">ConservationLaw::compute_refinement_indicators</a><a href="#ConservationLawcompute_refinement_indicators">ConservationLaw::compute_refinement_indicators</a>
        <li><a href="#ConservationLawrefine_grid">ConservationLaw::refine_grid</a><a href="#ConservationLawrefine_grid">ConservationLaw::refine_grid</a>
        <li><a href="#ConservationLawoutput_results">ConservationLaw::output_results</a><a href="#ConservationLawoutput_results">ConservationLaw::output_results</a>
        <li><a href="#ConservationLawrun">ConservationLaw::run</a><a href="#ConservationLawrun">ConservationLaw::run</a>
      </ul>
        <li><a href="#main">main()</a><a href="#main">main()</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
      <ul>
        <li><a href="#Stabilization">Stabilization</a><a href="#Stabilization">Stabilization</a>
        <li><a href="#Betterlinearsolvers">Better linear solvers</a><a href="#Betterlinearsolvers">Better linear solvers</a>
        <li><a href="#Cachetheexplicitpartofresidual">Cache the explicit part of residual</a><a href="#Cachetheexplicitpartofresidual">Cache the explicit part of residual</a>
        <li><a href="#Otherconservationlaws">Other conservation laws</a><a href="#Otherconservationlaws">Other conservation laws</a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
</p>
<p><br  />
 <br  />
</p>
<p><em> This program was written for fun by David Neckels (NCAR) while working at Sandia (on the Wyoming Express bus to and from Corrales each day). The main purpose was to better understand Euler flow. The code solves the basic Euler equations of gas dynamics, by using a fully implicit Newton iteration (inspired by Sandia's Aria code). The code may be configured by an input file to run different simulations on different meshes, with differing boundary conditions. <br  />
 The original code and documentation was later slightly modified by Wolfgang Bangerth to make it more modular and allow replacing the parts that are specific to the Euler equations by other hyperbolic conservation laws without too much trouble. </em></p>
<dl class="section note"><dt>Note</dt><dd>程序使用<a href="http://trilinos.org">Trilinos</a>线性求解器（这些可以在Trilinos的Aztec/Amesos包中找到）和自动微分包Sacado，也是Trilinos的一部分。deal.II必须被配置为使用Trilinos。请参考<a href="../../readme.html#trilinos">ReadMe</a>文件，以了解如何做到这一点。</dd>
<dd>
虽然这个程序很好地演示了自动微分的使用，但它并没有表达欧拉方程求解器的技术水平。对于这个方程有更快、更准确的方法，你应该看看 <a class="el" href="step_67.html">step-67</a> 和 <a class="el" href="step_69.html">step-69</a> 以了解如何更有效地解决这个方程。</dd></dl>
<p><a class="anchor" id="Introduction"></a><a class="anchor" id="Intro"></a> </p><h1>Introduction</h1>
<p><a class="anchor" id="Eulerflow"></a></p><h3>Euler flow</h3>
<p>描述可压缩的无粘性气体运动的方程（所谓气体动力学的欧拉方程）是一个基本的守恒定律系统。在空间维度 \(d\) 中，它们读作 </p><p class="formulaDsp">
\[ \partial_t \mathbf{w} + \nabla \cdot \mathbf{F}(\mathbf{w}) = \mathbf{G}(\mathbf w), \]
</p>
<p>，解 \(\mathbf{w}=(\rho v_1,\ldots,\rho v_d,\rho, E)^{\top}\) 由 \(\rho\) 流体密度、 \({\mathbf v}=(v_1,\ldots v_d)^T\) 流速（因此 \(\rho\mathbf v\) 为线性动量密度）和 \(E\) 气体的能量密度组成。我们将上述方程解释为 \(\partial_t \mathbf{w}_i + \nabla \cdot \mathbf{F}_i(\mathbf{w}) = \mathbf G_i(\mathbf w)\) , \(i=1,\ldots,dim+2\) 。</p>
<p>对于欧拉方程，通量矩阵 \(\mathbf F\) （或通量函数系统）被定义为（这里显示为 \(d=3\) 的情况） </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf F(\mathbf w) = \left( \begin{array}{ccc} \rho v_1^2+p &amp; \rho v_2v_1 &amp; \rho v_3v_1 \\ \rho v_1v_2 &amp; \rho v_2^2+p &amp; \rho v_3v_2 \\ \rho v_1v_3 &amp; \rho v_2v_3 &amp; \rho v_3^2+p \\ \rho v_1 &amp; \rho v_2 &amp; \rho v_3 \\ (E+p) v_1 &amp; (E+p) v_2 &amp; (E+p) v_3 \end{array} \right), \end{eqnarray*}
</p>
<p>而我们将选择仅将重力的影响作为特定的右手边强制力，由 </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf G(\mathbf w) = \left( \begin{array}{c} g_1\rho \\ g_2\rho \\ g_3\rho \\ 0 \\ \rho \mathbf g \cdot \mathbf v \end{array} \right), \end{eqnarray*}
</p>
<p>描述</p>
<p>其中 \(\mathbf g=(g_1,g_2,g_3)^T\) 表示重力矢量。这样一来，整个方程组就成了。 </p><p class="formulaDsp">
\begin{eqnarray*} \partial_t (\rho v_i) + \sum_{s=1}^d \frac{\partial(\rho v_i v_s + \delta_{is} p)}{\partial x_s} &amp;=&amp; g_i \rho, \qquad i=1,\dots,d, \\ \partial_t \rho + \sum_{s=1}^d \frac{\partial(\rho v_s)}{\partial x_s} &amp;=&amp; 0, \\ \partial_t E + \sum_{s=1}^d \frac{\partial((E+p)v_s)}{\partial x_s} &amp;=&amp; \rho \mathbf g \cdot \mathbf v. \end{eqnarray*}
</p>
<p>这些方程分别描述了动量、质量和能量的守恒。该系统由一个定义压力的关系封闭。 \(p = (\gamma -1)(E-\frac{1}{2} \rho |\mathbf v|^2)\) . 对于空气（主要是氮气和氧气）和其他双原子气体的成分，其比热比为 \(\gamma=1.4\) 。</p>
<p>这个问题显然属于矢量值问题的范畴。关于如何在deal.II中处理这些问题的一般概述可以在 <a class="el" href="group__vector__valued.html">Handling vector valued problems</a> 模块中找到。</p>
<p><a class="anchor" id="Discretization"></a></p><h3>Discretization</h3>
<p>考虑到这是一个双曲问题，与 <a class="el" href="step_12.html">step-12</a> 中讨论的简单问题的风格相同，具体化以通常的方式进行：我们选择一个有限元空间 \(V_h\) ，并针对我们的（矢量值的）测试函数 \(\mathbf{z} \in V_h\) 积分我们的守恒定律。 然后我们通过部分积分，用<em> numerical </em>通量 \(\mathbf{H}\) 、 </p><p class="formulaDsp">
\begin{eqnarray*} &amp;&amp;\int_{\Omega} (\partial_t \mathbf{w}, \mathbf{z}) + (\nabla \cdot \mathbf{F}(\mathbf{w}), \mathbf{z}) \\ &amp;\approx &amp;\int_{\Omega} (\partial_t \mathbf{w}, \mathbf{z}) - (\mathbf{F}(\mathbf{w}), \nabla \mathbf{z}) + h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z}) + \int_{\partial \Omega} (\mathbf{H}(\mathbf{w}^+, \mathbf{w}^-, \mathbf{n}), \mathbf{z}^+), \end{eqnarray*}
</p>
<p>近似边界通量。</p>
<p>其中上标 \(+\) 表示一个函数的内部轨迹， \(-\) 表示外部轨迹。扩散项 \(h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z})\) 是严格为了稳定而引入的，其中 \(h\) 是网格大小， \(\eta\) 是一个参数，规定要增加多少扩散。</p>
<p>在边界上，我们必须说明外部跟踪 \(\mathbf{w}^-\) 是什么。根据边界条件，我们规定以下两种情况。 </p><ul>
<li>
流入边界： \(\mathbf{w}^-\) 被规定为期望值。 </li>
<li>
超音速流出边界： \(\mathbf{w}^- = \mathbf{w}^+\) </li>
<li>
亚音速流出边界： \(\mathbf{w}^- = \mathbf{w}^+\) 除了能量变量被修改为支持规定的压力 \(p_o\) ，即 \(\mathbf{w}^- =(\rho^+, \rho v_1^+, \dots, \rho v_d^+, p_o/(\gamma -1) + 0.5 \rho |\mathbf{v}^+|^2)\) </li>
<li>
反射边界：我们设定 \(\mathbf{w}^-\) ，使 \((\mathbf{v}^+ + \mathbf{v}^-) \cdot \mathbf{n} = 0\) 和 \(\rho^- = \rho^+,E^-=E^+\) 。 </li>
</ul>
<p><br  />
</p>
<p>关于这些问题的更多信息可以在Ralf Hartmann的博士论文中找到，例如（"可压缩欧拉方程的自适应有限元方法"，博士论文，海德堡大学，2002）。</p>
<p>我们使用一个时间步进方案来替代上述方程中的时间导数。为简单起见，我们将 \( \mathbf{B}({\mathbf{w}_{n}})(\mathbf z) \) 定义为时间步长的空间残差 \(n\) 。</p>
<p class="formulaDsp">
\begin{eqnarray*} \mathbf{B}(\mathbf{w}_{n})(\mathbf z) &amp;=&amp; - \int_{\Omega} \left(\mathbf{F}(\mathbf{w}_n), \nabla\mathbf{z}\right) + h^{\eta}(\nabla \mathbf{w}_n , \nabla \mathbf{z}) \\ &amp;&amp; + \int_{\partial \Omega} \left(\mathbf{H}(\mathbf{w}_n^+, \mathbf{w}^-(\mathbf{w}_n^+), \mathbf{n}), \mathbf{z}\right) - \int_{\Omega} \left(\mathbf{G}(\mathbf{w}_n), \mathbf{z}\right) . \end{eqnarray*}
</p>
<p>因此，在每个时间步长，我们的完全离散化是，应用于任何测试函数 \(\mathbf z\) 的残差等于零。 </p><p class="formulaDsp">
\begin{eqnarray*} R(\mathbf{W}_{n+1})(\mathbf z) &amp;=&amp; \int_{\Omega} \left(\frac{{\mathbf w}_{n+1} - \mathbf{w}_n}{\delta t}, \mathbf{z}\right)+ \theta \mathbf{B}({\mathbf{w}}_{n+1}) + (1-\theta) \mathbf{B}({\mathbf w}_{n}) \\ &amp;=&amp; 0 \end{eqnarray*}
</p>
<p>其中 \( \theta \in [0,1] \) 和 \(\mathbf{w}_i = \sum_k \mathbf{W}_i^k \mathbf{\phi}_k\) 。选择 \(\theta=0\) 的结果是显式（正向）欧拉方案， \(\theta=1\) 是稳定的隐式（反向）欧拉方案，而 \(\theta=\frac 12\) 是克拉克-尼克尔森方案。</p>
<p>在下面的实现中，我们为函数 \(\mathbf H\) 选择Lax-Friedrichs通量，即 \(\mathbf{H}(\mathbf{a},\mathbf{b},\mathbf{n}) = \frac{1}{2}(\mathbf{F}(\mathbf{a})\cdot \mathbf{n} + \mathbf{F}(\mathbf{b})\cdot \mathbf{n} + \alpha (\mathbf{a} - \mathbf{b}))\) ，其中 \(\alpha\) 是输入文件中指定的一个固定数字，或者 \(\alpha\) 是一个与网格有关的值。在后一种情况下，它被选为 \(\frac{h}{2\delta T}\) ，其中 \(h\) 是应用通量的面的直径，而 \(\delta T\) 是当前的时间步长。</p>
<p>有了这些选择，将残差等效为零就会产生一个非线性方程组 \(R(\mathbf{W}_{n+1})=0\) 。我们通过牛顿迭代来解决这个非线性系统（与 <a class="el" href="step_15.html">step-15</a> 中解释的方法相同），即通过迭代 </p><p class="formulaDsp">
\begin{eqnarray*} R&#39;(\mathbf{W}^k_{n+1},\delta \mathbf{W}_{n+1}^k)(\mathbf z) &amp; = &amp; - R(\mathbf{W}^{k}_{n+1})(\mathbf z) \qquad \qquad \forall \mathbf z\in V_h \\ \mathbf{W}^{k+1}_{n+1} &amp;=&amp; \mathbf{W}^k_{n+1} + \delta \mathbf{W}^k_{n+1}, \end{eqnarray*}
</p>
<p>来解决这个问题。</p>
<p>直到 \(|R(\mathbf{W}^k_{n+1})|\) （残差）足够小。通过用有限元空间的节点基础而不是所有的 \(\mathbf z\) 进行测试，我们得到一个 \(\delta \mathbf W\) 的线性系统： </p><p class="formulaDsp">
\begin{eqnarray*} \mathbf R&#39;(\mathbf{W}^k_{n+1})\delta \mathbf{W}^k_{n+1} &amp; = &amp; - \mathbf R(\mathbf{W}^{k}_{n+1}). \end{eqnarray*}
</p>
<p>一般来说，这个线性系统既不是对称的，也没有任何特定的确定性属性。我们将使用直接求解器或Trilinos的GMRES实现来解决它。从<a href="#Results">results shown below</a>中可以看出，这种全隐式迭代收敛速度非常快（通常为3步），并且具有牛顿方法所期望的二次收敛顺序。</p>
<p><a class="anchor" id="Automaticdifferentiation"></a></p><h3>Automatic differentiation </h3>
<p>由于计算雅各布矩阵 \(\mathbf R&#39;(\mathbf W^k)\) 是一个可怕的野兽，我们使用一个自动微分包，Sacado，来做这个。 Sacado是<a href="http://trilinos.org" target="_top">Trilinos</a>框架内的一个包，提供了一个C++模板类 <code>Sacado::Fad::DFad</code> （ <code>Fad</code> 代表 "向前自动微分"），支持基本的算术运算符和函数，如 <code> sqrt, sin, cos, pow, </code> 等。为了使用这个功能，人们声明一个这种类型的变量集合，然后将这个集合中的一些变量表示为自由度，其余的变量是独立变量的函数。 这些变量在算法中被使用，随着变量的使用，它们对自由度的敏感度被持续更新。</p>
<p>可以想象，对于整个雅各布矩阵来说，这可能是非常昂贵的：自变量的数量是 \(\mathbf W^k\) ，因变量是向量 \(\mathbf R(\mathbf W^k)\) 的元素。这两个向量很容易有几万个元素或更多。 然而，需要注意的是，并非 \(\mathbf R\) 的所有元素都依赖于 \(\mathbf W^k\) 的所有元素：事实上， \(\mathbf R\) 中的一个条目只依赖于 \(\mathbf W^k\) 的一个元素，如果两个相应的形状函数以弱形式重叠和耦合。</p>
<p>具体来说，定义当前单元上的残差可能依赖的最小独立AD变量集是明智的：在每个元素上，我们定义那些对应于定义在这个单元上的自由度的独立变量（或者，如果我们必须计算单元之间的跳跃项，则对应于定义在两个相邻单元上的自由度），而因变量是本地残差向量的元素。不这样做，即把<em>all</em>的元素 \(\mathbf W^k\) 定义为独立的，将导致大量零的计算非常昂贵：局部残差向量的元素几乎独立于解向量的所有元素，因此它们的导数为零；然而，试图计算这些零很容易占用整个程序计算时间的90甚至更多，正如这个程序首次编写几年后一个学生无意中做的实验所示。</p>
<p>回到自动计算雅各布的问题上。作者将这种方法与手工编码的雅各布式并列用于不可压缩的Navier-Stokes问题，发现Sacado方法与使用手工编码的雅各布式一样快，但无限简单，而且不容易出错。由于使用自动差分只需要编码残差 \(R(\mathbf{W})\) ，确保代码的正确性和维护代码变得非常简单&ndash;雅各布矩阵 \(\mathbf R&#39;\) 基本上是由计算残差 \(\mathbf R\) 的相同代码计算的。</p>
<p>说了这么多，这里有一个非常简单的例子，展示了Sacado的使用方法。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> fad_double = Sacado::Fad::DFad&lt;double&gt;;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">main() {</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  fad_double a,<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>,c;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  a = 1; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a> = 2;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  a.diff(0,2);  <span class="comment">// Set a to be dof 0, in a 2-dof system.</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>.diff(1,2);  <span class="comment">// Set b to be dof 1, in a 2-dof system.</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  c = 2*a+<a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(a*<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> *derivs = &amp;c.fastAccessDx(0); <span class="comment">// Access derivatives</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;dc/da = &quot;</span> &lt;&lt; derivs[0] &lt;&lt; <span class="stringliteral">&quot;, dc/db=&quot;</span> &lt;&lt; derivs[1] &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="aclassVectorizedArray_html_adea3423146bcdda2dce143cfb4d10ae8"><div class="ttname"><a href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">VectorizedArray::cos</a></div><div class="ttdeci">VectorizedArray&lt; Number, width &gt; cos(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05318">vectorization.h:5318</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_ae880749870e5b45fbb6a441fd96c1a07"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">Physics::Elasticity::Kinematics::b</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; b(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
</div><!-- fragment --><p>输出是 \(c(a,b)=2a+\cos(ab)\) 在 \(a=1,b=2\) 的导数 \(\frac{\partial c(a,b)}{\partial a}, \frac{\partial c(a,b)}{\partial b}\) 。</p>
<p>应该注意的是，Sacado提供了更多的自动差分能力，而不是本程序中使用的小子集。 然而，理解上面的例子就足以理解Sacado在这个欧拉流程序中的使用。</p>
<p><a class="anchor" id="Trilinossolvers"></a></p><h3>Trilinos solvers </h3>
<p>该程序使用Aztec迭代求解器，或Amesos稀疏直接求解器，两者均由Trilinos软件包提供。 这个软件包本身就是为了用于并行程序而设计的，但是，它也可以像这里一样方便地用于串行程序。 Epetra软件包是基本的矢量/矩阵库，解算器是在此基础上建立的。 这个非常强大的包可以用来描述矢量的平行分布，并定义对这些矢量进行操作的稀疏矩阵。 请查看注释代码以了解更多关于这些求解器在例子中的使用细节。</p>
<p><a class="anchor" id="Adaptivity"></a></p><h3>Adaptivity </h3>
<p>这个例子使用了一个特殊的细化指标，在冲击型问题中显示了一些有用性，在包括下坡流的例子中也是如此。 我们根据密度的平方梯度进行细化。悬空节点的处理是通过计算不同细化水平的单元的数值通量来实现的，而不是像迄今为止的所有其他教程程序那样使用AffineConstraints类。 通过这种方式，这个例子结合了连续和DG的方法论。它还简化了雅各布系数的生成，因为我们不必通过用于计算它的自动微分来跟踪约束自由度。</p>
<dl class="section note"><dt>Note</dt><dd>而这个程序是在2008年写的，我们不知道有什么出版物会真正使用这种方法。然而，A. Dedner, R. Kl&ouml;fkorn, and M. Kr&auml;nkel（"Continuous Finite-Elements on Non-Conforming Grids Using Discontinuous Galerkin Stabilization", Proceedings of Finite Volumes for Complex Applications VII - Methods and Theoretical Aspects, Springer, 2014）的一篇较新的论文接近。</dd></dl>
<p>此外，我们强制规定了细化水平的最大数量，以控制细化。 笔者的经验是，对于时间相关问题的适应性，如果不注意的话，细化很容易导致模拟戛然而止，因为时间步长的限制，如果网格在领域的任何部分变得太细的话。 在这个例子中，细化的数量被限制，让用户指定在网格的任何地方出现的最大细化水平。 这样一来，细化就不会使模拟速度减慢到停滞不前。 当然，这纯粹是一种启发式的策略，如果作者的顾问听说了，作者可能会被永远放逐出有限元误差估计界。</p>
<p><a class="anchor" id="Inputdeckinitialandboundaryconditions"></a></p><h3>Input deck, initial and boundary conditions</h3>
<p>我们使用一个输入文件平台来驱动模拟。 通过这种方式，我们可以改变边界条件和其他重要的模拟属性，而不必重新编译。 关于格式的更多信息，请看<a href="#Results">results section</a>，在那里我们更详细地描述了一个输入文件的例子。</p>
<p>在以前的例子程序中，我们通常对初始和边界条件进行硬编码。在这个程序中，我们改用表达式解析器类FunctionParser，这样我们就可以在输入文件中指定一个通用表达式，并在运行时对其进行解析&amp;mdash；这样，我们就可以改变初始条件而不需要重新编译程序。因此，在下面的程序中不会声明名为InitialConditions或BoundaryConditions的类。</p>
<p><a class="anchor" id="Implementation"></a></p><h3>Implementation</h3>
<p>这个程序的实现被分成三个基本部分。 </p><ul>
<li>
<p class="startli"><code>EulerEquations</code> 类，它封装了完全描述欧拉方程具体内容的一切。这包括通量矩阵 \(\mathbf F(\mathbf W)\) 、数值通量 \(\mathbf F(\mathbf W^+,\mathbf W^-,\mathbf n)\) 、右手边 \(\mathbf G(\mathbf W)\) 、边界条件、细化指标、输出的后处理，以及类似的需要了解解向量和方程的各个组成部分的含义的东西。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">一个命名空间，处理与运行时参数有关的一切。</p>
<p class="endli"></p>
</li>
<li>
处理时间步进、外部非线性和内部线性求解、组装线性系统以及驱动这一切的顶层逻辑的 <code>ConservationLaw</code> 类。 </li>
</ul>
<p><br  />
</p>
<p>采用这种方法的原因是，它将程序中的各种关注点分开： <code>ConservationLaw</code> 是以这样一种方式编写的，即相对简单地将其适应于不同的方程组。人们只需为其他双曲方程重新实现 <code>EulerEquations</code> 类的成员，或用其他方程来增加现有方程（例如通过增加变量，或通过增加化学等）。然而，这样的修改不会影响时间步进，也不会影响非线性求解器，如果正确的话，因此， <code>ConservationLaw</code> 中的任何内容都不需要修改。</p>
<p>同样，如果我们想改进线性或非线性求解器，或时间步进方案（如<a href="#Results">results section</a>末尾所暗示的），那么这根本不需要修改 <code>EulerEquations</code> 。<a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>首先是一套标准的deal.II包括。这里没有什么特别要评论的。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function__parser_8h.html">deal.II/base/function_parser.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mapping__q1_8h.html">deal.II/fe/mapping_q1.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
<div class="ttc" id="aconditional__ostream_8h_html"><div class="ttname"><a href="conditional__ostream_8h.html">conditional_ostream.h</a></div></div>
<div class="ttc" id="adof__tools_8h_html"><div class="ttname"><a href="dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="adynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="afe__q_8h_html"><div class="ttname"><a href="fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="afe__system_8h_html"><div class="ttname"><a href="fe__system_8h.html">fe_system.h</a></div></div>
<div class="ttc" id="afunction_8h_html"><div class="ttname"><a href="function_8h.html">function.h</a></div></div>
<div class="ttc" id="afunction__parser_8h_html"><div class="ttname"><a href="function__parser_8h.html">function_parser.h</a></div></div>
<div class="ttc" id="agrid_2grid__refinement_8h_html"><div class="ttname"><a href="grid_2grid__refinement_8h.html">grid_refinement.h</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="agrid__generator_8h_html"><div class="ttname"><a href="grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="agrid__in_8h_html"><div class="ttname"><a href="grid__in_8h.html">grid_in.h</a></div></div>
<div class="ttc" id="agrid__out_8h_html"><div class="ttname"><a href="grid__out_8h.html">grid_out.h</a></div></div>
<div class="ttc" id="ainclude_2deal_8II_2base_2utilities_8h_html"><div class="ttname"><a href="include_2deal_8II_2base_2utilities_8h.html">utilities.h</a></div></div>
<div class="ttc" id="amapping__q1_8h_html"><div class="ttname"><a href="mapping__q1_8h.html">mapping_q1.h</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="anumerics_2solution__transfer_8h_html"><div class="ttname"><a href="numerics_2solution__transfer_8h.html">solution_transfer.h</a></div></div>
<div class="ttc" id="aparameter__handler_8h_html"><div class="ttname"><a href="parameter__handler_8h.html">parameter_handler.h</a></div></div>
<div class="ttc" id="aquadrature__lib_8h_html"><div class="ttname"><a href="quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="avector_8h_html"><div class="ttname"><a href="vector_8h.html">vector.h</a></div></div>
<div class="ttc" id="avector__tools_8h_html"><div class="ttname"><a href="vector__tools_8h.html">vector_tools.h</a></div></div>
</div><!-- fragment --><p>然后，正如在介绍中提到的，我们使用各种Trilinos软件包作为线性求解器以及自动微分。这些都在下面的include文件中。</p>
<p>由于deal.II提供了基本的Trilinos矩阵、预处理程序和求解器的接口，我们把它们作为deal.II线性代数结构类似地包括在内。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="trilinos__sparse__matrix_8h.html">deal.II/lac/trilinos_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="trilinos__precondition_8h.html">deal.II/lac/trilinos_precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="trilinos__solver_8h.html">deal.II/lac/trilinos_solver.h</a>&gt;</span></div>
<div class="ttc" id="atrilinos__precondition_8h_html"><div class="ttname"><a href="trilinos__precondition_8h.html">trilinos_precondition.h</a></div></div>
<div class="ttc" id="atrilinos__solver_8h_html"><div class="ttname"><a href="trilinos__solver_8h.html">trilinos_solver.h</a></div></div>
<div class="ttc" id="atrilinos__sparse__matrix_8h_html"><div class="ttname"><a href="trilinos__sparse__matrix_8h.html">trilinos_sparse_matrix.h</a></div></div>
</div><!-- fragment --><p>Sacado是Trilinos中的自动微分包，用于寻找全隐式牛顿迭代的雅各布系数。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
</div><!-- fragment --><p>而这又是C++。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
</div><!-- fragment --><p>为了结束本节，将dealii库中的所有内容引入本程序内容将进入的命名空间。</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Step33</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="namespace__dealii_8h_source.html#l00025">namespace_dealii.h:26</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Eulerequationspecifics"></a> </p><h3>Euler equation specifics</h3>
<p>在这里，我们为这个特定的守恒定律系统定义了通量函数，以及几乎所有其他与气体动力学欧拉方程有关的东西，原因在介绍中已经讨论过了。我们将所有这些归入一个结构，该结构定义了与通量有关的一切。这个结构的所有成员都是静态的，也就是说，这个结构没有由实例成员变量指定的实际状态。更好的方法是使用命名空间，而不是一个拥有所有静态成员的结构&ndash;但是命名空间不能被模板化，而且我们希望结构中的一些成员变量取决于空间维度，我们以通常的方式使用模板参数来引入。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>EulerEquations</div>
<div class="line">{</div>
</div><!-- fragment --><p><a class="anchor" id="Componentdescription"></a></p><h4>Component description</h4>
<p>首先是几个变量，它们以一种通用的方式描述我们的解向量的各个组成部分。这包括系统中分量的数量（欧拉方程中每个空间方向的动量都有一个条目，加上能量和密度分量，总共有 <code>dim+2</code> 个分量），以及描述第一动量分量、密度分量和能量密度分量在解向量中的索引的函数。请注意，所有这些数都取决于空间维度；以通用的方式定义它们（而不是通过隐含的惯例）使我们的代码更加灵活，并使以后的扩展更加容易，例如在方程中加入更多的分量。</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_components             = dim + 2;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_momentum_component = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> density_component        = dim;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> energy_component         = dim + 1;</div>
</div><!-- fragment --><p>在这个程序中，当生成图形输出的时候，我们需要指定解变量的名称，以及各种成分如何分组为矢量和标量场。我们可以在这里进行描述，但为了使与欧拉方程有关的事情在这里得到解决，并使程序的其他部分尽可能地通用，我们在以下两个函数中提供这类信息。</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> std::vector&lt;std::string&gt; component_names()</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;std::string&gt; names(dim, <span class="stringliteral">&quot;momentum&quot;</span>);</div>
<div class="line">  names.emplace_back(<span class="stringliteral">&quot;density&quot;</span>);</div>
<div class="line">  names.emplace_back(<span class="stringliteral">&quot;energy_density&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> names;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">component_interpretation()</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    data_component_interpretation(</div>
<div class="line">      dim, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> data_component_interpretation;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a></div><div class="ttdeci">@ component_is_scalar</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00053">data_component_interpretation.h:53</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a></div><div class="ttdeci">@ component_is_part_of_vector</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00059">data_component_interpretation.h:59</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Transformationsbetweenvariables"></a> </p><h4>Transformations between variables</h4>
<p>接下来，我们定义气体常数。我们将在紧随这个类的声明之后的定义中把它设置为1.4（与整数变量不同，比如上面的变量，静态常数浮点成员变量不能在C++的类声明中初始化）。这个1.4的值代表了由两个原子组成的分子的气体，例如空气，它几乎完全由 \(N_2\) 和 \(O_2\) 组成，直到小的痕迹为止。</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> gas_gamma;</div>
</div><!-- fragment --><p>在下文中，我们将需要从保守变量的矢量中计算动能和压力。我们可以根据能量密度和动能 \(\frac 12 \rho |\mathbf v|^2 = \frac{|\rho \mathbf v|^2}{2\rho}\) 做到这一点（注意，独立变量包含动量分量 \(\rho v_i\) ，而不是速度 \(v_i\) ）。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">compute_kinetic_energy(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">typename</span> InputVector::value_type kinetic_energy = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">    kinetic_energy +=</div>
<div class="line">      W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] * W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">  kinetic_energy *= 1. / (2 * W[density_component]);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> kinetic_energy;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">compute_pressure(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> ((gas_gamma - 1.0) *</div>
<div class="line">          (W[energy_component] - compute_kinetic_energy(W)));</div>
<div class="line">}</div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a15728437b942dab0b0042eb06a407d2c"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">Physics::Elasticity::Kinematics::d</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; d(const Tensor&lt; 2, dim, Number &gt; &amp;F, const Tensor&lt; 2, dim, Number &gt; &amp;dF_dt)</div></div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_flux_matrix"></a> </p><h4>EulerEquations::compute_flux_matrix</h4>
<p>我们将通量函数 \(F(W)\) 定义为一个大矩阵。 这个矩阵的每一行都代表该行成分的标量守恒定律。 这个矩阵的确切形式在介绍中给出。请注意，我们知道矩阵的大小：它的行数与系统的分量一样多， <code>dim</code> 列数一样多；我们没有为这样的矩阵使用FullMatrix对象（它的行数和列数是可变的，因此每次创建这样的矩阵时必须在堆上分配内存），而是立即使用一个矩形的数字阵列。 <br  />
</p>
<p>我们将通量函数的数值类型模板化，这样我们就可以在这里使用自动微分类型。 同样地，我们将用不同的输入矢量数据类型来调用该函数，所以我们也对其进行模板化。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> compute_flux_matrix(<span class="keyword">const</span> InputVector &amp;W,</div>
<div class="line">                                <a class="code" href="ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">                                        EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">                                        dim&gt; &amp;     flux)</div>
<div class="line">{</div>
<div class="ttc" id="andarray_8h_html_a82399009710c9549884b9d8c506ad695"><div class="ttname"><a href="ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a></div><div class="ttdeci">typename internal::ndarray::HelperArray&lt; T, Ns... &gt;::type ndarray</div><div class="ttdef"><b>Definition:</b> <a href="ndarray_8h_source.html#l00108">ndarray.h:108</a></div></div>
</div><!-- fragment --><p>首先计算出现在通量矩阵中的压力，然后计算对应于动量项的矩阵的第一 <code>dim</code> 列。</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">typename</span> InputVector::value_type pressure = compute_pressure(W);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>)</div>
<div class="line">      flux[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>] =</div>
<div class="line">        W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] *</div>
<div class="line">        W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>] / W[density_component];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    flux[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] += pressure;</div>
<div class="line">  }</div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
</div><!-- fragment --><p>然后是密度的条款（即质量守恒），最后是能量守恒。</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">    flux[density_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">    flux[energy_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] /</div>
<div class="line">                                W[density_component] *</div>
<div class="line">                                (W[energy_component] + pressure);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_normal_flux"></a> </p><h4>EulerEquations::compute_normal_flux</h4>
<p>在域的边界和跨挂节点上，我们使用一个数值通量函数来强制执行边界条件。 这个程序是基本的Lax-Friedrich的通量，有一个稳定的参数 \(\alpha\) 。它的形式也已经在介绍中给出。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> numerical_normal_flux(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                                      normal,</div>
<div class="line">  <span class="keyword">const</span> InputVector &amp;                                         Wplus,</div>
<div class="line">  <span class="keyword">const</span> InputVector &amp;                                         Wminus,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>                                                alpha,</div>
<div class="line">  std::array&lt;typename InputVector::value_type, n_components&gt; &amp;normal_flux)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">          EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">          dim&gt;</div>
<div class="line">    iflux, oflux;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  compute_flux_matrix(Wplus, iflux);</div>
<div class="line">  compute_flux_matrix(Wminus, oflux);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; n_components; ++di)</div>
<div class="line">    {</div>
<div class="line">      normal_flux[di] = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        normal_flux[di] += 0.5 * (iflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] + oflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]) * normal[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      normal_flux[di] += 0.5 * alpha * (Wplus[di] - Wminus[di]);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 1, dim &gt;</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_forcing_vector"></a> </p><h4>EulerEquations::compute_forcing_vector</h4>
<p>与描述通量函数 \(\mathbf F(\mathbf w)\) 的方式相同，我们也需要有一种方法来描述右侧的强制项。正如介绍中提到的，我们在这里只考虑重力，这导致了具体的形式 \(\mathbf G(\mathbf w) = \left( g_1\rho, g_2\rho, g_3\rho, 0, \rho \mathbf g \cdot \mathbf v \right)^T\) ，这里显示的是三维情况。更具体地说，我们将只考虑三维的 \(\mathbf g=(0,0,-1)^T\) ，或二维的 \(\mathbf g=(0,-1)^T\) 。这自然导致了下面的函数。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> compute_forcing_vector(</div>
<div class="line">  <span class="keyword">const</span> InputVector &amp;                                         W,</div>
<div class="line">  std::array&lt;typename InputVector::value_type, n_components&gt; &amp;forcing)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> gravity = -1.0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; n_components; ++c)</div>
<div class="line">    <span class="keywordflow">switch</span> (c)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> first_momentum_component + dim - 1:</div>
<div class="line">          forcing[c] = gravity * W[density_component];</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> energy_component:</div>
<div class="line">          forcing[c] = gravity * W[first_momentum_component + dim - 1];</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          forcing[c] = 0;</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Dealingwithboundaryconditions"></a> </p><h4>Dealing with boundary conditions</h4>
<p>我们必须处理的另一件事是边界条件。为此，让我们首先定义我们目前知道如何处理的各种边界条件。</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> BoundaryKind</div>
<div class="line">{</div>
<div class="line">  inflow_boundary,</div>
<div class="line">  outflow_boundary,</div>
<div class="line">  no_penetration_boundary,</div>
<div class="line">  pressure_boundary</div>
<div class="line">};</div>
</div><!-- fragment --><p>接下来的部分是实际决定在每一种边界上做什么。为此，请记住，从介绍中可以看出，边界条件是通过在给定的不均匀性 \(\mathbf j\) 的边界外侧选择一个值 \(\mathbf w^-\) ，以及可能在内部选择解的值 \(\mathbf w^+\) 来指定的。然后将两者都传递给数值通量 \(\mathbf H(\mathbf{w}^+, \mathbf{w}^-, \mathbf{n})\) 以定义边界对双线性形式的贡献。</p>
<p>边界条件在某些情况下可以为解矢量的每个分量独立指定。例如，如果分量 \(c\) 被标记为流入，那么 \(w^-_c = j_c\) 。如果是流出，那么 \(w^-_c = w^+_c\) 。这两种简单的情况在下面的函数中首先被处理。</p>
<p>从C++语言的角度看，有一个小插曲使这个函数不讨人喜欢。输出向量 <code>Wminus</code> 当然会被修改，所以它不应该是一个 <code>const</code> 的参数。然而，在下面的实现中，它却成为了参数，而且为了使代码能够编译，它必须成为参数。原因是我们在 <code>Wminus</code> 类型为 <code><a class="el" href="classTable.html">Table</a>&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt;</code> 的地方调用这个函数，这是一个2d表，其指数分别代表正交点和向量分量。我们用 <code>Wminus[q]</code> 作为最后一个参数来调用这个函数；对2d表进行下标会产生一个代表1d向量的临时访问器对象，这正是我们在这里想要的。问题是，根据C++ 1998和2003标准，临时访问器对象不能被绑定到一个函数的非静态引用参数上，就像我们在这里希望的那样（这个问题将在下一个标准中以rvalue引用的形式得到解决）。 我们在这里把输出参数变成常量，是因为<em>accessor</em>对象是常量，而不是它所指向的表：那个表仍然可以被写到。然而，这个黑客是不愉快的，因为它限制了可以作为这个函数的模板参数的数据类型：一个普通的向量是不行的，因为当标记为 <code>const</code> 时，它不能被写到。由于目前没有好的解决方案，我们将采用这里显示的务实的，甚至是不漂亮的解决方案。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataVector&gt;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">compute_Wminus(<span class="keyword">const</span> std::array&lt;BoundaryKind, n_components&gt; &amp;boundary_kind,</div>
<div class="line">               <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                        normal_vector,</div>
<div class="line">               <span class="keyword">const</span> DataVector &amp;                            Wplus,</div>
<div class="line">               <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;boundary_values,</div>
<div class="line">               <span class="keyword">const</span> DataVector &amp;    Wminus)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; n_components; c++)</div>
<div class="line">    <span class="keywordflow">switch</span> (boundary_kind[c])</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> inflow_boundary:</div>
<div class="line">          {</div>
<div class="line">            Wminus[c] = boundary_values(c);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> outflow_boundary:</div>
<div class="line">          {</div>
<div class="line">            Wminus[c] = Wplus[c];</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
</div><!-- fragment --><p>规定的压力边界条件要复杂一些，因为即使压力是规定的，我们在这里真正设定的是能量分量，它将取决于速度和压力。因此，尽管这似乎是一个迪里切特类型的边界条件，我们得到了能量对速度和密度的敏感性（除非这些也是规定的）。</p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> pressure_boundary:</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> DataVector::value_type density =</div>
<div class="line">      (boundary_kind[density_component] == inflow_boundary ?</div>
<div class="line">         boundary_values(density_component) :</div>
<div class="line">         Wplus[density_component]);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typename</span> DataVector::value_type kinetic_energy = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">      <span class="keywordflow">if</span> (boundary_kind[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] == inflow_boundary)</div>
<div class="line">        kinetic_energy += boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) * boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        kinetic_energy += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] * Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">    kinetic_energy *= 1. / 2. / density;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    Wminus[c] =</div>
<div class="line">      boundary_values(c) / (gas_gamma - 1.0) + kinetic_energy;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">case</span> no_penetration_boundary:</div>
<div class="line">  {</div>
</div><!-- fragment --><p>我们规定速度（我们在这里处理的是一个特定的分量，所以速度的平均值是与表面法线正交的。 这就产生了整个速度分量的敏感度。</p>
<div class="fragment"><div class="line">            <span class="keyword">typename</span> DataVector::value_type vdotn = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>++)</div>
<div class="line">              {</div>
<div class="line">                vdotn += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] * normal_vector[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            Wminus[c] = Wplus[c] - 2.0 * vdotn * normal_vector[c];</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">      }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01473">exceptions.h:1473</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga7b52b286796c23ef9ff178faf7a4b68f"><div class="ttname"><a href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">StandardExceptions::ExcNotImplemented</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcNotImplemented()</div></div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationscompute_refinement_indicators"></a></p><h4>EulerEquations::compute_refinement_indicators</h4>
<p>在这个类中，我们还想指定如何细化网格。将使用我们在 <code>EulerEquation</code> 类中提供的所有信息的 <code>ConservationLaw</code> 类对于它所求解的特定守恒定律是相当不可知的：因为它甚至不关心一个解矢量有多少分量。因此，它不可能知道合理的细化指标是什么。另一方面，在这里我们知道，或者至少我们可以想出一个合理的选择：我们简单地看一下密度的梯度，并计算 \(\eta_K=\log\left(1+|\nabla\rho(x_K)|\right)\) ，其中 \(x_K\) 是单元 \(K\) 的中心。 <br  />
</p>
<p>当然也有许多同样合理的细化指标，但这个指标确实如此，而且很容易计算。</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">compute_refinement_indicators(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   mapping,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp; solution,</div>
<div class="line">                              <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       refinement_indicators)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">  std::vector&lt;unsigned int&gt; dofs(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQMidpoint.html">QMidpoint&lt;dim&gt;</a> quadrature_formula;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>    update_flags = <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(mapping,</div>
<div class="line">                     dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>(),</div>
<div class="line">                     quadrature_formula,</div>
<div class="line">                     update_flags);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;std::vector&lt;Tensor&lt;1, dim&gt;&gt;&gt; dU(</div>
<div class="line">    1, std::vector&lt;<a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>&gt;(n_components));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = cell-&gt;active_cell_index();</div>
<div class="line">      fe_v.reinit(cell);</div>
<div class="line">      fe_v.get_function_gradients(solution, dU);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      refinement_indicators(cell_no) = <a class="code" href="numbers_8h.html#a5ecbfe991bebf7e99864f2e4eb3ea8df">std::log</a>(</div>
<div class="line">        1 + std::sqrt(dU[0][density_component] * dU[0][density_component]));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00314">dof_handler.h:315</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_ac1fedeb50b5f03b13d8b69f86e33f726"><div class="ttname"><a href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">DoFHandler::get_fe</a></div><div class="ttdeci">const FiniteElement&lt; dim, spacedim &gt; &amp; get_fe(const unsigned int index=0) const</div></div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l03905">fe_values.h:3906</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a33b522422da89e5c080e7405ad49d7c7"><div class="ttname"><a href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">FiniteElementData::n_dofs_per_cell</a></div><div class="ttdeci">unsigned int n_dofs_per_cell() const</div></div>
<div class="ttc" id="aclassMapping_html"><div class="ttname"><a href="classMapping.html">Mapping</a></div><div class="ttdoc">Abstract base class for mapping classes.</div><div class="ttdef"><b>Definition:</b> <a href="mapping_8h_source.html#l00303">mapping.h:304</a></div></div>
<div class="ttc" id="aclassQMidpoint_html"><div class="ttname"><a href="classQMidpoint.html">QMidpoint</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00089">quadrature_lib.h:90</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52f"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div><div class="ttdeci">UpdateFlags</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00066">fe_update_flags.h:67</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00084">fe_update_flags.h:84</a></div></div>
<div class="ttc" id="agroup__CPP11_html_gaace8c98aca00e7e48a619bb5e08084aa"><div class="ttname"><a href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div></div>
<div class="ttc" id="anumbers_8h_html_a5ecbfe991bebf7e99864f2e4eb3ea8df"><div class="ttname"><a href="numbers_8h.html#a5ecbfe991bebf7e99864f2e4eb3ea8df">std::log</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; log(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05384">vectorization.h:5384</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="EulerEquationsPostprocessor"></a> </p><h4>EulerEquations::Postprocessor</h4>
<p>最后，我们声明一个实现数据组件后处理的类。这个类解决的问题是，我们使用的欧拉方程的表述中的变量是保守的而不是物理的形式：它们是动量密度 \(\mathbf m=\rho\mathbf v\) ，密度 \(\rho\) ，和能量密度 \(E\) 。我们还想把速度 \(\mathbf v=\frac{\mathbf m}{\rho}\) 和压力 \(p=(\gamma-1)(E-\frac{1}{2} \rho |\mathbf v|^2)\) 放入我们的输出文件中。</p>
<p>此外，我们还想增加生成Schlieren图的可能性。Schlieren图是一种将冲击和其他尖锐界面可视化的方法。Schlieren "这个词是一个德语单词，可以翻译成 "条纹"--不过，用一个例子来解释可能更简单：比如说，当你把高浓度的酒精或透明的盐水溶液倒入水中时，你会看到schlieren；这两种物质的颜色相同，但它们的折射率不同，所以在它们完全混合之前，光线会沿着弯曲的光线穿过混合物，如果你看它，会导致亮度变化。这就是 "分光"。类似的效果发生在可压缩流中，因为折射率取决于气体的压力（以及因此的密度）。 <br  />
</p>
<p>这个词的起源是指三维体积的二维投影（我们看到的是三维流体的二维图片）。在计算流体力学中，我们可以通过考虑其原因来了解这种效应：密度变化。因此，Schlieren图是通过绘制 \(s=|\nabla \rho|^2\) 产生的；显然， \(s\) 在冲击和其他高度动态的地方很大。如果用户需要的话（通过在输入文件中指定），我们希望除了上面列出的其他派生量之外，还能生成这些雪莲图。 <br  />
</p>
<p>计算解决我们问题的派生量并将其输出到数据文件的算法的实现依赖于DataPostprocessor类。它有大量的文档，该类的其他用途也可以在 <a class="el" href="step_29.html">step-29</a> 中找到。因此，我们不做广泛的评论。</p>
<div class="fragment"><div class="line">  <span class="keyword">class </span>Postprocessor : <span class="keyword">public</span> <a class="code" href="classDataPostprocessor.html">DataPostprocessor</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Postprocessor(<span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classDataPostprocessor.html#a1ba57b598d24d64365d469a854271c68">evaluate_vector_field</a>(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">      std::vector&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;computed_quantities) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> std::vector&lt;std::string&gt; <a class="code" href="classDataPostprocessor.html#a254f38bcdf4bdb5aa94231b695da7d55">get_names</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> std::vector&lt;</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a>&gt;</div>
<div class="line">    <a class="code" href="classDataPostprocessor.html#ae994223acf8a16471ab5e579a4d75053">get_data_component_interpretation</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> <a class="code" href="classDataPostprocessor.html#aadecdd040447b395164397ea1196f721">get_needed_update_flags</a>() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot;</div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> EulerEquations&lt;dim&gt;::gas_gamma = 1.4;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">EulerEquations&lt;dim&gt;::Postprocessor::Postprocessor(</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot)</div>
<div class="line">  : do_schlieren_plot(do_schlieren_plot)</div>
<div class="line">{}</div>
<div class="ttc" id="aclassDataPostprocessor_html"><div class="ttname"><a href="classDataPostprocessor.html">DataPostprocessor</a></div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor_8h_source.html#l00520">data_postprocessor.h:521</a></div></div>
<div class="ttc" id="aclassDataPostprocessor_html_a1ba57b598d24d64365d469a854271c68"><div class="ttname"><a href="classDataPostprocessor.html#a1ba57b598d24d64365d469a854271c68">DataPostprocessor::evaluate_vector_field</a></div><div class="ttdeci">virtual void evaluate_vector_field(const DataPostprocessorInputs::Vector&lt; dim &gt; &amp;input_data, std::vector&lt; Vector&lt; double &gt;&gt; &amp;computed_quantities) const</div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor_8cc_source.html#l00037">data_postprocessor.cc:37</a></div></div>
<div class="ttc" id="aclassDataPostprocessor_html_a254f38bcdf4bdb5aa94231b695da7d55"><div class="ttname"><a href="classDataPostprocessor.html#a254f38bcdf4bdb5aa94231b695da7d55">DataPostprocessor::get_names</a></div><div class="ttdeci">virtual std::vector&lt; std::string &gt; get_names() const =0</div></div>
<div class="ttc" id="aclassDataPostprocessor_html_aadecdd040447b395164397ea1196f721"><div class="ttname"><a href="classDataPostprocessor.html#aadecdd040447b395164397ea1196f721">DataPostprocessor::get_needed_update_flags</a></div><div class="ttdeci">virtual UpdateFlags get_needed_update_flags() const =0</div></div>
<div class="ttc" id="aclassDataPostprocessor_html_ae994223acf8a16471ab5e579a4d75053"><div class="ttname"><a href="classDataPostprocessor.html#ae994223acf8a16471ab5e579a4d75053">DataPostprocessor::get_data_component_interpretation</a></div><div class="ttdeci">virtual std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; get_data_component_interpretation() const</div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor_8cc_source.html#l00048">data_postprocessor.cc:48</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a></div><div class="ttdeci">DataComponentInterpretation</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00047">data_component_interpretation.h:48</a></div></div>
<div class="ttc" id="astructDataPostprocessorInputs_1_1Vector_html"><div class="ttname"><a href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor_8h_source.html#l00337">data_postprocessor.h:338</a></div></div>
</div><!-- fragment --><p>这是唯一值得评论的功能。当生成图形输出时，DataOut和相关的类将在每个单元格上调用这个函数，以获取每个正交点的值、梯度、Hessians和法向量（如果我们正在处理面）。请注意，每个正交点的数据本身就是矢量值，即保守变量。我们在这里要做的是计算每个正交点上我们感兴趣的量。注意，为此我们可以忽略Hessians（"inputs.solution_hessians"）和法向量（"inputs.normals"）。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> EulerEquations&lt;dim&gt;::Postprocessor::evaluate_vector_field(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">  std::vector&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;               computed_quantities)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
</div><!-- fragment --><p>在函数的开始，让我们确保所有的变量都有正确的大小，这样我们就可以访问个别的向量元素，而不必怀疑我们是否可能读或写无效的元素；我们还检查 <code>solution_gradients</code> 向量是否只包含我们真正需要的数据（系统知道这一点，因为我们在下面的 <code>get_needed_update_flags()</code> 函数中这样说）。对于内向量，我们检查至少外向量的第一个元素有正确的内部大小。</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_quadrature_points = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>.size();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>.size() == n_quadrature_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities.size() == n_quadrature_points,</div>
<div class="line">       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[0].size() == n_components,</div>
<div class="line">       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].size() == dim + 2, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].size() == dim + 1, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  }</div>
<div class="ttc" id="agroup__Exceptions_html_ga31978c026b8b6b5116df30b8e748f6b7"><div class="ttname"><a href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">StandardExceptions::ExcInternalError</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcInternalError()</div></div>
<div class="ttc" id="astructDataPostprocessorInputs_1_1Vector_html_a8e034ae97f0447fb541bdb8ad0a4f599"><div class="ttname"><a href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">DataPostprocessorInputs::Vector::solution_values</a></div><div class="ttdeci">std::vector&lt;::Vector&lt; double &gt; &gt; solution_values</div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor_8h_source.html#l00348">data_postprocessor.h:348</a></div></div>
<div class="ttc" id="astructDataPostprocessorInputs_1_1Vector_html_ac96fb295c3c807f96021bae734e8c3c3"><div class="ttname"><a href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">DataPostprocessorInputs::Vector::solution_gradients</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; Tensor&lt; 1, spacedim &gt; &gt; &gt; solution_gradients</div><div class="ttdef"><b>Definition:</b> <a href="data__postprocessor_8h_source.html#l00367">data_postprocessor.h:367</a></div></div>
</div><!-- fragment --><p>然后在所有的正交点上循环，在那里做我们的工作。这段代码应该是不言自明的。输出变量的顺序是：首先是 <code>dim</code> 速度，然后是压力，如果需要的话，还可以是SCHELEN图。请注意，我们尝试使用 <code>first_momentum_component</code> 和 <code>density_component</code> 的信息，对输入向量中的变量顺序进行通用处理。</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_quadrature_points; ++q)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> density = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[q](density_component);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        computed_quantities[q](<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) =</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[q](first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) / density;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      computed_quantities[q](dim) =</div>
<div class="line">        compute_pressure(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[q]);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">        computed_quantities[q](dim + 1) =</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>[q][density_component] *</div>
<div class="line">          inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>[q][density_component];</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;std::string&gt; EulerEquations&lt;dim&gt;::Postprocessor::get_names()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;std::string&gt; names;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">    names.emplace_back(<span class="stringliteral">&quot;velocity&quot;</span>);</div>
<div class="line">  names.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    names.emplace_back(<span class="stringliteral">&quot;schlieren_plot&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> names;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">EulerEquations&lt;dim&gt;::Postprocessor::get_data_component_interpretation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    interpretation(dim,</div>
<div class="line">                   <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    interpretation.push_back(</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> interpretation;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div>
<div class="line">EulerEquations&lt;dim&gt;::Postprocessor::get_needed_update_flags()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line">}</div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00078">fe_update_flags.h:78</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Runtimeparameterhandling"></a> </p><h3>Run time parameter handling</h3>
<p>我们接下来的工作是定义一些包含运行时参数的类（例如求解器公差、迭代次数、稳定参数等等）。我们可以在主类中完成这个工作，但是我们把它和主类分开，以使程序更加模块化和容易阅读。所有与运行时参数有关的东西都将在以下命名空间中，而程序逻辑则在主类中。 <br  />
</p>
<p>我们将把运行时参数分成几个独立的结构，并将其全部放入一个命名空间 <code>Parameters</code> 。在这些类中，有几个是为单独的组进行参数分组的，如用于求解器、网格细化或输出。这些类中的每一个都有函数 <code>declare_parameters()</code> 和 <code>parse_parameters()</code> ，分别在ParameterHandler对象中声明参数子段和条目，并从这样的对象中检索实际的参数值。这些类在ParameterHandler的子段中声明他们所有的参数。 <br  />
</p>
<p>下面这个命名空间的最后一个类结合了前面所有的类，从它们派生出来，并负责处理输入文件顶层的另外几个条目，以及其他一些奇怪的条目，这些条目在子段中太短了，不值得自己有一个结构。 <br  />
</p>
<p>这里值得指出的是一件事。下面这些类中没有一个构造函数可以初始化各种成员变量。不过这不是问题，因为我们将从输入文件中读取这些类中声明的所有变量（或者间接地：一个ParameterHandler对象将从那里读取，而我们将从这个对象中获取数值），它们将以这种方式被初始化。如果输入文件中根本没有指定某个变量，这也不是问题。在这种情况下，ParameterHandler类将简单地采取默认值，这个默认值是在下面的类的 <code>declare_parameters()</code> 函数中声明一个条目时指定的。</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Parameters</div>
<div class="line">{</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersSolver"></a> </p><h4>Parameters::Solver</h4>
<p><br  />
</p>
<p>这些类中的第一个涉及到线性内解器的参数。它提供的参数表明使用哪种求解器（GMRES作为一般非对称不定式系统的求解器，或稀疏直接求解器），要产生的输出量，以及调整阈值不完全LU分解（ILUT）的各种参数，我们使用它作为GMRES的预处理器。 <br  />
</p>
<p>特别是，ILUT需要以下参数。</p>
<ul>
<li>ilut_fill：形成ILU分解时要增加的额外条目数</li>
<li>ilut_atol, ilut_rtol: 在形成预处理程序时，对于某些问题，不好的条件（或者只是运气不好）会导致预处理程序的条件非常差。 因此，将对角线扰动添加到原始矩阵中，并为这个稍好的矩阵形成预处理程序会有帮助。 ATOL是一个绝对扰动，在形成预处理之前加到对角线上，RTOL是一个比例因子 \(rtol \geq 1\) 。</li>
<li>ilut_drop: ILUT将放弃任何幅度小于此值的数值。 这是一种管理该预处理程序所使用的内存量的方法。 <br  />
</li>
</ul>
<p>每个参数的含义在 <a class="el" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a> 调用的第三个参数中也有简要描述 <code>declare_parameters()</code> 。</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Solver</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> <a class="code" href="classSolverType.html">SolverType</a></div>
<div class="line">  {</div>
<div class="line">    gmres,</div>
<div class="line">    direct</div>
<div class="line">  };</div>
<div class="line">  <a class="code" href="classSolverType.html">SolverType</a> solver;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> OutputType</div>
<div class="line">  {</div>
<div class="line">    quiet,</div>
<div class="line">    verbose</div>
<div class="line">  };</div>
<div class="line">  OutputType output;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> linear_residual;</div>
<div class="line">  <span class="keywordtype">int</span>    max_iterations;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> ilut_fill;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_atol;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_rtol;</div>
<div class="line">  <span class="keywordtype">double</span> ilut_drop;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Solver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;output&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;quiet&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;quiet|verbose&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;State whether output from solver runs should be printed. &quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;Choices are &lt;quiet|verbose&gt;.&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;method&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;gmres&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;gmres|direct&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;The kind of solver for the linear system. &quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;Choices are &lt;gmres|direct&gt;.&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;residual&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Linear solver residual&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max iters&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;300&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Maximum solver iterations&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut preconditioner fill&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-9&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut preconditioner tolerance&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut relative tolerance&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Ilut drop tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Solver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> std::string op = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;verbose&quot;</span>)</div>
<div class="line">      output = verbose;</div>
<div class="line">    <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;quiet&quot;</span>)</div>
<div class="line">      output = quiet;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string sv = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;method&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;direct&quot;</span>)</div>
<div class="line">      solver = direct;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;gmres&quot;</span>)</div>
<div class="line">      solver = gmres;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    linear_residual = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;residual&quot;</span>);</div>
<div class="line">    max_iterations  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;max iters&quot;</span>);</div>
<div class="line">    ilut_fill       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>);</div>
<div class="line">    ilut_atol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>);</div>
<div class="line">    ilut_rtol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>);</div>
<div class="line">    ilut_drop       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassParameterHandler_html"><div class="ttname"><a href="classParameterHandler.html">ParameterHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8h_source.html#l00840">parameter_handler.h:841</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a599462cacd492e2f712bf7369507dcff"><div class="ttname"><a href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">ParameterHandler::leave_subsection</a></div><div class="ttdeci">void leave_subsection()</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00953">parameter_handler.cc:953</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a61fa98fdc0c52980a5b1de0ee1fc5bb2"><div class="ttname"><a href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">ParameterHandler::get_integer</a></div><div class="ttdeci">long int get_integer(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01025">parameter_handler.cc:1025</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6d65f458be69e23a348221cb67fc411d"><div class="ttname"><a href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a></div><div class="ttdeci">void declare_entry(const std::string &amp;entry, const std::string &amp;default_value, const Patterns::PatternBase &amp;pattern=Patterns::Anything(), const std::string &amp;documentation=&quot;&quot;, const bool has_to_be_set=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00796">parameter_handler.cc:796</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a91cfbaca954f444047302446a4e87125"><div class="ttname"><a href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">ParameterHandler::get</a></div><div class="ttdeci">std::string get(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00987">parameter_handler.cc:987</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_aeaf3c7846747695b1f327677e3716ec5"><div class="ttname"><a href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">ParameterHandler::get_double</a></div><div class="ttdeci">double get_double(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01068">parameter_handler.cc:1068</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_af29c20cde6d44186806d559beb468696"><div class="ttname"><a href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">ParameterHandler::enter_subsection</a></div><div class="ttdeci">void enter_subsection(const std::string &amp;subsection)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00939">parameter_handler.cc:939</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Double_html"><div class="ttname"><a href="classPatterns_1_1Double.html">Patterns::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00292">patterns.h:293</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Integer_html"><div class="ttname"><a href="classPatterns_1_1Integer.html">Patterns::Integer</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00189">patterns.h:190</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Selection_html"><div class="ttname"><a href="classPatterns_1_1Selection.html">Patterns::Selection</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00382">patterns.h:383</a></div></div>
<div class="ttc" id="aclassSolverType_html"><div class="ttname"><a href="classSolverType.html">SolverType</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ParametersRefinement"></a></p><h4>Parameters::Refinement</h4>
<p><br  />
</p>
<p>同样的，这里有几个参数决定了网格如何被细化（以及是否被细化）。关于冲击参数的具体作用，请参见下面的网格细化函数。</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Refinement</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">bool</span>   do_refine;</div>
<div class="line">  <span class="keywordtype">double</span> shock_val;</div>
<div class="line">  <span class="keywordtype">double</span> shock_levels;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Refinement::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Whether to perform mesh refinement or not&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement fraction&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Fraction of high refinement&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;unrefinement fraction&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Fraction of low unrefinement&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max elements&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1000000&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;maximum number of elements&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock value&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;4.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;value for shock indicator&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock levels&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;3.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;number of shock refinement levels&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Refinement::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    do_refine    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">    shock_val    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock value&quot;</span>);</div>
<div class="line">    shock_levels = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock levels&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassParameterHandler_html_a6bb45dc67787e3fab7882461929b5fbe"><div class="ttname"><a href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">ParameterHandler::get_bool</a></div><div class="ttdeci">bool get_bool(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01113">parameter_handler.cc:1113</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Bool_html"><div class="ttname"><a href="classPatterns_1_1Bool.html">Patterns::Bool</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00981">patterns.h:982</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ParametersFlux"></a></p><h4>Parameters::Flux</h4>
<p><br  />
</p>
<p>接下来是关于通量修改的部分，使其更加稳定。特别是提供了两个选项来稳定Lax-Friedrichs通量：要么选择 \(\mathbf{H}(\mathbf{a},\mathbf{b},\mathbf{n}) = \frac{1}{2}(\mathbf{F}(\mathbf{a})\cdot \mathbf{n} + \mathbf{F}(\mathbf{b})\cdot \mathbf{n} + \alpha (\mathbf{a} - \mathbf{b}))\) ，其中 \(\alpha\) 是输入文件中指定的一个固定数字，要么 \(\alpha\) 是一个与网格有关的值。在后一种情况下，它被选择为 \(\frac{h}{2\delta T}\) ，其中 \(h\) 是应用通量的面的直径，而 \(\delta T\) 是当前的时间步长。</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Flux</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> StabilizationKind</div>
<div class="line">  {</div>
<div class="line">    constant,</div>
<div class="line">    mesh_dependent</div>
<div class="line">  };</div>
<div class="line">  StabilizationKind stabilization_kind;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> stabilization_value;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Flux::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;stab&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;constant|mesh&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;Whether to use a constant stabilization parameter or &quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;a mesh-dependent one&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;stab value&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;alpha stabilization&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Flux::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> std::string stab = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;stab&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;constant&quot;</span>)</div>
<div class="line">      stabilization_kind = constant;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;mesh&quot;</span>)</div>
<div class="line">      stabilization_kind = mesh_dependent;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    stabilization_value = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;stab value&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Exceptions_html_gafc0ca7ad85b3ebd64e8e51689ac85caf"><div class="ttname"><a href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a></div><div class="ttdeci">#define AssertThrow(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01583">exceptions.h:1583</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ParametersOutput"></a> </p><h4>Parameters::Output</h4>
<p><br  />
</p>
<p>然后是一个关于输出参数的部分。我们提供产生Schlieren图（密度的平方梯度，一种可视化冲击前沿的工具），以及图形输出的时间间隔，以防我们不希望每个时间步骤都有输出文件。</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Output</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">bool</span>   schlieren_plot;</div>
<div class="line">  <span class="keywordtype">double</span> output_step;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Output::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Whether or not to produce schlieren plots&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;step&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;-1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Output once per this period&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Output::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    schlieren_plot = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>);</div>
<div class="line">    output_step    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;step&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ParametersAllParameters"></a></p><h4>Parameters::AllParameters</h4>
<p><br  />
</p>
<p>最后是将这一切结合起来的类。它自己声明了一些参数，主要是参数文件顶层的参数，以及一些太小的部分，不值得自己的类。它还包含所有实际上与空间维度有关的东西，比如初始或边界条件。 <br  />
</p>
<p>由于这个类是由上面所有的类派生出来的， <code>declare_parameters()</code> and <code>parse_parameters()</code> 函数也会调用基类的相应函数。 <br  />
</p>
<p>请注意，这个类也处理输入文件中指定的初始和边界条件的声明。为此，在这两种情况下，都有像 "w_0值 "这样的条目，它代表了 \(x,y,z\) 方面的表达式，将初始或边界条件描述为一个公式，随后将由FunctionParser类来解析。类似的表达方式还有 "w_1"、"w_2 "等，表示欧拉系统的 <code>dim+2</code> 守恒变量。同样，我们允许在输入文件中最多使用 <code>max_n_boundaries</code> 个边界指标，这些边界指标中的每一个都可以与流入、流出或压力边界条件相关联，同质边界条件被分别指定给每个组件和每个边界指标。 <br  />
</p>
<p>用来存储边界指标的数据结构有点复杂。它是一个 <code>max_n_boundaries</code> 元素的数组，表示将被接受的边界指标的范围。对于这个数组中的每个条目，我们在 <code>BoundaryCondition</code> 结构中存储一对数据：首先是一个大小为 <code>n_components</code> 的数组，对于解向量的每个分量，表明它是流入、流出还是其他种类的边界，其次是一个FunctionParser对象，一次性描述这个边界ID的解向量的所有分量。 <br  />
</p>
<p><code>BoundaryCondition</code> 结构需要一个构造器，因为我们需要在构造时告诉函数解析器对象它要描述多少个向量分量。因此，这种初始化不能等到我们在后面的 <code>AllParameters::parse_parameters()</code> 中实际设置FunctionParser对象所代表的公式。 <br  />
</p>
<p>由于必须在构造时告诉Function对象其向量大小的同样原因，我们必须有一个 <code>AllParameters</code> 类的构造函数，至少要初始化另一个FunctionParser对象，即描述初始条件的对象。</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> Solver,</div>
<div class="line">                         <span class="keyword">public</span> Refinement,</div>
<div class="line">                         <span class="keyword">public</span> Flux,</div>
<div class="line">                         <span class="keyword">public</span> Output</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_n_boundaries = 10;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>BoundaryConditions</div>
<div class="line">    {</div>
<div class="line">      std::array&lt;typename EulerEquations&lt;dim&gt;::BoundaryKind,</div>
<div class="line">                 EulerEquations&lt;dim&gt;::n_components&gt;</div>
<div class="line">        kind;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      BoundaryConditions();</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    AllParameters();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> diffusion_power;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> time_step, final_time;</div>
<div class="line">    <span class="keywordtype">double</span> theta;</div>
<div class="line">    <span class="keywordtype">bool</span>   is_stationary;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::string mesh_filename;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> initial_conditions;</div>
<div class="line">    BoundaryConditions  boundary_conditions[max_n_boundaries];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  AllParameters&lt;dim&gt;::BoundaryConditions::BoundaryConditions()</div>
<div class="line">    : <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>(EulerEquations&lt;dim&gt;::n_components)</div>
<div class="line">  {</div>
<div class="line">    std::fill(kind.begin(),</div>
<div class="line">              kind.end(),</div>
<div class="line">              EulerEquations&lt;dim&gt;::no_penetration_boundary);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  AllParameters&lt;dim&gt;::AllParameters()</div>
<div class="line">    : diffusion_power(0.)</div>
<div class="line">    , time_step(1.)</div>
<div class="line">    , final_time(1.)</div>
<div class="line">    , theta(.5)</div>
<div class="line">    , is_stationary(true)</div>
<div class="line">    , initial_conditions(EulerEquations&lt;dim&gt;::n_components)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AllParameters&lt;dim&gt;::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;grid.inp&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;intput file name&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2.0&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;power of mesh size for diffusion&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;time step&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                        <span class="stringliteral">&quot;simulation time step&quot;</span>);</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;final time&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;10.0&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                        <span class="stringliteral">&quot;simulation end time&quot;</span>);</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;0.5&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0, 1),</div>
<div class="line">                        <span class="stringliteral">&quot;value for theta that interpolated between explicit &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Euler (theta=0), Crank-Nicolson (theta=0.5), and &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;implicit Euler (theta=1).&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a> &lt; max_n_boundaries; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>)</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>));</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;no penetration&quot;</span>,</div>
<div class="line">                            <span class="stringliteral">&quot;false&quot;</span>,</div>
<div class="line">                            <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                            <span class="stringliteral">&quot;whether the named boundary allows gas to &quot;</span></div>
<div class="line">                            <span class="stringliteral">&quot;penetrate or is a rigid wall&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; EulerEquations&lt;dim&gt;::n_components;</div>
<div class="line">               ++di)</div>
<div class="line">            {</div>
<div class="line">              prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di),</div>
<div class="line">                                <span class="stringliteral">&quot;outflow&quot;</span>,</div>
<div class="line">                                <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(</div>
<div class="line">                                  <span class="stringliteral">&quot;inflow|outflow|pressure&quot;</span>),</div>
<div class="line">                                <span class="stringliteral">&quot;&lt;inflow|outflow|pressure&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) +</div>
<div class="line">                                  <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                                <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                                <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                                <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; EulerEquations&lt;dim&gt;::n_components; ++di)</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    Parameters::Solver::declare_parameters(prm);</div>
<div class="line">    Parameters::Refinement::declare_parameters(prm);</div>
<div class="line">    Parameters::Flux::declare_parameters(prm);</div>
<div class="line">    Parameters::Output::declare_parameters(prm);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AllParameters&lt;dim&gt;::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    mesh_filename   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;mesh&quot;</span>);</div>
<div class="line">    diffusion_power = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      time_step = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;time step&quot;</span>);</div>
<div class="line">      <span class="keywordflow">if</span> (time_step == 0)</div>
<div class="line">        {</div>
<div class="line">          is_stationary = <span class="keyword">true</span>;</div>
<div class="line">          time_step     = 1.0;</div>
<div class="line">          final_time    = 1.0;</div>
<div class="line">        }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        is_stationary = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      final_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;final time&quot;</span>);</div>
<div class="line">      theta      = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 0; <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> &lt; max_n_boundaries;</div>
<div class="line">         ++<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>)</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> +</div>
<div class="line">                             <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>));</div>
<div class="line">        {</div>
<div class="line">          std::vector&lt;std::string&gt; expressions(</div>
<div class="line">            EulerEquations&lt;dim&gt;::n_components, <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">bool</span> no_penetration = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;no penetration&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; EulerEquations&lt;dim&gt;::n_components;</div>
<div class="line">               ++di)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> std::string boundary_type =</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">if</span> ((di &lt; dim) &amp;&amp; (no_penetration == <span class="keyword">true</span>))</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::no_penetration_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;inflow&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::inflow_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;pressure&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::pressure_boundary;</div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;outflow&quot;</span>)</div>
<div class="line">                boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind[di] =</div>
<div class="line">                  EulerEquations&lt;dim&gt;::outflow_boundary;</div>
<div class="line">              <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              expressions[di] =</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].values.initialize(</div>
<div class="line">            <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">            expressions,</div>
<div class="line">            std::map&lt;std::string, double&gt;());</div>
<div class="line">        }</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;std::string&gt; expressions(EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">                                           <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; EulerEquations&lt;dim&gt;::n_components; di++)</div>
<div class="line">        expressions[di] =</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">      initial_conditions.initialize(</div>
<div class="line">        <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">        expressions,</div>
<div class="line">        std::map&lt;std::string, double&gt;());</div>
<div class="line">    }</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    Parameters::Solver::parse_parameters(prm);</div>
<div class="line">    Parameters::Refinement::parse_parameters(prm);</div>
<div class="line">    Parameters::Flux::parse_parameters(prm);</div>
<div class="line">    Parameters::Output::parse_parameters(prm);</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Parameters</span></div>
<div class="ttc" id="aclassFunctionParser_html"><div class="ttname"><a href="classFunctionParser.html">FunctionParser</a></div><div class="ttdef"><b>Definition:</b> <a href="function__parser_8h_source.html#l00223">function_parser.h:224</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Anything_html"><div class="ttname"><a href="classPatterns_1_1Anything.html">Patterns::Anything</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l01022">patterns.h:1023</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a></div><div class="ttdeci">@ values</div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00051">evaluation_flags.h:51</a></div></div>
<div class="ttc" id="anamespaceUtilities_html_a6195c5f009ea8c7c536c6ffdf108c32f"><div class="ttname"><a href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></div><div class="ttdeci">std::string int_to_string(const unsigned int value, const unsigned int digits=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00473">utilities.cc:473</a></div></div>
<div class="ttc" id="anamespacetypes_html_aed8813fee8c8a2edcc6005e6a48c321a"><div class="ttname"><a href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">types::boundary_id</a></div><div class="ttdeci">unsigned int boundary_id</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00129">types.h:129</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Conservationlawclass"></a> </p><h3>Conservation law class</h3>
<p>这里终于出现了一个类，它实际上是对我们上面定义的所有欧拉方程和参数的具体内容做一些事情。公共接口与以往基本相同（构造函数现在需要一个文件名来读取参数，这个文件名在命令行中传递）。私有函数接口也与通常的安排非常相似， <code>assemble_system</code> 函数被分成三个部分：一个包含所有单元的主循环，然后分别调用另外两个单元和面的积分。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>ConservationLaw</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  ConservationLaw(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename);</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_cell_term(<span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">                          <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs);</div>
<div class="line">  <span class="keywordtype">void</span> assemble_face_term(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          face_no,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs_neighbor,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::pair&lt;unsigned int, double&gt; solve(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;solution);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> compute_refinement_indicators(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;indicator) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;indicator);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
<div class="ttc" id="aclassFEFaceValuesBase_html"><div class="ttname"><a href="classFEFaceValuesBase.html">FEFaceValuesBase</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l04044">fe_values.h:4045</a></div></div>
<div class="ttc" id="anamespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00691">work_stream.h:691</a></div></div>
</div><!-- fragment --><p>前面的几个成员变量也是相当标准的。请注意，我们定义了一个映射对象，在整个程序中组装术语时使用（我们将把它交给每个FEValues和FEFaceValues对象）；我们使用的映射只是标准的 \(Q_1\) 映射&ndash;换句话说，没有什么花哨的东西&ndash;但在这里声明一个映射并在整个程序中使用它将使以后在需要时改变它变得更简单。这实际上是相当相关的：众所周知，对于欧拉方程的跨音速模拟，如果边界近似没有足够高的阶数，计算甚至不能收敛 \(h\rightarrow 0\) 。</p>
<div class="fragment"><div class="line"><a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>   <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a> mapping;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a> fe;</div>
<div class="line"><a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>     dof_handler;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     quadrature;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt; face_quadrature;</div>
<div class="ttc" id="aclassFESystem_html"><div class="ttname"><a href="classFESystem.html">FESystem</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__system_8h_source.html#l00215">fe_system.h:216</a></div></div>
<div class="ttc" id="aclassMappingQ1_html"><div class="ttname"><a href="classMappingQ1.html">MappingQ1</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q1_8h_source.html#l00054">mapping_q1.h:55</a></div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00038">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01127">tria.h:1128</a></div></div>
<div class="ttc" id="ap4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
</div><!-- fragment --><p>接下来是一些数据向量，对应于前一个时间步骤的解（ <code>old_solution</code> ），当前解的最佳猜测（ <code>current_solution</code> ；我们说<em>guess</em>是因为计算它的牛顿迭代可能还没有收敛，而 <code>old_solution</code> 是指前一个时间步骤的完全收敛的最终结果），以及下一个时间步骤的解的预测器，通过将当前和前一个时间步骤的解推算到未来。</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> old_solution;</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> current_solution;</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> predictor;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> right_hand_side;</div>
</div><!-- fragment --><p>这最后一组成员变量（除了最下面的保存所有运行时参数的对象和一个屏幕输出流，它只在要求verbose输出时打印一些东西）处理我们在这个程序中与Trilinos库的接口，它为我们提供了线性求解器。与在 <a class="el" href="step_17.html">step-17</a> 和 <a class="el" href="step_18.html">step-18</a> 中包括PETSc矩阵类似，我们需要做的是创建一个Trilinos稀疏矩阵而不是标准的deal.II类。该系统矩阵在每个牛顿步骤中被用于雅各布系数。由于我们不打算并行运行这个程序（不过用Trilinos数据结构也不会太难），所以我们不必考虑其他的事情，比如分配自由度。</p>
<div class="fragment"><div class="line">  <a class="code" href="classTrilinosWrappers_1_1SparseMatrix.html">TrilinosWrappers::SparseMatrix</a> system_matrix;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  Parameters::AllParameters&lt;dim&gt; parameters;</div>
<div class="line">  <a class="code" href="classConditionalOStream.html">ConditionalOStream</a>             verbose_cout;</div>
<div class="line">};</div>
<div class="ttc" id="aclassConditionalOStream_html"><div class="ttname"><a href="classConditionalOStream.html">ConditionalOStream</a></div><div class="ttdef"><b>Definition:</b> <a href="conditional__ostream_8h_source.html#l00080">conditional_ostream.h:81</a></div></div>
<div class="ttc" id="aclassTrilinosWrappers_1_1SparseMatrix_html"><div class="ttname"><a href="classTrilinosWrappers_1_1SparseMatrix.html">TrilinosWrappers::SparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8h_source.html#l00510">trilinos_sparse_matrix.h:511</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawConservationLaw"></a></p><h4>ConservationLaw::ConservationLaw</h4>
<p><br  />
</p>
<p>关于构造函数没有什么可说的。基本上，它读取输入文件并将解析后的值填充到参数对象中。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">ConservationLaw&lt;dim&gt;::ConservationLaw(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename)</div>
<div class="line">  : mapping()</div>
<div class="line">  , fe(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;dim&gt;(1), EulerEquations&lt;dim&gt;::n_components)</div>
<div class="line">  , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , quadrature(fe.degree + 1)</div>
<div class="line">  , face_quadrature(fe.degree + 1)</div>
<div class="line">  , verbose_cout(std::cout, false)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">  Parameters::AllParameters&lt;dim&gt;::declare_parameters(prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_filename);</div>
<div class="line">  parameters.parse_parameters(prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  verbose_cout.set_condition(parameters.output ==</div>
<div class="line">                             Parameters::Solver::verbose);</div>
<div class="line">}</div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8h_source.html#l00548">fe_q.h:549</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a0ddaa05c5463c6c0b7701e18005717a9"><div class="ttname"><a href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">ParameterHandler::parse_input</a></div><div class="ttdeci">virtual void parse_input(std::istream &amp;input, const std::string &amp;filename=&quot;input file&quot;, const std::string &amp;last_line=&quot;&quot;, const bool skip_undefined=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00399">parameter_handler.cc:399</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawsetup_system"></a> </p><h4>ConservationLaw::setup_system</h4>
<p><br  />
</p>
<p>每次改变网格时，都会调用下面这个（简单）的函数。它所做的就是根据我们在之前所有的教程程序中生成的稀疏模式来调整特里诺斯矩阵的大小。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(), dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  system_matrix.reinit(dsp);</div>
<div class="line">}</div>
<div class="ttc" id="aclassDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="aclassDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamic__sparsity__pattern_8h_source.html#l00318">dynamic_sparsity_pattern.h:319</a></div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_system"></a> </p><h4>ConservationLaw::assemble_system</h4>
<p><br  />
</p>
<p>这个函数和下面的两个函数是这个程序的核心。它们将牛顿方法应用于非线性守恒方程组所产生的线性系统组装起来。 <br  />
</p>
<p>第一个函数将所有的装配部件放在一个例行程序中，为每个单元格/面派送正确的部件。 对这些对象的装配的实际实现是在下面的函数中完成的。 <br  />
</p>
<p>在函数的顶部，我们做了常规的内务处理：分配FEValues、FEFaceValues和FESubfaceValues对象，这些对象是在单元格、面和子面（在不同细化水平上的相邻单元的情况下）上进行积分所必需的。请注意，我们并不需要所有这些对象的所有信息（如值、梯度或正交点的实际位置），所以我们只让FEValues类通过指定最小的UpdateFlags集来获得实际需要的信息。例如，当使用邻接单元的FEFaceValues对象时，我们只需要形状值。给定一个特定的面，正交点和 <code>JxW</code> 值与当前单元的相同，法向量已知是当前单元的法向量的负值。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; dof_indices(dofs_per_cell);</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; dof_indices_neighbor(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> update_flags = <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                                   <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                                   <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>,</div>
<div class="line">                    face_update_flags =</div>
<div class="line">                      <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                      <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>,</div>
<div class="line">                    neighbor_face_update_flags = <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(mapping, fe, quadrature, update_flags);</div>
<div class="line">  <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face(mapping,</div>
<div class="line">                              fe,</div>
<div class="line">                              face_quadrature,</div>
<div class="line">                              face_update_flags);</div>
<div class="line">  <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface(mapping,</div>
<div class="line">                                    fe,</div>
<div class="line">                                    face_quadrature,</div>
<div class="line">                                    face_update_flags);</div>
<div class="line">  <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face_neighbor(mapping,</div>
<div class="line">                                       fe,</div>
<div class="line">                                       face_quadrature,</div>
<div class="line">                                       neighbor_face_update_flags);</div>
<div class="line">  <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface_neighbor(mapping,</div>
<div class="line">                                             fe,</div>
<div class="line">                                             face_quadrature,</div>
<div class="line">                                             neighbor_face_update_flags);</div>
<div class="ttc" id="aclassFEFaceValues_html"><div class="ttname"><a href="classFEFaceValues.html">FEFaceValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l04157">fe_values.h:4158</a></div></div>
<div class="ttc" id="aclassFESubfaceValues_html"><div class="ttname"><a href="classFESubfaceValues.html">FESubfaceValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l04323">fe_values.h:4324</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a></div><div class="ttdeci">@ update_normal_vectors</div><div class="ttdoc">Normal vectors.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00136">fe_update_flags.h:136</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00129">fe_update_flags.h:129</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00122">fe_update_flags.h:122</a></div></div>
</div><!-- fragment --><p>然后循环所有单元，初始化当前单元的FEValues对象，并调用在此单元上组装问题的函数。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">  {</div>
<div class="line">    fe_v.reinit(cell);</div>
<div class="line">    cell-&gt;get_dof_indices(dof_indices);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    assemble_cell_term(fe_v, dof_indices);</div>
</div><!-- fragment --><p>然后在这个单元格的所有面中循环。 如果一个面是外部边界的一部分，那么就在那里装配边界条件（ <code>assemble_face_terms</code> 的第五个参数表示我们是在外部面还是内部面工作；如果是外部面，表示邻居自由度指数的第四个参数被忽略，所以我们传递一个空矢量）。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> face_no : cell-&gt;face_indices())</div>
<div class="line">  <span class="keywordflow">if</span> (cell-&gt;at_boundary(face_no))</div>
<div class="line">    {</div>
<div class="line">      fe_v_face.reinit(cell, face_no);</div>
<div class="line">      assemble_face_term(face_no,</div>
<div class="line">                         fe_v_face,</div>
<div class="line">                         fe_v_face,</div>
<div class="line">                         dof_indices,</div>
<div class="line">                         std::vector&lt;types::global_dof_index&gt;(),</div>
<div class="line">                         <span class="keyword">true</span>,</div>
<div class="line">                         cell-&gt;face(face_no)-&gt;boundary_id(),</div>
<div class="line">                         cell-&gt;face(face_no)-&gt;diameter());</div>
<div class="line">    }</div>
</div><!-- fragment --><p>另一种情况是，我们正在处理一个内部面。我们需要区分两种情况：这是在同一细化水平的两个单元之间的正常面，以及它是不同细化水平的两个单元之间的面。 <br  />
</p>
<p>在第一种情况下，我们不需要做什么：我们使用的是连续有限元，在这种情况下，面条款不会出现在双线性表格中。在第二种情况下，如果我们强烈地执行悬挂节点约束，通常也不会导致面项的出现（就像迄今为止，只要我们使用连续有限元的所有教程程序一样&ndash;这种执行是由AffineConstraints类和 <a class="el" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>). 一起完成的）在当前的程序中，我们选择在不同细化水平的单元之间的面弱地执行连续性，原因有二。(i)因为我们可以，更重要的是(ii)因为我们必须通过AffineConstraints类的操作将我们用来计算牛顿矩阵元素的自动微分穿起来。这是有可能的，但不是微不足道的，所以我们选择了这种替代方法。 <br  />
</p>
<p>需要决定的是我们所处的两个不同细化水平的单元之间的接口的哪一边。 <br  />
</p>
<p>让我们来看看邻居首先是更精细的情况。然后，我们必须在当前单元的面的子代上进行循环，并在每个子代上进行整合。我们在代码中洒下几个断言，以确保我们试图找出邻居的哪个子面与当前单元格的某个子面重合的推理是正确的&ndash;有点防御性的编程总是无害的。 <br  />
</p>
<p>然后我们调用对面进行整合的函数；由于这是一个内部面，第五个参数是假的，第六个参数被忽略了，所以我们再次传递一个无效的值。</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (cell-&gt;neighbor(face_no)-&gt;has_children())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor2 =</div>
<div class="line">          cell-&gt;neighbor_of_neighbor(face_no);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> subface_no = 0;</div>
<div class="line">             subface_no &lt; cell-&gt;face(face_no)-&gt;n_children();</div>
<div class="line">             ++subface_no)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a></div>
<div class="line">              neighbor_child =</div>
<div class="line">                cell-&gt;neighbor_child_on_subface(face_no, subface_no);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;face(neighbor2) ==</div>
<div class="line">                     cell-&gt;face(face_no)-&gt;child(subface_no),</div>
<div class="line">                   <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;is_active(), <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            fe_v_subface.reinit(cell, face_no, subface_no);</div>
<div class="line">            fe_v_face_neighbor.reinit(neighbor_child, neighbor2);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            neighbor_child-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            assemble_face_term(</div>
<div class="line">              face_no,</div>
<div class="line">              fe_v_subface,</div>
<div class="line">              fe_v_face_neighbor,</div>
<div class="line">              dof_indices,</div>
<div class="line">              dof_indices_neighbor,</div>
<div class="line">              <span class="keyword">false</span>,</div>
<div class="line">              <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">              neighbor_child-&gt;face(neighbor2)-&gt;diameter());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="ttc" id="agroup__Iterators_html_ga6b8bbcafed8847f3030ea30c6990eb2d"><div class="ttname"><a href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler::active_cell_iterator</a></div><div class="ttdeci">typename ActiveSelector::active_cell_iterator active_cell_iterator</div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00438">dof_handler.h:438</a></div></div>
<div class="ttc" id="anamespacenumbers_html_a8ae36952c7e0cc778b47b5371b3aeff1"><div class="ttname"><a href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a></div><div class="ttdeci">static const unsigned int invalid_unsigned_int</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00196">types.h:196</a></div></div>
</div><!-- fragment --><p>我们必须关注的另一种可能性是邻居是否比当前单元更粗（特别是，由于每个面只有一个悬挂节点的通常限制，邻居必须正好比当前单元更粗一级，这是我们用断言检查的东西）。同样，我们在这个界面上进行整合。</p>
<div class="fragment"><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cell-&gt;neighbor(face_no)-&gt;level() != cell-&gt;level())</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga32b2a057d9abd2e1752bf8a3cb88e644">DoFHandler&lt;dim&gt;::cell_iterator</a> neighbor =</div>
<div class="line">                  cell-&gt;neighbor(face_no);</div>
<div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor-&gt;level() == cell-&gt;level() - 1,</div>
<div class="line">                       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">                neighbor-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">                <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; faceno_subfaceno =</div>
<div class="line">                  cell-&gt;neighbor_of_coarser_neighbor(face_no);</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor_face_no = faceno_subfaceno.first,</div>
<div class="line">                                   neighbor_subface_no =</div>
<div class="line">                                     faceno_subfaceno.second;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor-&gt;neighbor_child_on_subface(</div>
<div class="line">                         neighbor_face_no, neighbor_subface_no) == cell,</div>
<div class="line">                       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">                fe_v_face.reinit(cell, face_no);</div>
<div class="line">                fe_v_subface_neighbor.reinit(neighbor,</div>
<div class="line">                                             neighbor_face_no,</div>
<div class="line">                                             neighbor_subface_no);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">                assemble_face_term(face_no,</div>
<div class="line">                                   fe_v_face,</div>
<div class="line">                                   fe_v_subface_neighbor,</div>
<div class="line">                                   dof_indices,</div>
<div class="line">                                   dof_indices_neighbor,</div>
<div class="line">                                   <span class="keyword">false</span>,</div>
<div class="line">                                   <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                                   cell-&gt;face(face_no)-&gt;diameter());</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Iterators_html_ga32b2a057d9abd2e1752bf8a3cb88e644"><div class="ttname"><a href="group__Iterators.html#ga32b2a057d9abd2e1752bf8a3cb88e644">DoFHandler::cell_iterator</a></div><div class="ttdeci">typename ActiveSelector::cell_iterator cell_iterator</div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00466">dof_handler.h:466</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_cell_term"></a> </p><h4>ConservationLaw::assemble_cell_term</h4>
<p><br  />
</p>
<p>这个函数通过计算残差的单元部分来组合单元项，将其负数加到右手边的向量上，并将其相对于局部变量的导数加到雅各布系数（即牛顿矩阵）上。回顾一下，单元格对残差的贡献为 \(R_i = \left(\frac{\mathbf{w}^{k}_{n+1} - \mathbf{w}_n}{\delta t} , \mathbf{z}_i \right)_K \) \( + \theta \mathbf{B}(\mathbf{w}^{k}_{n+1})(\mathbf{z}_i)_K \) \( + (1-\theta) \mathbf{B}(\mathbf{w}_{n}) (\mathbf{z}_i)_K \) ，其中 \(\mathbf{B}(\mathbf{w})(\mathbf{z}_i)_K = - \left(\mathbf{F}(\mathbf{w}),\nabla\mathbf{z}_i\right)_K \) \( + h^{\eta}(\nabla \mathbf{w} , \nabla \mathbf{z}_i)_K \) \( - (\mathbf{G}(\mathbf {w}), \mathbf{z}_i)_K \) 为 \(\mathbf{w} = \mathbf{w}^k_{n+1}\) 和 \(\mathbf{w} = \mathbf{w}_{n}\) ， \(\mathbf{z}_i\) 为 \(i\) 第1个向量值的测试函数。此外，标量积 \(\left(\mathbf{F}(\mathbf{w}), \nabla\mathbf{z}_i\right)_K\) 可以理解为 \(\int_K \sum_{c=1}^{\text{n\_components}} \sum_{d=1}^{\text{dim}} \mathbf{F}(\mathbf{w})_{cd} \frac{\partial z^c_i}{x_d}\) ，其中 \(z^c_i\) 是 \(i\) 第1个测试函数的 \(c\) 分量。</p>
<p>在这个函数的顶部，我们做了一些常规的内务工作，即分配一些我们以后需要的局部变量。特别是，我们将分配一些变量，用于保存 \(k\) 次牛顿迭代后的当前解 \(W_{n+1}^k\) （变量 <code>W</code> ）和前一时间步长的解 \(W_{n}\) （变量 <code>W_old</code> ）的值。 <br  />
</p>
<p>除了这些之外，我们还需要当前变量的梯度。 我们必须计算这些是有点遗憾的，我们几乎不需要。 一个简单的守恒定律的好处是，通量一般不涉及任何梯度。 然而，我们确实需要这些，用于扩散稳定化。 <br  />
</p>
<p>我们存储这些变量的实际格式需要一些解释。首先，我们需要在每个正交点为解向量的 <code>EulerEquations::n_components</code> 分量取值。这就构成了一个二维表，我们使用deal.II的表类（这比 <code>std::vector&lt;std::vector&lt;T&gt; &gt;</code> 更有效，因为它只需要分配一次内存，而不是为外向量的每个元素分配一次）。同样地，梯度是一个三维表，Table类也支持。 <br  />
</p>
<p>其次，我们想使用自动微分。为此，我们使用 Sacado::Fad::DFad 模板来计算所有我们想计算导数的变量。这包括当前解和正交点的梯度（是自由度的线性组合），以及由它们计算出来的所有东西，如残差，但不包括前一个时间步长的解。这些变量都可以在函数的第一部分找到，同时还有一个变量，我们将用它来存储残差的一个分量的导数。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_cell_term(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; W(n_q_points,</div>
<div class="line">                                        EulerEquations&lt;dim&gt;::n_components);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> W_old(n_q_points, EulerEquations&lt;dim&gt;::n_components);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;3, Sacado::Fad::DFad&lt;double&gt;</a>&gt; grad_W(</div>
<div class="line">    n_q_points, EulerEquations&lt;dim&gt;::n_components, dim);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> grad_W_old(n_q_points,</div>
<div class="line">                              EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">                              dim);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;double&gt; residual_derivatives(dofs_per_cell);</div>
<div class="ttc" id="aclassFEValuesBase_html_a5b264d5b2fb6615f5dea7a21135ed1a5"><div class="ttname"><a href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">FEValuesBase::dofs_per_cell</a></div><div class="ttdeci">const unsigned int dofs_per_cell</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l02362">fe_values.h:2362</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_a807c3049bfe81743fc0f237dfc2fbdea"><div class="ttname"><a href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">FEValuesBase::n_quadrature_points</a></div><div class="ttdeci">const unsigned int n_quadrature_points</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l02344">fe_values.h:2344</a></div></div>
<div class="ttc" id="aclassTable_html"><div class="ttname"><a href="classTable.html">Table</a></div><div class="ttdef"><b>Definition:</b> <a href="table_8h_source.html#l00666">table.h:667</a></div></div>
</div><!-- fragment --><p>接下来，我们必须定义自变量，我们将尝试通过解决一个牛顿步骤来确定这些自变量。这些自变量是我们在这里提取的局部自由度的值。</p>
<div class="fragment"><div class="line">std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">  dofs_per_cell);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">  independent_local_dof_values[i] = current_solution(dof_indices[i]);</div>
</div><!-- fragment --><p>下一步包含了所有的魔力：我们宣布自分变量的一个子集为独立自由度，而所有其他的自由度仍然是依赖函数。这些正是刚刚提取的局部自由度。所有引用它们（直接或间接）的计算都将积累与这些变量有关的敏感度。 <br  />
</p>
<p>为了将这些变量标记为独立变量，下面的方法可以做到这一点，将 <code>independent_local_dof_values[i]</code> 标记为总共 <code>dofs_per_cell</code> 中的 \(i\) 个独立变量。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">  independent_local_dof_values[i].diff(i, dofs_per_cell);</div>
</div><!-- fragment --><p>在所有这些声明之后，让我们实际计算一些东西。首先， <code>W</code>, <code>W_old</code>, <code>grad_W</code> 和 <code>grad_W_old</code> 的值，我们可以通过使用公式 \(W(x_q)=\sum_i \mathbf W_i \Phi_i(x_q)\) 从本地DoF值计算出来，其中 \(\mathbf W_i\) 是（本地部分）解向量的 \(i\) 第1个条目，而 \(\Phi_i(x_q)\) 是在正交点 \(x_q\) 评估的第2个矢量值形状函数的值。梯度可以用类似的方法计算。 <br  />
</p>
<p>理想情况下，我们可以通过调用类似 <a class="el" href="classFEValuesBase.html#a357b422e374f2f2207af3512093f3907">FEValues::get_function_values</a> 和 <a class="el" href="classFEValuesBase.html#ad1f4e0deb5d982e8172d82141c634a67">FEValues::get_function_gradients</a>, 的东西来计算这些信息，但是由于（i）我们必须为此扩展FEValues类，（ii）我们不想让整个 <code>old_solution</code> 矢量fad类型，只有局部单元变量，我们明确编码上面的循环。在这之前，我们添加另一个循环，将所有的fad变量初始化为零。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; EulerEquations&lt;dim&gt;::n_components; ++c)</div>
<div class="line">    {</div>
<div class="line">      W[q][c]     = 0;</div>
<div class="line">      W_old[q][c] = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        {</div>
<div class="line">          grad_W[q][c][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]     = 0;</div>
<div class="line">          grad_W_old[q][c][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c =</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      W[q][c] += independent_local_dof_values[i] *</div>
<div class="line">                 fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, c);</div>
<div class="line">      W_old[q][c] +=</div>
<div class="line">        old_solution(dof_indices[i]) * fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, c);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>++)</div>
<div class="line">        {</div>
<div class="line">          grad_W[q][c][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] += independent_local_dof_values[i] *</div>
<div class="line">                             fe_v.<a class="code" href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">shape_grad_component</a>(i, q, c)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">          grad_W_old[q][c][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] += old_solution(dof_indices[i]) *</div>
<div class="line">                                 fe_v.<a class="code" href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">shape_grad_component</a>(i, q, c)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="ttc" id="aclassFEValuesBase_html_a71e93aa182f3acd34abd020538f3bc39"><div class="ttname"><a href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">FEValuesBase::shape_grad_component</a></div><div class="ttdeci">Tensor&lt; 1, spacedim &gt; shape_grad_component(const unsigned int function_no, const unsigned int point_no, const unsigned int component) const</div></div>
<div class="ttc" id="aclassFEValuesBase_html_aa57a7e777b0798ec009b4ce888ad9574"><div class="ttname"><a href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">FEValuesBase::shape_value_component</a></div><div class="ttdeci">double shape_value_component(const unsigned int function_no, const unsigned int point_no, const unsigned int component) const</div></div>
<div class="ttc" id="aclassFEValuesBase_html_ade22ffd9fb5b07842daa504929244aa7"><div class="ttname"><a href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">FEValuesBase::get_fe</a></div><div class="ttdeci">const FiniteElement&lt; dim, spacedim &gt; &amp; get_fe() const</div></div>
<div class="ttc" id="aclassFiniteElement_html_a23200d54e40cd719a183d47b6cfb719f"><div class="ttname"><a href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">FiniteElement::system_to_component_index</a></div><div class="ttdeci">std::pair&lt; unsigned int, unsigned int &gt; system_to_component_index(const unsigned int index) const</div></div>
</div><!-- fragment --><p>接下来，为了计算单元贡献，我们需要在所有正交点评估 \(\mathbf{F}({\mathbf w}^k_{n+1})\) , \(\mathbf{G}({\mathbf w}^k_{n+1})\) 和 \(\mathbf{F}({\mathbf w}_n)\) , \(\mathbf{G}({\mathbf w}_n)\) 。为了存储这些，我们还需要分配一点内存。请注意，我们以自分变量的方式计算通量矩阵和右手边，这样以后就可以很容易地从中计算出雅各布贡献。</p>
<div class="fragment"><div class="line">std::vector&lt;ndarray&lt;Sacado::Fad::DFad&lt;double&gt;,</div>
<div class="line">                    EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">                    dim&gt;&gt;</div>
<div class="line">  flux(n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::vector&lt;ndarray&lt;double, EulerEquations&lt;dim&gt;::n_components, dim&gt;&gt;</div>
<div class="line">  flux_old(n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::vector&lt;</div>
<div class="line">  std::array&lt;Sacado::Fad::DFad&lt;double&gt;, EulerEquations&lt;dim&gt;::n_components&gt;&gt;</div>
<div class="line">  forcing(n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components&gt;&gt;</div>
<div class="line">  forcing_old(n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">  {</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_flux_matrix(W_old[q], flux_old[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_forcing_vector(W_old[q], forcing_old[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_flux_matrix(W[q], flux[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_forcing_vector(W[q], forcing[q]);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>我们现在已经有了所有的部件，所以要进行组装。 我们有一个通过系统组件的外循环，和一个通过正交点的内循环，在那里我们积累了对 \(i\) 第三残差的贡献 \(R_i\) 。这个残差的一般公式在引言和本函数的顶部给出。然而，考虑到 \(i\) 第三个（矢量值）测试函数 \(\mathbf{z}_i\) 实际上只有一个非零分量，我们可以将其简化一下（关于这个主题的更多内容可以在 <a class="el" href="group__vector__valued.html">Handling vector valued problems</a> 模块中找到）。它将由下面的变量 <code>component_i</code> 表示。有了这个，残差项可以重新写成 </p><p class="formulaDsp">
\begin{eqnarray*} R_i &amp;=&amp; \left(\frac{(\mathbf{w}_{n+1} - \mathbf{w}_n)_{\text{component\_i}}}{\delta t},(\mathbf{z}_i)_{\text{component\_i}}\right)_K \\ &amp;-&amp; \sum_{d=1}^{\text{dim}} \left( \theta \mathbf{F} ({\mathbf{w}^k_{n+1}})_{\text{component\_i},d} + (1-\theta) \mathbf{F} ({\mathbf{w}_{n}})_{\text{component\_i},d} , \frac{\partial(\mathbf{z}_i)_{\text{component\_i}}} {\partial x_d}\right)_K \\ &amp;+&amp; \sum_{d=1}^{\text{dim}} h^{\eta} \left( \theta \frac{\partial (\mathbf{w}^k_{n+1})_{\text{component\_i}}}{\partial x_d} + (1-\theta) \frac{\partial (\mathbf{w}_n)_{\text{component\_i}}}{\partial x_d} , \frac{\partial (\mathbf{z}_i)_{\text{component\_i}}}{\partial x_d} \right)_K \\ &amp;-&amp; \left( \theta\mathbf{G}({\mathbf{w}^k_n+1} )_{\text{component\_i}} + (1-\theta)\mathbf{G}({\mathbf{w}_n})_{\text{component\_i}} , (\mathbf{z}_i)_{\text{component\_i}} \right)_K , \end{eqnarray*}
</p>
<p>其中积分可以理解为通过对正交点求和来评估。 <br  />
</p>
<p>我们最初对残差的所有贡献进行正意义上的求和，这样我们就不需要对雅各布项进行负数。 然后，当我们对 <code>right_hand_side</code> 矢量求和时，我们要否定这个残差。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>; ++i)</div>
<div class="line">  {</div>
<div class="line">    Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
</div><!-- fragment --><p>每一行（i）的残差将累积到这个fad变量中。 在这一行的装配结束时，我们将查询这个变量的敏感度，并将其加入到雅各布系数中。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> = 0; <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> &lt; fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>; ++<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (parameters.is_stationary == <span class="keyword">false</span>)</div>
<div class="line">      R_i += 1.0 / parameters.time_step *</div>
<div class="line">             (W[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i] - W_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i]) *</div>
<div class="line">             fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i) *</div>
<div class="line">             fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>++)</div>
<div class="line">      R_i -=</div>
<div class="line">        (parameters.theta * flux[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] +</div>
<div class="line">         (1.0 - parameters.theta) * flux_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]) *</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">shape_grad_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] *</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>++)</div>
<div class="line">      R_i +=</div>
<div class="line">        1.0 *</div>
<div class="line">        std::pow(fe_v.<a class="code" href="classFEValuesBase.html#a9d3a1c53c139e2553b672de682d6233e">get_cell</a>()-&gt;diameter(),</div>
<div class="line">                 parameters.diffusion_power) *</div>
<div class="line">        (parameters.theta * grad_W[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] +</div>
<div class="line">         (1.0 - parameters.theta) * grad_W_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]) *</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">shape_grad_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] *</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    R_i -=</div>
<div class="line">      (parameters.theta * forcing[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i] +</div>
<div class="line">       (1.0 - parameters.theta) * forcing_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i]) *</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i) *</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line">  }</div>
<div class="ttc" id="aclassFEValuesBase_html_a9d3a1c53c139e2553b672de682d6233e"><div class="ttname"><a href="classFEValuesBase.html#a9d3a1c53c139e2553b672de682d6233e">FEValuesBase::get_cell</a></div><div class="ttdeci">const Triangulation&lt; dim, spacedim &gt;::cell_iterator get_cell() const</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8cc_source.html#l04141">fe_values.cc:4141</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_abade89efb068b71b7ced7082012a2441"><div class="ttname"><a href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">FEValuesBase::JxW</a></div><div class="ttdeci">double JxW(const unsigned int quadrature_point) const</div></div>
<div class="ttc" id="anamespaceOpenCASCADE_html_a7b0b2393711bae58d859be1bb9761781"><div class="ttname"><a href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">OpenCASCADE::point</a></div><div class="ttdeci">Point&lt; spacedim &gt; point(const gp_Pnt &amp;p, const double tolerance=1e-10)</div><div class="ttdef"><b>Definition:</b> <a href="opencascade_2utilities_8cc_source.html#l00188">utilities.cc:188</a></div></div>
</div><!-- fragment --><p>在循环结束时，我们要把敏感度加入到矩阵中，并从右手边减去残差。Trilinos FAD数据类型让我们可以使用 <code>R_i.fastAccessDx(k)</code> 访问导数，因此我们将数据存储在一个临时数组中。然后，这些关于整行局部道夫的信息被一次性添加到特里诺斯矩阵中（支持我们选择的数据类型）。</p>
<div class="fragment"><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">        residual_derivatives[k] = R_i.fastAccessDx(k);</div>
<div class="line">      system_matrix.add(dof_indices[i], dof_indices, residual_derivatives);</div>
<div class="line">      right_hand_side(dof_indices[i]) -= R_i.val();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawassemble_face_term"></a> </p><h4>ConservationLaw::assemble_face_term</h4>
<p><br  />
</p>
<p>在这里，我们的做法与前一个函数基本相同。在顶部，我们引入自变量。因为如果我们在两个单元之间的内部面上工作，也会使用当前的函数，所以自变量不仅是当前单元上的自由度，而且在内部面上的情况下，也是邻近单元上的自由度。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_face_term(</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          face_no,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices,</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices_neighbor,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">    dofs_per_cell),</div>
<div class="line">    independent_neighbor_dof_values(external_face == <span class="keyword">false</span> ? dofs_per_cell :</div>
<div class="line">                                                             0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_independent_variables =</div>
<div class="line">    (external_face == <span class="keyword">false</span> ? 2 * dofs_per_cell : dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; i++)</div>
<div class="line">    {</div>
<div class="line">      independent_local_dof_values[i] = current_solution(dof_indices[i]);</div>
<div class="line">      independent_local_dof_values[i].diff(i, n_independent_variables);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; i++)</div>
<div class="line">      {</div>
<div class="line">        independent_neighbor_dof_values[i] =</div>
<div class="line">          current_solution(dof_indices_neighbor[i]);</div>
<div class="line">        independent_neighbor_dof_values[i].diff(i + dofs_per_cell,</div>
<div class="line">                                                n_independent_variables);</div>
<div class="line">      }</div>
</div><!-- fragment --><p>接下来，我们需要定义保守变量 \({\mathbf W}\) 在面的这一侧（ \( {\mathbf W}^+\) ）和另一侧（ \({\mathbf W}^-\) ）的值，对于 \({\mathbf W} = {\mathbf W}^k_{n+1}\) 和 \({\mathbf W} = {\mathbf W}_n\) 。"这一边 "的值可以用与前一个函数完全相同的方式计算，但注意 <code>fe_v</code> 变量现在是FEFaceValues或FESubfaceValues的类型。</p>
<div class="fragment"><div class="line"><a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; Wplus(</div>
<div class="line">  n_q_points, EulerEquations&lt;dim&gt;::n_components),</div>
<div class="line">  Wminus(n_q_points, EulerEquations&lt;dim&gt;::n_components);</div>
<div class="line"><a class="code" href="classTable.html">Table&lt;2, double&gt;</a> Wplus_old(n_q_points, EulerEquations&lt;dim&gt;::n_components),</div>
<div class="line">  Wminus_old(n_q_points, EulerEquations&lt;dim&gt;::n_components);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">      Wplus[q][component_i] +=</div>
<div class="line">        independent_local_dof_values[i] *</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, component_i);</div>
<div class="line">      Wplus_old[q][component_i] +=</div>
<div class="line">        old_solution(dof_indices[i]) *</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, component_i);</div>
<div class="line">    }</div>
</div><!-- fragment --><p>计算 "对立面 "要复杂一些。如果这是一个内部面，我们可以像上面那样，简单地使用邻居的独立变量来计算它。</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">          Wminus[q][component_i] +=</div>
<div class="line">            independent_neighbor_dof_values[i] *</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, component_i);</div>
<div class="line">          Wminus_old[q][component_i] +=</div>
<div class="line">            old_solution(dof_indices_neighbor[i]) *</div>
<div class="line">            fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, component_i);</div>
<div class="line">        }</div>
<div class="line">  }</div>
</div><!-- fragment --><p>另一方面，如果这是一个外部边界面，那么 \(\mathbf{W}^-\) 的值将是 \(\mathbf{W}^+\) 的函数，或者它们将是规定的，取决于这里施加的边界条件的种类。 <br  />
</p>
<p>为了开始评估，让我们确保为这个边界指定的边界ID是我们在参数对象中实际有数据的一个。接下来，我们对不均匀性的函数对象进行评估。 这有点棘手：一个给定的边界可能同时有规定的和隐含的值。 如果一个特定的成分没有被规定，那么这些值就会被评估为零，并在下面被忽略。 <br  />
</p>
<p>其余的由一个实际上知道欧拉方程边界条件具体内容的函数来完成。请注意，由于我们在这里使用的是fad变量，敏感度将被适当地更新，否则这个过程将是非常复杂的。</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> &lt; Parameters::AllParameters&lt;dim&gt;::max_n_boundaries,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                         0,</div>
<div class="line">                         Parameters::AllParameters&lt;dim&gt;::max_n_boundaries));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; boundary_values(</div>
<div class="line">      n_q_points, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>(EulerEquations&lt;dim&gt;::n_components));</div>
<div class="line">    parameters.boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].values.vector_value_list(</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ae41b67cfd48e02f6035e39c84f0fb47a">get_quadrature_points</a>(), boundary_values);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; q++)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">          parameters.boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind,</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">          Wplus[q],</div>
<div class="line">          boundary_values[q],</div>
<div class="line">          Wminus[q]);</div>
<div class="ttc" id="aclassFEValuesBase_html_ac25ec6835799c3b6c7c842f8acb05eb3"><div class="ttname"><a href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">FEValuesBase::normal_vector</a></div><div class="ttdeci">const Tensor&lt; 1, spacedim &gt; &amp; normal_vector(const unsigned int i) const</div></div>
<div class="ttc" id="aclassFEValuesBase_html_ae41b67cfd48e02f6035e39c84f0fb47a"><div class="ttname"><a href="classFEValuesBase.html#ae41b67cfd48e02f6035e39c84f0fb47a">FEValuesBase::get_quadrature_points</a></div><div class="ttdeci">const std::vector&lt; Point&lt; spacedim &gt; &gt; &amp; get_quadrature_points() const</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga0d685aad996180f9851183ae3e29019a"><div class="ttname"><a href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">StandardExceptions::ExcIndexRange</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcIndexRange(int arg1, int arg2, int arg3)</div></div>
</div><!-- fragment --><p>这里我们假设边界类型、边界法向量和边界数据值在时间推进中保持不变。</p>
<div class="fragment"><div class="line">      EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">        parameters.boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind,</div>
<div class="line">        fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">        Wplus_old[q],</div>
<div class="line">        boundary_values[q],</div>
<div class="line">        Wminus_old[q]);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>现在我们有了 \(\mathbf w^+\) 和 \(\mathbf w^-\) ，我们可以去计算每个正交点的数值流量函数 \(\mathbf H(\mathbf w^+,\mathbf w^-, \mathbf n)\) 。在调用这个函数之前，我们还需要确定Lax-Friedrich的稳定参数。</p>
<div class="fragment"><div class="line">std::vector&lt;</div>
<div class="line">  std::array&lt;Sacado::Fad::DFad&lt;double&gt;, EulerEquations&lt;dim&gt;::n_components&gt;&gt;</div>
<div class="line">  normal_fluxes(n_q_points);</div>
<div class="line">std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components&gt;&gt;</div>
<div class="line">  normal_fluxes_old(n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> alpha;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">switch</span> (parameters.stabilization_kind)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> Parameters::Flux::constant:</div>
<div class="line">      alpha = parameters.stabilization_value;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> Parameters::Flux::mesh_dependent:</div>
<div class="line">      alpha = face_diameter / (2.0 * parameters.time_step);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">      alpha = 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">  {</div>
<div class="line">    EulerEquations&lt;dim&gt;::numerical_normal_flux(</div>
<div class="line">      fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q), Wplus[q], Wminus[q], alpha, normal_fluxes[q]);</div>
<div class="line">    EulerEquations&lt;dim&gt;::numerical_normal_flux(fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">                                               Wplus_old[q],</div>
<div class="line">                                               Wminus_old[q],</div>
<div class="line">                                               alpha,</div>
<div class="line">                                               normal_fluxes_old[q]);</div>
<div class="line">  }</div>
</div><!-- fragment --><p>现在以与前一个函数中的单元贡献完全相同的方式组装面项。唯一的区别是，如果这是一个内部面，我们还必须考虑到残余贡献对邻近单元自由度的敏感性。</p>
<div class="fragment"><div class="line">  std::vector&lt;double&gt; residual_derivatives(dofs_per_cell);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>; ++i)</div>
<div class="line">    <span class="keywordflow">if</span> (fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a68dc9f085edbcd92f8d0703d3e5fce6f">has_support_on_face</a>(i, face_no) == <span class="keyword">true</span>)</div>
<div class="line">      {</div>
<div class="line">        Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> = 0; <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> &lt; n_q_points; ++<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            R_i += (parameters.theta * normal_fluxes[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i] +</div>
<div class="line">                    (1.0 - parameters.theta) *</div>
<div class="line">                      normal_fluxes_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i]) *</div>
<div class="line">                   fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i) *</div>
<div class="line">                   fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">          residual_derivatives[k] = R_i.fastAccessDx(k);</div>
<div class="line">        system_matrix.add(dof_indices[i], dof_indices, residual_derivatives);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">              residual_derivatives[k] = R_i.fastAccessDx(dofs_per_cell + k);</div>
<div class="line">            system_matrix.add(dof_indices[i],</div>
<div class="line">                              dof_indices_neighbor,</div>
<div class="line">                              residual_derivatives);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        right_hand_side(dof_indices[i]) -= R_i.val();</div>
<div class="line">      }</div>
<div class="line">}</div>
<div class="ttc" id="aclassFiniteElement_html_a68dc9f085edbcd92f8d0703d3e5fce6f"><div class="ttname"><a href="classFiniteElement.html#a68dc9f085edbcd92f8d0703d3e5fce6f">FiniteElement::has_support_on_face</a></div><div class="ttdeci">virtual bool has_support_on_face(const unsigned int shape_index, const unsigned int face_index) const</div></div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawsolve"></a> </p><h4>ConservationLaw::solve</h4>
<p><br  />
</p>
<p>在这里，我们实际解决了线性系统，使用Trilinos的Aztec或Amesos线性求解器。计算的结果将被写入传递给这个函数的参数向量中。其结果是一对迭代次数和最终的线性残差。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::pair&lt;unsigned int, double&gt;</div>
<div class="line">ConservationLaw&lt;dim&gt;::solve(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span> (parameters.solver)</div>
<div class="line">    {</div>
</div><!-- fragment --><p>如果参数文件中指定应使用直接求解器，那么我们就会到这里。这个过程很简单，因为deal.II在Trilinos中提供了一个对Amesos直接求解器的封装类。我们所要做的就是创建一个求解器控制对象（这里只是一个假对象，因为我们不会进行任何迭代），然后创建直接求解器对象。在实际进行求解时，注意我们没有传递一个预处理程序。无论如何，这对直接求解器来说没有什么意义。 最后，我们返回求解器的控制统计信息&amp;mdash；它将告诉我们没有进行过迭代，并且最终的线性残差为零，这里没有任何可能提供的更好的信息。</p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> Parameters::Solver::direct:</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>                                  solver_control(1, 0);</div>
<div class="line">    <a class="code" href="structTrilinosWrappers_1_1SolverDirect_1_1AdditionalData.html">TrilinosWrappers::SolverDirect::AdditionalData</a> data(</div>
<div class="line">      parameters.output == Parameters::Solver::verbose);</div>
<div class="line">    <a class="code" href="classTrilinosWrappers_1_1SolverDirect.html">TrilinosWrappers::SolverDirect</a> direct(solver_control, data);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    direct.solve(system_matrix, newton_update, right_hand_side);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> {solver_control.last_step(), solver_control.last_value()};</div>
<div class="line">  }</div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00065">solver_control.h:66</a></div></div>
<div class="ttc" id="aclassTrilinosWrappers_1_1SolverDirect_html"><div class="ttname"><a href="classTrilinosWrappers_1_1SolverDirect.html">TrilinosWrappers::SolverDirect</a></div><div class="ttdef"><b>Definition:</b> <a href="trilinos__solver_8h_source.html#l00561">trilinos_solver.h:562</a></div></div>
<div class="ttc" id="astructTrilinosWrappers_1_1SolverDirect_1_1AdditionalData_html"><div class="ttname"><a href="structTrilinosWrappers_1_1SolverDirect_1_1AdditionalData.html">TrilinosWrappers::SolverDirect::AdditionalData</a></div><div class="ttdef"><b>Definition:</b> <a href="trilinos__solver_8h_source.html#l00568">trilinos_solver.h:569</a></div></div>
</div><!-- fragment --><p>同样地，如果我们要使用迭代求解器，我们使用Aztec的GMRES求解器。我们也可以在这里使用Trilinos的迭代求解器和预处理类，但我们选择直接使用Aztec求解器。对于给定的问题，Aztec的内部预处理实现优于deal.II的包装类，所以我们在AztecOO求解器中使用ILU-T预处理，并设置了一堆可以从参数文件中修改的选项。 <br  />
</p>
<p>还有两个实际问题。由于我们将右手边和求解向量建立为deal.II向量对象（而不是矩阵，后者是一个Trilinos对象），我们必须将Trilinos Epetra向量交给求解器。 幸运的是，他们支持 "视图 "的概念，所以我们只需发送一个指向deal.II向量的指针。我们必须为设置平行分布的向量提供一个Epetra_Map，这只是一个串行的假对象。最简单的方法是要求矩阵提供它的地图，我们要用它为矩阵-向量乘积做好准备。 <br  />
</p>
<p>其次，Aztec求解器要我们传入一个Trilinos Epetra_CrsMatrix，而不是 deal.II包装类本身。所以我们通过trilinos_matrix()命令来访问Trilinos包装类中的实际Trilinos矩阵。Trilinos希望矩阵是非常量的，所以我们必须用const_cast手动删除常量。</p>
<div class="fragment"><div class="line">      <span class="keywordflow">case</span> Parameters::Solver::gmres:</div>
<div class="line">        {</div>
<div class="line">          Epetra_Vector x(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                          system_matrix.trilinos_matrix().DomainMap(),</div>
<div class="line">                          newton_update.<a class="code" href="group__Vectors.html#gaf34b888fe493ef2ed188179de69ad7ed">begin</a>());</div>
<div class="line">          Epetra_Vector <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                          system_matrix.trilinos_matrix().RangeMap(),</div>
<div class="line">                          right_hand_side.begin());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          AztecOO solver;</div>
<div class="line">          solver.SetAztecOption(</div>
<div class="line">            AZ_output,</div>
<div class="line">            (parameters.output == Parameters::Solver::quiet ? AZ_none :</div>
<div class="line">                                                              AZ_all));</div>
<div class="line">          solver.SetAztecOption(AZ_solver, AZ_gmres);</div>
<div class="line">          solver.SetRHS(&amp;<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>);</div>
<div class="line">          solver.SetLHS(&amp;x);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          solver.SetAztecOption(AZ_precond, AZ_dom_decomp);</div>
<div class="line">          solver.SetAztecOption(AZ_subdomain_solve, AZ_ilut);</div>
<div class="line">          solver.SetAztecOption(AZ_overlap, 0);</div>
<div class="line">          solver.SetAztecOption(AZ_reorder, 0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          solver.SetAztecParam(AZ_drop, parameters.ilut_drop);</div>
<div class="line">          solver.SetAztecParam(AZ_ilut_fill, parameters.ilut_fill);</div>
<div class="line">          solver.SetAztecParam(AZ_athresh, parameters.ilut_atol);</div>
<div class="line">          solver.SetAztecParam(AZ_rthresh, parameters.ilut_rtol);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          solver.SetUserMatrix(</div>
<div class="line">            <span class="keyword">const_cast&lt;</span>Epetra_CrsMatrix *<span class="keyword">&gt;</span>(&amp;system_matrix.trilinos_matrix()));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          solver.Iterate(parameters.max_iterations,</div>
<div class="line">                         parameters.linear_residual);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">return</span> {solver.NumIters(), solver.TrueResidual()};</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  <span class="keywordflow">return</span> {0, 0};</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Vectors_html_gaf34b888fe493ef2ed188179de69ad7ed"><div class="ttname"><a href="group__Vectors.html#gaf34b888fe493ef2ed188179de69ad7ed">Vector::begin</a></div><div class="ttdeci">iterator begin()</div></div>
<div class="ttc" id="anamespaceFEValuesViews_html_af2099b26234f5816729f7f6dc523dc0f"><div class="ttname"><a href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">FEValuesViews::View</a></div><div class="ttdeci">typename ::internal::FEValuesViews::ViewType&lt; dim, spacedim, Extractor &gt;::type View</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l02219">fe_values.h:2220</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawcompute_refinement_indicators"></a></p><h4>ConservationLaw::compute_refinement_indicators</h4>
<p>这个函数是非常简单的。我们在这里并不假装知道一个好的细化指标会是什么。相反，我们假设 <code>EulerEquation</code> 类会知道这一点，所以我们只是服从于我们在那里实现的相应函数。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::compute_refinement_indicators(</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  EulerEquations&lt;dim&gt;::compute_refinement_indicators(dof_handler,</div>
<div class="line">                                                     mapping,</div>
<div class="line">                                                     predictor,</div>
<div class="line">                                                     refinement_indicators);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawrefine_grid"></a> </p><h4>ConservationLaw::refine_grid</h4>
<p>在这里，我们使用之前计算的细化指标来细化网格。在开始的时候，我们在所有的单元上循环，并标记那些我们认为应该被细化的单元。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">ConservationLaw&lt;dim&gt;::refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = cell-&gt;active_cell_index();</div>
<div class="line">      cell-&gt;clear_coarsen_flag();</div>
<div class="line">      cell-&gt;clear_refine_flag();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((cell-&gt;level() &lt; parameters.shock_levels) &amp;&amp;</div>
<div class="line">          (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &gt; parameters.shock_val))</div>
<div class="line">        cell-&gt;set_refine_flag();</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cell-&gt;level() &gt; 0) &amp;&amp;</div>
<div class="line">               (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &lt;</div>
<div class="line">                0.75 * parameters.shock_val))</div>
<div class="line">        cell-&gt;set_coarsen_flag();</div>
<div class="line">    }</div>
<div class="ttc" id="anamespaceDifferentiation_1_1SD_html_a592560ee80355620422a86087f11b9df"><div class="ttname"><a href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">Differentiation::SD::fabs</a></div><div class="ttdeci">Expression fabs(const Expression &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="symengine__math_8cc_source.html#l00273">symengine_math.cc:273</a></div></div>
</div><!-- fragment --><p>然后，我们需要在进行细化的同时，将各种解向量从旧网格转移到新网格。SolutionTransfer类是我们的朋友；它有相当丰富的文档，包括例子，所以我们不会对下面的代码做太多评论。最后三行只是将其他一些向量的大小重新设置为现在的正确大小。</p>
<div class="fragment"><div class="line">  std::vector&lt;Vector&lt;double&gt;&gt; transfer_in;</div>
<div class="line">  std::vector&lt;Vector&lt;double&gt;&gt; transfer_out;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  transfer_in.push_back(old_solution);</div>
<div class="line">  transfer_in.push_back(predictor);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line">  soltrans.prepare_for_coarsening_and_refinement(transfer_in);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_old_solution(1);</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_predictor(1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    transfer_out.push_back(new_old_solution);</div>
<div class="line">    transfer_out.push_back(new_predictor);</div>
<div class="line">    transfer_out[0].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    transfer_out[1].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  soltrans.interpolate(transfer_in, transfer_out);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  old_solution.reinit(transfer_out[0].size());</div>
<div class="line">  old_solution = transfer_out[0];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  predictor.reinit(transfer_out[1].size());</div>
<div class="line">  predictor = transfer_out[1];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  current_solution = old_solution;</div>
<div class="line">  right_hand_side.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">}</div>
<div class="ttc" id="aclassDoFHandler_html_a553ca864aaf70330d9be86bc78f36d1e"><div class="ttname"><a href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">DoFHandler::distribute_dofs</a></div><div class="ttdeci">void distribute_dofs(const FiniteElement&lt; dim, spacedim &gt; &amp;fe)</div></div>
<div class="ttc" id="aclassDoFHandler_html_ad316958f8045d9a48094335b23a03a53"><div class="ttname"><a href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">DoFHandler::clear</a></div><div class="ttdeci">void clear()</div></div>
<div class="ttc" id="aclassSolutionTransfer_html"><div class="ttname"><a href="classSolutionTransfer.html">SolutionTransfer</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2solution__transfer_8h_source.html#l00338">solution_transfer.h:339</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawoutput_results"></a> </p><h4>ConservationLaw::output_results</h4>
<p>这个函数现在是相当直接的。所有的魔法，包括将数据从保守变量转化为物理变量，都已经被抽象化，并被移到EulerEquations类中，以便在我们想要解决其他双曲守恒定律时可以被替换。 <br  />
</p>
<p>请注意，输出文件的数量是通过保持一个静态变量形式的计数器来确定的，这个计数器在我们第一次来到这个函数时被设置为零，并在每次调用结束时被增加一。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">typename</span> EulerEquations&lt;dim&gt;::Postprocessor postprocessor(</div>
<div class="line">    parameters.schlieren_plot);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(current_solution,</div>
<div class="line">                           EulerEquations&lt;dim&gt;::component_names(),</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                           EulerEquations&lt;dim&gt;::component_interpretation());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(current_solution, postprocessor);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_file_number = 0;</div>
<div class="line">  std::string         filename =</div>
<div class="line">    <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(output_file_number, 3) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line">  std::ofstream output(filename);</div>
<div class="line">  data_out.<a class="code" href="group__Exceptions.html#gacad99726038e4fca7f605fdffb3317e4">write_vtk</a>(output);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  ++output_file_number;</div>
<div class="line">}</div>
<div class="ttc" id="aclassDataOut__DoFData_html_ac1eb26168177faa30ffbcf9cbb9c3cd5"><div class="ttname"><a href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandlerType &amp;)</div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_ace4b76e565ba0701c4d32c26075ed3b9"><div class="ttname"><a href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="data__out__dof__data_8h_source.html#l01087">data_out_dof_data.h:1087</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8h_source.html#l00147">data_out.h:150</a></div></div>
<div class="ttc" id="aclassDataOut_html_a5eb51872b8736849bb7e8d2007fae086"><div class="ttname"><a href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01085">data_out.cc:1085</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gacad99726038e4fca7f605fdffb3317e4"><div class="ttname"><a href="group__Exceptions.html#gacad99726038e4fca7f605fdffb3317e4">DataOutInterface::write_vtk</a></div><div class="ttdeci">void write_vtk(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07177">data_out_base.cc:7177</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ConservationLawrun"></a></p><h4>ConservationLaw::run</h4>
<p>这个函数包含了这个程序的顶层逻辑：初始化，时间循环，以及牛顿内部迭代。 <br  />
</p>
<p>开始时，我们读取参数文件中指定的网格文件，设置DoFHandler和各种向量，然后在这个网格上插值给定的初始条件。然后，我们根据初始条件进行一系列的网格细化，以获得一个已经很好地适应初始解的网格。在这个过程结束时，我们输出初始解。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">ConservationLaw&lt;dim&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classGridIn.html">GridIn&lt;dim&gt;</a> grid_in;</div>
<div class="line">    grid_in.<a class="code" href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">attach_triangulation</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::ifstream input_file(parameters.mesh_filename);</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(input_file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(parameters.mesh_filename.c_str()));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    grid_in.<a class="code" href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">read_ucd</a>(input_file);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="ttc" id="aclassGridIn_html"><div class="ttname"><a href="classGridIn.html">GridIn</a></div><div class="ttdef"><b>Definition:</b> <a href="grid__in_8h_source.html#l00306">grid_in.h:307</a></div></div>
<div class="ttc" id="aclassGridIn_html_a82ac1c03b0efe87204ad45d2f1d87f7e"><div class="ttname"><a href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">GridIn::attach_triangulation</a></div><div class="ttdeci">void attach_triangulation(Triangulation&lt; dim, spacedim &gt; &amp;tria)</div><div class="ttdef"><b>Definition:</b> <a href="grid__in_8cc_source.html#l00119">grid_in.cc:119</a></div></div>
<div class="ttc" id="aclassGridIn_html_abbb16aa0aa53bfa9231b69278d397616"><div class="ttname"><a href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">GridIn::read_ucd</a></div><div class="ttdeci">void read_ucd(std::istream &amp;in, const bool apply_all_indicators_to_manifolds=false)</div><div class="ttdef"><b>Definition:</b> <a href="grid__in_8cc_source.html#l00874">grid_in.cc:874</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga4c22c86ff89575667de2ca9778aa28e5"><div class="ttname"><a href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">StandardExceptions::ExcFileNotOpen</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcFileNotOpen(std::string arg1)</div></div>
</div><!-- fragment --><p>确定所有场的大小。</p>
<div class="fragment"><div class="line">old_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">predictor.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">right_hand_side.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">setup_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                         parameters.initial_conditions,</div>
<div class="line">                         old_solution);</div>
<div class="line">current_solution = old_solution;</div>
<div class="line">predictor        = old_solution;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (parameters.do_refine == <span class="keyword">true</span>)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; parameters.shock_levels; ++i)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      compute_refinement_indicators(refinement_indicators);</div>
<div class="line">      refine_grid(refinement_indicators);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      setup_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                               parameters.initial_conditions,</div>
<div class="line">                               old_solution);</div>
<div class="line">      current_solution = old_solution;</div>
<div class="line">      predictor        = old_solution;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">output_results();</div>
<div class="ttc" id="anamespaceVectorTools_html_a761f008bdeb7d94a69205ae824deefad"><div class="ttname"><a href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a></div><div class="ttdeci">void interpolate(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Function&lt; spacedim, typename VectorType::value_type &gt; &amp;function, VectorType &amp;vec, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
</div><!-- fragment --><p>然后我们进入主时间步进循环。在顶部，我们简单地输出一些状态信息，以便人们可以跟踪计算的位置，以及显示非线性内迭代进度的表格的标题。</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> newton_update(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> time        = 0;</div>
<div class="line"><span class="keywordtype">double</span> next_output = time + parameters.output_step;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">predictor = old_solution;</div>
<div class="line"><span class="keywordflow">while</span> (time &lt; parameters.final_time)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;T=&quot;</span> &lt;&lt; time &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Number of active cells:       &quot;</span></div>
<div class="line">              &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells() &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;   NonLin Res     Lin Iter       Lin Res&quot;</span> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   _____________________________________&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>然后是牛顿内迭代，在每个时间步长中解决非线性问题。它的工作方式是将矩阵和右手边重置为零，然后组装线性系统。如果右手边的规范足够小，那么我们就宣布牛顿迭代已经收敛了。否则，我们求解线性系统，用牛顿增量更新当前解，并输出收敛信息。最后，我们检查牛顿迭代的次数是否超过了10次的限制&ndash;如果超过了，就说明迭代有可能出现了发散，继续迭代也没有什么好处。如果发生这种情况，我们就抛出一个异常，这个异常将在 <code>main()</code> 中被捕获，并在程序终止前显示状态信息。 <br  />
</p>
<p>请注意，我们写AssertThrow宏的方式大体上等同于写<code>if (!(nonlin_iter &lt;= 10)) throw ExcMessage ("No convergence in nonlinear solver");</code>。唯一显著的区别是AssertThrow也确保被抛出的异常带有它产生的位置（文件名和行号）的信息。这在这里不是太关键，因为只有一个地方可能发生这种异常；然而，当人们想找出错误发生的地方时，它通常是一个非常有用的工具。</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nonlin_iter = 0;</div>
<div class="line">current_solution         = predictor;</div>
<div class="line"><span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">  {</div>
<div class="line">    system_matrix = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    right_hand_side = 0;</div>
<div class="line">    assemble_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> res_norm = right_hand_side.l2_norm();</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(res_norm) &lt; 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-10)</div>
<div class="line">      {</div>
<div class="line">        std::printf(<span class="stringliteral">&quot;   %-16.3e (converged)\n\n&quot;</span>, res_norm);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        newton_update = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::pair&lt;unsigned int, double&gt; convergence =</div>
<div class="line">          solve(newton_update);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        current_solution += newton_update;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::printf(<span class="stringliteral">&quot;   %-16.3e %04d        %-5.2e\n&quot;</span>,</div>
<div class="line">                    res_norm,</div>
<div class="line">                    convergence.first,</div>
<div class="line">                    convergence.second);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    ++nonlin_iter;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(nonlin_iter &lt;= 10,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver&quot;</span>));</div>
<div class="line">  }</div>
<div class="ttc" id="agroup__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
</div><!-- fragment --><p>我们只有在牛顿迭代已经收敛的情况下才会到达这一点，所以在这里做各种收敛后的任务。 <br  />
</p>
<p>首先，我们更新时间，如果需要的话，产生图形输出。然后，我们通过近似 \(\mathbf w^{n+1}\approx \mathbf w^n + \delta t \frac{\partial \mathbf w}{\partial t} \approx \mathbf w^n + \delta t \; \frac{\mathbf w^n-\mathbf w^{n-1}}{\delta t} = 2 \mathbf w^n - \mathbf w^{n-1}\) 更新下一个时间步长的解决方案的预测器，以尝试使适应性更好地工作。 我们的想法是尝试在前面进行细化，而不是步入一个粗略的元素集并抹去旧的解决方案。 这个简单的时间推断器可以完成这个工作。有了这个，如果用户需要的话，我们再细化网格，最后继续进行下一个时间步骤。</p>
<div class="fragment"><div class="line">        time += parameters.time_step;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (parameters.output_step &lt; 0)</div>
<div class="line">          output_results();</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (time &gt;= next_output)</div>
<div class="line">          {</div>
<div class="line">            output_results();</div>
<div class="line">            next_output += parameters.output_step;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        predictor = current_solution;</div>
<div class="line">        predictor.sadd(2.0, -1.0, old_solution);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        old_solution = current_solution;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (parameters.do_refine == <span class="keyword">true</span>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(</div>
<div class="line">              <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line">            compute_refinement_indicators(refinement_indicators);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            refine_grid(refinement_indicators);</div>
<div class="line">            setup_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            newton_update.<a class="code" href="group__Vectors.html#gac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step33</span></div>
<div class="ttc" id="agroup__Vectors_html_gac4a4dbef7dd65ef8ad35ae56b57d7c05"><div class="ttname"><a href="group__Vectors.html#gac4a4dbef7dd65ef8ad35ae56b57d7c05">Vector::reinit</a></div><div class="ttdeci">virtual void reinit(const size_type N, const bool omit_zeroing_entries=false)</div></div>
</div><!-- fragment --><p><a class="anchor" id="main"></a> </p><h3>main()</h3>
<p>下面的`&lsquo;main&rsquo;'函数与前面的例子类似，不需要注释。注意，如果在命令行上没有给出输入文件名，程序就会中止。</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span>Step33;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (argc != 2)</div>
<div class="line">        {</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; input_file&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">          std::exit(1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(</div>
<div class="line">        argc, argv, ::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      ConservationLaw&lt;2&gt; cons(argv[1]);</div>
<div class="line">      cons.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassUtilities_1_1MPI_1_1MPI__InitFinalize_html"><div class="ttname"><a href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a></div><div class="ttdef"><b>Definition:</b> <a href="mpi_8h_source.html#l00902">mpi.h:903</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Results"></a> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>我们用网格 <code>slide.inp</code> （该文件与本程序的源代码在同一目录下）和以下输入牌（可在同一目录下的 <code>input.prm</code> ）运行该问题。</p>
<pre class="fragment"># Listing of Parameters
# ---------------------


# The input grid
set mesh = slide.inp


# Stabilization parameter
set diffusion power = 2.0


# --------------------------------------------------
# Boundary conditions
# We may specify boundary conditions for up to MAX_BD boundaries.
# Your .inp file should have these boundaries designated.
subsection boundary_1
  set no penetration = true # reflective boundary condition
end


subsection boundary_2
  # outflow boundary
  # set w_2 = pressure
  # set w_2 value = 1.5 - y
end


subsection boundary_3
  set no penetration = true # reflective
  # set w_3 = pressure
  # set w_3 value = 1.0
end


subsection boundary_4
  set no penetration = true #reflective
end


# --------------------------------------------------
# Initial Conditions
# We set the initial conditions of the conservative variables.  These lines
# are passed to the expression parsing function.  You should use x,y,z for
# the coordinate variables.


subsection initial condition
  set w_0 value = 0
  set w_1 value = 0
  set w_2 value = 10*(x&lt;-0.7)*(y&gt; 0.3)*(y&lt; 0.45) + (1-(x&lt;-0.7)*(y&gt; 0.3)*(y&lt; 0.45))*1.0
  set w_3 value = (1.5-(1.0*1.0*y))/0.4
end


# --------------------------------------------------
# Time stepping control
subsection time stepping
  set final time = 10.0 # simulation end time
  set time step  = 0.02 # simulation time step
  set theta scheme value = 0.5
end


subsection linear solver
  set output         = quiet
  set method         = gmres
  set ilut fill      = 1.5
  set ilut drop tolerance = 1e-6
  set ilut absolute tolerance = 1e-6
  set ilut relative tolerance = 1.0
end


# --------------------------------------------------
# Output frequency and kind
subsection output
  set step           = 0.01
  set schlieren plot = true
end


# --------------------------------------------------
# Refinement control
subsection refinement
  set refinement = true # none only other option
  set shock value = 1.5
  set shock levels = 1 # how many levels of refinement to allow
end


# --------------------------------------------------
# Flux parameters
subsection flux
 set stab = constant
 #set stab value = 1.0
end
</pre><p>当我们运行该程序时，我们会得到以下那种输出。</p>
<pre class="fragment">...
T=0.14
   Number of active cells:       1807
   Number of degrees of freedom: 7696


   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.015e-03        0008        3.39e-13
   2.150e-05        0008        1.56e-15
   2.628e-09        0008        5.09e-20
   5.243e-16        (converged)


T=0.16
   Number of active cells:       1807
   Number of degrees of freedom: 7696


   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.145e-03        0008        3.80e-13
   2.548e-05        0008        7.20e-16
   4.063e-09        0008        2.49e-19
   5.970e-16        (converged)


T=0.18
   Number of active cells:       1807
   Number of degrees of freedom: 7696


   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   7.395e-03        0008        6.69e-13
   2.867e-05        0008        1.33e-15
   4.091e-09        0008        3.35e-19
   5.617e-16        (converged)
...
</pre><p>这个输出报告了牛顿迭代的进度和时间步长。请注意，我们对牛顿迭代的实现确实显示了预期的二次收敛顺序：每一步的非线性残差的规范大致是前一步的规范的平方。这导致了我们在这里可以看到的非常快速的收敛。这一直保持到 \(t=1.9\) 的时候，这时非线性迭代报告缺乏收敛性。</p>
<pre class="fragment">...


T=1.88
   Number of active cells:       2119
   Number of degrees of freedom: 9096


   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   2.251e-01        0012        9.78e-12
   5.698e-03        0012        2.04e-13
   3.896e-05        0012        1.48e-15
   3.915e-09        0012        1.94e-19
   8.800e-16        (converged)


T=1.9
   Number of active cells:       2140
   Number of degrees of freedom: 9184


   NonLin Res     Lin Iter       Lin Res
   _____________________________________
   2.320e-01        0013        3.94e-12
   1.235e-01        0016        6.62e-12
   8.494e-02        0016        6.05e-12
   1.199e+01        0026        5.72e-10
   1.198e+03        0002        1.20e+03
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan
   7.030e+03        0001        nan





----------------------------------------------------
Exception on processing:


--------------------------------------------------------
An error occurred in line &lt;2476&gt; of file &lt;step-33.cc&gt; in function
    void Step33::ConservationLaw&lt;dim&gt;::run() [with int dim = 2]
The violated condition was:
    nonlin_iter &lt;= 10
The name and call sequence of the exception was:
    ExcMessage ("No convergence in nonlinear solver")
Additional Information:
No convergence in nonlinear solver


--------------------------------------------------------


Aborting!


----------------------------------------------------
</pre><p>我们可以通过查看解决方案的动画来找出原因和可能的补救措施。</p>
<p>运行这些计算的结果是一堆输出文件，我们可以将其传递给我们选择的可视化程序。当我们把它们整理成一个电影时，过去几个时间步骤的结果看起来是这样的。</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-33.oscillation.gif " alt="" height="300" class="inline"/> <br  />
</p>
<p>正如我们所看到的，当大质量的流体撞击到左下角时，会发生一些振荡，导致迭代的分歧。解决这个问题的一个懒办法是添加更多的粘性。如果我们将扩散功率设置为 \(\eta = 1.5\) 而不是 \(2.0\) ，模拟就能度过这一危机。那么，结果就会是这样。</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-33.slide.ed2.gif " alt="" height="300" class="inline"/> <br  />
</p>
<p>沉重的流体在重力作用下被拉下山坡，在那里与滑雪屋相撞，并被抛向空中！希望每个人都能逃过一劫。 希望每个人都能逃过一劫! 还有，我们可以看到由于人为的粘性，重质和轻质之间的界限很快就模糊了。</p>
<p>我们还可以直观地看到自适应细化网格的演变。</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-33.slide.adapt.ed2.gif " alt="" height="300" class="inline"/> <br  />
</p>
<p>根据上面讨论的启发式细化方案，自适应性跟随并先于流动模式。</p>
<p><a class="anchor" id="extensions"></a> <a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p><a class="anchor" id="Stabilization"></a></p><h4>Stabilization</h4>
<p>我们所选择的数值方案在人工黏度小的时候不是特别稳定，而在人工黏度大的时候则过于扩散。此外，众所周知，还有更先进的技术来稳定解决方案，例如流线扩散、最小二乘稳定项、熵粘性。</p>
<p><a class="anchor" id="Betterlinearsolvers"></a></p><h4>Better linear solvers</h4>
<p>虽然牛顿法作为非线性求解器在时间步长足够小的情况下似乎效果很好，但线性求解器还可以改进。例如，在目前的方案中，只要我们使用迭代求解器，每个牛顿步骤都要重新计算ILU；同样，对于直接求解器，每个步骤都要计算牛顿矩阵的LU分解。这显然是一种浪费：从一个牛顿步骤到另一个牛顿步骤，可能还有不同的时间步骤，牛顿矩阵并没有发生根本性的变化：一个牛顿步骤的ILU或稀疏LU分解可能仍然是下一个牛顿或时间步骤的一个非常好的预处理。因此，避免重新计算是减少计算时间的一个好办法。</p>
<p>我们可以更进一步：由于接近收敛时，牛顿矩阵只发生一点点变化，我们可以定义一个准牛顿方案，在每次牛顿迭代中只重新计算残差（即右手边的向量），并重新使用牛顿矩阵。由此产生的方案很可能不是二次收敛的，我们不得不期望多做几次非线性迭代；然而，鉴于我们不必每次都花时间建立牛顿矩阵，由此产生的方案很可能更快。</p>
<p><a class="anchor" id="Cachetheexplicitpartofresidual"></a></p><h4>Cache the explicit part of residual</h4>
<p>在 ConservationLaw::assemble_cell_term 函数中计算的残差为 \(R_i = \left(\frac{\mathbf{w}^{k}_{n+1} - \mathbf{w}_n}{\delta t} , \mathbf{z}_i \right)_K + \theta \mathbf{B}({\mathbf{w}^{k}_{n+1}})(\mathbf{z}_i)_K + (1-\theta) \mathbf{B}({\mathbf{w}_{n}}) (\mathbf{z}_i)_K \) 这意味着我们在一个牛顿迭代步骤中计算了两次空间残差：一次是关于当前解 \(\mathbf{w}^{k}_{n+1}\) ，另一次是关于最后一个时间步骤的解 \(\mathbf{w}_{n}\) ，在通过一个时间步骤的所有牛顿迭代中保持相同。在牛顿迭代过程中缓存残差 \( \mathbf{B}({\mathbf{w}_{n}}) (\mathbf{z}_i)_K\) 的显式部分将节省大量的人力。</p>
<p><a class="anchor" id="Otherconservationlaws"></a></p><h4>Other conservation laws</h4>
<p>最后，作为超越立即解决欧拉方程的一个方向，这个程序非常努力地将所有具体到欧拉方程的实现分离到一个类（ <code>EulerEquation</code> 类），而将所有具体到组装矩阵和向量、非线性和线性求解器以及一般顶层逻辑的实现分离到另一个类（ <code>ConservationLaw</code> 类）。</p>
<p>通过替换这个类中的通量矩阵和数值通量的定义，以及那里定义的各种其他部分，应该可以将 <code>ConservationLaw</code> 类也应用于其他双曲守恒定律。<a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2007 - 2020 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Author: David Neckels, Boulder, Colorado, 2007, 2008</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function__parser_8h.html">deal.II/base/function_parser.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mapping__q1_8h.html">deal.II/fe/mapping_q1.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2solution__transfer_8h.html">deal.II/numerics/solution_transfer.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="trilinos__sparse__matrix_8h.html">deal.II/lac/trilinos_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="trilinos__precondition_8h.html">deal.II/lac/trilinos_precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="trilinos__solver_8h.html">deal.II/lac/trilinos_solver.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;Sacado.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step33</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>EulerEquations</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_components             = dim + 2;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_momentum_component = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> density_component        = dim;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> energy_component         = dim + 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> std::vector&lt;std::string&gt; component_names()</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;std::string&gt; names(dim, <span class="stringliteral">&quot;momentum&quot;</span>);</div>
<div class="line">      names.emplace_back(<span class="stringliteral">&quot;density&quot;</span>);</div>
<div class="line">      names.emplace_back(<span class="stringliteral">&quot;energy_density&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> names;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    component_interpretation()</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">        data_component_interpretation(</div>
<div class="line">          dim, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">      data_component_interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">      data_component_interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> data_component_interpretation;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> gas_gamma;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">    compute_kinetic_energy(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">typename</span> InputVector::value_type kinetic_energy = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        kinetic_energy +=</div>
<div class="line">          W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] * W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">      kinetic_energy *= 1. / (2 * W[density_component]);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> kinetic_energy;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">typename</span> InputVector::value_type</div>
<div class="line">    compute_pressure(<span class="keyword">const</span> InputVector &amp;W)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> ((gas_gamma - 1.0) *</div>
<div class="line">              (W[energy_component] - compute_kinetic_energy(W)));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> compute_flux_matrix(<span class="keyword">const</span> InputVector &amp;W,</div>
<div class="line">                                    <a class="code" href="ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">                                            EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">                                            dim&gt; &amp;     flux)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> InputVector::value_type pressure = compute_pressure(W);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>)</div>
<div class="line">            flux[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>] =</div>
<div class="line">              W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] *</div>
<div class="line">              W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>] / W[density_component];</div>
<div class="line"> </div>
<div class="line">          flux[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] += pressure;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        flux[density_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        flux[energy_component][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = W[first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] /</div>
<div class="line">                                    W[density_component] *</div>
<div class="line">                                    (W[energy_component] + pressure);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> numerical_normal_flux(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                                      normal,</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         Wplus,</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         Wminus,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>                                                alpha,</div>
<div class="line">      std::array&lt;typename InputVector::value_type, n_components&gt; &amp;normal_flux)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="ndarray_8h.html#a82399009710c9549884b9d8c506ad695">ndarray</a>&lt;<span class="keyword">typename</span> InputVector::value_type,</div>
<div class="line">              EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">              dim&gt;</div>
<div class="line">        iflux, oflux;</div>
<div class="line"> </div>
<div class="line">      compute_flux_matrix(Wplus, iflux);</div>
<div class="line">      compute_flux_matrix(Wminus, oflux);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; n_components; ++di)</div>
<div class="line">        {</div>
<div class="line">          normal_flux[di] = 0;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">            normal_flux[di] += 0.5 * (iflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] + oflux[di][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]) * normal[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line"> </div>
<div class="line">          normal_flux[di] += 0.5 * alpha * (Wplus[di] - Wminus[di]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> compute_forcing_vector(</div>
<div class="line">      <span class="keyword">const</span> InputVector &amp;                                         W,</div>
<div class="line">      std::array&lt;typename InputVector::value_type, n_components&gt; &amp;forcing)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> gravity = -1.0;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; n_components; ++c)</div>
<div class="line">        <span class="keywordflow">switch</span> (c)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">case</span> first_momentum_component + dim - 1:</div>
<div class="line">              forcing[c] = gravity * W[density_component];</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> energy_component:</div>
<div class="line">              forcing[c] = gravity * W[first_momentum_component + dim - 1];</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              forcing[c] = 0;</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> BoundaryKind</div>
<div class="line">    {</div>
<div class="line">      inflow_boundary,</div>
<div class="line">      outflow_boundary,</div>
<div class="line">      no_penetration_boundary,</div>
<div class="line">      pressure_boundary</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataVector&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">    compute_Wminus(<span class="keyword">const</span> std::array&lt;BoundaryKind, n_components&gt; &amp;boundary_kind,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;                        normal_vector,</div>
<div class="line">                   <span class="keyword">const</span> DataVector &amp;                            Wplus,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;boundary_values,</div>
<div class="line">                   <span class="keyword">const</span> DataVector &amp;    Wminus)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; n_components; c++)</div>
<div class="line">        <span class="keywordflow">switch</span> (boundary_kind[c])</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">case</span> inflow_boundary:</div>
<div class="line">              {</div>
<div class="line">                Wminus[c] = boundary_values(c);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> outflow_boundary:</div>
<div class="line">              {</div>
<div class="line">                Wminus[c] = Wplus[c];</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> pressure_boundary:</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> <span class="keyword">typename</span> DataVector::value_type density =</div>
<div class="line">                  (boundary_kind[density_component] == inflow_boundary ?</div>
<div class="line">                     boundary_values(density_component) :</div>
<div class="line">                     Wplus[density_component]);</div>
<div class="line"> </div>
<div class="line">                <span class="keyword">typename</span> DataVector::value_type kinetic_energy = 0;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">                  <span class="keywordflow">if</span> (boundary_kind[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] == inflow_boundary)</div>
<div class="line">                    kinetic_energy += boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) * boundary_values(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>);</div>
<div class="line">                  <span class="keywordflow">else</span></div>
<div class="line">                    kinetic_energy += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] * Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">                kinetic_energy *= 1. / 2. / density;</div>
<div class="line"> </div>
<div class="line">                Wminus[c] =</div>
<div class="line">                  boundary_values(c) / (gas_gamma - 1.0) + kinetic_energy;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">case</span> no_penetration_boundary:</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">typename</span> DataVector::value_type vdotn = 0;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>++)</div>
<div class="line">                  {</div>
<div class="line">                    vdotn += Wplus[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] * normal_vector[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">                  }</div>
<div class="line"> </div>
<div class="line">                Wminus[c] = Wplus[c] - 2.0 * vdotn * normal_vector[c];</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">    compute_refinement_indicators(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   mapping,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp; solution,</div>
<div class="line">                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;       refinement_indicators)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line">      std::vector&lt;unsigned int&gt; dofs(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classQMidpoint.html">QMidpoint&lt;dim&gt;</a> quadrature_formula;</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>    update_flags = <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">      <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(mapping,</div>
<div class="line">                         dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>(),</div>
<div class="line">                         quadrature_formula,</div>
<div class="line">                         update_flags);</div>
<div class="line"> </div>
<div class="line">      std::vector&lt;std::vector&lt;Tensor&lt;1, dim&gt;&gt;&gt; dU(</div>
<div class="line">        1, std::vector&lt;<a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>&gt;(n_components));</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = cell-&gt;active_cell_index();</div>
<div class="line">          fe_v.reinit(cell);</div>
<div class="line">          fe_v.get_function_gradients(solution, dU);</div>
<div class="line"> </div>
<div class="line">          refinement_indicators(cell_no) = <a class="code" href="numbers_8h.html#a5ecbfe991bebf7e99864f2e4eb3ea8df">std::log</a>(</div>
<div class="line">            1 + std::sqrt(dU[0][density_component] * dU[0][density_component]));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">class </span>Postprocessor : <span class="keyword">public</span> <a class="code" href="classDataPostprocessor.html">DataPostprocessor</a>&lt;dim&gt;</div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">      Postprocessor(<span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">void</span> evaluate_vector_field(</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">        std::vector&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;computed_quantities) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> std::vector&lt;std::string&gt; get_names() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> std::vector&lt;</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a>&gt;</div>
<div class="line">      get_data_component_interpretation() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">virtual</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> get_needed_update_flags() <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot;</div>
<div class="line">    };</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> EulerEquations&lt;dim&gt;::gas_gamma = 1.4;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  EulerEquations&lt;dim&gt;::Postprocessor::Postprocessor(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot)</div>
<div class="line">    : do_schlieren_plot(do_schlieren_plot)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> EulerEquations&lt;dim&gt;::Postprocessor::evaluate_vector_field(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs,</div>
<div class="line">    std::vector&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt; &amp;               computed_quantities)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_quadrature_points = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>.size();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>.size() == n_quadrature_points,</div>
<div class="line">             <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities.size() == n_quadrature_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[0].size() == n_components,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].size() == dim + 2, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].size() == dim + 1, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_quadrature_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> density = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[q](density_component);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">          computed_quantities[q](<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) =</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[q](first_momentum_component + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) / density;</div>
<div class="line"> </div>
<div class="line">        computed_quantities[q](dim) =</div>
<div class="line">          compute_pressure(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[q]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">          computed_quantities[q](dim + 1) =</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>[q][density_component] *</div>
<div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>[q][density_component];</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;std::string&gt; EulerEquations&lt;dim&gt;::Postprocessor::get_names()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;std::string&gt; names;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">      names.emplace_back(<span class="stringliteral">&quot;velocity&quot;</span>);</div>
<div class="line">    names.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      names.emplace_back(<span class="stringliteral">&quot;schlieren_plot&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> names;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">  EulerEquations&lt;dim&gt;::Postprocessor::get_data_component_interpretation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">      interpretation(dim,</div>
<div class="line">                     <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line"> </div>
<div class="line">    interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      interpretation.push_back(</div>
<div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> interpretation;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div>
<div class="line">  EulerEquations&lt;dim&gt;::Postprocessor::get_needed_update_flags()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>)</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">namespace </span>Parameters</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">struct </span>Solver</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">enum</span> <a class="code" href="classSolverType.html">SolverType</a></div>
<div class="line">      {</div>
<div class="line">        gmres,</div>
<div class="line">        direct</div>
<div class="line">      };</div>
<div class="line">      <a class="code" href="classSolverType.html">SolverType</a> solver;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">enum</span> OutputType</div>
<div class="line">      {</div>
<div class="line">        quiet,</div>
<div class="line">        verbose</div>
<div class="line">      };</div>
<div class="line">      OutputType output;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> linear_residual;</div>
<div class="line">      <span class="keywordtype">int</span>    max_iterations;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> ilut_fill;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_atol;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_rtol;</div>
<div class="line">      <span class="keywordtype">double</span> ilut_drop;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Solver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">          <span class="stringliteral">&quot;output&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;quiet&quot;</span>,</div>
<div class="line">          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;quiet|verbose&quot;</span>),</div>
<div class="line">          <span class="stringliteral">&quot;State whether output from solver runs should be printed. &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;Choices are &lt;quiet|verbose&gt;.&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;method&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;gmres&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;gmres|direct&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;The kind of solver for the linear system. &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Choices are &lt;gmres|direct&gt;.&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;residual&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Linear solver residual&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max iters&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;300&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Maximum solver iterations&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut preconditioner fill&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-9&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut preconditioner tolerance&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut relative tolerance&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-10&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Ilut drop tolerance&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Solver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> std::string op = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;verbose&quot;</span>)</div>
<div class="line">          output = verbose;</div>
<div class="line">        <span class="keywordflow">if</span> (op == <span class="stringliteral">&quot;quiet&quot;</span>)</div>
<div class="line">          output = quiet;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string sv = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;method&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;direct&quot;</span>)</div>
<div class="line">          solver = direct;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sv == <span class="stringliteral">&quot;gmres&quot;</span>)</div>
<div class="line">          solver = gmres;</div>
<div class="line"> </div>
<div class="line">        linear_residual = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;residual&quot;</span>);</div>
<div class="line">        max_iterations  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;max iters&quot;</span>);</div>
<div class="line">        ilut_fill       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut fill&quot;</span>);</div>
<div class="line">        ilut_atol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut absolute tolerance&quot;</span>);</div>
<div class="line">        ilut_rtol       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut relative tolerance&quot;</span>);</div>
<div class="line">        ilut_drop       = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;ilut drop tolerance&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Refinement</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">bool</span>   do_refine;</div>
<div class="line">      <span class="keywordtype">double</span> shock_val;</div>
<div class="line">      <span class="keywordtype">double</span> shock_levels;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Refinement::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Whether to perform mesh refinement or not&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;refinement fraction&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Fraction of high refinement&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;unrefinement fraction&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Fraction of low unrefinement&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;max elements&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1000000&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;maximum number of elements&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;4.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;value for shock indicator&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;shock levels&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;3.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;number of shock refinement levels&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Refinement::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        do_refine    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;refinement&quot;</span>);</div>
<div class="line">        shock_val    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock value&quot;</span>);</div>
<div class="line">        shock_levels = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;shock levels&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Flux</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">enum</span> StabilizationKind</div>
<div class="line">      {</div>
<div class="line">        constant,</div>
<div class="line">        mesh_dependent</div>
<div class="line">      };</div>
<div class="line">      StabilizationKind stabilization_kind;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> stabilization_value;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Flux::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">          <span class="stringliteral">&quot;stab&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;constant|mesh&quot;</span>),</div>
<div class="line">          <span class="stringliteral">&quot;Whether to use a constant stabilization parameter or &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;a mesh-dependent one&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;stab value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;alpha stabilization&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Flux::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;flux&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> std::string stab = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;stab&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;constant&quot;</span>)</div>
<div class="line">          stabilization_kind = constant;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stab == <span class="stringliteral">&quot;mesh&quot;</span>)</div>
<div class="line">          stabilization_kind = mesh_dependent;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">        stabilization_value = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;stab value&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Output</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">bool</span>   schlieren_plot;</div>
<div class="line">      <span class="keywordtype">double</span> output_step;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Output::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Whether or not to produce schlieren plots&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;step&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;-1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Output once per this period&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Output::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        schlieren_plot = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;schlieren plot&quot;</span>);</div>
<div class="line">        output_step    = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;step&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> Solver,</div>
<div class="line">                           <span class="keyword">public</span> Refinement,</div>
<div class="line">                           <span class="keyword">public</span> Flux,</div>
<div class="line">                           <span class="keyword">public</span> Output</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_n_boundaries = 10;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">struct </span>BoundaryConditions</div>
<div class="line">      {</div>
<div class="line">        std::array&lt;typename EulerEquations&lt;dim&gt;::BoundaryKind,</div>
<div class="line">                   EulerEquations&lt;dim&gt;::n_components&gt;</div>
<div class="line">          kind;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>;</div>
<div class="line"> </div>
<div class="line">        BoundaryConditions();</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      AllParameters();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> diffusion_power;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> time_step, final_time;</div>
<div class="line">      <span class="keywordtype">double</span> theta;</div>
<div class="line">      <span class="keywordtype">bool</span>   is_stationary;</div>
<div class="line"> </div>
<div class="line">      std::string mesh_filename;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;</a> initial_conditions;</div>
<div class="line">      BoundaryConditions  boundary_conditions[max_n_boundaries];</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">      <span class="keywordtype">void</span>        parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    AllParameters&lt;dim&gt;::BoundaryConditions::BoundaryConditions()</div>
<div class="line">      : <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>(EulerEquations&lt;dim&gt;::n_components)</div>
<div class="line">    {</div>
<div class="line">      std::fill(kind.begin(),</div>
<div class="line">                kind.end(),</div>
<div class="line">                EulerEquations&lt;dim&gt;::no_penetration_boundary);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    AllParameters&lt;dim&gt;::AllParameters()</div>
<div class="line">      : diffusion_power(0.)</div>
<div class="line">      , time_step(1.)</div>
<div class="line">      , final_time(1.)</div>
<div class="line">      , theta(.5)</div>
<div class="line">      , is_stationary(true)</div>
<div class="line">      , initial_conditions(EulerEquations&lt;dim&gt;::n_components)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keywordtype">void</span> AllParameters&lt;dim&gt;::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;mesh&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;grid.inp&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                        <span class="stringliteral">&quot;intput file name&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>,</div>
<div class="line">                        <span class="stringliteral">&quot;2.0&quot;</span>,</div>
<div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                        <span class="stringliteral">&quot;power of mesh size for diffusion&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;time step&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;simulation time step&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;final time&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;10.0&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;simulation end time&quot;</span>);</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.5&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0, 1),</div>
<div class="line">                          <span class="stringliteral">&quot;value for theta that interpolated between explicit &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Euler (theta=0), Crank-Nicolson (theta=0.5), and &quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;implicit Euler (theta=1).&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a> &lt; max_n_boundaries; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>)</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>));</div>
<div class="line">          {</div>
<div class="line">            prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;no penetration&quot;</span>,</div>
<div class="line">                              <span class="stringliteral">&quot;false&quot;</span>,</div>
<div class="line">                              <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                              <span class="stringliteral">&quot;whether the named boundary allows gas to &quot;</span></div>
<div class="line">                              <span class="stringliteral">&quot;penetrate or is a rigid wall&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; EulerEquations&lt;dim&gt;::n_components;</div>
<div class="line">                 ++di)</div>
<div class="line">              {</div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di),</div>
<div class="line">                                  <span class="stringliteral">&quot;outflow&quot;</span>,</div>
<div class="line">                                  <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(</div>
<div class="line">                                    <span class="stringliteral">&quot;inflow|outflow|pressure&quot;</span>),</div>
<div class="line">                                  <span class="stringliteral">&quot;&lt;inflow|outflow|pressure&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">                prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) +</div>
<div class="line">                                    <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                                  <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                                  <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                                  <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; EulerEquations&lt;dim&gt;::n_components; ++di)</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>,</div>
<div class="line">                            <span class="stringliteral">&quot;0.0&quot;</span>,</div>
<div class="line">                            <a class="code" href="classPatterns_1_1Anything.html">Patterns::Anything</a>(),</div>
<div class="line">                            <span class="stringliteral">&quot;expression in x,y,z&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      Parameters::Solver::declare_parameters(prm);</div>
<div class="line">      Parameters::Refinement::declare_parameters(prm);</div>
<div class="line">      Parameters::Flux::declare_parameters(prm);</div>
<div class="line">      Parameters::Output::declare_parameters(prm);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">    <span class="keywordtype">void</span> AllParameters&lt;dim&gt;::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      mesh_filename   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;mesh&quot;</span>);</div>
<div class="line">      diffusion_power = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;diffusion power&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;time stepping&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        time_step = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;time step&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (time_step == 0)</div>
<div class="line">          {</div>
<div class="line">            is_stationary = <span class="keyword">true</span>;</div>
<div class="line">            time_step     = 1.0;</div>
<div class="line">            final_time    = 1.0;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          is_stationary = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">        final_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;final time&quot;</span>);</div>
<div class="line">        theta      = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;theta scheme value&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 0; <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> &lt; max_n_boundaries;</div>
<div class="line">           ++<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>)</div>
<div class="line">        {</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;boundary_&quot;</span> +</div>
<div class="line">                               <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>));</div>
<div class="line">          {</div>
<div class="line">            std::vector&lt;std::string&gt; expressions(</div>
<div class="line">              EulerEquations&lt;dim&gt;::n_components, <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">bool</span> no_penetration = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;no penetration&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; EulerEquations&lt;dim&gt;::n_components;</div>
<div class="line">                 ++di)</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> std::string boundary_type =</div>
<div class="line">                  prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di));</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> ((di &lt; dim) &amp;&amp; (no_penetration == <span class="keyword">true</span>))</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::no_penetration_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;inflow&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::inflow_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;pressure&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::pressure_boundary;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boundary_type == <span class="stringliteral">&quot;outflow&quot;</span>)</div>
<div class="line">                  boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind[di] =</div>
<div class="line">                    EulerEquations&lt;dim&gt;::outflow_boundary;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">                expressions[di] =</div>
<div class="line">                  prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].values.initialize(</div>
<div class="line">              <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">              expressions,</div>
<div class="line">              std::map&lt;std::string, double&gt;());</div>
<div class="line">          }</div>
<div class="line">          prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;initial condition&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        std::vector&lt;std::string&gt; expressions(EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">                                             <span class="stringliteral">&quot;0.0&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = 0; di &lt; EulerEquations&lt;dim&gt;::n_components; di++)</div>
<div class="line">          expressions[di] =</div>
<div class="line">            prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;w_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(di) + <span class="stringliteral">&quot; value&quot;</span>);</div>
<div class="line">        initial_conditions.initialize(</div>
<div class="line">          <a class="code" href="classFunctionParser.html">FunctionParser&lt;dim&gt;::default_variable_names</a>(),</div>
<div class="line">          expressions,</div>
<div class="line">          std::map&lt;std::string, double&gt;());</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">      Parameters::Solver::parse_parameters(prm);</div>
<div class="line">      Parameters::Refinement::parse_parameters(prm);</div>
<div class="line">      Parameters::Flux::parse_parameters(prm);</div>
<div class="line">      Parameters::Output::parse_parameters(prm);</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// namespace Parameters</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>ConservationLaw</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    ConservationLaw(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cell_term(<span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">                            <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs);</div>
<div class="line">    <span class="keywordtype">void</span> assemble_face_term(</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          face_no,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs,</div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dofs_neighbor,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter);</div>
<div class="line"> </div>
<div class="line">    std::pair&lt;unsigned int, double&gt; solve(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;solution);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> compute_refinement_indicators(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;indicator) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;indicator);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a>   <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a> mapping;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a> fe;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>     dof_handler;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     quadrature;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt; face_quadrature;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> old_solution;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> current_solution;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> predictor;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> right_hand_side;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTrilinosWrappers_1_1SparseMatrix.html">TrilinosWrappers::SparseMatrix</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">    Parameters::AllParameters&lt;dim&gt; parameters;</div>
<div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a>             verbose_cout;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  ConservationLaw&lt;dim&gt;::ConservationLaw(<span class="keyword">const</span> <span class="keywordtype">char</span> *input_filename)</div>
<div class="line">    : mapping()</div>
<div class="line">    , fe(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;dim&gt;(1), EulerEquations&lt;dim&gt;::n_components)</div>
<div class="line">    , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">    , quadrature(fe.degree + 1)</div>
<div class="line">    , face_quadrature(fe.degree + 1)</div>
<div class="line">    , verbose_cout(std::cout, false)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">    Parameters::AllParameters&lt;dim&gt;::declare_parameters(prm);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_filename);</div>
<div class="line">    parameters.parse_parameters(prm);</div>
<div class="line"> </div>
<div class="line">    verbose_cout.set_condition(parameters.output ==</div>
<div class="line">                               Parameters::Solver::verbose);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::setup_system()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(), dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line"> </div>
<div class="line">    system_matrix.reinit(dsp);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_system()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = dof_handler.<a class="code" href="classDoFHandler.html#ac1fedeb50b5f03b13d8b69f86e33f726">get_fe</a>().<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>();</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; dof_indices(dofs_per_cell);</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; dof_indices_neighbor(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> update_flags = <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                                     <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                                     <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>,</div>
<div class="line">                      face_update_flags =</div>
<div class="line">                        <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                        <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>,</div>
<div class="line">                      neighbor_face_update_flags = <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>        fe_v(mapping, fe, quadrature, update_flags);</div>
<div class="line">    <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face(mapping,</div>
<div class="line">                                fe,</div>
<div class="line">                                face_quadrature,</div>
<div class="line">                                face_update_flags);</div>
<div class="line">    <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface(mapping,</div>
<div class="line">                                      fe,</div>
<div class="line">                                      face_quadrature,</div>
<div class="line">                                      face_update_flags);</div>
<div class="line">    <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a>    fe_v_face_neighbor(mapping,</div>
<div class="line">                                         fe,</div>
<div class="line">                                         face_quadrature,</div>
<div class="line">                                         neighbor_face_update_flags);</div>
<div class="line">    <a class="code" href="classFESubfaceValues.html">FESubfaceValues&lt;dim&gt;</a> fe_v_subface_neighbor(mapping,</div>
<div class="line">                                               fe,</div>
<div class="line">                                               face_quadrature,</div>
<div class="line">                                               neighbor_face_update_flags);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      {</div>
<div class="line">        fe_v.reinit(cell);</div>
<div class="line">        cell-&gt;get_dof_indices(dof_indices);</div>
<div class="line"> </div>
<div class="line">        assemble_cell_term(fe_v, dof_indices);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> face_no : cell-&gt;face_indices())</div>
<div class="line">          <span class="keywordflow">if</span> (cell-&gt;at_boundary(face_no))</div>
<div class="line">            {</div>
<div class="line">              fe_v_face.reinit(cell, face_no);</div>
<div class="line">              assemble_face_term(face_no,</div>
<div class="line">                                 fe_v_face,</div>
<div class="line">                                 fe_v_face,</div>
<div class="line">                                 dof_indices,</div>
<div class="line">                                 std::vector&lt;types::global_dof_index&gt;(),</div>
<div class="line">                                 <span class="keyword">true</span>,</div>
<div class="line">                                 cell-&gt;face(face_no)-&gt;boundary_id(),</div>
<div class="line">                                 cell-&gt;face(face_no)-&gt;diameter());</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">if</span> (cell-&gt;neighbor(face_no)-&gt;has_children())</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor2 =</div>
<div class="line">                    cell-&gt;neighbor_of_neighbor(face_no);</div>
<div class="line"> </div>
<div class="line">                  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> subface_no = 0;</div>
<div class="line">                       subface_no &lt; cell-&gt;face(face_no)-&gt;n_children();</div>
<div class="line">                       ++subface_no)</div>
<div class="line">                    {</div>
<div class="line">                      <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a></div>
<div class="line">                        neighbor_child =</div>
<div class="line">                          cell-&gt;neighbor_child_on_subface(face_no, subface_no);</div>
<div class="line"> </div>
<div class="line">                      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;face(neighbor2) ==</div>
<div class="line">                               cell-&gt;face(face_no)-&gt;child(subface_no),</div>
<div class="line">                             <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">                      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor_child-&gt;is_active(), <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                      fe_v_subface.reinit(cell, face_no, subface_no);</div>
<div class="line">                      fe_v_face_neighbor.reinit(neighbor_child, neighbor2);</div>
<div class="line"> </div>
<div class="line">                      neighbor_child-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">                      assemble_face_term(</div>
<div class="line">                        face_no,</div>
<div class="line">                        fe_v_subface,</div>
<div class="line">                        fe_v_face_neighbor,</div>
<div class="line">                        dof_indices,</div>
<div class="line">                        dof_indices_neighbor,</div>
<div class="line">                        <span class="keyword">false</span>,</div>
<div class="line">                        <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                        neighbor_child-&gt;face(neighbor2)-&gt;diameter());</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cell-&gt;neighbor(face_no)-&gt;level() != cell-&gt;level())</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga32b2a057d9abd2e1752bf8a3cb88e644">DoFHandler&lt;dim&gt;::cell_iterator</a> neighbor =</div>
<div class="line">                    cell-&gt;neighbor(face_no);</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor-&gt;level() == cell-&gt;level() - 1,</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                  neighbor-&gt;get_dof_indices(dof_indices_neighbor);</div>
<div class="line"> </div>
<div class="line">                  <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; faceno_subfaceno =</div>
<div class="line">                    cell-&gt;neighbor_of_coarser_neighbor(face_no);</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor_face_no = faceno_subfaceno.first,</div>
<div class="line">                                     neighbor_subface_no =</div>
<div class="line">                                       faceno_subfaceno.second;</div>
<div class="line"> </div>
<div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(neighbor-&gt;neighbor_child_on_subface(</div>
<div class="line">                           neighbor_face_no, neighbor_subface_no) == cell,</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">                  fe_v_face.reinit(cell, face_no);</div>
<div class="line">                  fe_v_subface_neighbor.reinit(neighbor,</div>
<div class="line">                                               neighbor_face_no,</div>
<div class="line">                                               neighbor_subface_no);</div>
<div class="line"> </div>
<div class="line">                  assemble_face_term(face_no,</div>
<div class="line">                                     fe_v_face,</div>
<div class="line">                                     fe_v_subface_neighbor,</div>
<div class="line">                                     dof_indices,</div>
<div class="line">                                     dof_indices_neighbor,</div>
<div class="line">                                     <span class="keyword">false</span>,</div>
<div class="line">                                     <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>,</div>
<div class="line">                                     cell-&gt;face(face_no)-&gt;diameter());</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_cell_term(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;                       fe_v,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; W(n_q_points,</div>
<div class="line">                                          EulerEquations&lt;dim&gt;::n_components);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> W_old(n_q_points, EulerEquations&lt;dim&gt;::n_components);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;3, Sacado::Fad::DFad&lt;double&gt;</a>&gt; grad_W(</div>
<div class="line">      n_q_points, EulerEquations&lt;dim&gt;::n_components, dim);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;3, double&gt;</a> grad_W_old(n_q_points,</div>
<div class="line">                                EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">                                dim);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;double&gt; residual_derivatives(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">      dofs_per_cell);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">      independent_local_dof_values[i] = current_solution(dof_indices[i]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">      independent_local_dof_values[i].diff(i, dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; EulerEquations&lt;dim&gt;::n_components; ++c)</div>
<div class="line">        {</div>
<div class="line">          W[q][c]     = 0;</div>
<div class="line">          W_old[q][c] = 0;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">            {</div>
<div class="line">              grad_W[q][c][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]     = 0;</div>
<div class="line">              grad_W_old[q][c][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = 0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c =</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line"> </div>
<div class="line">          W[q][c] += independent_local_dof_values[i] *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, c);</div>
<div class="line">          W_old[q][c] +=</div>
<div class="line">            old_solution(dof_indices[i]) * fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, c);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>++)</div>
<div class="line">            {</div>
<div class="line">              grad_W[q][c][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] += independent_local_dof_values[i] *</div>
<div class="line">                                 fe_v.<a class="code" href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">shape_grad_component</a>(i, q, c)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">              grad_W_old[q][c][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] += old_solution(dof_indices[i]) *</div>
<div class="line">                                     fe_v.<a class="code" href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">shape_grad_component</a>(i, q, c)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>];</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::vector&lt;ndarray&lt;Sacado::Fad::DFad&lt;double&gt;,</div>
<div class="line">                        EulerEquations&lt;dim&gt;::n_components,</div>
<div class="line">                        dim&gt;&gt;</div>
<div class="line">      flux(n_q_points);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;ndarray&lt;double, EulerEquations&lt;dim&gt;::n_components, dim&gt;&gt;</div>
<div class="line">      flux_old(n_q_points);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;</div>
<div class="line">      std::array&lt;Sacado::Fad::DFad&lt;double&gt;, EulerEquations&lt;dim&gt;::n_components&gt;&gt;</div>
<div class="line">      forcing(n_q_points);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components&gt;&gt;</div>
<div class="line">      forcing_old(n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_flux_matrix(W_old[q], flux_old[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_forcing_vector(W_old[q], forcing_old[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_flux_matrix(W[q], flux[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::compute_forcing_vector(W[q], forcing[q]);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>; ++i)</div>
<div class="line">      {</div>
<div class="line">        Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> = 0; <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> &lt; fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>; ++<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">if</span> (parameters.is_stationary == <span class="keyword">false</span>)</div>
<div class="line">              R_i += 1.0 / parameters.time_step *</div>
<div class="line">                     (W[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i] - W_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i]) *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i) *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>++)</div>
<div class="line">              R_i -=</div>
<div class="line">                (parameters.theta * flux[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] +</div>
<div class="line">                 (1.0 - parameters.theta) * flux_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]) *</div>
<div class="line">                fe_v.<a class="code" href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">shape_grad_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] *</div>
<div class="line">                fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>++)</div>
<div class="line">              R_i +=</div>
<div class="line">                1.0 *</div>
<div class="line">                std::pow(fe_v.<a class="code" href="classFEValuesBase.html#a9d3a1c53c139e2553b672de682d6233e">get_cell</a>()-&gt;diameter(),</div>
<div class="line">                         parameters.diffusion_power) *</div>
<div class="line">                (parameters.theta * grad_W[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] +</div>
<div class="line">                 (1.0 - parameters.theta) * grad_W_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]) *</div>
<div class="line">                fe_v.<a class="code" href="classFEValuesBase.html#a71e93aa182f3acd34abd020538f3bc39">shape_grad_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i)[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] *</div>
<div class="line">                fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line"> </div>
<div class="line">            R_i -=</div>
<div class="line">              (parameters.theta * forcing[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i] +</div>
<div class="line">               (1.0 - parameters.theta) * forcing_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i]) *</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i) *</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">          residual_derivatives[k] = R_i.fastAccessDx(k);</div>
<div class="line">        system_matrix.add(dof_indices[i], dof_indices, residual_derivatives);</div>
<div class="line">        right_hand_side(dof_indices[i]) -= R_i.val();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::assemble_face_term(</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          face_no,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFEFaceValuesBase.html">FEFaceValuesBase&lt;dim&gt;</a> &amp;               fe_v_neighbor,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices,</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; &amp;dof_indices_neighbor,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span>                                  external_face,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                          <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                                face_diameter)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = fe_v.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Sacado::Fad::DFad&lt;double&gt;&gt; independent_local_dof_values(</div>
<div class="line">      dofs_per_cell),</div>
<div class="line">      independent_neighbor_dof_values(external_face == <span class="keyword">false</span> ? dofs_per_cell :</div>
<div class="line">                                                               0);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_independent_variables =</div>
<div class="line">      (external_face == <span class="keyword">false</span> ? 2 * dofs_per_cell : dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; i++)</div>
<div class="line">      {</div>
<div class="line">        independent_local_dof_values[i] = current_solution(dof_indices[i]);</div>
<div class="line">        independent_local_dof_values[i].diff(i, n_independent_variables);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; i++)</div>
<div class="line">        {</div>
<div class="line">          independent_neighbor_dof_values[i] =</div>
<div class="line">            current_solution(dof_indices_neighbor[i]);</div>
<div class="line">          independent_neighbor_dof_values[i].diff(i + dofs_per_cell,</div>
<div class="line">                                                  n_independent_variables);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, Sacado::Fad::DFad&lt;double&gt;</a>&gt; Wplus(</div>
<div class="line">      n_q_points, EulerEquations&lt;dim&gt;::n_components),</div>
<div class="line">      Wminus(n_q_points, EulerEquations&lt;dim&gt;::n_components);</div>
<div class="line">    <a class="code" href="classTable.html">Table&lt;2, double&gt;</a> Wplus_old(n_q_points, EulerEquations&lt;dim&gt;::n_components),</div>
<div class="line">      Wminus_old(n_q_points, EulerEquations&lt;dim&gt;::n_components);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">          Wplus[q][component_i] +=</div>
<div class="line">            independent_local_dof_values[i] *</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, component_i);</div>
<div class="line">          Wplus_old[q][component_i] +=</div>
<div class="line">            old_solution(dof_indices[i]) *</div>
<div class="line">            fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, component_i);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">              Wminus[q][component_i] +=</div>
<div class="line">                independent_neighbor_dof_values[i] *</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, component_i);</div>
<div class="line">              Wminus_old[q][component_i] +=</div>
<div class="line">                old_solution(dof_indices_neighbor[i]) *</div>
<div class="line">                fe_v_neighbor.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, q, component_i);</div>
<div class="line">            }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> &lt; Parameters::AllParameters&lt;dim&gt;::max_n_boundaries,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                             0,</div>
<div class="line">                             Parameters::AllParameters&lt;dim&gt;::max_n_boundaries));</div>
<div class="line"> </div>
<div class="line">        std::vector&lt;Vector&lt;double&gt;&gt; boundary_values(</div>
<div class="line">          n_q_points, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>(EulerEquations&lt;dim&gt;::n_components));</div>
<div class="line">        parameters.boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].values.vector_value_list(</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ae41b67cfd48e02f6035e39c84f0fb47a">get_quadrature_points</a>(), boundary_values);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; q++)</div>
<div class="line">          {</div>
<div class="line">            EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">              parameters.boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind,</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">              Wplus[q],</div>
<div class="line">              boundary_values[q],</div>
<div class="line">              Wminus[q]);</div>
<div class="line">            EulerEquations&lt;dim&gt;::compute_Wminus(</div>
<div class="line">              parameters.boundary_conditions[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>].kind,</div>
<div class="line">              fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">              Wplus_old[q],</div>
<div class="line">              boundary_values[q],</div>
<div class="line">              Wminus_old[q]);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::vector&lt;</div>
<div class="line">      std::array&lt;Sacado::Fad::DFad&lt;double&gt;, EulerEquations&lt;dim&gt;::n_components&gt;&gt;</div>
<div class="line">      normal_fluxes(n_q_points);</div>
<div class="line">    std::vector&lt;std::array&lt;double, EulerEquations&lt;dim&gt;::n_components&gt;&gt;</div>
<div class="line">      normal_fluxes_old(n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> alpha;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (parameters.stabilization_kind)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Flux::constant:</div>
<div class="line">          alpha = parameters.stabilization_value;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Flux::mesh_dependent:</div>
<div class="line">          alpha = face_diameter / (2.0 * parameters.time_step);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">          alpha = 1;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        EulerEquations&lt;dim&gt;::numerical_normal_flux(</div>
<div class="line">          fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q), Wplus[q], Wminus[q], alpha, normal_fluxes[q]);</div>
<div class="line">        EulerEquations&lt;dim&gt;::numerical_normal_flux(fe_v.<a class="code" href="classFEValuesBase.html#ac25ec6835799c3b6c7c842f8acb05eb3">normal_vector</a>(q),</div>
<div class="line">                                                   Wplus_old[q],</div>
<div class="line">                                                   Wminus_old[q],</div>
<div class="line">                                                   alpha,</div>
<div class="line">                                                   normal_fluxes_old[q]);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;double&gt; residual_derivatives(dofs_per_cell);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; fe_v.<a class="code" href="classFEValuesBase.html#a5b264d5b2fb6615f5dea7a21135ed1a5">dofs_per_cell</a>; ++i)</div>
<div class="line">      <span class="keywordflow">if</span> (fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a68dc9f085edbcd92f8d0703d3e5fce6f">has_support_on_face</a>(i, face_no) == <span class="keyword">true</span>)</div>
<div class="line">        {</div>
<div class="line">          Sacado::Fad::DFad&lt;double&gt; R_i = 0;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> = 0; <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> &lt; n_q_points; ++<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe_v.<a class="code" href="classFEValuesBase.html#ade22ffd9fb5b07842daa504929244aa7">get_fe</a>().<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line"> </div>
<div class="line">              R_i += (parameters.theta * normal_fluxes[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i] +</div>
<div class="line">                      (1.0 - parameters.theta) *</div>
<div class="line">                        normal_fluxes_old[<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>][component_i]) *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#aa57a7e777b0798ec009b4ce888ad9574">shape_value_component</a>(i, <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>, component_i) *</div>
<div class="line">                     fe_v.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(<a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">            residual_derivatives[k] = R_i.fastAccessDx(k);</div>
<div class="line">          system_matrix.add(dof_indices[i], dof_indices, residual_derivatives);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (external_face == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">                residual_derivatives[k] = R_i.fastAccessDx(dofs_per_cell + k);</div>
<div class="line">              system_matrix.add(dof_indices[i],</div>
<div class="line">                                dof_indices_neighbor,</div>
<div class="line">                                residual_derivatives);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          right_hand_side(dof_indices[i]) -= R_i.val();</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::pair&lt;unsigned int, double&gt;</div>
<div class="line">  ConservationLaw&lt;dim&gt;::solve(<a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">switch</span> (parameters.solver)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Solver::direct:</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classSolverControl.html">SolverControl</a>                                  solver_control(1, 0);</div>
<div class="line">            <a class="code" href="structTrilinosWrappers_1_1SolverDirect_1_1AdditionalData.html">TrilinosWrappers::SolverDirect::AdditionalData</a> data(</div>
<div class="line">              parameters.output == Parameters::Solver::verbose);</div>
<div class="line">            <a class="code" href="classTrilinosWrappers_1_1SolverDirect.html">TrilinosWrappers::SolverDirect</a> direct(solver_control, data);</div>
<div class="line"> </div>
<div class="line">            direct.solve(system_matrix, newton_update, right_hand_side);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> {solver_control.last_step(), solver_control.last_value()};</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> Parameters::Solver::gmres:</div>
<div class="line">          {</div>
<div class="line">            Epetra_Vector x(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                            system_matrix.trilinos_matrix().DomainMap(),</div>
<div class="line">                            newton_update.<a class="code" href="group__Vectors.html#gaf34b888fe493ef2ed188179de69ad7ed">begin</a>());</div>
<div class="line">            Epetra_Vector <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>(<a class="code" href="namespaceFEValuesViews.html#af2099b26234f5816729f7f6dc523dc0f">View</a>,</div>
<div class="line">                            system_matrix.trilinos_matrix().RangeMap(),</div>
<div class="line">                            right_hand_side.begin());</div>
<div class="line"> </div>
<div class="line">            AztecOO solver;</div>
<div class="line">            solver.SetAztecOption(</div>
<div class="line">              AZ_output,</div>
<div class="line">              (parameters.output == Parameters::Solver::quiet ? AZ_none :</div>
<div class="line">                                                                AZ_all));</div>
<div class="line">            solver.SetAztecOption(AZ_solver, AZ_gmres);</div>
<div class="line">            solver.SetRHS(&amp;<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">b</a>);</div>
<div class="line">            solver.SetLHS(&amp;x);</div>
<div class="line"> </div>
<div class="line">            solver.SetAztecOption(AZ_precond, AZ_dom_decomp);</div>
<div class="line">            solver.SetAztecOption(AZ_subdomain_solve, AZ_ilut);</div>
<div class="line">            solver.SetAztecOption(AZ_overlap, 0);</div>
<div class="line">            solver.SetAztecOption(AZ_reorder, 0);</div>
<div class="line"> </div>
<div class="line">            solver.SetAztecParam(AZ_drop, parameters.ilut_drop);</div>
<div class="line">            solver.SetAztecParam(AZ_ilut_fill, parameters.ilut_fill);</div>
<div class="line">            solver.SetAztecParam(AZ_athresh, parameters.ilut_atol);</div>
<div class="line">            solver.SetAztecParam(AZ_rthresh, parameters.ilut_rtol);</div>
<div class="line"> </div>
<div class="line">            solver.SetUserMatrix(</div>
<div class="line">              <span class="keyword">const_cast&lt;</span>Epetra_CrsMatrix *<span class="keyword">&gt;</span>(&amp;system_matrix.trilinos_matrix()));</div>
<div class="line"> </div>
<div class="line">            solver.Iterate(parameters.max_iterations,</div>
<div class="line">                           parameters.linear_residual);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> {solver.NumIters(), solver.TrueResidual()};</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">    <span class="keywordflow">return</span> {0, 0};</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::compute_refinement_indicators(</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    EulerEquations&lt;dim&gt;::compute_refinement_indicators(dof_handler,</div>
<div class="line">                                                       mapping,</div>
<div class="line">                                                       predictor,</div>
<div class="line">                                                       refinement_indicators);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  ConservationLaw&lt;dim&gt;::refine_grid(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;refinement_indicators)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_no = cell-&gt;active_cell_index();</div>
<div class="line">        cell-&gt;clear_coarsen_flag();</div>
<div class="line">        cell-&gt;clear_refine_flag();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((cell-&gt;level() &lt; parameters.shock_levels) &amp;&amp;</div>
<div class="line">            (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &gt; parameters.shock_val))</div>
<div class="line">          cell-&gt;set_refine_flag();</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cell-&gt;level() &gt; 0) &amp;&amp;</div>
<div class="line">                 (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(refinement_indicators(cell_no)) &lt;</div>
<div class="line">                  0.75 * parameters.shock_val))</div>
<div class="line">          cell-&gt;set_coarsen_flag();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; transfer_in;</div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; transfer_out;</div>
<div class="line"> </div>
<div class="line">    transfer_in.push_back(old_solution);</div>
<div class="line">    transfer_in.push_back(predictor);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.prepare_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolutionTransfer.html">SolutionTransfer&lt;dim&gt;</a> soltrans(dof_handler);</div>
<div class="line">    soltrans.prepare_for_coarsening_and_refinement(transfer_in);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_old_solution(1);</div>
<div class="line">      <a class="code" href="classVector.html">Vector&lt;double&gt;</a> new_predictor(1);</div>
<div class="line"> </div>
<div class="line">      transfer_out.push_back(new_old_solution);</div>
<div class="line">      transfer_out.push_back(new_predictor);</div>
<div class="line">      transfer_out[0].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">      transfer_out[1].reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    soltrans.interpolate(transfer_in, transfer_out);</div>
<div class="line"> </div>
<div class="line">    old_solution.reinit(transfer_out[0].size());</div>
<div class="line">    old_solution = transfer_out[0];</div>
<div class="line"> </div>
<div class="line">    predictor.reinit(transfer_out[1].size());</div>
<div class="line">    predictor = transfer_out[1];</div>
<div class="line"> </div>
<div class="line">    current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    current_solution = old_solution;</div>
<div class="line">    right_hand_side.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> ConservationLaw&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">typename</span> EulerEquations&lt;dim&gt;::Postprocessor postprocessor(</div>
<div class="line">      parameters.schlieren_plot);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(current_solution,</div>
<div class="line">                             EulerEquations&lt;dim&gt;::component_names(),</div>
<div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                             EulerEquations&lt;dim&gt;::component_interpretation());</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(current_solution, postprocessor);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_file_number = 0;</div>
<div class="line">    std::string         filename =</div>
<div class="line">      <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(output_file_number, 3) + <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line">    std::ofstream output(filename);</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#gacad99726038e4fca7f605fdffb3317e4">write_vtk</a>(output);</div>
<div class="line"> </div>
<div class="line">    ++output_file_number;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">ConservationLaw&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classGridIn.html">GridIn&lt;dim&gt;</a> grid_in;</div>
<div class="line">      grid_in.<a class="code" href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">attach_triangulation</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line"> </div>
<div class="line">      std::ifstream input_file(parameters.mesh_filename);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(input_file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(parameters.mesh_filename.c_str()));</div>
<div class="line"> </div>
<div class="line">      grid_in.<a class="code" href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">read_ucd</a>(input_file);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#ad316958f8045d9a48094335b23a03a53">clear</a>();</div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line"> </div>
<div class="line">    old_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    current_solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    predictor.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    right_hand_side.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    setup_system();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                             parameters.initial_conditions,</div>
<div class="line">                             old_solution);</div>
<div class="line">    current_solution = old_solution;</div>
<div class="line">    predictor        = old_solution;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (parameters.do_refine == <span class="keyword">true</span>)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; parameters.shock_levels; ++i)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">          compute_refinement_indicators(refinement_indicators);</div>
<div class="line">          refine_grid(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">          setup_system();</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler,</div>
<div class="line">                                   parameters.initial_conditions,</div>
<div class="line">                                   old_solution);</div>
<div class="line">          current_solution = old_solution;</div>
<div class="line">          predictor        = old_solution;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    output_results();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> newton_update(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> time        = 0;</div>
<div class="line">    <span class="keywordtype">double</span> next_output = time + parameters.output_step;</div>
<div class="line"> </div>
<div class="line">    predictor = old_solution;</div>
<div class="line">    <span class="keywordflow">while</span> (time &lt; parameters.final_time)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;T=&quot;</span> &lt;&lt; time &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells() &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">                  &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   NonLin Res     Lin Iter       Lin Res&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;   _____________________________________&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nonlin_iter = 0;</div>
<div class="line">        current_solution         = predictor;</div>
<div class="line">        <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">          {</div>
<div class="line">            system_matrix = 0;</div>
<div class="line"> </div>
<div class="line">            right_hand_side = 0;</div>
<div class="line">            assemble_system();</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> res_norm = right_hand_side.l2_norm();</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(res_norm) &lt; 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-10)</div>
<div class="line">              {</div>
<div class="line">                std::printf(<span class="stringliteral">&quot;   %-16.3e (converged)\n\n&quot;</span>, res_norm);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              {</div>
<div class="line">                newton_update = 0;</div>
<div class="line"> </div>
<div class="line">                std::pair&lt;unsigned int, double&gt; convergence =</div>
<div class="line">                  solve(newton_update);</div>
<div class="line"> </div>
<div class="line">                current_solution += newton_update;</div>
<div class="line"> </div>
<div class="line">                std::printf(<span class="stringliteral">&quot;   %-16.3e %04d        %-5.2e\n&quot;</span>,</div>
<div class="line">                            res_norm,</div>
<div class="line">                            convergence.first,</div>
<div class="line">                            convergence.second);</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            ++nonlin_iter;</div>
<div class="line">            <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(nonlin_iter &lt;= 10,</div>
<div class="line">                        <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver&quot;</span>));</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        time += parameters.time_step;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (parameters.output_step &lt; 0)</div>
<div class="line">          output_results();</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (time &gt;= next_output)</div>
<div class="line">          {</div>
<div class="line">            output_results();</div>
<div class="line">            next_output += parameters.output_step;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        predictor = current_solution;</div>
<div class="line">        predictor.sadd(2.0, -1.0, old_solution);</div>
<div class="line"> </div>
<div class="line">        old_solution = current_solution;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (parameters.do_refine == <span class="keyword">true</span>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> refinement_indicators(</div>
<div class="line">              <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line">            compute_refinement_indicators(refinement_indicators);</div>
<div class="line"> </div>
<div class="line">            refine_grid(refinement_indicators);</div>
<div class="line">            setup_system();</div>
<div class="line"> </div>
<div class="line">            newton_update.<a class="code" href="group__Vectors.html#gac4a4dbef7dd65ef8ad35ae56b57d7c05">reinit</a>(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step33</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">      <span class="keyword">using namespace </span>Step33;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (argc != 2)</div>
<div class="line">        {</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; input_file&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">          std::exit(1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(</div>
<div class="line">        argc, argv, ::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>);</div>
<div class="line"> </div>
<div class="line">      ConservationLaw&lt;2&gt; cons(argv[1]);</div>
<div class="line">      cons.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> 。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
