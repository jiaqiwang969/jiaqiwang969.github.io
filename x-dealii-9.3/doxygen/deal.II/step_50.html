<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_50.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-50 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.3.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.3.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-50 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_16.html">step-16</a>, <a class="el" href="step_37.html">step-37</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Thetestcase">The testcase</a>
        <li><a href="#Workloadimbalanceforgeometricmultigridmethods">Workload imbalance for geometric multigrid methods</a>
        <li><a href="#Workloadimbalanceforalgebraicmultigridmethods">Workload imbalance for algebraic multigrid methods</a>
        <li><a href="#Runningtheprogram">Running the program</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a>
        <li><a href="#Coefficientsandhelperclasses">Coefficients and helper classes</a>
        <li><a href="#Runtimeparameters">Run time parameters</a>
        <li><a href="#LaplaceProblemclass">LaplaceProblem class</a>
      <ul>
        <li><a href="#LaplaceProblemsetup_system">LaplaceProblem::setup_system()</a>
        <li><a href="#LaplaceProblemsetup_multigrid">LaplaceProblem::setup_multigrid()</a>
        <li><a href="#LaplaceProblemassemble_system">LaplaceProblem::assemble_system()</a>
        <li><a href="#LaplaceProblemassemble_multigrid">LaplaceProblem::assemble_multigrid()</a>
        <li><a href="#LaplaceProblemassemble_rhs">LaplaceProblem::assemble_rhs()</a>
        <li><a href="#LaplaceProblemsolve">LaplaceProblem::solve()</a>
      </ul>
        <li><a href="#Theerrorestimator">The error estimator</a>
      <ul>
        <li><a href="#LaplaceProblemrefine_grid">LaplaceProblem::refine_grid()</a>
        <li><a href="#LaplaceProblemoutput_results">LaplaceProblem::output_results()</a>
        <li><a href="#LaplaceProblemrun">LaplaceProblem::run()</a>
      </ul>
        <li><a href="#Themainfunction">The main() function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Possibilitiesforextensions"> Possibilities for extensions </a>
      <ul>
        <li><a href="#Testingconvergenceandhigherorderelements"> Testing convergence and higher order elements </a>
        <li><a href="#Coarsesolver"> Coarse solver </a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
</p>
<p><em> This program was contributed by Thomas C. Clevenger and Timo Heister. <br  />
 This material is based upon work partly supported by the National Science Foundation Award DMS-2028346, OAC-2015848, EAR-1925575, by the Computational Infrastructure in Geodynamics initiative (CIG), through the NSF under Award EAR-0949446 and EAR-1550901 and The University of California &ndash; Davis. </em></p>
<dl class="section note"><dt>Note</dt><dd>If you use this program as a basis for your own work, please consider citing it in your list of references. The initial version of this work was contributed to the deal.II project by the authors listed in the following citation: <a href="https://doi.org/10.5281/zenodo.4004166"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.4004166.svg" alt="10.5281/zenodo.4004166"/></a> </dd>
<dd>
As a prerequisite of this program, you need to have both p4est and either the PETSc or Trilinos library installed. The installation of deal.II together with these additional libraries is described in the <a href="../../readme.html" target="body">README</a> file.</dd></dl>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>This example shows the usage of the multilevel functions in deal.II on parallel, distributed meshes and gives a comparison between geometric and algebraic multigrid methods. The algebraic multigrid (AMG) preconditioner is the same used in <a class="el" href="step_40.html">step-40</a>. Two geometric multigrid (GMG) preconditioners are considered: a matrix-based version similar to that in <a class="el" href="step_16.html">step-16</a> (but for parallel computations) and a matrix-free version discussed in <a class="el" href="step_37.html">step-37</a>. The goal is to find out which approach leads to the best solver for large parallel computations.</p>
<p>This tutorial is based on one of the numerical examples in <b>[clevenger_par_gmg]</b>. Please see that publication for a detailed background on the multigrid implementation in deal.II. We will summarize some of the results in the following text.</p>
<p>Algebraic multigrid methods are obviously the easiest to implement with deal.II since classes such as <a class="el" href="classTrilinosWrappers_1_1PreconditionAMG.html">TrilinosWrappers::PreconditionAMG</a> and <a class="el" href="classPETScWrappers_1_1PreconditionBoomerAMG.html">PETScWrappers::PreconditionBoomerAMG</a> are, in essence, black box preconditioners that require only a couple of lines to set up even for parallel computations. On the other hand, geometric multigrid methods require changes throughout a code base &ndash; not very many, but one has to know what one is doing.</p>
<p>What the results of this program will show is that algebraic and geometric multigrid methods are roughly comparable in performance <em>when using matrix-based formulations</em>, and that matrix-free geometric multigrid methods are vastly better for the problem under consideration here. A secondary conclusion will be that matrix-based geometric multigrid methods really don't scale well strongly when the number of unknowns per processor becomes smaller than 20,000 or so.</p>
<p><a class="anchor" id="Thetestcase"></a></p><h3>The testcase</h3>
<p>We consider the variable-coefficient Laplacian weak formulation </p><p class="formulaDsp">
\begin{align*} (\epsilon \nabla u, \nabla v) = (f,v) \quad \forall v \in V_h \end{align*}
</p>
<p> on the domain \(\Omega = [-1,1]^\text{dim} \setminus [0,1]^\text{dim}\) (an L-shaped domain for 2D and a Fichera corner for 3D) with \(\epsilon = 1\) if \(\min(x,y,z)&gt;-\frac{1}{2}\) and \(\epsilon = 100\) otherwise. In other words, \(\epsilon\) is small along the edges or faces of the domain that run into the reentrant corner, as will be visible in the figure below.</p>
<p>The boundary conditions are \(u=0\) on the whole boundary and the right-hand side is \(f=1\). We use continuous \(Q_2\) elements for the discrete finite element space \(V_h\), and use a residual-based, cell-wise a posteriori error estimator \(e(K) = e_{\text{cell}}(K) + e_{\text{face}}(K)\) from <b>[karakashian2003posteriori]</b> with </p><p class="formulaDsp">
\begin{align*} e_{\text{cell}}(K) &amp;= h^2 \| f + \epsilon \triangle u \|_K^2, \\ e_{\text{face}}(K) &amp;= \sum_F h_F \| \jump{ \epsilon \nabla u \cdot n } \|_F^2, \end{align*}
</p>
<p> to adaptively refine the mesh. (This is a generalization of the Kelly error estimator used in the <a class="el" href="classKellyErrorEstimator.html">KellyErrorEstimator</a> class that drives mesh refinement in most of the other tutorial programs.) The following figure visualizes the solution and refinement for 2D: <img src="https://www.dealii.org/images/steps/developer/step-50-2d-solution.png" alt="" width="400px" class="inline"/> In 3D, the solution looks similar (see below). On the left you can see the solution and on the right we show a slice for \(x\) close to the center of the domain showing the adaptively refined mesh. </p><table width="60%" align="center">
<tr>
<td align="center"><img src="https://www.dealii.org/images/steps/developer/step-50-3d-solution.png" alt="" width="400px" class="inline"/>  </td><td align="center"><img src="https://www.dealii.org/images/steps/developer/step-50-refinement.png" alt="" width="400px" class="inline"/>   </td></tr>
</table>
<p>Both in 2D and 3D you can see the adaptive refinement picking up the corner singularity and the inner singularity where the viscosity jumps, while the interface along the line that separates the two viscosities is (correctly) not refined as it is resolved adequately. This is because the kink in the solution that results from the jump in the coefficient is aligned with cell interfaces.</p>
<p><a class="anchor" id="Workloadimbalanceforgeometricmultigridmethods"></a></p><h3>Workload imbalance for geometric multigrid methods</h3>
<p>As mentioned above, the purpose of this program is to demonstrate the use of algebraic and geometric multigrid methods for this problem, and to do so for parallel computations. An important component of making algorithms scale to large parallel machines is ensuring that every processor has the same amount of work to do. (More precisely, what matters is that there are no small fraction of processors that have substantially more work than the rest since, if that were so, a large fraction of processors will sit idle waiting for the small fraction to finish. Conversely, a small fraction of processors having substantially <em>less</em> work is not a problem because the majority of processors continues to be productive and only the small fraction sits idle once finished with their work.)</p>
<p>For the active mesh, we use the <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a> class as done in <a class="el" href="step_40.html">step-40</a> which uses functionality in the external library <a href="http://www.p4est.org/">p4est</a> for the distribution of the active cells among processors. For the non-active cells in the multilevel hierarchy, deal.II implements what we will refer to as the "first-child rule" where, for each cell in the hierarchy, we recursively assign the parent of a cell to the owner of the first child cell. The following figures give an example of such a distribution. Here the left image represents the active cells for a sample 2D mesh partitioned using a space-filling curve (which is what p4est uses to partition cells); the center image gives the tree representation of the active mesh; and the right image gives the multilevel hierarchy of cells. The colors and numbers represent the different processors. The circular nodes in the tree are the non-active cells which are distributed using the "first-child rule".</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-50-workload-example.png" alt="" width="800px" class="inline"/></p>
<p>Included among the output to screen in this example is a value "Partition efficiency" given by one over <a class="el" href="namespaceMGTools.html#a8776ac550d9ac85e7e0db51625935673">MGTools::workload_imbalance()</a>. This value, which will be denoted by \(\mathbb{E}\), quantifies the overhead produced by not having a perfect work balance on each level of the multigrid hierarchy. This imbalance is evident from the example above: while level \(\ell=2\) is about as well balanced as is possible with four cells among three processors, the coarse level \(\ell=0\) has work for only one processor, and level \(\ell=1\) has work for only two processors of which one has three times as much work as the other.</p>
<p>For defining \(\mathbb{E}\), it is important to note that, as we are using local smoothing to define the multigrid hierarchy (see the <a class="el" href="DEALGlossary.html#mg_paper">multigrid paper</a> for a description of local smoothing), the refinement level of a cell corresponds to that cell's multigrid level. Now, let \(N_{\ell}\) be the number of cells on level \(\ell\) (both active and non-active cells) and \(N_{\ell,p}\) be the subset owned by process \(p\). We will also denote by \(P\) the total number of processors. Assuming that the workload for any one processor is proportional to the number of cells owned by that processor, the optimal workload per processor is given by </p><p class="formulaDsp">
\begin{align*} W_{\text{opt}} = \frac1{P}\sum_{\ell} N_{\ell} = \sum_{\ell}\left(\frac1{P}\sum_{p}N_{\ell,p}\right). \end{align*}
</p>
<p> Next, assuming a synchronization of work on each level (i.e., on each level of a V-cycle, work must be completed by all processors before moving on to the next level), the limiting effort on each level is given by </p><p class="formulaDsp">
\begin{align*} W_\ell = \max_{p} N_{\ell,p}, \end{align*}
</p>
<p> and the total parallel complexity </p><p class="formulaDsp">
\begin{align*} W = \sum_{\ell} W_\ell. \end{align*}
</p>
<p> Then we define \(\mathbb{E}\) as a ratio of the optimal partition to the parallel complexity of the current partition </p><p class="formulaDsp">
\begin{align*} \mathbb{E} = \frac{W_{\text{opt}}}{W}. \end{align*}
</p>
<p> For the example distribution above, we have </p><p class="formulaDsp">
\begin{align*} W_{\text{opt}}&amp;=\frac{1}{P}\sum_{\ell} N_{\ell} = \frac{1}{3} \left(1+4+4\right)= 3 \qquad \\ W &amp;= \sum_\ell W_\ell = 1 + 2 + 3 = 6 \\ \mathbb{E} &amp;= \frac{W_{\text{opt}}}{W} = \frac12. \end{align*}
</p>
<p> The value <a class="el" href="namespaceMGTools.html#a8776ac550d9ac85e7e0db51625935673">MGTools::workload_imbalance()</a> \(= 1/\mathbb{E}\) then represents the factor increase in timings we expect for GMG methods (vmults, assembly, etc.) due to the imbalance of the mesh partition compared to a perfectly load-balanced workload. We will report on these in the results section below for a sequence of meshes, and compare with the observed slow-downs as we go to larger and larger processor numbers (where, typically, the load imbalance becomes larger as well).</p>
<p>These sorts of considerations are considered in much greater detail in <b>[clevenger_par_gmg]</b>, which contains a full discussion of the partition efficiency model and the effect the imbalance has on the GMG V-cycle timing. In summary, the value of \(\mathbb{E}\) is highly dependent on the degree of local mesh refinement used and has an optimal value \(\mathbb{E} \approx 1\) for globally refined meshes. Typically for adaptively refined meshes, the number of processors used to distribute a single mesh has a negative impact on \(\mathbb{E}\) but only up to a leveling off point, where the imbalance remains relatively constant for an increasing number of processors, and further refinement has very little impact on \(\mathbb{E}\). Finally, \(1/\mathbb{E}\) was shown to give an accurate representation of the slowdown in parallel scaling expected for the timing of a V-cycle.</p>
<p>It should be noted that there is potential for some asynchronous work between multigrid levels, specifically with purely nearest neighbor MPI communication, and an adaptive mesh could be constructed such that the efficiency model would far overestimate the V-cycle slowdown due to the asynchronous work "covering up" the imbalance (which assumes synchronization over levels). However, for most realistic adaptive meshes the expectation is that this asynchronous work will only cover up a very small portion of the imbalance and the efficiency model will describe the slowdown very well.</p>
<p><a class="anchor" id="Workloadimbalanceforalgebraicmultigridmethods"></a></p><h3>Workload imbalance for algebraic multigrid methods</h3>
<p>The considerations above show that one has to expect certain limits on the scalability of the geometric multigrid algorithm as it is implemented in deal.II because even in cases where the finest levels of a mesh are perfectly load balanced, the coarser levels may not be. At the same time, the coarser levels are weighted less (the contributions of \(W_\ell\) to \(W\) are small) because coarser levels have fewer cells and, consequently, do not contribute to the overall run time as much as finer levels. In other words, imbalances in the coarser levels may not lead to large effects in the big picture.</p>
<p>Algebraic multigrid methods are of course based on an entirely different approach to creating a hierarchy of levels. In particular, they create these purely based on analyzing the system matrix, and very sophisticated algorithms for ensuring that the problem is well load-balanced on every level are implemented in both the hypre and ML/MueLu packages that underly the <a class="el" href="classTrilinosWrappers_1_1PreconditionAMG.html">TrilinosWrappers::PreconditionAMG</a> and <a class="el" href="classPETScWrappers_1_1PreconditionBoomerAMG.html">PETScWrappers::PreconditionBoomerAMG</a> classes. In some sense, these algorithms are simpler than for geometric multigrid methods because they only deal with the matrix itself, rather than all of the connotations of meshes, neighbors, parents, and other geometric entities. At the same time, much work has also been put into making algebraic multigrid methods scale to very large problems, including questions such as reducing the number of processors that work on a given level of the hierarchy to a subset of all processors, if otherwise processors would spend less time on computations than on communication. (One might note that it is of course possible to implement these same kinds of ideas also in geometric multigrid algorithms where one purposefully idles some processors on coarser levels to reduce the amount of communication. deal.II just doesn't do this at this time.)</p>
<p>These are not considerations we typically have to worry about here, however: For most purposes, we use algebraic multigrid methods as black-box methods.</p>
<p><a class="anchor" id="Runningtheprogram"></a></p><h3>Running the program</h3>
<p>As mentioned above, this program can use three different ways of solving the linear system: matrix-based geometric multigrid ("MB"), matrix-free geometric multigrid ("MF"), and algebraic multigrid ("AMG"). The directory in which this program resides has input files with suffix <code>.prm</code> for all three of these options, and for both 2d and 3d.</p>
<p>You can execute the program as in </p><div class="fragment"><div class="line">./step-50 gmg_mb_2d.prm</div>
</div><!-- fragment --><p> and this will take the run-time parameters from the given input file (here, <code>gmg_mb_2d.prm</code>).</p>
<p>The program is intended to be run in parallel, and you can achieve this using a command such as </p><div class="fragment"><div class="line">mpirun -np 4 ./step-50 gmg_mb_2d.prm</div>
</div><!-- fragment --><p> if you want to, for example, run on four processors. (That said, the program is also ready to run with, say, <code>-np 28672</code> if that's how many processors you have available.)</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>The include files are a combination of <a class="el" href="step_40.html">step-40</a>, <a class="el" href="step_16.html">step-16</a>, and <a class="el" href="step_37.html">step-37</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="data__out__base_8h.html">deal.II/base/data_out_base.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="index__set_8h.html">deal.II/base/index_set.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="logstream_8h.html">deal.II/base/logstream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="distributed_2grid__refinement_8h.html">deal.II/distributed/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="distributed_2tria_8h.html">deal.II/distributed/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="ttc" id="aaffine__constraints_8h_html"><div class="ttname"><a href="affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="aconditional__ostream_8h_html"><div class="ttname"><a href="conditional__ostream_8h.html">conditional_ostream.h</a></div></div>
<div class="ttc" id="adata__out__base_8h_html"><div class="ttname"><a href="data__out__base_8h.html">data_out_base.h</a></div></div>
<div class="ttc" id="adistributed_2grid__refinement_8h_html"><div class="ttname"><a href="distributed_2grid__refinement_8h.html">grid_refinement.h</a></div></div>
<div class="ttc" id="adistributed_2tria_8h_html"><div class="ttname"><a href="distributed_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="adof__tools_8h_html"><div class="ttname"><a href="dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="adynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="afe__q_8h_html"><div class="ttname"><a href="fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="agrid_2grid__refinement_8h_html"><div class="ttname"><a href="grid_2grid__refinement_8h.html">grid_refinement.h</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="agrid__generator_8h_html"><div class="ttname"><a href="grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="aindex__set_8h_html"><div class="ttname"><a href="index__set_8h.html">index_set.h</a></div></div>
<div class="ttc" id="alogstream_8h_html"><div class="ttname"><a href="logstream_8h.html">logstream.h</a></div></div>
<div class="ttc" id="aparameter__handler_8h_html"><div class="ttname"><a href="parameter__handler_8h.html">parameter_handler.h</a></div></div>
<div class="ttc" id="aquadrature__lib_8h_html"><div class="ttname"><a href="quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="asolver__cg_8h_html"><div class="ttname"><a href="solver__cg_8h.html">solver_cg.h</a></div></div>
<div class="ttc" id="atimer_8h_html"><div class="ttname"><a href="timer_8h.html">timer.h</a></div></div>
</div><!-- fragment --><p>We use the same strategy as in <a class="el" href="step_40.html">step-40</a> to switch between PETSc and Trilinos:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="generic__linear__algebra_8h.html">deal.II/lac/generic_linear_algebra.h</a>&gt;</span></div>
<div class="ttc" id="ageneric__linear__algebra_8h_html"><div class="ttname"><a href="generic__linear__algebra_8h.html">generic_linear_algebra.h</a></div></div>
</div><!-- fragment --><p>Comment the following preprocessor definition in or out if you have PETSc and Trilinos installed and you prefer using PETSc in this example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define FORCE_USE_OF_TRILINOS</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>LA</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if defined(DEAL_II_WITH_PETSC) &amp;&amp; !defined(DEAL_II_PETSC_WITH_COMPLEX) &amp;&amp; \</span></div>
<div class="line"><span class="preprocessor">  !(defined(DEAL_II_WITH_TRILINOS) &amp;&amp; defined(FORCE_USE_OF_TRILINOS))</span></div>
<div class="line">  <span class="keyword">using namespace </span>dealii::LinearAlgebraPETSc;</div>
<div class="line"><span class="preprocessor">#  define USE_PETSC_LA</span></div>
<div class="line"><span class="preprocessor">#elif defined(DEAL_II_WITH_TRILINOS)</span></div>
<div class="line">  <span class="keyword">using namespace </span>dealii::LinearAlgebraTrilinos;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#  error DEAL_II_WITH_PETSC or DEAL_II_WITH_TRILINOS required</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">} <span class="comment">// namespace LA</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__transfer__matrix__free_8h.html">deal.II/multigrid/mg_transfer_matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="ttc" id="afe__evaluation_8h_html"><div class="ttname"><a href="fe__evaluation_8h.html">fe_evaluation.h</a></div></div>
<div class="ttc" id="amatrix__free_8h_html"><div class="ttname"><a href="matrix__free_8h.html">matrix_free.h</a></div></div>
<div class="ttc" id="amg__coarse_8h_html"><div class="ttname"><a href="mg__coarse_8h.html">mg_coarse.h</a></div></div>
<div class="ttc" id="amg__constrained__dofs_8h_html"><div class="ttname"><a href="mg__constrained__dofs_8h.html">mg_constrained_dofs.h</a></div></div>
<div class="ttc" id="amg__matrix_8h_html"><div class="ttname"><a href="mg__matrix_8h.html">mg_matrix.h</a></div></div>
<div class="ttc" id="amg__smoother_8h_html"><div class="ttname"><a href="mg__smoother_8h.html">mg_smoother.h</a></div></div>
<div class="ttc" id="amg__tools_8h_html"><div class="ttname"><a href="mg__tools_8h.html">mg_tools.h</a></div></div>
<div class="ttc" id="amg__transfer_8h_html"><div class="ttname"><a href="mg__transfer_8h.html">mg_transfer.h</a></div></div>
<div class="ttc" id="amg__transfer__matrix__free_8h_html"><div class="ttname"><a href="mg__transfer__matrix__free_8h.html">mg_transfer_matrix_free.h</a></div></div>
<div class="ttc" id="amultigrid_8h_html"><div class="ttname"><a href="multigrid_8h.html">multigrid.h</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aoperators_8h_html"><div class="ttname"><a href="operators_8h.html">operators.h</a></div></div>
<div class="ttc" id="avector__tools_8h_html"><div class="ttname"><a href="vector__tools_8h.html">vector_tools.h</a></div></div>
</div><!-- fragment --><p>The following files are used to assemble the error estimator like in <a class="el" href="step_12.html">step-12</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__interface__values_8h.html">deal.II/fe/fe_interface_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mesh__loop_8h.html">deal.II/meshworker/mesh_loop.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="ttc" id="afe__interface__values_8h_html"><div class="ttname"><a href="fe__interface__values_8h.html">fe_interface_values.h</a></div></div>
<div class="ttc" id="amesh__loop_8h_html"><div class="ttname"><a href="mesh__loop_8h.html">mesh_loop.h</a></div></div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="namespace__dealii_8h_source.html#l00025">namespace_dealii.h:26</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Coefficientsandhelperclasses"></a> </p><h3>Coefficients and helper classes</h3>
<p><a class="el" href="classMatrixFree.html">MatrixFree</a> operators must use the <a class="el" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a> vector type. Here we define operations which copy to and from Trilinos vectors for compatibility with the matrix-based code. Note that this functionality does not currently exist for PETSc vector types, so Trilinos must be installed to use the <a class="el" href="classMatrixFree.html">MatrixFree</a> solver in this tutorial.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>ChangeVectorTypes</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a>(<a class="code" href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LA::MPI::Vector</a> &amp;                                         out,</div>
<div class="line">            const ::LinearAlgebra::distributed::Vector&lt;number&gt; &amp;in)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1ReadWriteVector.html">::LinearAlgebra::ReadWriteVector&lt;double&gt;</a> rwv(</div>
<div class="line">      out.locally_owned_elements());</div>
<div class="line">    rwv.import(in, <a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae5042eefddc828c7c31e1e8e26da8b09">VectorOperation::insert</a>);</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;CopyVectorTypes::copy() not implemented for &quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;PETSc vector types.&quot;</span>));</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    out.import(rwv, <a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae5042eefddc828c7c31e1e8e26da8b09">VectorOperation::insert</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a>(::<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;out,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LA::MPI::Vector</a> &amp;                             in)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1ReadWriteVector.html">::LinearAlgebra::ReadWriteVector&lt;double&gt;</a> rwv;</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">    (void)in;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;CopyVectorTypes::copy() not implemented for &quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;PETSc vector types.&quot;</span>));</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    rwv.<a class="code" href="group__Vectors.html#gaaee2ea7c671f9ece558b081b0d104295">reinit</a>(in);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    out.<a class="code" href="group__Vectors.html#gaf7b743d761233b92e0ed23e6bf37a409">import</a>(rwv, <a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae5042eefddc828c7c31e1e8e26da8b09">VectorOperation::insert</a>);</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace ChangeVectorTypes</span></div>
<div class="ttc" id="aclassLinearAlgebra_1_1ReadWriteVector_html"><div class="ttname"><a href="classLinearAlgebra_1_1ReadWriteVector.html">LinearAlgebra::ReadWriteVector</a></div><div class="ttdef"><b>Definition:</b> <a href="read__write__vector_8h_source.html#l00133">read_write_vector.h:134</a></div></div>
<div class="ttc" id="aclassLinearAlgebra_1_1distributed_1_1Vector_html"><div class="ttname"><a href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="la__parallel__vector_8h_source.html#l00248">la_parallel_vector.h:250</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
<div class="ttc" id="agroup__Exceptions_html_gafc0ca7ad85b3ebd64e8e51689ac85caf"><div class="ttname"><a href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a></div><div class="ttdeci">#define AssertThrow(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01583">exceptions.h:1583</a></div></div>
<div class="ttc" id="agroup__Vectors_html_gaaee2ea7c671f9ece558b081b0d104295"><div class="ttname"><a href="group__Vectors.html#gaaee2ea7c671f9ece558b081b0d104295">LinearAlgebra::ReadWriteVector::reinit</a></div><div class="ttdeci">virtual void reinit(const size_type size, const bool omit_zeroing_entries=false)</div></div>
<div class="ttc" id="agroup__Vectors_html_gaf7b743d761233b92e0ed23e6bf37a409"><div class="ttname"><a href="group__Vectors.html#gaf7b743d761233b92e0ed23e6bf37a409">LinearAlgebra::distributed::Vector::import</a></div><div class="ttdeci">void import(const Vector&lt; Number, MemorySpace2 &gt; &amp;src, VectorOperation::values operation)</div></div>
<div class="ttc" id="agroup__Vectors_html_gga40c50779cd14ba89bbf0bd9b4561964cae5042eefddc828c7c31e1e8e26da8b09"><div class="ttname"><a href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae5042eefddc828c7c31e1e8e26da8b09">VectorOperation::insert</a></div><div class="ttdeci">@ insert</div><div class="ttdef"><b>Definition:</b> <a href="vector__operation_8h_source.html#l00049">vector_operation.h:49</a></div></div>
<div class="ttc" id="anamespaceLinearAlgebraDealII_html_a9fe13d579422411556954ab3f28a59be"><div class="ttname"><a href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LinearAlgebraDealII::Vector</a></div><div class="ttdeci">Vector&lt; double &gt; Vector</div><div class="ttdef"><b>Definition:</b> <a href="generic__linear__algebra_8h_source.html#l00043">generic_linear_algebra.h:43</a></div></div>
<div class="ttc" id="anamespaceinternal_1_1VectorOperations_html_a40c8daa0881cff0123fbaeb08929f5cb"><div class="ttname"><a href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">internal::VectorOperations::copy</a></div><div class="ttdeci">void copy(const T *begin, const T *end, U *dest)</div><div class="ttdef"><b>Definition:</b> <a href="vector__operations__internal_8h_source.html#l00068">vector_operations_internal.h:68</a></div></div>
</div><!-- fragment --><p>Let's move on to the description of the problem we want to solve. We set the right-hand side function to 1.0. The <code>value</code> function returning a <a class="el" href="classVectorizedArray.html">VectorizedArray</a> is used by the matrix-free code path.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*component*/</span> = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> 1.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a></div>
<div class="line">  <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a>&lt;dim, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*component*/</span> = 0)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>(1.0);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassFunction_html"><div class="ttname"><a href="classFunction.html">Function</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00150">function.h:153</a></div></div>
<div class="ttc" id="aclassFunction_html_acbfcab66b2fc63bfea59268f40772bb4"><div class="ttname"><a href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">Function::value</a></div><div class="ttdeci">virtual RangeNumberType value(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const</div></div>
<div class="ttc" id="aclassPoint_html"><div class="ttname"><a href="classPoint.html">Point</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2point_8h_source.html#l00110">point.h:111</a></div></div>
<div class="ttc" id="aclassVectorizedArray_html"><div class="ttname"><a href="classVectorizedArray.html">VectorizedArray</a></div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l00389">vectorization.h:391</a></div></div>
</div><!-- fragment --><p>This next class represents the diffusion coefficient. We use a variable coefficient which is 100.0 at any point where at least one coordinate is less than -0.5, and 1.0 at all other points. As above, a separate value() returning a <a class="el" href="classVectorizedArray.html">VectorizedArray</a> is used for the matrix-free code. An <code>average()</code> function computes the arithmetic average for a set of points.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>Coefficient : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;p,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*component*/</span> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a>&lt;dim, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp;p,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*component*/</span> = 0) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  number average_value(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim, number&gt;</a>&gt; &amp;points) <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>When using a coefficient in the <a class="el" href="classMatrixFree.html">MatrixFree</a> framework, we also need a function that creates a <a class="el" href="classTable.html">Table</a> of coefficient values for a set of cells provided by the <a class="el" href="classMatrixFree.html">MatrixFree</a> operator argument here.</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  std::shared_ptr&lt;Table&lt;2, VectorizedArray&lt;number&gt;&gt;&gt; make_coefficient_table(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree</a>&lt;dim, number, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp;mf_storage) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> Coefficient&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;p, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (p[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] &lt; -0.5)</div>
<div class="line">        <span class="keywordflow">return</span> 100.0;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">return</span> 1.0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line"><a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a></div>
<div class="line">Coefficient&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a>&lt;dim, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp;p,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a> return_value = <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>(1.0);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; VectorizedArray&lt;number&gt;::size(); ++i)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        <span class="keywordflow">if</span> (p[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>][i] &lt; -0.5)</div>
<div class="line">          {</div>
<div class="line">            return_value[i] = 100.0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> return_value;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">number Coefficient&lt;dim&gt;::average_value(</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim, number&gt;</a>&gt; &amp;points)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  number average(0);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; points.size(); ++i)</div>
<div class="line">    average += <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(points[i]);</div>
<div class="line">  average /= points.size();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> average;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">std::shared_ptr&lt;Table&lt;2, VectorizedArray&lt;number&gt;&gt;&gt;</div>
<div class="line">Coefficient&lt;dim&gt;::make_coefficient_table(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree</a>&lt;dim, number, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp;mf_storage)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">auto</span> coefficient_table =</div>
<div class="line">    std::make_shared&lt;Table&lt;2, VectorizedArray&lt;number&gt;&gt;&gt;();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation</a>&lt;dim, -1, 0, 1, number&gt; fe_eval(mf_storage);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>    = mf_storage.n_cell_batches();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = fe_eval.n_q_points;</div>
<div class="line"> </div>
<div class="line">  coefficient_table-&gt;reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, 1);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++cell)</div>
<div class="line">    {</div>
<div class="line">      fe_eval.reinit(cell);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a> average_value = 0.;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">        average_value += <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(fe_eval.quadrature_point(q));</div>
<div class="line">      average_value /= n_q_points;</div>
<div class="line"> </div>
<div class="line">      (*coefficient_table)(cell, 0) = average_value;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> coefficient_table;</div>
<div class="line">}</div>
<div class="ttc" id="aclassFEEvaluation_html"><div class="ttname"><a href="classFEEvaluation.html">FEEvaluation</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__evaluation_8h_source.html#l02511">fe_evaluation.h:2516</a></div></div>
<div class="ttc" id="aclassMatrixFree_html"><div class="ttname"><a href="classMatrixFree.html">MatrixFree</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00116">matrix_free.h:117</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a15728437b942dab0b0042eb06a407d2c"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">Physics::Elasticity::Kinematics::d</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; d(const Tensor&lt; 2, dim, Number &gt; &amp;F, const Tensor&lt; 2, dim, Number &gt; &amp;dF_dt)</div></div>
<div class="ttc" id="anamespaceinternal_1_1TriangulationImplementation_html_a9f815604be9b560fea00beef8d720480"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">internal::TriangulationImplementation::n_cells</a></div><div class="ttdeci">unsigned int n_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12651">tria.cc:12651</a></div></div>
<div class="ttc" id="anamespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div><div class="ttdeci">@ value</div></div>
</div><!-- fragment --><p><a class="anchor" id="Runtimeparameters"></a> </p><h3>Run time parameters</h3>
<p>We will use <a class="el" href="classParameterHandler.html">ParameterHandler</a> to pass in parameters at runtime. The structure <code>Settings</code> parses and stores these parameters to be queried throughout the program.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a></div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">bool</span> try_parse(<span class="keyword">const</span> std::string &amp;prm_filename);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> <a class="code" href="classSolverType.html">SolverType</a></div>
<div class="line">  {</div>
<div class="line">    gmg_mb,</div>
<div class="line">    gmg_mf,</div>
<div class="line">    amg</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolverType.html">SolverType</a> solver;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span>          dimension;</div>
<div class="line">  <span class="keywordtype">double</span>       smoother_dampen;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> smoother_steps;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_steps;</div>
<div class="line">  <span class="keywordtype">bool</span>         output;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> Settings::try_parse(<span class="keyword">const</span> std::string &amp;prm_filename)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;dim&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(), <span class="stringliteral">&quot;The problem dimension.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;n_steps&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;10&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of adaptive refinement steps.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;smoother dampen&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;1.0&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                    <span class="stringliteral">&quot;Dampen factor for the smoother.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;smoother steps&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of smoother steps.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;solver&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;MF&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;MF|MB|AMG&quot;</span>),</div>
<div class="line">                    <span class="stringliteral">&quot;Switch between matrix-free GMG, &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;matrix-based GMG, and AMG.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;output&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;false&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Output graphical results.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (prm_filename.size() == 0)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;****  Error: No input file provided!\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;****  Error: Call this program as &#39;./step-50 input.prm\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;****  You may want to use one of the input files in this\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;****  directory, or use the following default values\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;****  to create an input file:\n&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">print_parameters</a>(std::cout, <a class="code" href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827ae4d13a4598073bfcb69cd0cf4c1f8365">ParameterHandler::Text</a>);</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(prm_filename);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">        std::cerr &lt;&lt; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>.what() &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;solver&quot;</span>) == <span class="stringliteral">&quot;MF&quot;</span>)</div>
<div class="line">    this-&gt;solver = gmg_mf;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;solver&quot;</span>) == <span class="stringliteral">&quot;MB&quot;</span>)</div>
<div class="line">    this-&gt;solver = gmg_mb;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;solver&quot;</span>) == <span class="stringliteral">&quot;AMG&quot;</span>)</div>
<div class="line">    this-&gt;solver = amg;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">  this-&gt;dimension       = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;dim&quot;</span>);</div>
<div class="line">  this-&gt;n_steps         = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;n_steps&quot;</span>);</div>
<div class="line">  this-&gt;smoother_dampen = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;smoother dampen&quot;</span>);</div>
<div class="line">  this-&gt;smoother_steps  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;smoother steps&quot;</span>);</div>
<div class="line">  this-&gt;output          = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassParameterHandler_html"><div class="ttname"><a href="classParameterHandler.html">ParameterHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8h_source.html#l00840">parameter_handler.h:841</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a0ddaa05c5463c6c0b7701e18005717a9"><div class="ttname"><a href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">ParameterHandler::parse_input</a></div><div class="ttdeci">virtual void parse_input(std::istream &amp;input, const std::string &amp;filename=&quot;input file&quot;, const std::string &amp;last_line=&quot;&quot;, const bool skip_undefined=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00399">parameter_handler.cc:399</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a4ac3a8b19ade16e96e8ea25906daf23a"><div class="ttname"><a href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">ParameterHandler::print_parameters</a></div><div class="ttdeci">std::ostream &amp; print_parameters(std::ostream &amp;out, const OutputStyle style) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01250">parameter_handler.cc:1250</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a61fa98fdc0c52980a5b1de0ee1fc5bb2"><div class="ttname"><a href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">ParameterHandler::get_integer</a></div><div class="ttdeci">long int get_integer(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01025">parameter_handler.cc:1025</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6bb45dc67787e3fab7882461929b5fbe"><div class="ttname"><a href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">ParameterHandler::get_bool</a></div><div class="ttdeci">bool get_bool(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01113">parameter_handler.cc:1113</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6d65f458be69e23a348221cb67fc411d"><div class="ttname"><a href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a></div><div class="ttdeci">void declare_entry(const std::string &amp;entry, const std::string &amp;default_value, const Patterns::PatternBase &amp;pattern=Patterns::Anything(), const std::string &amp;documentation=&quot;&quot;, const bool has_to_be_set=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00796">parameter_handler.cc:796</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a91cfbaca954f444047302446a4e87125"><div class="ttname"><a href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">ParameterHandler::get</a></div><div class="ttdeci">std::string get(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00987">parameter_handler.cc:987</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_aeaf3c7846747695b1f327677e3716ec5"><div class="ttname"><a href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">ParameterHandler::get_double</a></div><div class="ttdeci">double get_double(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01068">parameter_handler.cc:1068</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Bool_html"><div class="ttname"><a href="classPatterns_1_1Bool.html">Patterns::Bool</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00981">patterns.h:982</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Double_html"><div class="ttname"><a href="classPatterns_1_1Double.html">Patterns::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00292">patterns.h:293</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Integer_html"><div class="ttname"><a href="classPatterns_1_1Integer.html">Patterns::Integer</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00189">patterns.h:190</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Selection_html"><div class="ttname"><a href="classPatterns_1_1Selection.html">Patterns::Selection</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00382">patterns.h:383</a></div></div>
<div class="ttc" id="aclassSolverType_html"><div class="ttname"><a href="classSolverType.html">SolverType</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga7b52b286796c23ef9ff178faf7a4b68f"><div class="ttname"><a href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">StandardExceptions::ExcNotImplemented</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcNotImplemented()</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga8364dda711b93753c6809eefe2a8e827ae4d13a4598073bfcb69cd0cf4c1f8365"><div class="ttname"><a href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827ae4d13a4598073bfcb69cd0cf4c1f8365">ParameterHandler::Text</a></div><div class="ttdeci">@ Text</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8h_source.html#l00889">parameter_handler.h:889</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="anamespaceTriangulationDescription_html_aa1531298eb0a267d9ceca5eb46ada8e0"><div class="ttname"><a href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">TriangulationDescription::Settings</a></div><div class="ttdeci">Settings</div><div class="ttdef"><b>Definition:</b> <a href="tria__description_8h_source.html#l00254">tria_description.h:255</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1MPI_html_a895dcd8223a0ee6f0e6a80b80e2d5982"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a></div><div class="ttdeci">unsigned int this_mpi_process(const MPI_Comm &amp;mpi_communicator)</div><div class="ttdef"><b>Definition:</b> <a href="mpi_8cc_source.html#l00128">mpi.cc:128</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemclass"></a> </p><h3>LaplaceProblem class</h3>
<p>This is the main class of the program. It looks very similar to <a class="el" href="step_16.html">step-16</a>, <a class="el" href="step_37.html">step-37</a>, and <a class="el" href="step_40.html">step-40</a>. For the <a class="el" href="classMatrixFree.html">MatrixFree</a> setup, we use the <a class="el" href="classMatrixFreeOperators_1_1LaplaceOperator.html">MatrixFreeOperators::LaplaceOperator</a> class which defines <code>local_apply()</code>, <code><a class="el" href="namespaceMatrixFreeTools.html#a523190adf5671e317d745fed4b1d357f">compute_diagonal()</a></code>, and <code>set_coefficient()</code> functions internally. Note that the polynomial degree is a template parameter of this class. This is necesary for the matrix-free code.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keyword">class </span>LaplaceProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  LaplaceProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;settings);</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="ttc" id="anamespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00691">work_stream.h:691</a></div></div>
</div><!-- fragment --><p>We will use the following types throughout the program. First the matrix-based types, after that the matrix-free classes. For the matrix-free implementation, we use <code>float</code> for the level operators.</p>
<div class="fragment"><div class="line">  <span class="keyword">using</span> MatrixType         = <a class="code" href="namespaceLinearAlgebraDealII.html#a912abe2208022aec6753876bcc72f6bf">LA::MPI::SparseMatrix</a>;</div>
<div class="line">  <span class="keyword">using</span> VectorType         = <a class="code" href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LA::MPI::Vector</a>;</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a41f11f7a1992c6d6aa9367b12c68f791">PreconditionAMG</a>    = <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a41f11f7a1992c6d6aa9367b12c68f791">LA::MPI::PreconditionAMG</a>;</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="classPreconditionJacobi.html">PreconditionJacobi</a> = <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a84fd288bacabd1a7e3408885fb0fad01">LA::MPI::PreconditionJacobi</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> MatrixFreeLevelMatrix = <a class="code" href="classMatrixFreeOperators_1_1LaplaceOperator.html">MatrixFreeOperators::LaplaceOperator</a>&lt;</div>
<div class="line">    dim,</div>
<div class="line">    degree,</div>
<div class="line">    degree + 1,</div>
<div class="line">    1,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div>
<div class="line">  <span class="keyword">using</span> MatrixFreeActiveMatrix = <a class="code" href="classMatrixFreeOperators_1_1LaplaceOperator.html">MatrixFreeOperators::LaplaceOperator</a>&lt;</div>
<div class="line">    dim,</div>
<div class="line">    degree,</div>
<div class="line">    degree + 1,</div>
<div class="line">    1,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> MatrixFreeLevelVector  = <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>;</div>
<div class="line">  <span class="keyword">using</span> MatrixFreeActiveVector = <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line">  <span class="keywordtype">void</span> setup_multigrid();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_multigrid();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_rhs();</div>
<div class="line">  <span class="keywordtype">void</span> solve();</div>
<div class="line">  <span class="keywordtype">void</span> estimate();</div>
<div class="line">  <span class="keywordtype">void</span> refine_grid();</div>
<div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> settings;</div>
<div class="line"> </div>
<div class="line">  MPI_Comm           mpi_communicator;</div>
<div class="line">  <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a>                      mapping;</div>
<div class="line">  <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>                                 fe;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classIndexSet.html">IndexSet</a>                  locally_owned_dofs;</div>
<div class="line">  <a class="code" href="classIndexSet.html">IndexSet</a>                  locally_relevant_dofs;</div>
<div class="line">  <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"> </div>
<div class="line">  MatrixType             system_matrix;</div>
<div class="line">  MatrixFreeActiveMatrix mf_system_matrix;</div>
<div class="line">  VectorType             solution;</div>
<div class="line">  VectorType             right_hand_side;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>         estimated_error_square_per_cell;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixType&gt;</a> mg_matrix;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixType&gt;</a> mg_interface_in;</div>
<div class="line">  <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a>         mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixFreeLevelMatrix&gt;</a> mf_mg_matrix;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">};</div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassConditionalOStream_html"><div class="ttname"><a href="classConditionalOStream.html">ConditionalOStream</a></div><div class="ttdef"><b>Definition:</b> <a href="conditional__ostream_8h_source.html#l00080">conditional_ostream.h:81</a></div></div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00314">dof_handler.h:315</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8h_source.html#l00548">fe_q.h:549</a></div></div>
<div class="ttc" id="aclassIndexSet_html"><div class="ttname"><a href="classIndexSet.html">IndexSet</a></div><div class="ttdef"><b>Definition:</b> <a href="index__set_8h_source.html#l00072">index_set.h:73</a></div></div>
<div class="ttc" id="aclassMGConstrainedDoFs_html"><div class="ttname"><a href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__constrained__dofs_8h_source.html#l00046">mg_constrained_dofs.h:47</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html"><div class="ttname"><a href="classMGLevelObject.html">MGLevelObject</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__level__object_8h_source.html#l00049">mg_level_object.h:50</a></div></div>
<div class="ttc" id="aclassMappingQ1_html"><div class="ttname"><a href="classMappingQ1.html">MappingQ1</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q1_8h_source.html#l00054">mapping_q1.h:55</a></div></div>
<div class="ttc" id="aclassMatrixFreeOperators_1_1LaplaceOperator_html"><div class="ttname"><a href="classMatrixFreeOperators_1_1LaplaceOperator.html">MatrixFreeOperators::LaplaceOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l00805">operators.h:806</a></div></div>
<div class="ttc" id="aclassPreconditionJacobi_html"><div class="ttname"><a href="classPreconditionJacobi.html">PreconditionJacobi</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00497">precondition.h:498</a></div></div>
<div class="ttc" id="aclassTimerOutput_html"><div class="ttname"><a href="classTimerOutput.html">TimerOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00544">timer.h:545</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassparallel_1_1distributed_1_1Triangulation_html"><div class="ttname"><a href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="distributed_2tria_8h_source.html#l00252">tria.h:254</a></div></div>
<div class="ttc" id="anamespaceLinearAlgebraDealII_html_a912abe2208022aec6753876bcc72f6bf"><div class="ttname"><a href="namespaceLinearAlgebraDealII.html#a912abe2208022aec6753876bcc72f6bf">LinearAlgebraDealII::SparseMatrix</a></div><div class="ttdeci">SparseMatrix&lt; double &gt; SparseMatrix</div><div class="ttdef"><b>Definition:</b> <a href="generic__linear__algebra_8h_source.html#l00053">generic_linear_algebra.h:53</a></div></div>
<div class="ttc" id="anamespaceLinearAlgebraPETSc_1_1MPI_html_a41f11f7a1992c6d6aa9367b12c68f791"><div class="ttname"><a href="namespaceLinearAlgebraPETSc_1_1MPI.html#a41f11f7a1992c6d6aa9367b12c68f791">LinearAlgebraPETSc::MPI::PreconditionAMG</a></div><div class="ttdeci">PETScWrappers::PreconditionBoomerAMG PreconditionAMG</div><div class="ttdef"><b>Definition:</b> <a href="generic__linear__algebra_8h_source.html#l00133">generic_linear_algebra.h:133</a></div></div>
<div class="ttc" id="anamespaceLinearAlgebraPETSc_1_1MPI_html_a84fd288bacabd1a7e3408885fb0fad01"><div class="ttname"><a href="namespaceLinearAlgebraPETSc_1_1MPI.html#a84fd288bacabd1a7e3408885fb0fad01">LinearAlgebraPETSc::MPI::PreconditionJacobi</a></div><div class="ttdeci">PETScWrappers::PreconditionJacobi PreconditionJacobi</div><div class="ttdef"><b>Definition:</b> <a href="generic__linear__algebra_8h_source.html#l00148">generic_linear_algebra.h:148</a></div></div>
<div class="ttc" id="ap4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
</div><!-- fragment --><p>The only interesting part about the constructor is that we construct the multigrid hierarchy unless we use AMG. For that, we need to parse the run time parameters before this constructor completes.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line">LaplaceProblem&lt;dim, degree&gt;::LaplaceProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;settings)</div>
<div class="line">  : settings(settings)</div>
<div class="line">  , mpi_communicator(MPI_COMM_WORLD)</div>
<div class="line">  , pcout(std::cout, (<a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(mpi_communicator) == 0))</div>
<div class="line">  , <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(mpi_communicator,</div>
<div class="line">                  <a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::limit_level_difference_at_vertices,</div>
<div class="line">                  (settings.solver == <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a>::amg) ?</div>
<div class="line">                    <a class="code" href="namespaceparallel.html">parallel</a>::distributed::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a7c2ea84f1b4c5f2a6aa010f600ca66b6">default_setting</a> :</div>
<div class="line">                    <a class="code" href="namespaceparallel.html">parallel</a>::distributed::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;</div>
<div class="line">                      dim&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0acc0ed1c2dd30bca7c7576e65b4045274">construct_multigrid_hierarchy</a>)</div>
<div class="line">  , mapping()</div>
<div class="line">  , fe(degree)</div>
<div class="line">  , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , computing_timer(pcout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::never, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#a3b2a4ad8296c2b72a11d23b5969e8cc0">GridGenerator::hyper_L</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>, -1., 1., <span class="comment">/*colorize*/</span> <span class="keyword">false</span>);</div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(1);</div>
<div class="line">}</div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01127">tria.h:1128</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_a3b2a4ad8296c2b72a11d23b5969e8cc0"><div class="ttname"><a href="namespaceGridGenerator.html#a3b2a4ad8296c2b72a11d23b5969e8cc0">GridGenerator::hyper_L</a></div><div class="ttdeci">void hyper_L(Triangulation&lt; dim &gt; &amp;tria, const double left=-1., const double right=1., const bool colorize=false)</div></div>
<div class="ttc" id="anamespaceTriangulationDescription_html_aa1531298eb0a267d9ceca5eb46ada8e0a7c2ea84f1b4c5f2a6aa010f600ca66b6"><div class="ttname"><a href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a7c2ea84f1b4c5f2a6aa010f600ca66b6">TriangulationDescription::default_setting</a></div><div class="ttdeci">@ default_setting</div><div class="ttdef"><b>Definition:</b> <a href="tria__description_8h_source.html#l00259">tria_description.h:259</a></div></div>
<div class="ttc" id="anamespaceTriangulationDescription_html_aa1531298eb0a267d9ceca5eb46ada8e0acc0ed1c2dd30bca7c7576e65b4045274"><div class="ttname"><a href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0acc0ed1c2dd30bca7c7576e65b4045274">TriangulationDescription::construct_multigrid_hierarchy</a></div><div class="ttdeci">@ construct_multigrid_hierarchy</div><div class="ttdef"><b>Definition:</b> <a href="tria__description_8h_source.html#l00266">tria_description.h:265</a></div></div>
<div class="ttc" id="anamespaceUtilities_html"><div class="ttname"><a href="namespaceUtilities.html">Utilities</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2communication__pattern__base_8h_source.html#l00030">communication_pattern_base.h:31</a></div></div>
<div class="ttc" id="anamespaceparallel_html"><div class="ttname"><a href="namespaceparallel.html">parallel</a></div><div class="ttdef"><b>Definition:</b> <a href="distributed_8h_source.html#l00416">distributed.h:417</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemsetup_system"></a> </p><h4>LaplaceProblem::setup_system()</h4>
<p>Unlike <a class="el" href="step_16.html">step-16</a> and <a class="el" href="step_37.html">step-37</a>, we split the set up into two parts, setup_system() and setup_multigrid(). Here is the typical setup_system() function for the active mesh found in most tutorials. For matrix-free, the active mesh set up is similar to <a class="el" href="step_37.html">step-37</a>; for matrix-based (GMG and AMG solvers), the setup is similar to <a class="el" href="step_40.html">step-40</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  dof_handler.distribute_dofs(fe);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div>
<div class="line">  locally_owned_dofs = dof_handler.locally_owned_dofs();</div>
<div class="line"> </div>
<div class="line">  solution.reinit(locally_owned_dofs, mpi_communicator);</div>
<div class="line">  right_hand_side.reinit(locally_owned_dofs, mpi_communicator);</div>
<div class="line">  constraints.reinit(locally_relevant_dofs);</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">    mapping, dof_handler, 0, <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), constraints);</div>
<div class="line">  constraints.close();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (settings.solver)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mf:</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div>
<div class="line">          additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">            <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::none</a>;</div>
<div class="line">          additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">            (<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">          std::shared_ptr&lt;MatrixFree&lt;dim, double&gt;&gt; mf_storage =</div>
<div class="line">            std::make_shared&lt;MatrixFree&lt;dim, double&gt;&gt;();</div>
<div class="line">          mf_storage-&gt;reinit(mapping,</div>
<div class="line">                             dof_handler,</div>
<div class="line">                             constraints,</div>
<div class="line">                             <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(degree + 1),</div>
<div class="line">                             additional_data);</div>
<div class="line"> </div>
<div class="line">          mf_system_matrix.initialize(mf_storage);</div>
<div class="line"> </div>
<div class="line">          <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line">          mf_system_matrix.set_coefficient(</div>
<div class="line">            coefficient.make_coefficient_table(*mf_storage));</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mb:</div>
<div class="line">      <span class="keywordflow">case</span> Settings::amg:</div>
<div class="line">        {</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">          <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(locally_relevant_dofs);</div>
<div class="line">          <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp, constraints);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceSparsityTools.html#afbc0c7a206ced91b154666215ea3c218">SparsityTools::distribute_sparsity_pattern</a>(dsp,</div>
<div class="line">                                                     locally_owned_dofs,</div>
<div class="line">                                                     mpi_communicator,</div>
<div class="line">                                                     locally_relevant_dofs);</div>
<div class="line"> </div>
<div class="line">          system_matrix.reinit(locally_owned_dofs,</div>
<div class="line">                               locally_owned_dofs,</div>
<div class="line">                               dsp,</div>
<div class="line">                               mpi_communicator);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">          <a class="code" href="classTrilinosWrappers_1_1SparsityPattern.html">TrilinosWrappers::SparsityPattern</a> dsp(locally_owned_dofs,</div>
<div class="line">                                                locally_owned_dofs,</div>
<div class="line">                                                locally_relevant_dofs,</div>
<div class="line">                                                mpi_communicator);</div>
<div class="line">          <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp, constraints);</div>
<div class="line">          dsp.compress();</div>
<div class="line">          system_matrix.reinit(dsp);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamic__sparsity__pattern_8h_source.html#l00318">dynamic_sparsity_pattern.h:319</a></div></div>
<div class="ttc" id="aclassFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00510">function.h:511</a></div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00038">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="aclassTimerOutput_1_1Scope_html"><div class="ttname"><a href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00552">timer.h:553</a></div></div>
<div class="ttc" id="aclassTrilinosWrappers_1_1SparsityPattern_html"><div class="ttname"><a href="classTrilinosWrappers_1_1SparsityPattern.html">TrilinosWrappers::SparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparsity__pattern_8h_source.html#l00276">trilinos_sparsity_pattern.h:277</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00129">fe_update_flags.h:129</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00084">fe_update_flags.h:84</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00122">fe_update_flags.h:122</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01473">exceptions.h:1473</a></div></div>
<div class="ttc" id="agroup__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_acad7e0841b9046eaafddc4c617ab1d9d"><div class="ttname"><a href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a></div><div class="ttdeci">void extract_locally_relevant_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01210">dof_tools.cc:1210</a></div></div>
<div class="ttc" id="anamespaceSparsityTools_html_afbc0c7a206ced91b154666215ea3c218"><div class="ttname"><a href="namespaceSparsityTools.html#afbc0c7a206ced91b154666215ea3c218">SparsityTools::distribute_sparsity_pattern</a></div><div class="ttdeci">void distribute_sparsity_pattern(DynamicSparsityPattern &amp;dsp, const IndexSet &amp;locally_owned_rows, const MPI_Comm &amp;mpi_comm, const IndexSet &amp;locally_relevant_rows)</div><div class="ttdef"><b>Definition:</b> <a href="sparsity__tools_8cc_source.html#l01045">sparsity_tools.cc:1045</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html">MatrixFree::AdditionalData</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00181">matrix_free.h:182</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_a0bcce2facca91b925d3e1a5a00c7704b"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">MatrixFree::AdditionalData::tasks_parallel_scheme</a></div><div class="ttdeci">TasksParallelScheme tasks_parallel_scheme</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00344">matrix_free.h:344</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_aa5d597e6c4441d273f4100b6139a2552"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">MatrixFree::AdditionalData::mapping_update_flags</a></div><div class="ttdeci">UpdateFlags mapping_update_flags</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00368">matrix_free.h:368</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemsetup_multigrid"></a> </p><h4>LaplaceProblem::setup_multigrid()</h4>
<p>This function does the multilevel setup for both matrix-free and matrix-based GMG. The matrix-free setup is similar to that of <a class="el" href="step_37.html">step-37</a>, and the matrix-based is similar to <a class="el" href="step_16.html">step-16</a>, except we must use appropriate distributed sparsity patterns.</p>
<p>The function is not called for the AMG approach, but to err on the safe side, the main <code>switch</code> statement of this function nevertheless makes sure that the function only operates on known multigrid settings by throwing an assertion if the function were called for anything other than the two geometric multigrid methods.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::setup_multigrid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Setup multigrid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  dof_handler.distribute_mg_dofs();</div>
<div class="line"> </div>
<div class="line">  mg_constrained_dofs.clear();</div>
<div class="line">  mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::set&lt;types::boundary_id&gt; boundary_ids = {<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">types::boundary_id</a>(0)};</div>
<div class="line">  mg_constrained_dofs.make_zero_boundary_constraints(dof_handler, boundary_ids);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_levels = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (settings.solver)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mf:</div>
<div class="line">        {</div>
<div class="line">          mf_mg_matrix.resize(0, n_levels - 1);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">            {</div>
<div class="line">              <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div>
<div class="line">              <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                            <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                                            relevant_dofs);</div>
<div class="line">              <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div>
<div class="line">              level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div>
<div class="line">              level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div>
<div class="line">                mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">              level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">              <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div>
<div class="line">              additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">                <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::none</a>;</div>
<div class="line">              additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">                (<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">                 <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">              additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;</div>
<div class="line">              std::shared_ptr&lt;MatrixFree&lt;dim, float&gt;&gt; mf_storage_level(</div>
<div class="line">                <span class="keyword">new</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;</a>());</div>
<div class="line">              mf_storage_level-&gt;reinit(mapping,</div>
<div class="line">                                       dof_handler,</div>
<div class="line">                                       level_constraints,</div>
<div class="line">                                       <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(degree + 1),</div>
<div class="line">                                       additional_data);</div>
<div class="line"> </div>
<div class="line">              mf_mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mf_storage_level,</div>
<div class="line">                                             mg_constrained_dofs,</div>
<div class="line">                                             <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line"> </div>
<div class="line">              <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line">              mf_mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].set_coefficient(</div>
<div class="line">                coefficient.make_coefficient_table(*mf_storage_level));</div>
<div class="line"> </div>
<div class="line">              mf_mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].compute_diagonal();</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mb:</div>
<div class="line">        {</div>
<div class="line">          mg_matrix.resize(0, n_levels - 1);</div>
<div class="line">          mg_matrix.clear_elements();</div>
<div class="line">          mg_interface_in.resize(0, n_levels - 1);</div>
<div class="line">          mg_interface_in.clear_elements();</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">            {</div>
<div class="line">              <a class="code" href="classIndexSet.html">IndexSet</a> dof_set;</div>
<div class="line">              <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                            <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                                            dof_set);</div>
<div class="line"> </div>
<div class="line">              {</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">                <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_set);</div>
<div class="line">                <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                dsp.compress();</div>
<div class="line">                <a class="code" href="namespaceSparsityTools.html#afbc0c7a206ced91b154666215ea3c218">SparsityTools::distribute_sparsity_pattern</a>(</div>
<div class="line">                  dsp,</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  mpi_communicator,</div>
<div class="line">                  dof_set);</div>
<div class="line"> </div>
<div class="line">                mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dsp,</div>
<div class="line">                  mpi_communicator);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">                <a class="code" href="classTrilinosWrappers_1_1SparsityPattern.html">TrilinosWrappers::SparsityPattern</a> dsp(</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_set,</div>
<div class="line">                  mpi_communicator);</div>
<div class="line">                <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line"> </div>
<div class="line">                dsp.compress();</div>
<div class="line">                mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(dsp);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">              {</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">                <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_set);</div>
<div class="line">                <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                         mg_constrained_dofs,</div>
<div class="line">                                                         dsp,</div>
<div class="line">                                                         <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                dsp.compress();</div>
<div class="line">                <a class="code" href="namespaceSparsityTools.html#afbc0c7a206ced91b154666215ea3c218">SparsityTools::distribute_sparsity_pattern</a>(</div>
<div class="line">                  dsp,</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  mpi_communicator,</div>
<div class="line">                  dof_set);</div>
<div class="line"> </div>
<div class="line">                mg_interface_in[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dsp,</div>
<div class="line">                  mpi_communicator);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">                <a class="code" href="classTrilinosWrappers_1_1SparsityPattern.html">TrilinosWrappers::SparsityPattern</a> dsp(</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_set,</div>
<div class="line">                  mpi_communicator);</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                         mg_constrained_dofs,</div>
<div class="line">                                                         dsp,</div>
<div class="line">                                                         <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                dsp.compress();</div>
<div class="line">                mg_interface_in[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(dsp);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">              }</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassAffineConstraints_html_a1611aa37f754086388ca76bcd421cce5"><div class="ttname"><a href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a></div><div class="ttdeci">void close()</div></div>
<div class="ttc" id="aclassAffineConstraints_html_a2c9d71b5b7e8851c25a411ccf34de986"><div class="ttname"><a href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">AffineConstraints::reinit</a></div><div class="ttdeci">void reinit(const IndexSet &amp;local_constraints=IndexSet())</div></div>
<div class="ttc" id="aclassAffineConstraints_html_aef97b22281acb10c914d79a3881e2735"><div class="ttname"><a href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">AffineConstraints::add_lines</a></div><div class="ttdeci">void add_lines(const std::vector&lt; bool &gt; &amp;lines)</div></div>
<div class="ttc" id="agrid__out_8cc_html_a9082f945c1d289684d0bcd51ee08e11e"><div class="ttname"><a href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a></div><div class="ttdeci">unsigned int level</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04590">grid_out.cc:4590</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a1fef7be07cf379b661646e39b9354e17"><div class="ttname"><a href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a></div><div class="ttdeci">void extract_locally_relevant_level_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const unsigned int level, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01252">dof_tools.cc:1252</a></div></div>
<div class="ttc" id="anamespaceMGTools_html_a19ba9ee4a2b65235c8bb3fb65ea8f4e0"><div class="ttname"><a href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity, const unsigned int level, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true)</div><div class="ttdef"><b>Definition:</b> <a href="mg__tools_8cc_source.html#l00593">mg_tools.cc:593</a></div></div>
<div class="ttc" id="anamespaceMGTools_html_a8c677f65f8f1d21fb1f4c55cb90079e0"><div class="ttname"><a href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a></div><div class="ttdeci">void make_interface_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const MGConstrainedDoFs &amp;mg_constrained_dofs, SparsityPatternType &amp;sparsity, const unsigned int level)</div><div class="ttdef"><b>Definition:</b> <a href="mg__tools_8cc_source.html#l01052">mg_tools.cc:1052</a></div></div>
<div class="ttc" id="anamespacetypes_html_aed8813fee8c8a2edcc6005e6a48c321a"><div class="ttname"><a href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">types::boundary_id</a></div><div class="ttdeci">unsigned int boundary_id</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00129">types.h:129</a></div></div>
<div class="ttc" id="astructMatrixFree_1_1AdditionalData_html_a67c9ff01c51fb7fb3ada151b83cdd409"><div class="ttname"><a href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">MatrixFree::AdditionalData::mg_level</a></div><div class="ttdeci">unsigned int mg_level</div><div class="ttdef"><b>Definition:</b> <a href="matrix__free_8h_source.html#l00448">matrix_free.h:448</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemassemble_system"></a> </p><h4>LaplaceProblem::assemble_system()</h4>
<p>The assembly is split into three parts: <code>assemble_system()</code>, <code>assemble_multigrid()</code>, and <code>assemble_rhs()</code>. The <code>assemble_system()</code> function here assembles and stores the (global) system matrix and the right-hand side for the matrix-based methods. It is similar to the assembly in <a class="el" href="step_40.html">step-40</a>.</p>
<p>Note that the matrix-free method does not execute this function as it does not need to assemble a matrix, and it will instead assemble the right-hand side in assemble_rhs().</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Assemble&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(degree + 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe.n_dofs_per_cell();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell);</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_rhs(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line">  RightHandSide&lt;dim&gt;     rhs;</div>
<div class="line">  std::vector&lt;double&gt;    rhs_values(n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.active_cell_iterators())</div>
<div class="line">    <span class="keywordflow">if</span> (cell-&gt;is_locally_owned())</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0;</div>
<div class="line">        cell_rhs    = 0;</div>
<div class="line"> </div>
<div class="line">        fe_values.reinit(cell);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> coefficient_value =</div>
<div class="line">          coefficient.average_value(fe_values.get_quadrature_points());</div>
<div class="line">        rhs.value_list(fe_values.get_quadrature_points(), rhs_values);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">                <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) +=</div>
<div class="line">                  coefficient_value *                <span class="comment">// epsilon(x)</span></div>
<div class="line">                  fe_values.shape_grad(i, q_point) * <span class="comment">// * grad phi_i(x)</span></div>
<div class="line">                  fe_values.shape_grad(j, q_point) * <span class="comment">// * grad phi_j(x)</span></div>
<div class="line">                  fe_values.JxW(q_point);            <span class="comment">// * dx</span></div>
<div class="line"> </div>
<div class="line">              cell_rhs(i) +=</div>
<div class="line">                fe_values.shape_value(i, q_point) * <span class="comment">// grad phi_i(x)</span></div>
<div class="line">                rhs_values[q_point] *               <span class="comment">// * f(x)</span></div>
<div class="line">                fe_values.JxW(q_point);             <span class="comment">// * dx</span></div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">        cell-&gt;get_dof_indices(local_dof_indices);</div>
<div class="line">        constraints.distribute_local_to_global(<a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>,</div>
<div class="line">                                               cell_rhs,</div>
<div class="line">                                               local_dof_indices,</div>
<div class="line">                                               system_matrix,</div>
<div class="line">                                               right_hand_side);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">  system_matrix.compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line">  right_hand_side.compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line">}</div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l03905">fe_values.h:3906</a></div></div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00078">fe_update_flags.h:78</a></div></div>
<div class="ttc" id="agroup__Vectors_html_gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708"><div class="ttname"><a href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a></div><div class="ttdeci">@ add</div><div class="ttdef"><b>Definition:</b> <a href="vector__operation_8h_source.html#l00053">vector_operation.h:53</a></div></div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Advection_html_a8bc7b8136646134f73a4193adefe15f8"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">LocalIntegrators::Advection::cell_matrix</a></div><div class="ttdeci">void cell_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const FEValuesBase&lt; dim &gt; &amp;fetest, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="advection_8h_source.html#l00075">advection.h:75</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemassemble_multigrid"></a> </p><h4>LaplaceProblem::assemble_multigrid()</h4>
<p>The following function assembles and stores the multilevel matrices for the matrix-based GMG method. This function is similar to the one found in <a class="el" href="step_16.html">step-16</a>, only here it works for distributed meshes. This difference amounts to adding a condition that we only assemble on locally owned level cells and a call to <a class="el" href="namespaceUtilities.html#a6155277fd058eddb1504f9562cb1c04d">compress()</a> for each matrix that is built.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::assemble_multigrid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Assemble multigrid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(degree + 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe.n_dofs_per_cell();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels(); ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classIndexSet.html">IndexSet</a> dof_set;</div>
<div class="line">      <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                    <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                                    dof_set);</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(dof_set);</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">        mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">        mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line"> </div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].close();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.cell_iterators())</div>
<div class="line">    <span class="keywordflow">if</span> (cell-&gt;level_subdomain_id() == <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.locally_owned_subdomain())</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0;</div>
<div class="line">        fe_values.reinit(cell);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> coefficient_value =</div>
<div class="line">          coefficient.average_value(fe_values.get_quadrature_points());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">              <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) +=</div>
<div class="line">                coefficient_value * fe_values.shape_grad(i, q_point) *</div>
<div class="line">                fe_values.shape_grad(j, q_point) * fe_values.JxW(q_point);</div>
<div class="line"> </div>
<div class="line">        cell-&gt;get_mg_dof_indices(local_dof_indices);</div>
<div class="line"> </div>
<div class="line">        boundary_constraints[cell-&gt;level()].distribute_local_to_global(</div>
<div class="line">          <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>, local_dof_indices, mg_matrix[cell-&gt;level()]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">            <span class="keywordflow">if</span> (mg_constrained_dofs.is_interface_matrix_entry(</div>
<div class="line">                  cell-&gt;level(), local_dof_indices[i], local_dof_indices[j]))</div>
<div class="line">              mg_interface_in[cell-&gt;level()].add(local_dof_indices[i],</div>
<div class="line">                                                 local_dof_indices[j],</div>
<div class="line">                                                 <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels(); ++i)</div>
<div class="line">    {</div>
<div class="line">      mg_matrix[i].compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line">      mg_interface_in[i].compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemassemble_rhs"></a> </p><h4>LaplaceProblem::assemble_rhs()</h4>
<p>The final function in this triptych assembles the right-hand side vector for the matrix-free method &ndash; because in the matrix-free framework, we don't have to assemble the matrix and can get away with only assembling the right hand side. We could do this by extracting the code from the <code>assemble_system()</code> function above that deals with the right hand side, but we decide instead to go all in on the matrix-free approach and do the assembly using that way as well.</p>
<p>The result is a function that is similar to the one found in the "Use FEEvaluation::read_dof_values_plain()
   to avoid resolving constraints" subsection in the "Possibilities
   for extensions" section of <a class="el" href="step_37.html">step-37</a>.</p>
<p>The reason for this function is that the <a class="el" href="classMatrixFree.html">MatrixFree</a> operators do not take into account non-homogeneous Dirichlet constraints, instead treating all Dirichlet constraints as homogeneous. To account for this, the right-hand side here is assembled as the residual \(r_0 = f-Au_0\), where \(u_0\) is a zero vector except in the Dirichlet values. Then when solving, we have that the solution is \(u = u_0 + A^{-1}r_0\). This can be seen as a Newton iteration on a linear system with initial guess \(u_0\). The CG solve in the <code>solve()</code> function below computes \(A^{-1}r_0\) and the call to <code>constraints.distribute()</code> (which directly follows) adds the \(u_0\).</p>
<p>Obviously, since we are considering a problem with zero Dirichlet boundary, we could have taken a similar approach to <a class="el" href="step_37.html">step-37</a> <code>assemble_rhs()</code>, but this additional work allows us to change the problem declaration if we so choose.</p>
<p>This function has two parts in the integration loop: applying the negative of matrix \(A\) to \(u_0\) by submitting the negative of the gradient, and adding the right-hand side contribution by submitting the value \(f\). We must be sure to use <code>read_dof_values_plain()</code> for evaluating \(u_0\) as <code>read_dof_vaues()</code> would set all Dirichlet values to zero.</p>
<p>Finally, the system_rhs vector is of type LA::MPI::Vector, but the <a class="el" href="classMatrixFree.html">MatrixFree</a> class only work for <a class="el" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a>. Therefore we must compute the right-hand side using <a class="el" href="classMatrixFree.html">MatrixFree</a> funtionality and then use the functions in the <code>ChangeVectorType</code> namespace to copy it to the correct type.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::assemble_rhs()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Assemble right-hand side&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  MatrixFreeActiveVector solution_copy;</div>
<div class="line">  MatrixFreeActiveVector right_hand_side_copy;</div>
<div class="line">  mf_system_matrix.initialize_dof_vector(solution_copy);</div>
<div class="line">  mf_system_matrix.initialize_dof_vector(right_hand_side_copy);</div>
<div class="line"> </div>
<div class="line">  solution_copy = 0.;</div>
<div class="line">  constraints.distribute(solution_copy);</div>
<div class="line">  solution_copy.update_ghost_values();</div>
<div class="line">  right_hand_side_copy = 0;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;double&gt;</a>&gt; &amp;coefficient =</div>
<div class="line">    *(mf_system_matrix.get_coefficient());</div>
<div class="line"> </div>
<div class="line">  RightHandSide&lt;dim&gt; right_hand_side_function;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, 1, double&gt;</a> phi(</div>
<div class="line">    *mf_system_matrix.get_matrix_free());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0;</div>
<div class="line">       cell &lt; mf_system_matrix.get_matrix_free()-&gt;n_cell_batches();</div>
<div class="line">       ++cell)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(cell);</div>
<div class="line">      phi.read_dof_values_plain(solution_copy);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          phi.submit_gradient(-1.0 *</div>
<div class="line">                                (coefficient(cell, 0) * phi.get_gradient(q)),</div>
<div class="line">                              q);</div>
<div class="line">          phi.submit_value(</div>
<div class="line">            right_hand_side_function.value(phi.quadrature_point(q)), q);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a>,</div>
<div class="line">                            right_hand_side_copy);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  right_hand_side_copy.compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">ChangeVectorTypes::copy</a>(right_hand_side, right_hand_side_copy);</div>
<div class="line">}</div>
<div class="ttc" id="aclassTable_html"><div class="ttname"><a href="classTable.html">Table</a></div><div class="ttdef"><b>Definition:</b> <a href="table_8h_source.html#l00666">table.h:667</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a></div><div class="ttdeci">@ gradients</div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00055">evaluation_flags.h:55</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a></div><div class="ttdeci">@ values</div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00051">evaluation_flags.h:51</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemsolve"></a> </p><h4>LaplaceProblem::solve()</h4>
<p>Here we set up the multigrid preconditioner, test the timing of a single V-cycle, and solve the linear system. Unsurprisingly, this is one of the places where the three methods differ the most.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::solve()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Solve&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(1000, 1.e-10 * right_hand_side.l2_norm());</div>
<div class="line">  solver_control.enable_history_data();</div>
<div class="line"> </div>
<div class="line">  solution = 0.;</div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00065">solver_control.h:66</a></div></div>
</div><!-- fragment --><p>The solver for the matrix-free GMG method is similar to <a class="el" href="step_37.html">step-37</a>, apart from adding some interface matrices in complete analogy to <a class="el" href="step_16.html">step-16</a>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">switch</span> (settings.solver)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> Settings::gmg_mf:</div>
<div class="line">      {</div>
<div class="line">        computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a> mg_transfer(mg_constrained_dofs);</div>
<div class="line">        mg_transfer.build(dof_handler);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classSolverControl.html">SolverControl</a> coarse_solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-12, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line">        <a class="code" href="classSolverCG.html">SolverCG&lt;MatrixFreeLevelVector&gt;</a> coarse_solver(coarse_solver_control);</div>
<div class="line">        <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>            <a class="code" href="structidentity.html">identity</a>;</div>
<div class="line">        <a class="code" href="classMGCoarseGridIterativeSolver.html">MGCoarseGridIterativeSolver</a>&lt;MatrixFreeLevelVector,</div>
<div class="line">                                    <a class="code" href="classSolverCG.html">SolverCG&lt;MatrixFreeLevelVector&gt;</a>,</div>
<div class="line">                                    MatrixFreeLevelMatrix,</div>
<div class="line">                                    <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>&gt;</div>
<div class="line">          coarse_grid_solver(coarse_solver, mf_mg_matrix[0], <a class="code" href="structidentity.html">identity</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionJacobi.html">::PreconditionJacobi&lt;MatrixFreeLevelMatrix&gt;</a>;</div>
<div class="line">        <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a>&lt;MatrixFreeLevelMatrix,</div>
<div class="line">                               Smoother,</div>
<div class="line">                               MatrixFreeLevelVector&gt;</div>
<div class="line">          smoother;</div>
<div class="line">        smoother.<a class="code" href="classMGCoarseGridIterativeSolver.html#a80c597f7ca12c63b070ab0a5605f0a3a">initialize</a>(mf_mg_matrix,</div>
<div class="line">                            <span class="keyword">typename</span> Smoother::AdditionalData(</div>
<div class="line">                              settings.smoother_dampen));</div>
<div class="line">        smoother.set_steps(settings.smoother_steps);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;MatrixFreeLevelVector&gt;</a> mg_m(mf_mg_matrix);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classMGLevelObject.html">MGLevelObject</a>&lt;</div>
<div class="line">          <a class="code" href="classMatrixFreeOperators_1_1MGInterfaceOperator.html">MatrixFreeOperators::MGInterfaceOperator&lt;MatrixFreeLevelMatrix&gt;</a>&gt;</div>
<div class="line">          mg_interface_matrices;</div>
<div class="line">        mg_interface_matrices.resize(0, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels() - 1);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div>
<div class="line">             ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">          mg_interface_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mf_mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">        <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;MatrixFreeLevelVector&gt;</a> mg_interface(mg_interface_matrices);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classMultigrid.html">Multigrid&lt;MatrixFreeLevelVector&gt;</a> <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">          mg_m, coarse_grid_solver, mg_transfer, smoother, smoother);</div>
<div class="line">        <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface, mg_interface);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;dim,</div>
<div class="line">                       MatrixFreeLevelVector,</div>
<div class="line">                       <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>&gt;</div>
<div class="line">          preconditioner(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="ttc" id="aclassMGCoarseGridIterativeSolver_html"><div class="ttname"><a href="classMGCoarseGridIterativeSolver.html">MGCoarseGridIterativeSolver</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__coarse_8h_source.html#l00092">mg_coarse.h:93</a></div></div>
<div class="ttc" id="aclassMGCoarseGridIterativeSolver_html_a80c597f7ca12c63b070ab0a5605f0a3a"><div class="ttname"><a href="classMGCoarseGridIterativeSolver.html#a80c597f7ca12c63b070ab0a5605f0a3a">MGCoarseGridIterativeSolver::initialize</a></div><div class="ttdeci">void initialize(SolverType &amp;solver, const MatrixType &amp;matrix, const PreconditionerType &amp;precondition)</div></div>
<div class="ttc" id="aclassMGSmootherPrecondition_html"><div class="ttname"><a href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__smoother_8h_source.html#l00444">mg_smoother.h:445</a></div></div>
<div class="ttc" id="aclassMGTransferMatrixFree_html"><div class="ttname"><a href="classMGTransferMatrixFree.html">MGTransferMatrixFree</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer__matrix__free_8h_source.html#l00054">mg_transfer_matrix_free.h:56</a></div></div>
<div class="ttc" id="aclassMatrixFreeOperators_1_1MGInterfaceOperator_html"><div class="ttname"><a href="classMatrixFreeOperators_1_1MGInterfaceOperator.html">MatrixFreeOperators::MGInterfaceOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l00535">operators.h:536</a></div></div>
<div class="ttc" id="aclassMultigrid_html"><div class="ttname"><a href="classMultigrid.html">Multigrid</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_8h_source.html#l00152">multigrid.h:153</a></div></div>
<div class="ttc" id="aclassPreconditionIdentity_html"><div class="ttname"><a href="classPreconditionIdentity.html">PreconditionIdentity</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00079">precondition.h:80</a></div></div>
<div class="ttc" id="aclassPreconditionMG_html"><div class="ttname"><a href="classPreconditionMG.html">PreconditionMG</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_8h_source.html#l00467">multigrid.h:468</a></div></div>
<div class="ttc" id="aclassSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__cg_8h_source.html#l00095">solver_cg.h:96</a></div></div>
<div class="ttc" id="aclassmg_1_1Matrix_html"><div class="ttname"><a href="classmg_1_1Matrix.html">mg::Matrix</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__matrix_8h_source.html#l00044">mg_matrix.h:45</a></div></div>
<div class="ttc" id="anamespacemg_html"><div class="ttname"><a href="namespacemg.html">mg</a></div><div class="ttdef"><b>Definition:</b> <a href="mg_8h_source.html#l00081">mg.h:82</a></div></div>
<div class="ttc" id="astructidentity_html"><div class="ttname"><a href="structidentity.html">identity</a></div><div class="ttdef"><b>Definition:</b> <a href="template__constraints_8h_source.html#l00179">template_constraints.h:180</a></div></div>
</div><!-- fragment --><p>Copy the solution vector and right-hand side from LA::MPI::Vector to <a class="el" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a> so that we can solve.</p>
<div class="fragment"><div class="line">MatrixFreeActiveVector solution_copy;</div>
<div class="line">MatrixFreeActiveVector right_hand_side_copy;</div>
<div class="line">mf_system_matrix.initialize_dof_vector(solution_copy);</div>
<div class="line">mf_system_matrix.initialize_dof_vector(right_hand_side_copy);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">ChangeVectorTypes::copy</a>(solution_copy, solution);</div>
<div class="line"><a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">ChangeVectorTypes::copy</a>(right_hand_side_copy, right_hand_side);</div>
<div class="line">computing_timer.leave_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
</div><!-- fragment --><p>Timing for 1 V-cycle.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer,</div>
<div class="line">                            <span class="stringliteral">&quot;Solve: 1 multigrid V-cycle&quot;</span>);</div>
<div class="line">  preconditioner.vmult(solution_copy, right_hand_side_copy);</div>
<div class="line">}</div>
<div class="line">solution_copy = 0.;</div>
</div><!-- fragment --><p>Solve the linear system, update the ghost values of the solution, copy back to LA::MPI::Vector and distribute constraints.</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;MatrixFreeActiveVector&gt;</a> solver(solver_control);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Solve: CG&quot;</span>);</div>
<div class="line">    solver.solve(mf_system_matrix,</div>
<div class="line">                 solution_copy,</div>
<div class="line">                 right_hand_side_copy,</div>
<div class="line">                 preconditioner);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  solution_copy.update_ghost_values();</div>
<div class="line">  <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">ChangeVectorTypes::copy</a>(solution, solution_copy);</div>
<div class="line">  constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Solver for the matrix-based GMG method, similar to <a class="el" href="step_16.html">step-16</a>, only using a Jacobi smoother instead of a SOR smoother (which is not implemented in parallel).</p>
<div class="fragment"><div class="line">      <span class="keywordflow">case</span> Settings::gmg_mb:</div>
<div class="line">        {</div>
<div class="line">          computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;VectorType&gt;</a> mg_transfer(mg_constrained_dofs);</div>
<div class="line">          mg_transfer.build(dof_handler);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classSolverControl.html">SolverControl</a>        coarse_solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-12, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line">          <a class="code" href="classSolverCG.html">SolverCG&lt;VectorType&gt;</a> coarse_solver(coarse_solver_control);</div>
<div class="line">          <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a> <a class="code" href="structidentity.html">identity</a>;</div>
<div class="line">          <a class="code" href="classMGCoarseGridIterativeSolver.html">MGCoarseGridIterativeSolver</a>&lt;VectorType,</div>
<div class="line">                                      <a class="code" href="classSolverCG.html">SolverCG&lt;VectorType&gt;</a>,</div>
<div class="line">                                      MatrixType,</div>
<div class="line">                                      <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>&gt;</div>
<div class="line">            coarse_grid_solver(coarse_solver, mg_matrix[0], <a class="code" href="structidentity.html">identity</a>);</div>
<div class="line"> </div>
<div class="line">          <span class="keyword">using</span> Smoother = <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a84fd288bacabd1a7e3408885fb0fad01">LA::MPI::PreconditionJacobi</a>;</div>
<div class="line">          <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition&lt;MatrixType, Smoother, VectorType&gt;</a> smoother;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">          smoother.<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrix);</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(</div>
<div class="line">            settings.smoother_dampen == 1.0,</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>(</div>
<div class="line">              <span class="stringliteral">&quot;PETSc&#39;s PreconditionJacobi has no support for a damping parameter.&quot;</span>));</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">          smoother.<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrix, settings.smoother_dampen);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">          smoother.<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(settings.smoother_steps);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;VectorType&gt;</a> mg_m(mg_matrix);</div>
<div class="line">          <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;VectorType&gt;</a> mg_in(mg_interface_in);</div>
<div class="line">          <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;VectorType&gt;</a> mg_out(mg_interface_in);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classMultigrid.html">Multigrid&lt;VectorType&gt;</a> <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">            mg_m, coarse_grid_solver, mg_transfer, smoother, smoother);</div>
<div class="line">          <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_out, mg_in);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, VectorType, MGTransferPrebuilt&lt;VectorType&gt;</a>&gt;</div>
<div class="line">            preconditioner(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="line"> </div>
<div class="line">          computing_timer.leave_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="ttc" id="aclassMGSmootherPrecondition_html_a3cb789b815bf6719eee79e2137c9bd84"><div class="ttname"><a href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">MGSmootherPrecondition::initialize</a></div><div class="ttdeci">void initialize(const MGLevelObject&lt; MatrixType2 &gt; &amp;matrices, const typename PreconditionerType::AdditionalData &amp;additional_data=typename PreconditionerType::AdditionalData())</div></div>
<div class="ttc" id="aclassMGSmoother_html_a9976182b6b272aac7800a8fbf18c8ab9"><div class="ttname"><a href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">MGSmoother::set_steps</a></div><div class="ttdeci">void set_steps(const unsigned int)</div></div>
<div class="ttc" id="aclassMGTransferPrebuilt_html"><div class="ttname"><a href="classMGTransferPrebuilt.html">MGTransferPrebuilt</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer_8h_source.html#l00636">mg_transfer.h:637</a></div></div>
</div><!-- fragment --><p>Timing for 1 V-cycle.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer,</div>
<div class="line">                            <span class="stringliteral">&quot;Solve: 1 multigrid V-cycle&quot;</span>);</div>
<div class="line">  preconditioner.vmult(solution, right_hand_side);</div>
<div class="line">}</div>
<div class="line">solution = 0.;</div>
</div><!-- fragment --><p>Solve the linear system and distribute constraints.</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;VectorType&gt;</a> solver(solver_control);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Solve: CG&quot;</span>);</div>
<div class="line">    solver.solve(system_matrix,</div>
<div class="line">                 solution,</div>
<div class="line">                 right_hand_side,</div>
<div class="line">                 preconditioner);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Solver for the AMG method, similar to <a class="el" href="step_40.html">step-40</a>.</p>
<div class="fragment"><div class="line">      <span class="keywordflow">case</span> Settings::amg:</div>
<div class="line">        {</div>
<div class="line">          computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a41f11f7a1992c6d6aa9367b12c68f791">PreconditionAMG</a>                 preconditioner;</div>
<div class="line">          PreconditionAMG::AdditionalData Amg_data;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">          Amg_data.symmetric_operator = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">          Amg_data.elliptic              = <span class="keyword">true</span>;</div>
<div class="line">          Amg_data.smoother_type         = <span class="stringliteral">&quot;Jacobi&quot;</span>;</div>
<div class="line">          Amg_data.higher_order_elements = <span class="keyword">true</span>;</div>
<div class="line">          Amg_data.smoother_sweeps       = settings.smoother_steps;</div>
<div class="line">          Amg_data.aggregation_threshold = 0.02;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">          Amg_data.output_details = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">          preconditioner.<a class="code" href="classPETScWrappers_1_1PreconditionBoomerAMG.html#a3c82672eac786d7f369b296439859ff2">initialize</a>(system_matrix, Amg_data);</div>
<div class="line">          computing_timer.leave_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="ttc" id="aclassPETScWrappers_1_1PreconditionBoomerAMG_html_a3c82672eac786d7f369b296439859ff2"><div class="ttname"><a href="classPETScWrappers_1_1PreconditionBoomerAMG.html#a3c82672eac786d7f369b296439859ff2">PETScWrappers::PreconditionBoomerAMG::initialize</a></div><div class="ttdeci">void initialize(const MatrixBase &amp;matrix, const AdditionalData &amp;additional_data=AdditionalData())</div><div class="ttdef"><b>Definition:</b> <a href="petsc__precondition_8cc_source.html#l00679">petsc_precondition.cc:679</a></div></div>
</div><!-- fragment --><p>Timing for 1 V-cycle.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer,</div>
<div class="line">                            <span class="stringliteral">&quot;Solve: 1 multigrid V-cycle&quot;</span>);</div>
<div class="line">  preconditioner.vmult(solution, right_hand_side);</div>
<div class="line">}</div>
<div class="line">solution = 0.;</div>
</div><!-- fragment --><p>Solve the linear system and distribute constraints.</p>
<div class="fragment"><div class="line">          {</div>
<div class="line">            <a class="code" href="classSolverCG.html">SolverCG&lt;VectorType&gt;</a> solver(solver_control);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Solve: CG&quot;</span>);</div>
<div class="line">            solver.solve(system_matrix,</div>
<div class="line">                         solution,</div>
<div class="line">                         right_hand_side,</div>
<div class="line">                         preconditioner);</div>
<div class="line">          }</div>
<div class="line">          constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;   Number of CG iterations:      &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">        &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Exceptions_html_ga31978c026b8b6b5116df30b8e748f6b7"><div class="ttname"><a href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">StandardExceptions::ExcInternalError</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcInternalError()</div></div>
</div><!-- fragment --><p><a class="anchor" id="Theerrorestimator"></a> </p><h3>The error estimator</h3>
<p>We use the <a class="el" href="classFEInterfaceValues.html">FEInterfaceValues</a> class to assemble an error estimator to decide which cells to refine. See the exact definition of the cell and face integrals in the introduction. To use the method, we define Scratch and Copy objects for the <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop()</a> with much of the following code being in essence as was set up in <a class="el" href="step_12.html">step-12</a> already (or at least similar in spirit).</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>ScratchData</div>
<div class="line">{</div>
<div class="line">  ScratchData(<span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;      mapping,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe,</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        quadrature_degree,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         update_flags,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         interface_update_flags)</div>
<div class="line">    : fe_values(mapping, fe, <a class="code" href="classQGauss.html">QGauss</a>&lt;dim&gt;(quadrature_degree), update_flags)</div>
<div class="line">    , fe_interface_values(mapping,</div>
<div class="line">                          fe,</div>
<div class="line">                          <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt;(quadrature_degree),</div>
<div class="line">                          interface_update_flags)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  ScratchData(<span class="keyword">const</span> ScratchData&lt;dim&gt; &amp;scratch_data)</div>
<div class="line">    : fe_values(scratch_data.fe_values.get_mapping(),</div>
<div class="line">                scratch_data.fe_values.get_fe(),</div>
<div class="line">                scratch_data.fe_values.get_quadrature(),</div>
<div class="line">                scratch_data.fe_values.get_update_flags())</div>
<div class="line">    , fe_interface_values(scratch_data.fe_values.get_mapping(),</div>
<div class="line">                          scratch_data.fe_values.get_fe(),</div>
<div class="line">                          scratch_data.fe_interface_values.get_quadrature(),</div>
<div class="line">                          scratch_data.fe_interface_values.get_update_flags())</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>          fe_values;</div>
<div class="line">  <a class="code" href="classFEInterfaceValues.html">FEInterfaceValues&lt;dim&gt;</a> fe_interface_values;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>CopyData</div>
<div class="line">{</div>
<div class="line">  CopyData()</div>
<div class="line">    : <a class="code" href="grid__tools_8cc.html#aff11e57deb99b39b7d7d26cf866798f2">cell_index</a>(<a class="code" href="namespacenumbers.html">numbers</a>::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">invalid_unsigned_int</a>)</div>
<div class="line">    , <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(0.)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  CopyData(<span class="keyword">const</span> CopyData &amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span>FaceData</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_indices[2];</div>
<div class="line">    <span class="keywordtype">double</span>       <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>[2];</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>          <a class="code" href="grid__tools_8cc.html#aff11e57deb99b39b7d7d26cf866798f2">cell_index</a>;</div>
<div class="line">  <span class="keywordtype">double</span>                <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>;</div>
<div class="line">  std::vector&lt;FaceData&gt; face_data;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::estimate()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Estimate&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  VectorType temp_solution;</div>
<div class="line">  temp_solution.reinit(locally_owned_dofs,</div>
<div class="line">                       locally_relevant_dofs,</div>
<div class="line">                       mpi_communicator);</div>
<div class="line">  temp_solution = solution;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line"> </div>
<div class="line">  estimated_error_square_per_cell.<a class="code" href="classTableBase.html#a302ef67031a523602fd39911b968d6ab">reinit</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> Iterator = <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a>;</div>
<div class="ttc" id="aclassFEInterfaceValues_html"><div class="ttname"><a href="classFEInterfaceValues.html">FEInterfaceValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__interface__values_8h_source.html#l00053">fe_interface_values.h:54</a></div></div>
<div class="ttc" id="aclassFiniteElement_html"><div class="ttname"><a href="classFiniteElement.html">FiniteElement</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l00645">fe.h:646</a></div></div>
<div class="ttc" id="aclassMapping_html"><div class="ttname"><a href="classMapping.html">Mapping</a></div><div class="ttdoc">Abstract base class for mapping classes.</div><div class="ttdef"><b>Definition:</b> <a href="mapping_8h_source.html#l00303">mapping.h:304</a></div></div>
<div class="ttc" id="aclassTableBase_html_a302ef67031a523602fd39911b968d6ab"><div class="ttname"><a href="classTableBase.html#a302ef67031a523602fd39911b968d6ab">TableBase::reinit</a></div><div class="ttdeci">void reinit(const TableIndices&lt; N &gt; &amp;new_size, const bool omit_default_initialization=false)</div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52f"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div><div class="ttdeci">UpdateFlags</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00066">fe_update_flags.h:67</a></div></div>
<div class="ttc" id="agrid__tools_8cc_html_aff11e57deb99b39b7d7d26cf866798f2"><div class="ttname"><a href="grid__tools_8cc.html#aff11e57deb99b39b7d7d26cf866798f2">cell_index</a></div><div class="ttdeci">unsigned int cell_index</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l01093">grid_tools.cc:1093</a></div></div>
<div class="ttc" id="agroup__Iterators_html_ga6b8bbcafed8847f3030ea30c6990eb2d"><div class="ttname"><a href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler::active_cell_iterator</a></div><div class="ttdeci">typename ActiveSelector::active_cell_iterator active_cell_iterator</div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00438">dof_handler.h:438</a></div></div>
<div class="ttc" id="anamespacenumbers_html"><div class="ttname"><a href="namespacenumbers.html">numbers</a></div><div class="ttdef"><b>Definition:</b> <a href="numbers_8h_source.html#l00201">numbers.h:202</a></div></div>
<div class="ttc" id="anamespacenumbers_html_a8ae36952c7e0cc778b47b5371b3aeff1"><div class="ttname"><a href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a></div><div class="ttdeci">static const unsigned int invalid_unsigned_int</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00196">types.h:196</a></div></div>
</div><!-- fragment --><p>Assembler for cell residual \(h^2 \| f + \epsilon \triangle u \|_K^2\)</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> cell_worker = [&amp;](<span class="keyword">const</span> Iterator &amp;  cell,</div>
<div class="line">                       ScratchData&lt;dim&gt; &amp;scratch_data,</div>
<div class="line">                       CopyData &amp;        copy_data) {</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;fe_values = scratch_data.fe_values;</div>
<div class="line">  fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line">  RightHandSide&lt;dim&gt; rhs;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       rhs_value = rhs.value(cell-&gt;center());</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> nu = coefficient.value(cell-&gt;center());</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Tensor&lt;2, dim&gt;&gt; <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaccf663e018d31c264b769c80bd91db4d">hessians</a>(fe_values.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>);</div>
<div class="line">  fe_values.<a class="code" href="classFEValuesBase.html#ae8f183c9d6da0c7daf9d345e0bc91b0a">get_function_hessians</a>(temp_solution, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaccf663e018d31c264b769c80bd91db4d">hessians</a>);</div>
<div class="line"> </div>
<div class="line">  copy_data.cell_index = cell-&gt;active_cell_index();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> residual_norm_square = 0.;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; fe_values.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>; ++k)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> residual = (rhs_value + nu * <a class="code" href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">trace</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaccf663e018d31c264b769c80bd91db4d">hessians</a>[k]));</div>
<div class="line">      residual_norm_square += residual * residual * fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(k);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  copy_data.value =</div>
<div class="line">    cell-&gt;diameter() * cell-&gt;diameter() * residual_norm_square;</div>
<div class="line">};</div>
<div class="ttc" id="aclassFEValuesBase_html_a807c3049bfe81743fc0f237dfc2fbdea"><div class="ttname"><a href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">FEValuesBase::n_quadrature_points</a></div><div class="ttdeci">const unsigned int n_quadrature_points</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l02344">fe_values.h:2344</a></div></div>
<div class="ttc" id="aclassFEValuesBase_html_abade89efb068b71b7ced7082012a2441"><div class="ttname"><a href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">FEValuesBase::JxW</a></div><div class="ttdeci">double JxW(const unsigned int quadrature_point) const</div></div>
<div class="ttc" id="aclassFEValuesBase_html_ae8f183c9d6da0c7daf9d345e0bc91b0a"><div class="ttname"><a href="classFEValuesBase.html#ae8f183c9d6da0c7daf9d345e0bc91b0a">FEValuesBase::get_function_hessians</a></div><div class="ttdeci">void get_function_hessians(const InputVector &amp;fe_function, std::vector&lt; Tensor&lt; 2, spacedim, typename InputVector::value_type &gt;&gt; &amp;hessians) const</div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8cc_source.html#l03777">fe_values.cc:3777</a></div></div>
<div class="ttc" id="aclassFEValues_html_a21f914e63d588e2652a9514620653d77"><div class="ttname"><a href="classFEValues.html#a21f914e63d588e2652a9514620653d77">FEValues::reinit</a></div><div class="ttdeci">void reinit(const TriaIterator&lt; DoFCellAccessor&lt; dim, spacedim, level_dof_access &gt;&gt; &amp;cell)</div></div>
<div class="ttc" id="aclassSymmetricTensor_html_a9137b6052702150e8e5b1188d1971906"><div class="ttname"><a href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">SymmetricTensor::trace</a></div><div class="ttdeci">constexpr Number trace(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02680">symmetric_tensor.h:2680</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeaccf663e018d31c264b769c80bd91db4d"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaccf663e018d31c264b769c80bd91db4d">EvaluationFlags::hessians</a></div><div class="ttdeci">@ hessians</div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00060">evaluation_flags.h:59</a></div></div>
</div><!-- fragment --><p>Assembler for face term \(\sum_F h_F \| \jump{\epsilon \nabla u \cdot n} \|_F^2\)</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> face_worker = [&amp;](<span class="keyword">const</span> Iterator &amp;    cell,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;f,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;sf,</div>
<div class="line">                       <span class="keyword">const</span> Iterator &amp;    ncell,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;nf,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;nsf,</div>
<div class="line">                       ScratchData&lt;dim&gt; &amp;  scratch_data,</div>
<div class="line">                       CopyData &amp;          copy_data) {</div>
<div class="line">  <a class="code" href="classFEInterfaceValues.html">FEInterfaceValues&lt;dim&gt;</a> &amp;fe_interface_values =</div>
<div class="line">    scratch_data.fe_interface_values;</div>
<div class="line">  fe_interface_values.<a class="code" href="classFEInterfaceValues.html#af6aa20b6652c2605d4cee36021f6bcd2">reinit</a>(cell, f, sf, ncell, nf, nsf);</div>
<div class="line"> </div>
<div class="line">  copy_data.face_data.emplace_back();</div>
<div class="line">  CopyData::FaceData &amp;copy_data_face = copy_data.face_data.back();</div>
<div class="line"> </div>
<div class="line">  copy_data_face.cell_indices[0] = cell-&gt;active_cell_index();</div>
<div class="line">  copy_data_face.cell_indices[1] = ncell-&gt;active_cell_index();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> coeff1 = coefficient.value(cell-&gt;center());</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> coeff2 = coefficient.value(ncell-&gt;center());</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Tensor&lt;1, dim&gt;&gt; grad_u[2];</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2; ++i)</div>
<div class="line">    {</div>
<div class="line">      grad_u[i].resize(fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a41f6734be1313f750fa8b3b7ba470f35">n_quadrature_points</a>);</div>
<div class="line">      fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a6ac7ddd5ac77cc4a1925ec5f0b100bf2">get_fe_face_values</a>(i).get_function_gradients(</div>
<div class="line">        temp_solution, grad_u[i]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> jump_norm_square = 0.;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpoint = 0;</div>
<div class="line">       qpoint &lt; fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a41f6734be1313f750fa8b3b7ba470f35">n_quadrature_points</a>;</div>
<div class="line">       ++qpoint)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> jump =</div>
<div class="line">        coeff1 * grad_u[0][qpoint] * fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a1a52fcfa2f54f153cc7cdda3788e5ac0">normal</a>(qpoint) -</div>
<div class="line">        coeff2 * grad_u[1][qpoint] * fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a1a52fcfa2f54f153cc7cdda3788e5ac0">normal</a>(qpoint);</div>
<div class="line"> </div>
<div class="line">      jump_norm_square += jump * jump * fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a9f8f06f7da061e1c2a20c5cc68a89db1">JxW</a>(qpoint);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> h           = cell-&gt;face(f)-&gt;measure();</div>
<div class="line">  copy_data_face.values[0] = 0.5 * h * jump_norm_square;</div>
<div class="line">  copy_data_face.values[1] = copy_data_face.values[0];</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> copier = [&amp;](<span class="keyword">const</span> CopyData &amp;copy_data) {</div>
<div class="line">  <span class="keywordflow">if</span> (copy_data.cell_index != <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>)</div>
<div class="line">    estimated_error_square_per_cell[copy_data.cell_index] += copy_data.value;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;cdf : copy_data.face_data)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 2; ++j)</div>
<div class="line">      estimated_error_square_per_cell[cdf.cell_indices[j]] += cdf.values[j];</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_gauss_points = degree + 1;</div>
<div class="line">ScratchData&lt;dim&gt;   scratch_data(mapping,</div>
<div class="line">                              fe,</div>
<div class="line">                              n_gauss_points,</div>
<div class="line">                              <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                                <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>,</div>
<div class="line">                              <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                                <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>);</div>
<div class="line">CopyData           copy_data;</div>
<div class="ttc" id="aclassFEInterfaceValues_html_a1a52fcfa2f54f153cc7cdda3788e5ac0"><div class="ttname"><a href="classFEInterfaceValues.html#a1a52fcfa2f54f153cc7cdda3788e5ac0">FEInterfaceValues::normal</a></div><div class="ttdeci">Tensor&lt; 1, spacedim &gt; normal(const unsigned int q_point_index) const</div></div>
<div class="ttc" id="aclassFEInterfaceValues_html_a41f6734be1313f750fa8b3b7ba470f35"><div class="ttname"><a href="classFEInterfaceValues.html#a41f6734be1313f750fa8b3b7ba470f35">FEInterfaceValues::n_quadrature_points</a></div><div class="ttdeci">const unsigned int n_quadrature_points</div><div class="ttdef"><b>Definition:</b> <a href="fe__interface__values_8h_source.html#l00059">fe_interface_values.h:59</a></div></div>
<div class="ttc" id="aclassFEInterfaceValues_html_a6ac7ddd5ac77cc4a1925ec5f0b100bf2"><div class="ttname"><a href="classFEInterfaceValues.html#a6ac7ddd5ac77cc4a1925ec5f0b100bf2">FEInterfaceValues::get_fe_face_values</a></div><div class="ttdeci">const FEFaceValuesBase&lt; dim, spacedim &gt; &amp; get_fe_face_values(const unsigned int cell_index) const</div></div>
<div class="ttc" id="aclassFEInterfaceValues_html_a9f8f06f7da061e1c2a20c5cc68a89db1"><div class="ttname"><a href="classFEInterfaceValues.html#a9f8f06f7da061e1c2a20c5cc68a89db1">FEInterfaceValues::JxW</a></div><div class="ttdeci">double JxW(const unsigned int quadrature_point) const</div></div>
<div class="ttc" id="aclassFEInterfaceValues_html_af6aa20b6652c2605d4cee36021f6bcd2"><div class="ttname"><a href="classFEInterfaceValues.html#af6aa20b6652c2605d4cee36021f6bcd2">FEInterfaceValues::reinit</a></div><div class="ttdeci">void reinit(const CellIteratorType &amp;cell, const unsigned int face_no, const unsigned int sub_face_no, const typename identity&lt; CellIteratorType &gt;::type &amp;cell_neighbor, const unsigned int face_no_neighbor, const unsigned int sub_face_no_neighbor)</div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a></div><div class="ttdeci">@ update_hessians</div><div class="ttdoc">Second derivatives of shape functions.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00090">fe_update_flags.h:90</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a></div><div class="ttdeci">@ update_normal_vectors</div><div class="ttdoc">Normal vectors.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00136">fe_update_flags.h:136</a></div></div>
</div><!-- fragment --><p>We need to assemble each interior face once but we need to make sure that both processes assemble the face term between a locally owned and a ghost cell. This is achieved by setting the <a class="el" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa9396964e7e270fe0a0c5d01474721c24">MeshWorker::assemble_ghost_faces_both</a> flag. We need to do this, because we do not communicate the error estimator contributions here.</p>
<div class="fragment"><div class="line">  <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.begin_active(),</div>
<div class="line">                        dof_handler.end(),</div>
<div class="line">                        cell_worker,</div>
<div class="line">                        copier,</div>
<div class="line">                        scratch_data,</div>
<div class="line">                        copy_data,</div>
<div class="line">                        <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa">MeshWorker::assemble_own_cells</a> |</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa9396964e7e270fe0a0c5d01474721c24">MeshWorker::assemble_ghost_faces_both</a> |</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa47c6806a06155c94191629fae2755763">MeshWorker::assemble_own_interior_faces_once</a>,</div>
<div class="line">                        <span class="comment">/*boundary_worker=*/</span><span class="keyword">nullptr</span>,</div>
<div class="line">                        face_worker);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> global_error_estimate =</div>
<div class="line">    <a class="code" href="numbers_8h.html#ac4a2ed1890a931d0b6a55933310eadca">std::sqrt</a>(<a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(estimated_error_square_per_cell.l1_norm(),</div>
<div class="line">                                  mpi_communicator));</div>
<div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;   Global error estimate:        &quot;</span> &lt;&lt; global_error_estimate</div>
<div class="line">        &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__MeshWorker_html_ga76ec61fbd188fb320fe8ca166a79b322"><div class="ttname"><a href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a></div><div class="ttdeci">void mesh_loop(const CellIteratorType &amp;begin, const CellIteratorType &amp;end, const CellWorkerFunctionType &amp;cell_worker, const CopierType &amp;copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const AssembleFlags flags=assemble_own_cells, const BoundaryWorkerFunctionType &amp;boundary_worker=BoundaryWorkerFunctionType(), const FaceWorkerFunctionType &amp;face_worker=FaceWorkerFunctionType(), const unsigned int queue_length=2 *MultithreadInfo::n_threads(), const unsigned int chunk_size=8)</div><div class="ttdef"><b>Definition:</b> <a href="mesh__loop_8h_source.html#l00282">mesh_loop.h:282</a></div></div>
<div class="ttc" id="anamespaceMeshWorker_html_ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa"><div class="ttname"><a href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa">MeshWorker::assemble_own_cells</a></div><div class="ttdeci">@ assemble_own_cells</div><div class="ttdef"><b>Definition:</b> <a href="assemble__flags_8h_source.html#l00048">assemble_flags.h:48</a></div></div>
<div class="ttc" id="anamespaceMeshWorker_html_ac7a9db8b34d398d7d398d1e8809874aaa47c6806a06155c94191629fae2755763"><div class="ttname"><a href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa47c6806a06155c94191629fae2755763">MeshWorker::assemble_own_interior_faces_once</a></div><div class="ttdeci">@ assemble_own_interior_faces_once</div><div class="ttdef"><b>Definition:</b> <a href="assemble__flags_8h_source.html#l00057">assemble_flags.h:57</a></div></div>
<div class="ttc" id="anamespaceMeshWorker_html_ac7a9db8b34d398d7d398d1e8809874aaa9396964e7e270fe0a0c5d01474721c24"><div class="ttname"><a href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa9396964e7e270fe0a0c5d01474721c24">MeshWorker::assemble_ghost_faces_both</a></div><div class="ttdeci">@ assemble_ghost_faces_both</div><div class="ttdef"><b>Definition:</b> <a href="assemble__flags_8h_source.html#l00075">assemble_flags.h:75</a></div></div>
<div class="ttc" id="anamespaceUtilities_1_1MPI_html_ab544a3bf3301a6dd3e705ee352c5551b"><div class="ttname"><a href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a></div><div class="ttdeci">T sum(const T &amp;t, const MPI_Comm &amp;mpi_communicator)</div></div>
<div class="ttc" id="anumbers_8h_html_ac4a2ed1890a931d0b6a55933310eadca"><div class="ttname"><a href="numbers_8h.html#ac4a2ed1890a931d0b6a55933310eadca">std::sqrt</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; sqrt(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05406">vectorization.h:5406</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemrefine_grid"></a> </p><h4>LaplaceProblem::refine_grid()</h4>
<p>We use the cell-wise estimator stored in the vector <code>estimate_vector</code> and refine a fixed number of cells (chosen here to roughly double the number of DoFs in each step).</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::refine_grid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Refine grid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> refinement_fraction = 1. / (<a class="code" href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a>(2.0, dim) - 1.);</div>
<div class="line">  <a class="code" href="namespaceparallel_1_1distributed_1_1GridRefinement.html#aa2ffb707a796ae6dedb75036606ef2e6">parallel::distributed::GridRefinement::refine_and_coarsen_fixed_number</a>(</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>, estimated_error_square_per_cell, refinement_fraction, 0.0);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceparallel_1_1distributed_1_1GridRefinement_html_aa2ffb707a796ae6dedb75036606ef2e6"><div class="ttname"><a href="namespaceparallel_1_1distributed_1_1GridRefinement.html#aa2ffb707a796ae6dedb75036606ef2e6">parallel::distributed::GridRefinement::refine_and_coarsen_fixed_number</a></div><div class="ttdeci">void refine_and_coarsen_fixed_number(parallel::distributed::Triangulation&lt; dim, spacedim &gt; &amp;tria, const ::Vector&lt; Number &gt; &amp;criteria, const double top_fraction_of_cells, const double bottom_fraction_of_cells, const types::global_cell_index max_n_cells=std::numeric_limits&lt; types::global_cell_index &gt;::max())</div><div class="ttdef"><b>Definition:</b> <a href="distributed_2grid__refinement_8cc_source.html#l00493">grid_refinement.cc:493</a></div></div>
<div class="ttc" id="anumbers_8h_html_af44aee1db5cdcd0bab54e3c011d2be66"><div class="ttname"><a href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; pow(const ::VectorizedArray&lt; Number, width &gt; &amp;, const Number p)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05422">vectorization.h:5422</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemoutput_results"></a> </p><h4>LaplaceProblem::output_results()</h4>
<p>The output_results() function is similar to the ones found in many of the tutorials (see <a class="el" href="step_40.html">step-40</a> for example).</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Output results&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  VectorType temp_solution;</div>
<div class="line">  temp_solution.reinit(locally_owned_dofs,</div>
<div class="line">                       locally_relevant_dofs,</div>
<div class="line">                       mpi_communicator);</div>
<div class="line">  temp_solution = solution;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(temp_solution, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> subdomain(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; subdomain.size(); ++i)</div>
<div class="line">    subdomain(i) = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.locally_owned_subdomain();</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(subdomain, <span class="stringliteral">&quot;subdomain&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>(cell-&gt;active_cell_index()) = cell-&gt;level();</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, <span class="stringliteral">&quot;level&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (estimated_error_square_per_cell.size() &gt; 0)</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(estimated_error_square_per_cell,</div>
<div class="line">                             <span class="stringliteral">&quot;estimated_error_square_per_cell&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string pvtu_filename = data_out.<a class="code" href="group__Exceptions.html#ga0864e51eb173c87e2a3edc9391ea8009">write_vtu_with_pvtu_record</a>(</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;solution&quot;</span>, cycle, mpi_communicator, 2 <span class="comment">/*n_digits*/</span>, 1 <span class="comment">/*n_groups*/</span>);</div>
<div class="line"> </div>
<div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;   Wrote &quot;</span> &lt;&lt; pvtu_filename &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassDataOut__DoFData_html_ac1eb26168177faa30ffbcf9cbb9c3cd5"><div class="ttname"><a href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandlerType &amp;)</div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_ace4b76e565ba0701c4d32c26075ed3b9"><div class="ttname"><a href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="data__out__dof__data_8h_source.html#l01087">data_out_dof_data.h:1087</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8h_source.html#l00147">data_out.h:150</a></div></div>
<div class="ttc" id="aclassDataOut_html_a5eb51872b8736849bb7e8d2007fae086"><div class="ttname"><a href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01085">data_out.cc:1085</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga0864e51eb173c87e2a3edc9391ea8009"><div class="ttname"><a href="group__Exceptions.html#ga0864e51eb173c87e2a3edc9391ea8009">DataOutInterface::write_vtu_with_pvtu_record</a></div><div class="ttdeci">std::string write_vtu_with_pvtu_record(const std::string &amp;directory, const std::string &amp;filename_without_extension, const unsigned int counter, const MPI_Comm &amp;mpi_communicator, const unsigned int n_digits_for_counter=numbers::invalid_unsigned_int, const unsigned int n_groups=0) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07326">data_out_base.cc:7326</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="LaplaceProblemrun"></a> </p><h4><a class="el" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">LaplaceProblem::run()</a></h4>
<p>As in most tutorials, this function calls the various functions defined above to setup, assemble, solve, and output the results.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">LaplaceProblem&lt;dim, degree&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle = 0; cycle &lt; settings.n_steps; ++cycle)</div>
<div class="line">    {</div>
<div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; cycle &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">if</span> (cycle &gt; 0)</div>
<div class="line">        refine_grid();</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;   Number of active cells:       &quot;</span></div>
<div class="line">            &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_active_cells();</div>
</div><!-- fragment --><p>We only output level cell data for the GMG methods (same with DoF data below). Note that the partition efficiency is irrelevant for AMG since the level hierarchy is not distributed or used during the computation.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (settings.solver == Settings::gmg_mf ||</div>
<div class="line">    settings.solver == Settings::gmg_mb)</div>
<div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels() &lt;&lt; <span class="stringliteral">&quot; global levels)&quot;</span></div>
<div class="line">        &lt;&lt; std::endl</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;   Partition efficiency:         &quot;</span></div>
<div class="line">        &lt;&lt; 1.0 / <a class="code" href="namespaceMGTools.html#a8776ac550d9ac85e7e0db51625935673">MGTools::workload_imbalance</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">setup_system();</div>
<div class="ttc" id="anamespaceMGTools_html_a8776ac550d9ac85e7e0db51625935673"><div class="ttname"><a href="namespaceMGTools.html#a8776ac550d9ac85e7e0db51625935673">MGTools::workload_imbalance</a></div><div class="ttdeci">double workload_imbalance(const Triangulation&lt; dim, spacedim &gt; &amp;tria)</div><div class="ttdef"><b>Definition:</b> <a href="mg__tools_8cc_source.html#l01612">mg_tools.cc:1612</a></div></div>
</div><!-- fragment --><p>Only set up the multilevel hierarchy for GMG.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (settings.solver == Settings::gmg_mf ||</div>
<div class="line">    settings.solver == Settings::gmg_mb)</div>
<div class="line">  setup_multigrid();</div>
<div class="line"> </div>
<div class="line">pcout &lt;&lt; <span class="stringliteral">&quot;   Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.n_dofs();</div>
<div class="line"><span class="keywordflow">if</span> (settings.solver == Settings::gmg_mf ||</div>
<div class="line">    settings.solver == Settings::gmg_mb)</div>
<div class="line">  {</div>
<div class="line">    pcout &lt;&lt; <span class="stringliteral">&quot; (by level: &quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">      pcout &lt;&lt; dof_handler.n_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">            &lt;&lt; (<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> == <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels() - 1 ? <span class="stringliteral">&quot;)&quot;</span> :</div>
<div class="line">                                                               <span class="stringliteral">&quot;, &quot;</span>);</div>
<div class="line">  }</div>
<div class="line">pcout &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>For the matrix-free method, we only assemble the right-hand side. For both matrix-based methods, we assemble both active matrix and right-hand side, and only assemble the multigrid matrices for matrix-based GMG.</p>
<div class="fragment"><div class="line">      <span class="keywordflow">if</span> (settings.solver == Settings::gmg_mf)</div>
<div class="line">        assemble_rhs();</div>
<div class="line">      <span class="keywordflow">else</span> <span class="comment">/*gmg_mb or amg*/</span></div>
<div class="line">        {</div>
<div class="line">          assemble_system();</div>
<div class="line">          <span class="keywordflow">if</span> (settings.solver == Settings::gmg_mb)</div>
<div class="line">            assemble_multigrid();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      solve();</div>
<div class="line">      estimate();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (settings.output)</div>
<div class="line">        output_results(cycle);</div>
<div class="line"> </div>
<div class="line">      computing_timer.print_summary();</div>
<div class="line">      computing_timer.reset();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Themainfunction"></a> </p><h3>The main() function</h3>
<p>This is a similar main function to <a class="el" href="step_40.html">step-40</a>, with the exception that we require the user to pass a .prm file as a sole command line argument (see <a class="el" href="step_29.html">step-29</a> and the documentation of the <a class="el" href="classParameterHandler.html">ParameterHandler</a> class for a complete discussion of parameter files).</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">  <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(argc, argv, 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> settings;</div>
<div class="line">  <span class="keywordflow">if</span> (!settings.try_parse((argc &gt; 1) ? (argv[1]) : <span class="stringliteral">&quot;&quot;</span>))</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fe_degree = 2;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">switch</span> (settings.dimension)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">case</span> 2:</div>
<div class="line">            {</div>
<div class="line">              LaplaceProblem&lt;2, fe_degree&gt; test(settings);</div>
<div class="line">              test.run();</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> 3:</div>
<div class="line">            {</div>
<div class="line">              LaplaceProblem&lt;3, fe_degree&gt; test(settings);</div>
<div class="line">              test.run();</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">default</span>:</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;This program only works in 2d and 3d.&quot;</span>));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      MPI_Abort(MPI_COMM_WORLD, 1);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      MPI_Abort(MPI_COMM_WORLD, 2);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassUtilities_1_1MPI_1_1MPI__InitFinalize_html"><div class="ttname"><a href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a></div><div class="ttdef"><b>Definition:</b> <a href="mpi_8h_source.html#l00902">mpi.h:903</a></div></div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>When you run the program using the following command </p><div class="fragment"><div class="line">mpirun -np 16 ./step-50  gmg_mf_2d.prm</div>
</div><!-- fragment --><p> the screen output should look like the following: </p><div class="fragment"><div class="line">Cycle 0:</div>
<div class="line">   Number of active cells:       12 (2 global levels)</div>
<div class="line">   Partition efficiency:         0.1875</div>
<div class="line">   Number of degrees of freedom: 65 (by <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>: 21, 65)</div>
<div class="line">   Number of CG iterations:      10</div>
<div class="line">   Global error estimate:        0.355373</div>
<div class="line">   Wrote solution_00.pvtu</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">+---------------------------------------------+------------+------------+</div>
<div class="line">| Total wallclock time elapsed since start    |    0.0163s |            |</div>
<div class="line">|                                             |            |            |</div>
<div class="line">| Section                         | no. calls |  wall time | % of total |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">| Assemble right-hand side        |         1 |  0.000374s |       2.3% |</div>
<div class="line">| Estimate                        |         1 |  0.000724s |       4.4% |</div>
<div class="line">| Output results                  |         1 |   0.00277s |        17% |</div>
<div class="line">| Setup                           |         1 |   0.00225s |        14% |</div>
<div class="line">| Setup multigrid                 |         1 |   0.00181s |        11% |</div>
<div class="line">| Solve                           |         1 |   0.00364s |        22% |</div>
<div class="line">| Solve: 1 multigrid <a class="code" href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">V</a>-cycle      |         1 |  0.000354s |       2.2% |</div>
<div class="line">| Solve: CG                       |         1 |   0.00151s |       9.3% |</div>
<div class="line">| Solve: Preconditioner setup     |         1 |   0.00125s |       7.7% |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line"> </div>
<div class="line">Cycle 1:</div>
<div class="line">   Number of active cells:       24 (3 global levels)</div>
<div class="line">   Partition efficiency:         0.276786</div>
<div class="line">   Number of degrees of freedom: 139 (by <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>: 21, 65, 99)</div>
<div class="line">   Number of CG iterations:      10</div>
<div class="line">   Global error estimate:        0.216726</div>
<div class="line">   Wrote solution_01.pvtu</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">+---------------------------------------------+------------+------------+</div>
<div class="line">| Total wallclock time elapsed since start    |    0.0169s |            |</div>
<div class="line">|                                             |            |            |</div>
<div class="line">| Section                         | no. calls |  wall time | % of total |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">| Assemble right-hand side        |         1 |  0.000309s |       1.8% |</div>
<div class="line">| Estimate                        |         1 |   0.00156s |       9.2% |</div>
<div class="line">| Output results                  |         1 |   0.00222s |        13% |</div>
<div class="line">| Refine grid                     |         1 |   0.00278s |        16% |</div>
<div class="line">| Setup                           |         1 |   0.00196s |        12% |</div>
<div class="line">| Setup multigrid                 |         1 |    0.0023s |        14% |</div>
<div class="line">| Solve                           |         1 |   0.00565s |        33% |</div>
<div class="line">| Solve: 1 multigrid <a class="code" href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">V</a>-cycle      |         1 |  0.000349s |       2.1% |</div>
<div class="line">| Solve: CG                       |         1 |   0.00285s |        17% |</div>
<div class="line">| Solve: Preconditioner setup     |         1 |   0.00195s |        12% |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line"> </div>
<div class="line">Cycle 2:</div>
<div class="line">   Number of active cells:       51 (4 global levels)</div>
<div class="line">   Partition efficiency:         0.41875</div>
<div class="line">   Number of degrees of freedom: 245 (by <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>: 21, 65, 225, 25)</div>
<div class="line">   Number of CG iterations:      11</div>
<div class="line">   Global error estimate:        0.112098</div>
<div class="line">   Wrote solution_02.pvtu</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">+---------------------------------------------+------------+------------+</div>
<div class="line">| Total wallclock time elapsed since start    |    0.0183s |            |</div>
<div class="line">|                                             |            |            |</div>
<div class="line">| Section                         | no. calls |  wall time | % of total |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">| Assemble right-hand side        |         1 |  0.000274s |       1.5% |</div>
<div class="line">| Estimate                        |         1 |   0.00127s |       6.9% |</div>
<div class="line">| Output results                  |         1 |   0.00227s |        12% |</div>
<div class="line">| Refine grid                     |         1 |    0.0024s |        13% |</div>
<div class="line">| Setup                           |         1 |   0.00191s |        10% |</div>
<div class="line">| Setup multigrid                 |         1 |   0.00295s |        16% |</div>
<div class="line">| Solve                           |         1 |   0.00702s |        38% |</div>
<div class="line">| Solve: 1 multigrid <a class="code" href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">V</a>-cycle      |         1 |  0.000398s |       2.2% |</div>
<div class="line">| Solve: CG                       |         1 |   0.00376s |        21% |</div>
<div class="line">| Solve: Preconditioner setup     |         1 |   0.00238s |        13% |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="line">.</div>
<div class="ttc" id="anamespaceLAPACKSupport_html_aee5ef58d11434eb1d6a665e64bf17292"><div class="ttname"><a href="namespaceLAPACKSupport.html#aee5ef58d11434eb1d6a665e64bf17292">LAPACKSupport::V</a></div><div class="ttdeci">static const char V</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00177">lapack_support.h:177</a></div></div>
</div><!-- fragment --><p> Here, the timing of the <code>solve()</code> function is split up in 3 parts: setting up the multigrid preconditioner, execution of a single multigrid V-cycle, and the CG solver. The V-cycle that is timed is unnecessary for the overall solve and only meant to give an insight at the different costs for AMG and GMG. Also it should be noted that when using the AMG solver, "Workload imbalance" is not included in the output since the hierarchy of coarse meshes is not required.</p>
<p>All results in this section are gathered on Intel Xeon Platinum 8280 (Cascade Lake) nodes which have 56 cores and 192GB per node and support AVX-512 instructions, allowing for vectorization over 8 doubles (vectorization used only in the matrix-free computations). The code is compiled using gcc 7.1.0 with intel-mpi 17.0.3. Trilinos 12.10.1 is used for the matrix-based GMG/AMG computations.</p>
<p>We can then gather a variety of information by calling the program with the input files that are provided in the directory in which <a class="el" href="step_50.html">step-50</a> is located. Using these, and adjusting the number of mesh refinement steps, we can produce information about how well the program scales.</p>
<p>The following table gives weak scaling timings for this program on up to 256M DoFs and 7,168 processors. (Recall that weak scaling keeps the number of degrees of freedom per processor constant while increasing the number of processors; i.e., it considers larger and larger problems.) Here, \(\mathbb{E}\) is the partition efficiency from the introduction (also equal to 1.0/workload imbalance), "Setup" is a combination of setup, setup multigrid, assemble, and assemble multigrid from the timing blocks, and "Prec" is the preconditioner setup. Ideally all times would stay constant over each problem size for the individual solvers, but since the partition efficiency decreases from 0.371 to 0.161 from largest to smallest problem size, we expect to see an approximately \(0.371/0.161=2.3\) times increase in timings for GMG. This is, in fact, pretty close to what we really get:</p>
<table align="center" class="doxtable">
<tr>
<th colspan="4"></th><th></th><th colspan="4">MF-GMG </th><th></th><th colspan="4">MB-GMG </th><th></th><th colspan="4">AMG  </th></tr>
<tr>
<th align="right">Procs </th><th align="right">Cycle </th><th align="right">DoFs </th><th align="right">\(\mathbb{E}\) </th><th></th><th align="right">Setup </th><th align="right">Prec </th><th align="right">Solve </th><th align="right">Total </th><th></th><th align="right">Setup </th><th align="right">Prec </th><th align="right">Solve </th><th align="right">Total </th><th></th><th align="right">Setup </th><th align="right">Prec </th><th align="right">Solve </th><th align="right">Total  </th></tr>
<tr>
<td align="right">112 </td><td align="right">13 </td><td align="right">4M </td><td align="right">0.37 </td><td></td><td align="right">0.742 </td><td align="right">0.393 </td><td align="right">0.200 </td><td align="right">1.335 </td><td></td><td align="right">1.714 </td><td align="right">2.934 </td><td align="right">0.716 </td><td align="right">5.364 </td><td></td><td align="right">1.544 </td><td align="right">0.456 </td><td align="right">1.150 </td><td align="right">3.150  </td></tr>
<tr>
<td align="right">448 </td><td align="right">15 </td><td align="right">16M </td><td align="right">0.29 </td><td></td><td align="right">0.884 </td><td align="right">0.535 </td><td align="right">0.253 </td><td align="right">1.672 </td><td></td><td align="right">1.927 </td><td align="right">3.776 </td><td align="right">1.190 </td><td align="right">6.893 </td><td></td><td align="right">1.544 </td><td align="right">0.456 </td><td align="right">1.150 </td><td align="right">3.150  </td></tr>
<tr>
<td align="right">1,792 </td><td align="right">17 </td><td align="right">65M </td><td align="right">0.22 </td><td></td><td align="right">1.122 </td><td align="right">0.686 </td><td align="right">0.309 </td><td align="right">2.117 </td><td></td><td align="right">2.171 </td><td align="right">4.862 </td><td align="right">1.660 </td><td align="right">8.693 </td><td></td><td align="right">1.654 </td><td align="right">0.546 </td><td align="right">1.460 </td><td align="right">3.660  </td></tr>
<tr>
<td align="right">7,168 </td><td align="right">19 </td><td align="right">256M </td><td align="right">0.16 </td><td></td><td align="right">1.214 </td><td align="right">0.893 </td><td align="right">0.521 </td><td align="right">2.628 </td><td></td><td align="right">2.386 </td><td align="right">7.260 </td><td align="right">2.560 </td><td align="right">12.206 </td><td></td><td align="right">1.844 </td><td align="right">1.010 </td><td align="right">1.890 </td><td align="right">4.744  </td></tr>
</table>
<p>On the other hand, the algebraic multigrid in the last set of columns is relatively unaffected by the increasing imbalance of the mesh hierarchy (because it doesn't use the mesh hierarchy) and the growth in time is rather driven by other factors that are well documented in the literature (most notably that the algorithmic complexity of some parts of algebraic multigrid methods appears to be \({\cal O}(N \log N)\) instead of \({\cal O}(N)\) for geometric multigrid).</p>
<p>The upshort of the table above is that the matrix-free geometric multigrid method appears to be the fastest approach to solving this equation if not by a huge margin. Matrix-based methods, on the other hand, are consistently the worst.</p>
<p>The following figure provides strong scaling results for each method, i.e., we solve the same problem on more and more processors. Specifically, we consider the problems after 16 mesh refinement cycles (32M DoFs) and 19 cycles (256M DoFs), on between 56 to 28,672 processors:</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-50-strong-scaling.png" alt="" width="600px" class="inline"/></p>
<p>While the matrix-based GMG solver and AMG scale similarly and have a similar time to solution (at least as long as there is a substantial number of unknowns per processor &ndash; say, several 10,000), the matrix-free GMG solver scales much better and solves the finer problem in roughly the same time as the AMG solver for the coarser mesh with only an eighth of the number of processors. Conversely, it can solve the same problem on the same number of processors in about one eighth the time.</p>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions </h3>
<p><a class="anchor" id="Testingconvergenceandhigherorderelements"></a></p><h4>Testing convergence and higher order elements </h4>
<p>The finite element degree is currently hard-coded as 2, see the template arguments of the main class. It is easy to change. To test, it would be interesting to switch to a test problem with a reference solution. This way, you can compare error rates.</p>
<p><a class="anchor" id="Coarsesolver"></a></p><h4>Coarse solver </h4>
<p>A more interesting example would involve a more complicated coarse mesh (see <a class="el" href="step_49.html">step-49</a> for inspiration). The issue in that case is that the coarsest level of the mesh hierarchy is actually quite large, and one would have to think about ways to solve the coarse level problem efficiently. (This is not an issue for algebraic multigrid methods because they would just continue to build coarser and coarser levels of the matrix, regardless of their geometric origin.)</p>
<p>In the program here, we simply solve the coarse level problem with a Conjugate Gradient method without any preconditioner. That is acceptable if the coarse problem is really small &ndash; for example, if the coarse mesh had a single cell, then the coarse mesh problems has a \(9\times 9\) matrix in 2d, and a \(27\times 27\) matrix in 3d; for the coarse mesh we use on the \(L\)-shaped domain of the current program, these sizes are \(21\times 21\) in 2d and \(117\times 117\) in 3d. But if the coarse mesh consists of hundreds or thousands of cells, this approach will no longer work and might start to dominate the overall run-time of each V-cyle. A common approach is then to solve the coarse mesh problem using an algebraic multigrid preconditioner; this would then, however, require assembling the coarse matrix (even for the matrix-free version) as input to the AMG implementation.</p>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2019 - 2020 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Author: Thomas C. Clevenger, Clemson University</span></div>
<div class="line"><span class="comment"> *         Timo Heister, Clemson University</span></div>
<div class="line"><span class="comment"> *         Guido Kanschat, Heidelberg University</span></div>
<div class="line"><span class="comment"> *         Martin Kronbichler, Technical University of Munich</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="data__out__base_8h.html">deal.II/base/data_out_base.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="index__set_8h.html">deal.II/base/index_set.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="logstream_8h.html">deal.II/base/logstream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="distributed_2grid__refinement_8h.html">deal.II/distributed/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="distributed_2tria_8h.html">deal.II/distributed/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="generic__linear__algebra_8h.html">deal.II/lac/generic_linear_algebra.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define FORCE_USE_OF_TRILINOS</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>LA</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if defined(DEAL_II_WITH_PETSC) &amp;&amp; !defined(DEAL_II_PETSC_WITH_COMPLEX) &amp;&amp; \</span></div>
<div class="line"><span class="preprocessor">  !(defined(DEAL_II_WITH_TRILINOS) &amp;&amp; defined(FORCE_USE_OF_TRILINOS))</span></div>
<div class="line">  <span class="keyword">using namespace </span>dealii::LinearAlgebraPETSc;</div>
<div class="line"><span class="preprocessor">#  define USE_PETSC_LA</span></div>
<div class="line"><span class="preprocessor">#elif defined(DEAL_II_WITH_TRILINOS)</span></div>
<div class="line">  <span class="keyword">using namespace </span>dealii::LinearAlgebraTrilinos;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#  error DEAL_II_WITH_PETSC or DEAL_II_WITH_TRILINOS required</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">} <span class="comment">// namespace LA</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__transfer__matrix__free_8h.html">deal.II/multigrid/mg_transfer_matrix_free.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__interface__values_8h.html">deal.II/fe/fe_interface_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mesh__loop_8h.html">deal.II/meshworker/mesh_loop.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>ChangeVectorTypes</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a>(<a class="code" href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LA::MPI::Vector</a> &amp;                                         out,</div>
<div class="line">            const ::LinearAlgebra::distributed::Vector&lt;number&gt; &amp;in)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1ReadWriteVector.html">::LinearAlgebra::ReadWriteVector&lt;double&gt;</a> rwv(</div>
<div class="line">      out.locally_owned_elements());</div>
<div class="line">    rwv.import(in, <a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae5042eefddc828c7c31e1e8e26da8b09">VectorOperation::insert</a>);</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;CopyVectorTypes::copy() not implemented for &quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;PETSc vector types.&quot;</span>));</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    out.import(rwv, <a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae5042eefddc828c7c31e1e8e26da8b09">VectorOperation::insert</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">copy</a>(::<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;number&gt;</a> &amp;out,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LA::MPI::Vector</a> &amp;                             in)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1ReadWriteVector.html">::LinearAlgebra::ReadWriteVector&lt;double&gt;</a> rwv;</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">    (void)in;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;CopyVectorTypes::copy() not implemented for &quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;PETSc vector types.&quot;</span>));</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    rwv.<a class="code" href="group__Vectors.html#gaaee2ea7c671f9ece558b081b0d104295">reinit</a>(in);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    out.<a class="code" href="group__Vectors.html#gaf7b743d761233b92e0ed23e6bf37a409">import</a>(rwv, <a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae5042eefddc828c7c31e1e8e26da8b09">VectorOperation::insert</a>);</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace ChangeVectorTypes</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*component*/</span> = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> 1.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a></div>
<div class="line">  <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a>&lt;dim, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*component*/</span> = 0)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>(1.0);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>Coefficient : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;p,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*component*/</span> = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a>&lt;dim, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp;p,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*component*/</span> = 0) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  number average_value(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim, number&gt;</a>&gt; &amp;points) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">  std::shared_ptr&lt;Table&lt;2, VectorizedArray&lt;number&gt;&gt;&gt; make_coefficient_table(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree</a>&lt;dim, number, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp;mf_storage) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> Coefficient&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;p, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (p[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] &lt; -0.5)</div>
<div class="line">        <span class="keywordflow">return</span> 100.0;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">return</span> 1.0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line"><a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a></div>
<div class="line">Coefficient&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a>&lt;dim, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp;p,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a> return_value = <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>(1.0);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; VectorizedArray&lt;number&gt;::size(); ++i)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> = 0; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a> &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>)</div>
<div class="line">        <span class="keywordflow">if</span> (p[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>][i] &lt; -0.5)</div>
<div class="line">          {</div>
<div class="line">            return_value[i] = 100.0;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> return_value;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">number Coefficient&lt;dim&gt;::average_value(</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim, number&gt;</a>&gt; &amp;points)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  number average(0);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; points.size(); ++i)</div>
<div class="line">    average += <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(points[i]);</div>
<div class="line">  average /= points.size();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> average;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> number&gt;</div>
<div class="line">std::shared_ptr&lt;Table&lt;2, VectorizedArray&lt;number&gt;&gt;&gt;</div>
<div class="line">Coefficient&lt;dim&gt;::make_coefficient_table(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree</a>&lt;dim, number, <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a>&gt; &amp;mf_storage)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">auto</span> coefficient_table =</div>
<div class="line">    std::make_shared&lt;Table&lt;2, VectorizedArray&lt;number&gt;&gt;&gt;();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation</a>&lt;dim, -1, 0, 1, number&gt; fe_eval(mf_storage);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>    = mf_storage.n_cell_batches();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = fe_eval.n_q_points;</div>
<div class="line"> </div>
<div class="line">  coefficient_table-&gt;reinit(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>, 1);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a9f815604be9b560fea00beef8d720480">n_cells</a>; ++cell)</div>
<div class="line">    {</div>
<div class="line">      fe_eval.reinit(cell);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;number&gt;</a> average_value = 0.;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">        average_value += <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(fe_eval.quadrature_point(q));</div>
<div class="line">      average_value /= n_q_points;</div>
<div class="line"> </div>
<div class="line">      (*coefficient_table)(cell, 0) = average_value;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> coefficient_table;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a></div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">bool</span> try_parse(<span class="keyword">const</span> std::string &amp;prm_filename);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> <a class="code" href="classSolverType.html">SolverType</a></div>
<div class="line">  {</div>
<div class="line">    gmg_mb,</div>
<div class="line">    gmg_mf,</div>
<div class="line">    amg</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolverType.html">SolverType</a> solver;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span>          dimension;</div>
<div class="line">  <span class="keywordtype">double</span>       smoother_dampen;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> smoother_steps;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_steps;</div>
<div class="line">  <span class="keywordtype">bool</span>         output;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> Settings::try_parse(<span class="keyword">const</span> std::string &amp;prm_filename)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;dim&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(), <span class="stringliteral">&quot;The problem dimension.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;n_steps&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;10&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of adaptive refinement steps.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;smoother dampen&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;1.0&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                    <span class="stringliteral">&quot;Dampen factor for the smoother.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;smoother steps&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of smoother steps.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;solver&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;MF&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;MF|MB|AMG&quot;</span>),</div>
<div class="line">                    <span class="stringliteral">&quot;Switch between matrix-free GMG, &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;matrix-based GMG, and AMG.&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;output&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;false&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Output graphical results.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (prm_filename.size() == 0)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;****  Error: No input file provided!\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;****  Error: Call this program as &#39;./step-50 input.prm\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;****  You may want to use one of the input files in this\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;****  directory, or use the following default values\n&quot;</span></div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;****  to create an input file:\n&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">print_parameters</a>(std::cout, <a class="code" href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827ae4d13a4598073bfcb69cd0cf4c1f8365">ParameterHandler::Text</a>);</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(prm_filename);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD) == 0)</div>
<div class="line">        std::cerr &lt;&lt; <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>.what() &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;solver&quot;</span>) == <span class="stringliteral">&quot;MF&quot;</span>)</div>
<div class="line">    this-&gt;solver = gmg_mf;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;solver&quot;</span>) == <span class="stringliteral">&quot;MB&quot;</span>)</div>
<div class="line">    this-&gt;solver = gmg_mb;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;solver&quot;</span>) == <span class="stringliteral">&quot;AMG&quot;</span>)</div>
<div class="line">    this-&gt;solver = amg;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line"> </div>
<div class="line">  this-&gt;dimension       = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;dim&quot;</span>);</div>
<div class="line">  this-&gt;n_steps         = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;n_steps&quot;</span>);</div>
<div class="line">  this-&gt;smoother_dampen = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;smoother dampen&quot;</span>);</div>
<div class="line">  this-&gt;smoother_steps  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;smoother steps&quot;</span>);</div>
<div class="line">  this-&gt;output          = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keyword">class </span>LaplaceProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  LaplaceProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;settings);</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">using</span> MatrixType         = <a class="code" href="namespaceLinearAlgebraDealII.html#a912abe2208022aec6753876bcc72f6bf">LA::MPI::SparseMatrix</a>;</div>
<div class="line">  <span class="keyword">using</span> VectorType         = <a class="code" href="namespaceLinearAlgebraDealII.html#a9fe13d579422411556954ab3f28a59be">LA::MPI::Vector</a>;</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a41f11f7a1992c6d6aa9367b12c68f791">PreconditionAMG</a>    = <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a41f11f7a1992c6d6aa9367b12c68f791">LA::MPI::PreconditionAMG</a>;</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="classPreconditionJacobi.html">PreconditionJacobi</a> = <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a84fd288bacabd1a7e3408885fb0fad01">LA::MPI::PreconditionJacobi</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> MatrixFreeLevelMatrix = <a class="code" href="classMatrixFreeOperators_1_1LaplaceOperator.html">MatrixFreeOperators::LaplaceOperator</a>&lt;</div>
<div class="line">    dim,</div>
<div class="line">    degree,</div>
<div class="line">    degree + 1,</div>
<div class="line">    1,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>&gt;;</div>
<div class="line">  <span class="keyword">using</span> MatrixFreeActiveMatrix = <a class="code" href="classMatrixFreeOperators_1_1LaplaceOperator.html">MatrixFreeOperators::LaplaceOperator</a>&lt;</div>
<div class="line">    dim,</div>
<div class="line">    degree,</div>
<div class="line">    degree + 1,</div>
<div class="line">    1,</div>
<div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> MatrixFreeLevelVector  = <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;float&gt;</a>;</div>
<div class="line">  <span class="keyword">using</span> MatrixFreeActiveVector = <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;double&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line">  <span class="keywordtype">void</span> setup_multigrid();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_multigrid();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_rhs();</div>
<div class="line">  <span class="keywordtype">void</span> solve();</div>
<div class="line">  <span class="keywordtype">void</span> estimate();</div>
<div class="line">  <span class="keywordtype">void</span> refine_grid();</div>
<div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> settings;</div>
<div class="line"> </div>
<div class="line">  MPI_Comm           mpi_communicator;</div>
<div class="line">  <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMappingQ1.html">MappingQ1&lt;dim&gt;</a>                      mapping;</div>
<div class="line">  <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>                                 fe;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classIndexSet.html">IndexSet</a>                  locally_owned_dofs;</div>
<div class="line">  <a class="code" href="classIndexSet.html">IndexSet</a>                  locally_relevant_dofs;</div>
<div class="line">  <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"> </div>
<div class="line">  MatrixType             system_matrix;</div>
<div class="line">  MatrixFreeActiveMatrix mf_system_matrix;</div>
<div class="line">  VectorType             solution;</div>
<div class="line">  VectorType             right_hand_side;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>         estimated_error_square_per_cell;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixType&gt;</a> mg_matrix;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixType&gt;</a> mg_interface_in;</div>
<div class="line">  <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a>         mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;MatrixFreeLevelMatrix&gt;</a> mf_mg_matrix;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line">LaplaceProblem&lt;dim, degree&gt;::LaplaceProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;settings)</div>
<div class="line">  : settings(settings)</div>
<div class="line">  , mpi_communicator(MPI_COMM_WORLD)</div>
<div class="line">  , pcout(std::cout, (<a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(mpi_communicator) == 0))</div>
<div class="line">  , <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(mpi_communicator,</div>
<div class="line">                  <a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::limit_level_difference_at_vertices,</div>
<div class="line">                  (settings.solver == <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a>::amg) ?</div>
<div class="line">                    <a class="code" href="namespaceparallel.html">parallel</a>::distributed::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0a7c2ea84f1b4c5f2a6aa010f600ca66b6">default_setting</a> :</div>
<div class="line">                    <a class="code" href="namespaceparallel.html">parallel</a>::distributed::<a class="code" href="classTriangulation.html">Triangulation</a>&lt;</div>
<div class="line">                      dim&gt;::<a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0acc0ed1c2dd30bca7c7576e65b4045274">construct_multigrid_hierarchy</a>)</div>
<div class="line">  , mapping()</div>
<div class="line">  , fe(degree)</div>
<div class="line">  , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , computing_timer(pcout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::never, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#a3b2a4ad8296c2b72a11d23b5969e8cc0">GridGenerator::hyper_L</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>, -1., 1., <span class="comment">/*colorize*/</span> <span class="keyword">false</span>);</div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  dof_handler.distribute_dofs(fe);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceDoFTools.html#acad7e0841b9046eaafddc4c617ab1d9d">DoFTools::extract_locally_relevant_dofs</a>(dof_handler, locally_relevant_dofs);</div>
<div class="line">  locally_owned_dofs = dof_handler.locally_owned_dofs();</div>
<div class="line"> </div>
<div class="line">  solution.reinit(locally_owned_dofs, mpi_communicator);</div>
<div class="line">  right_hand_side.reinit(locally_owned_dofs, mpi_communicator);</div>
<div class="line">  constraints.reinit(locally_relevant_dofs);</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">    mapping, dof_handler, 0, <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), constraints);</div>
<div class="line">  constraints.close();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (settings.solver)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mf:</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, double&gt;::AdditionalData</a> additional_data;</div>
<div class="line">          additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">            <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, double&gt;::AdditionalData::none</a>;</div>
<div class="line">          additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">            (<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">          std::shared_ptr&lt;MatrixFree&lt;dim, double&gt;&gt; mf_storage =</div>
<div class="line">            std::make_shared&lt;MatrixFree&lt;dim, double&gt;&gt;();</div>
<div class="line">          mf_storage-&gt;reinit(mapping,</div>
<div class="line">                             dof_handler,</div>
<div class="line">                             constraints,</div>
<div class="line">                             <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(degree + 1),</div>
<div class="line">                             additional_data);</div>
<div class="line"> </div>
<div class="line">          mf_system_matrix.initialize(mf_storage);</div>
<div class="line"> </div>
<div class="line">          <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line">          mf_system_matrix.set_coefficient(</div>
<div class="line">            coefficient.make_coefficient_table(*mf_storage));</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mb:</div>
<div class="line">      <span class="keywordflow">case</span> Settings::amg:</div>
<div class="line">        {</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">          <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(locally_relevant_dofs);</div>
<div class="line">          <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp, constraints);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceSparsityTools.html#afbc0c7a206ced91b154666215ea3c218">SparsityTools::distribute_sparsity_pattern</a>(dsp,</div>
<div class="line">                                                     locally_owned_dofs,</div>
<div class="line">                                                     mpi_communicator,</div>
<div class="line">                                                     locally_relevant_dofs);</div>
<div class="line"> </div>
<div class="line">          system_matrix.reinit(locally_owned_dofs,</div>
<div class="line">                               locally_owned_dofs,</div>
<div class="line">                               dsp,</div>
<div class="line">                               mpi_communicator);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">          <a class="code" href="classTrilinosWrappers_1_1SparsityPattern.html">TrilinosWrappers::SparsityPattern</a> dsp(locally_owned_dofs,</div>
<div class="line">                                                locally_owned_dofs,</div>
<div class="line">                                                locally_relevant_dofs,</div>
<div class="line">                                                mpi_communicator);</div>
<div class="line">          <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp, constraints);</div>
<div class="line">          dsp.compress();</div>
<div class="line">          system_matrix.reinit(dsp);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::setup_multigrid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Setup multigrid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  dof_handler.distribute_mg_dofs();</div>
<div class="line"> </div>
<div class="line">  mg_constrained_dofs.clear();</div>
<div class="line">  mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::set&lt;types::boundary_id&gt; boundary_ids = {<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">types::boundary_id</a>(0)};</div>
<div class="line">  mg_constrained_dofs.make_zero_boundary_constraints(dof_handler, boundary_ids);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_levels = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (settings.solver)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mf:</div>
<div class="line">        {</div>
<div class="line">          mf_mg_matrix.resize(0, n_levels - 1);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">            {</div>
<div class="line">              <a class="code" href="classIndexSet.html">IndexSet</a> relevant_dofs;</div>
<div class="line">              <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                            <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                                            relevant_dofs);</div>
<div class="line">              <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> level_constraints;</div>
<div class="line">              level_constraints.<a class="code" href="classAffineConstraints.html#a2c9d71b5b7e8851c25a411ccf34de986">reinit</a>(relevant_dofs);</div>
<div class="line">              level_constraints.<a class="code" href="classAffineConstraints.html#aef97b22281acb10c914d79a3881e2735">add_lines</a>(</div>
<div class="line">                mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">              level_constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">              <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, float&gt;::AdditionalData</a> additional_data;</div>
<div class="line">              additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> =</div>
<div class="line">                <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;::AdditionalData::none</a>;</div>
<div class="line">              additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> =</div>
<div class="line">                (<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> |</div>
<div class="line">                 <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a>);</div>
<div class="line">              additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a67c9ff01c51fb7fb3ada151b83cdd409">mg_level</a> = <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;</div>
<div class="line">              std::shared_ptr&lt;MatrixFree&lt;dim, float&gt;&gt; mf_storage_level(</div>
<div class="line">                <span class="keyword">new</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, float&gt;</a>());</div>
<div class="line">              mf_storage_level-&gt;reinit(mapping,</div>
<div class="line">                                       dof_handler,</div>
<div class="line">                                       level_constraints,</div>
<div class="line">                                       <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(degree + 1),</div>
<div class="line">                                       additional_data);</div>
<div class="line"> </div>
<div class="line">              mf_mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mf_storage_level,</div>
<div class="line">                                             mg_constrained_dofs,</div>
<div class="line">                                             <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line"> </div>
<div class="line">              <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line">              mf_mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].set_coefficient(</div>
<div class="line">                coefficient.make_coefficient_table(*mf_storage_level));</div>
<div class="line"> </div>
<div class="line">              mf_mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].compute_diagonal();</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mb:</div>
<div class="line">        {</div>
<div class="line">          mg_matrix.resize(0, n_levels - 1);</div>
<div class="line">          mg_matrix.clear_elements();</div>
<div class="line">          mg_interface_in.resize(0, n_levels - 1);</div>
<div class="line">          mg_interface_in.clear_elements();</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">            {</div>
<div class="line">              <a class="code" href="classIndexSet.html">IndexSet</a> dof_set;</div>
<div class="line">              <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                            <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                                            dof_set);</div>
<div class="line"> </div>
<div class="line">              {</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">                <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_set);</div>
<div class="line">                <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                dsp.compress();</div>
<div class="line">                <a class="code" href="namespaceSparsityTools.html#afbc0c7a206ced91b154666215ea3c218">SparsityTools::distribute_sparsity_pattern</a>(</div>
<div class="line">                  dsp,</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  mpi_communicator,</div>
<div class="line">                  dof_set);</div>
<div class="line"> </div>
<div class="line">                mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dsp,</div>
<div class="line">                  mpi_communicator);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">                <a class="code" href="classTrilinosWrappers_1_1SparsityPattern.html">TrilinosWrappers::SparsityPattern</a> dsp(</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_set,</div>
<div class="line">                  mpi_communicator);</div>
<div class="line">                <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line"> </div>
<div class="line">                dsp.compress();</div>
<div class="line">                mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(dsp);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">              {</div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">                <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_set);</div>
<div class="line">                <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                         mg_constrained_dofs,</div>
<div class="line">                                                         dsp,</div>
<div class="line">                                                         <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                dsp.compress();</div>
<div class="line">                <a class="code" href="namespaceSparsityTools.html#afbc0c7a206ced91b154666215ea3c218">SparsityTools::distribute_sparsity_pattern</a>(</div>
<div class="line">                  dsp,</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  mpi_communicator,</div>
<div class="line">                  dof_set);</div>
<div class="line"> </div>
<div class="line">                mg_interface_in[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dsp,</div>
<div class="line">                  mpi_communicator);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">                <a class="code" href="classTrilinosWrappers_1_1SparsityPattern.html">TrilinosWrappers::SparsityPattern</a> dsp(</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_handler.locally_owned_mg_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                  dof_set,</div>
<div class="line">                  mpi_communicator);</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                         mg_constrained_dofs,</div>
<div class="line">                                                         dsp,</div>
<div class="line">                                                         <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                dsp.compress();</div>
<div class="line">                mg_interface_in[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(dsp);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">              }</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Assemble&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(degree + 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe.n_dofs_per_cell();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell);</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_rhs(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line">  RightHandSide&lt;dim&gt;     rhs;</div>
<div class="line">  std::vector&lt;double&gt;    rhs_values(n_q_points);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.active_cell_iterators())</div>
<div class="line">    <span class="keywordflow">if</span> (cell-&gt;is_locally_owned())</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0;</div>
<div class="line">        cell_rhs    = 0;</div>
<div class="line"> </div>
<div class="line">        fe_values.reinit(cell);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> coefficient_value =</div>
<div class="line">          coefficient.average_value(fe_values.get_quadrature_points());</div>
<div class="line">        rhs.value_list(fe_values.get_quadrature_points(), rhs_values);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">                <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) +=</div>
<div class="line">                  coefficient_value *                <span class="comment">// epsilon(x)</span></div>
<div class="line">                  fe_values.shape_grad(i, q_point) * <span class="comment">// * grad phi_i(x)</span></div>
<div class="line">                  fe_values.shape_grad(j, q_point) * <span class="comment">// * grad phi_j(x)</span></div>
<div class="line">                  fe_values.JxW(q_point);            <span class="comment">// * dx</span></div>
<div class="line"> </div>
<div class="line">              cell_rhs(i) +=</div>
<div class="line">                fe_values.shape_value(i, q_point) * <span class="comment">// grad phi_i(x)</span></div>
<div class="line">                rhs_values[q_point] *               <span class="comment">// * f(x)</span></div>
<div class="line">                fe_values.JxW(q_point);             <span class="comment">// * dx</span></div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">        cell-&gt;get_dof_indices(local_dof_indices);</div>
<div class="line">        constraints.distribute_local_to_global(<a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>,</div>
<div class="line">                                               cell_rhs,</div>
<div class="line">                                               local_dof_indices,</div>
<div class="line">                                               system_matrix,</div>
<div class="line">                                               right_hand_side);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">  system_matrix.compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line">  right_hand_side.compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::assemble_multigrid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Assemble multigrid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(degree + 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe.n_dofs_per_cell();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels(); ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classIndexSet.html">IndexSet</a> dof_set;</div>
<div class="line">      <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(dof_handler,</div>
<div class="line">                                                    <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                                    dof_set);</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(dof_set);</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">        mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">        mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line"> </div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].close();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.cell_iterators())</div>
<div class="line">    <span class="keywordflow">if</span> (cell-&gt;level_subdomain_id() == <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.locally_owned_subdomain())</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0;</div>
<div class="line">        fe_values.reinit(cell);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> coefficient_value =</div>
<div class="line">          coefficient.average_value(fe_values.get_quadrature_points());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">              <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) +=</div>
<div class="line">                coefficient_value * fe_values.shape_grad(i, q_point) *</div>
<div class="line">                fe_values.shape_grad(j, q_point) * fe_values.JxW(q_point);</div>
<div class="line"> </div>
<div class="line">        cell-&gt;get_mg_dof_indices(local_dof_indices);</div>
<div class="line"> </div>
<div class="line">        boundary_constraints[cell-&gt;level()].distribute_local_to_global(</div>
<div class="line">          <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>, local_dof_indices, mg_matrix[cell-&gt;level()]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">            <span class="keywordflow">if</span> (mg_constrained_dofs.is_interface_matrix_entry(</div>
<div class="line">                  cell-&gt;level(), local_dof_indices[i], local_dof_indices[j]))</div>
<div class="line">              mg_interface_in[cell-&gt;level()].add(local_dof_indices[i],</div>
<div class="line">                                                 local_dof_indices[j],</div>
<div class="line">                                                 <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels(); ++i)</div>
<div class="line">    {</div>
<div class="line">      mg_matrix[i].compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line">      mg_interface_in[i].compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::assemble_rhs()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Assemble right-hand side&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  MatrixFreeActiveVector solution_copy;</div>
<div class="line">  MatrixFreeActiveVector right_hand_side_copy;</div>
<div class="line">  mf_system_matrix.initialize_dof_vector(solution_copy);</div>
<div class="line">  mf_system_matrix.initialize_dof_vector(right_hand_side_copy);</div>
<div class="line"> </div>
<div class="line">  solution_copy = 0.;</div>
<div class="line">  constraints.distribute(solution_copy);</div>
<div class="line">  solution_copy.update_ghost_values();</div>
<div class="line">  right_hand_side_copy = 0;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classTable.html">Table&lt;2, VectorizedArray&lt;double&gt;</a>&gt; &amp;coefficient =</div>
<div class="line">    *(mf_system_matrix.get_coefficient());</div>
<div class="line"> </div>
<div class="line">  RightHandSide&lt;dim&gt; right_hand_side_function;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, 1, double&gt;</a> phi(</div>
<div class="line">    *mf_system_matrix.get_matrix_free());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0;</div>
<div class="line">       cell &lt; mf_system_matrix.get_matrix_free()-&gt;n_cell_batches();</div>
<div class="line">       ++cell)</div>
<div class="line">    {</div>
<div class="line">      phi.reinit(cell);</div>
<div class="line">      phi.read_dof_values_plain(solution_copy);</div>
<div class="line">      phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          phi.submit_gradient(-1.0 *</div>
<div class="line">                                (coefficient(cell, 0) * phi.get_gradient(q)),</div>
<div class="line">                              q);</div>
<div class="line">          phi.submit_value(</div>
<div class="line">            right_hand_side_function.value(phi.quadrature_point(q)), q);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      phi.integrate_scatter(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a> |</div>
<div class="line">                              <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aea91b5f00e4be473005cc331b8644ab2f1">EvaluationFlags::gradients</a>,</div>
<div class="line">                            right_hand_side_copy);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  right_hand_side_copy.compress(<a class="code" href="group__Vectors.html#gga40c50779cd14ba89bbf0bd9b4561964cae1077e8dbf4afea5d2df8c8b723c0708">VectorOperation::add</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">ChangeVectorTypes::copy</a>(right_hand_side, right_hand_side_copy);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::solve()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Solve&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(1000, 1.e-10 * right_hand_side.l2_norm());</div>
<div class="line">  solver_control.enable_history_data();</div>
<div class="line"> </div>
<div class="line">  solution = 0.;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (settings.solver)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mf:</div>
<div class="line">        {</div>
<div class="line">          computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a> mg_transfer(mg_constrained_dofs);</div>
<div class="line">          mg_transfer.build(dof_handler);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classSolverControl.html">SolverControl</a> coarse_solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-12, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line">          <a class="code" href="classSolverCG.html">SolverCG&lt;MatrixFreeLevelVector&gt;</a> coarse_solver(coarse_solver_control);</div>
<div class="line">          <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>            <a class="code" href="structidentity.html">identity</a>;</div>
<div class="line">          <a class="code" href="classMGCoarseGridIterativeSolver.html">MGCoarseGridIterativeSolver</a>&lt;MatrixFreeLevelVector,</div>
<div class="line">                                      <a class="code" href="classSolverCG.html">SolverCG&lt;MatrixFreeLevelVector&gt;</a>,</div>
<div class="line">                                      MatrixFreeLevelMatrix,</div>
<div class="line">                                      <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>&gt;</div>
<div class="line">            coarse_grid_solver(coarse_solver, mf_mg_matrix[0], <a class="code" href="structidentity.html">identity</a>);</div>
<div class="line"> </div>
<div class="line">          <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionJacobi.html">::PreconditionJacobi&lt;MatrixFreeLevelMatrix&gt;</a>;</div>
<div class="line">          <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a>&lt;MatrixFreeLevelMatrix,</div>
<div class="line">                                 Smoother,</div>
<div class="line">                                 MatrixFreeLevelVector&gt;</div>
<div class="line">            smoother;</div>
<div class="line">          smoother.<a class="code" href="classMGCoarseGridIterativeSolver.html#a80c597f7ca12c63b070ab0a5605f0a3a">initialize</a>(mf_mg_matrix,</div>
<div class="line">                              <span class="keyword">typename</span> Smoother::AdditionalData(</div>
<div class="line">                                settings.smoother_dampen));</div>
<div class="line">          smoother.set_steps(settings.smoother_steps);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;MatrixFreeLevelVector&gt;</a> mg_m(mf_mg_matrix);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classMGLevelObject.html">MGLevelObject</a>&lt;</div>
<div class="line">            <a class="code" href="classMatrixFreeOperators_1_1MGInterfaceOperator.html">MatrixFreeOperators::MGInterfaceOperator&lt;MatrixFreeLevelMatrix&gt;</a>&gt;</div>
<div class="line">            mg_interface_matrices;</div>
<div class="line">          mg_interface_matrices.resize(0, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels() - 1);</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div>
<div class="line">               ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">            mg_interface_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].initialize(mf_mg_matrix[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">          <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;MatrixFreeLevelVector&gt;</a> mg_interface(mg_interface_matrices);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classMultigrid.html">Multigrid&lt;MatrixFreeLevelVector&gt;</a> <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">            mg_m, coarse_grid_solver, mg_transfer, smoother, smoother);</div>
<div class="line">          <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface, mg_interface);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;dim,</div>
<div class="line">                         MatrixFreeLevelVector,</div>
<div class="line">                         <a class="code" href="classMGTransferMatrixFree.html">MGTransferMatrixFree&lt;dim, float&gt;</a>&gt;</div>
<div class="line">            preconditioner(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="line"> </div>
<div class="line">          MatrixFreeActiveVector solution_copy;</div>
<div class="line">          MatrixFreeActiveVector right_hand_side_copy;</div>
<div class="line">          mf_system_matrix.initialize_dof_vector(solution_copy);</div>
<div class="line">          mf_system_matrix.initialize_dof_vector(right_hand_side_copy);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">ChangeVectorTypes::copy</a>(solution_copy, solution);</div>
<div class="line">          <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">ChangeVectorTypes::copy</a>(right_hand_side_copy, right_hand_side);</div>
<div class="line">          computing_timer.leave_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer,</div>
<div class="line">                                      <span class="stringliteral">&quot;Solve: 1 multigrid V-cycle&quot;</span>);</div>
<div class="line">            preconditioner.vmult(solution_copy, right_hand_side_copy);</div>
<div class="line">          }</div>
<div class="line">          solution_copy = 0.;</div>
<div class="line"> </div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classSolverCG.html">SolverCG&lt;MatrixFreeActiveVector&gt;</a> solver(solver_control);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Solve: CG&quot;</span>);</div>
<div class="line">            solver.solve(mf_system_matrix,</div>
<div class="line">                         solution_copy,</div>
<div class="line">                         right_hand_side_copy,</div>
<div class="line">                         preconditioner);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">          solution_copy.update_ghost_values();</div>
<div class="line">          <a class="code" href="namespaceinternal_1_1VectorOperations.html#a40c8daa0881cff0123fbaeb08929f5cb">ChangeVectorTypes::copy</a>(solution, solution_copy);</div>
<div class="line">          constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">case</span> Settings::gmg_mb:</div>
<div class="line">        {</div>
<div class="line">          computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;VectorType&gt;</a> mg_transfer(mg_constrained_dofs);</div>
<div class="line">          mg_transfer.build(dof_handler);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classSolverControl.html">SolverControl</a>        coarse_solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-12, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line">          <a class="code" href="classSolverCG.html">SolverCG&lt;VectorType&gt;</a> coarse_solver(coarse_solver_control);</div>
<div class="line">          <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a> <a class="code" href="structidentity.html">identity</a>;</div>
<div class="line">          <a class="code" href="classMGCoarseGridIterativeSolver.html">MGCoarseGridIterativeSolver</a>&lt;VectorType,</div>
<div class="line">                                      <a class="code" href="classSolverCG.html">SolverCG&lt;VectorType&gt;</a>,</div>
<div class="line">                                      MatrixType,</div>
<div class="line">                                      <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>&gt;</div>
<div class="line">            coarse_grid_solver(coarse_solver, mg_matrix[0], <a class="code" href="structidentity.html">identity</a>);</div>
<div class="line"> </div>
<div class="line">          <span class="keyword">using</span> Smoother = <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a84fd288bacabd1a7e3408885fb0fad01">LA::MPI::PreconditionJacobi</a>;</div>
<div class="line">          <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition&lt;MatrixType, Smoother, VectorType&gt;</a> smoother;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">          smoother.<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrix);</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(</div>
<div class="line">            settings.smoother_dampen == 1.0,</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>(</div>
<div class="line">              <span class="stringliteral">&quot;PETSc&#39;s PreconditionJacobi has no support for a damping parameter.&quot;</span>));</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">          smoother.<a class="code" href="classMGSmootherPrecondition.html#a3cb789b815bf6719eee79e2137c9bd84">initialize</a>(mg_matrix, settings.smoother_dampen);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">          smoother.<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(settings.smoother_steps);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;VectorType&gt;</a> mg_m(mg_matrix);</div>
<div class="line">          <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;VectorType&gt;</a> mg_in(mg_interface_in);</div>
<div class="line">          <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;VectorType&gt;</a> mg_out(mg_interface_in);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classMultigrid.html">Multigrid&lt;VectorType&gt;</a> <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">            mg_m, coarse_grid_solver, mg_transfer, smoother, smoother);</div>
<div class="line">          <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_out, mg_in);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, VectorType, MGTransferPrebuilt&lt;VectorType&gt;</a>&gt;</div>
<div class="line">            preconditioner(dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="line"> </div>
<div class="line">          computing_timer.leave_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer,</div>
<div class="line">                                      <span class="stringliteral">&quot;Solve: 1 multigrid V-cycle&quot;</span>);</div>
<div class="line">            preconditioner.vmult(solution, right_hand_side);</div>
<div class="line">          }</div>
<div class="line">          solution = 0.;</div>
<div class="line"> </div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classSolverCG.html">SolverCG&lt;VectorType&gt;</a> solver(solver_control);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Solve: CG&quot;</span>);</div>
<div class="line">            solver.solve(system_matrix,</div>
<div class="line">                         solution,</div>
<div class="line">                         right_hand_side,</div>
<div class="line">                         preconditioner);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">          constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">case</span> Settings::amg:</div>
<div class="line">        {</div>
<div class="line">          computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceLinearAlgebraPETSc_1_1MPI.html#a41f11f7a1992c6d6aa9367b12c68f791">PreconditionAMG</a>                 preconditioner;</div>
<div class="line">          PreconditionAMG::AdditionalData Amg_data;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_PETSC_LA</span></div>
<div class="line">          Amg_data.symmetric_operator = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">          Amg_data.elliptic              = <span class="keyword">true</span>;</div>
<div class="line">          Amg_data.smoother_type         = <span class="stringliteral">&quot;Jacobi&quot;</span>;</div>
<div class="line">          Amg_data.higher_order_elements = <span class="keyword">true</span>;</div>
<div class="line">          Amg_data.smoother_sweeps       = settings.smoother_steps;</div>
<div class="line">          Amg_data.aggregation_threshold = 0.02;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">          Amg_data.output_details = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">          preconditioner.<a class="code" href="classPETScWrappers_1_1PreconditionBoomerAMG.html#a3c82672eac786d7f369b296439859ff2">initialize</a>(system_matrix, Amg_data);</div>
<div class="line">          computing_timer.leave_subsection(<span class="stringliteral">&quot;Solve: Preconditioner setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer,</div>
<div class="line">                                      <span class="stringliteral">&quot;Solve: 1 multigrid V-cycle&quot;</span>);</div>
<div class="line">            preconditioner.vmult(solution, right_hand_side);</div>
<div class="line">          }</div>
<div class="line">          solution = 0.;</div>
<div class="line"> </div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classSolverCG.html">SolverCG&lt;VectorType&gt;</a> solver(solver_control);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Solve: CG&quot;</span>);</div>
<div class="line">            solver.solve(system_matrix,</div>
<div class="line">                         solution,</div>
<div class="line">                         right_hand_side,</div>
<div class="line">                         preconditioner);</div>
<div class="line">          }</div>
<div class="line">          constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;   Number of CG iterations:      &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">        &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>ScratchData</div>
<div class="line">{</div>
<div class="line">  ScratchData(<span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;      mapping,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe,</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        quadrature_degree,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         update_flags,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         interface_update_flags)</div>
<div class="line">    : fe_values(mapping, fe, <a class="code" href="classQGauss.html">QGauss</a>&lt;dim&gt;(quadrature_degree), update_flags)</div>
<div class="line">    , fe_interface_values(mapping,</div>
<div class="line">                          fe,</div>
<div class="line">                          <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt;(quadrature_degree),</div>
<div class="line">                          interface_update_flags)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  ScratchData(<span class="keyword">const</span> ScratchData&lt;dim&gt; &amp;scratch_data)</div>
<div class="line">    : fe_values(scratch_data.fe_values.get_mapping(),</div>
<div class="line">                scratch_data.fe_values.get_fe(),</div>
<div class="line">                scratch_data.fe_values.get_quadrature(),</div>
<div class="line">                scratch_data.fe_values.get_update_flags())</div>
<div class="line">    , fe_interface_values(scratch_data.fe_values.get_mapping(),</div>
<div class="line">                          scratch_data.fe_values.get_fe(),</div>
<div class="line">                          scratch_data.fe_interface_values.get_quadrature(),</div>
<div class="line">                          scratch_data.fe_interface_values.get_update_flags())</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>          fe_values;</div>
<div class="line">  <a class="code" href="classFEInterfaceValues.html">FEInterfaceValues&lt;dim&gt;</a> fe_interface_values;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>CopyData</div>
<div class="line">{</div>
<div class="line">  CopyData()</div>
<div class="line">    : <a class="code" href="grid__tools_8cc.html#aff11e57deb99b39b7d7d26cf866798f2">cell_index</a>(<a class="code" href="namespacenumbers.html">numbers</a>::<a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">invalid_unsigned_int</a>)</div>
<div class="line">    , <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(0.)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  CopyData(<span class="keyword">const</span> CopyData &amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span>FaceData</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell_indices[2];</div>
<div class="line">    <span class="keywordtype">double</span>       <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>[2];</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>          <a class="code" href="grid__tools_8cc.html#aff11e57deb99b39b7d7d26cf866798f2">cell_index</a>;</div>
<div class="line">  <span class="keywordtype">double</span>                <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>;</div>
<div class="line">  std::vector&lt;FaceData&gt; face_data;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::estimate()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Estimate&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  VectorType temp_solution;</div>
<div class="line">  temp_solution.reinit(locally_owned_dofs,</div>
<div class="line">                       locally_relevant_dofs,</div>
<div class="line">                       mpi_communicator);</div>
<div class="line">  temp_solution = solution;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> Coefficient&lt;dim&gt; coefficient;</div>
<div class="line"> </div>
<div class="line">  estimated_error_square_per_cell.<a class="code" href="classTableBase.html#a302ef67031a523602fd39911b968d6ab">reinit</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> Iterator = <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> cell_worker = [&amp;](<span class="keyword">const</span> Iterator &amp;  cell,</div>
<div class="line">                         ScratchData&lt;dim&gt; &amp;scratch_data,</div>
<div class="line">                         CopyData &amp;        copy_data) {</div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> &amp;fe_values = scratch_data.fe_values;</div>
<div class="line">    fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line">    RightHandSide&lt;dim&gt; rhs;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       rhs_value = rhs.value(cell-&gt;center());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> nu = coefficient.value(cell-&gt;center());</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Tensor&lt;2, dim&gt;&gt; <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaccf663e018d31c264b769c80bd91db4d">hessians</a>(fe_values.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>);</div>
<div class="line">    fe_values.<a class="code" href="classFEValuesBase.html#ae8f183c9d6da0c7daf9d345e0bc91b0a">get_function_hessians</a>(temp_solution, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaccf663e018d31c264b769c80bd91db4d">hessians</a>);</div>
<div class="line"> </div>
<div class="line">    copy_data.cell_index = cell-&gt;active_cell_index();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> residual_norm_square = 0.;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; fe_values.<a class="code" href="classFEValuesBase.html#a807c3049bfe81743fc0f237dfc2fbdea">n_quadrature_points</a>; ++k)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> residual = (rhs_value + nu * <a class="code" href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">trace</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaccf663e018d31c264b769c80bd91db4d">hessians</a>[k]));</div>
<div class="line">        residual_norm_square += residual * residual * fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(k);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    copy_data.value =</div>
<div class="line">      cell-&gt;diameter() * cell-&gt;diameter() * residual_norm_square;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> face_worker = [&amp;](<span class="keyword">const</span> Iterator &amp;    cell,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;f,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;sf,</div>
<div class="line">                         <span class="keyword">const</span> Iterator &amp;    ncell,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;nf,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;nsf,</div>
<div class="line">                         ScratchData&lt;dim&gt; &amp;  scratch_data,</div>
<div class="line">                         CopyData &amp;          copy_data) {</div>
<div class="line">    <a class="code" href="classFEInterfaceValues.html">FEInterfaceValues&lt;dim&gt;</a> &amp;fe_interface_values =</div>
<div class="line">      scratch_data.fe_interface_values;</div>
<div class="line">    fe_interface_values.<a class="code" href="classFEInterfaceValues.html#af6aa20b6652c2605d4cee36021f6bcd2">reinit</a>(cell, f, sf, ncell, nf, nsf);</div>
<div class="line"> </div>
<div class="line">    copy_data.face_data.emplace_back();</div>
<div class="line">    CopyData::FaceData &amp;copy_data_face = copy_data.face_data.back();</div>
<div class="line"> </div>
<div class="line">    copy_data_face.cell_indices[0] = cell-&gt;active_cell_index();</div>
<div class="line">    copy_data_face.cell_indices[1] = ncell-&gt;active_cell_index();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> coeff1 = coefficient.value(cell-&gt;center());</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> coeff2 = coefficient.value(ncell-&gt;center());</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Tensor&lt;1, dim&gt;&gt; grad_u[2];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2; ++i)</div>
<div class="line">      {</div>
<div class="line">        grad_u[i].resize(fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a41f6734be1313f750fa8b3b7ba470f35">n_quadrature_points</a>);</div>
<div class="line">        fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a6ac7ddd5ac77cc4a1925ec5f0b100bf2">get_fe_face_values</a>(i).get_function_gradients(</div>
<div class="line">          temp_solution, grad_u[i]);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> jump_norm_square = 0.;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpoint = 0;</div>
<div class="line">         qpoint &lt; fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a41f6734be1313f750fa8b3b7ba470f35">n_quadrature_points</a>;</div>
<div class="line">         ++qpoint)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> jump =</div>
<div class="line">          coeff1 * grad_u[0][qpoint] * fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a1a52fcfa2f54f153cc7cdda3788e5ac0">normal</a>(qpoint) -</div>
<div class="line">          coeff2 * grad_u[1][qpoint] * fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a1a52fcfa2f54f153cc7cdda3788e5ac0">normal</a>(qpoint);</div>
<div class="line"> </div>
<div class="line">        jump_norm_square += jump * jump * fe_interface_values.<a class="code" href="classFEInterfaceValues.html#a9f8f06f7da061e1c2a20c5cc68a89db1">JxW</a>(qpoint);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> h           = cell-&gt;face(f)-&gt;measure();</div>
<div class="line">    copy_data_face.values[0] = 0.5 * h * jump_norm_square;</div>
<div class="line">    copy_data_face.values[1] = copy_data_face.values[0];</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> copier = [&amp;](<span class="keyword">const</span> CopyData &amp;copy_data) {</div>
<div class="line">    <span class="keywordflow">if</span> (copy_data.cell_index != <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>)</div>
<div class="line">      estimated_error_square_per_cell[copy_data.cell_index] += copy_data.value;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;cdf : copy_data.face_data)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 2; ++j)</div>
<div class="line">        estimated_error_square_per_cell[cdf.cell_indices[j]] += cdf.values[j];</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_gauss_points = degree + 1;</div>
<div class="line">  ScratchData&lt;dim&gt;   scratch_data(mapping,</div>
<div class="line">                                fe,</div>
<div class="line">                                n_gauss_points,</div>
<div class="line">                                <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                                  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>,</div>
<div class="line">                                <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                                  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a>);</div>
<div class="line">  CopyData           copy_data;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.begin_active(),</div>
<div class="line">                        dof_handler.end(),</div>
<div class="line">                        cell_worker,</div>
<div class="line">                        copier,</div>
<div class="line">                        scratch_data,</div>
<div class="line">                        copy_data,</div>
<div class="line">                        <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa">MeshWorker::assemble_own_cells</a> |</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa9396964e7e270fe0a0c5d01474721c24">MeshWorker::assemble_ghost_faces_both</a> |</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa47c6806a06155c94191629fae2755763">MeshWorker::assemble_own_interior_faces_once</a>,</div>
<div class="line">                        <span class="comment">/*boundary_worker=*/</span><span class="keyword">nullptr</span>,</div>
<div class="line">                        face_worker);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> global_error_estimate =</div>
<div class="line">    <a class="code" href="numbers_8h.html#ac4a2ed1890a931d0b6a55933310eadca">std::sqrt</a>(<a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(estimated_error_square_per_cell.l1_norm(),</div>
<div class="line">                                  mpi_communicator));</div>
<div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;   Global error estimate:        &quot;</span> &lt;&lt; global_error_estimate</div>
<div class="line">        &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::refine_grid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Refine grid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> refinement_fraction = 1. / (<a class="code" href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a>(2.0, dim) - 1.);</div>
<div class="line">  <a class="code" href="namespaceparallel_1_1distributed_1_1GridRefinement.html#aa2ffb707a796ae6dedb75036606ef2e6">parallel::distributed::GridRefinement::refine_and_coarsen_fixed_number</a>(</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>, estimated_error_square_per_cell, refinement_fraction, 0.0);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.execute_coarsening_and_refinement();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> LaplaceProblem&lt;dim, degree&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> timing(computing_timer, <span class="stringliteral">&quot;Output results&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  VectorType temp_solution;</div>
<div class="line">  temp_solution.reinit(locally_owned_dofs,</div>
<div class="line">                       locally_relevant_dofs,</div>
<div class="line">                       mpi_communicator);</div>
<div class="line">  temp_solution = solution;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(temp_solution, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> subdomain(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; subdomain.size(); ++i)</div>
<div class="line">    subdomain(i) = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.locally_owned_subdomain();</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(subdomain, <span class="stringliteral">&quot;subdomain&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>(cell-&gt;active_cell_index()) = cell-&gt;level();</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, <span class="stringliteral">&quot;level&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (estimated_error_square_per_cell.size() &gt; 0)</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(estimated_error_square_per_cell,</div>
<div class="line">                             <span class="stringliteral">&quot;estimated_error_square_per_cell&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string pvtu_filename = data_out.<a class="code" href="group__Exceptions.html#ga0864e51eb173c87e2a3edc9391ea8009">write_vtu_with_pvtu_record</a>(</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;solution&quot;</span>, cycle, mpi_communicator, 2 <span class="comment">/*n_digits*/</span>, 1 <span class="comment">/*n_groups*/</span>);</div>
<div class="line"> </div>
<div class="line">  pcout &lt;&lt; <span class="stringliteral">&quot;   Wrote &quot;</span> &lt;&lt; pvtu_filename &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">LaplaceProblem&lt;dim, degree&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle = 0; cycle &lt; settings.n_steps; ++cycle)</div>
<div class="line">    {</div>
<div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;Cycle &quot;</span> &lt;&lt; cycle &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">if</span> (cycle &gt; 0)</div>
<div class="line">        refine_grid();</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;   Number of active cells:       &quot;</span></div>
<div class="line">            &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_active_cells();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (settings.solver == Settings::gmg_mf ||</div>
<div class="line">          settings.solver == Settings::gmg_mb)</div>
<div class="line">        pcout &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels() &lt;&lt; <span class="stringliteral">&quot; global levels)&quot;</span></div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Partition efficiency:         &quot;</span></div>
<div class="line">              &lt;&lt; 1.0 / <a class="code" href="namespaceMGTools.html#a8776ac550d9ac85e7e0db51625935673">MGTools::workload_imbalance</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">      pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      setup_system();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (settings.solver == Settings::gmg_mf ||</div>
<div class="line">          settings.solver == Settings::gmg_mb)</div>
<div class="line">        setup_multigrid();</div>
<div class="line"> </div>
<div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;   Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.n_dofs();</div>
<div class="line">      <span class="keywordflow">if</span> (settings.solver == Settings::gmg_mf ||</div>
<div class="line">          settings.solver == Settings::gmg_mb)</div>
<div class="line">        {</div>
<div class="line">          pcout &lt;&lt; <span class="stringliteral">&quot; (by level: &quot;</span>;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div>
<div class="line">               ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">            pcout &lt;&lt; dof_handler.n_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">                  &lt;&lt; (<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> == <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels() - 1 ? <span class="stringliteral">&quot;)&quot;</span> :</div>
<div class="line">                                                                     <span class="stringliteral">&quot;, &quot;</span>);</div>
<div class="line">        }</div>
<div class="line">      pcout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (settings.solver == Settings::gmg_mf)</div>
<div class="line">        assemble_rhs();</div>
<div class="line">      <span class="keywordflow">else</span> <span class="comment">/*gmg_mb or amg*/</span></div>
<div class="line">        {</div>
<div class="line">          assemble_system();</div>
<div class="line">          <span class="keywordflow">if</span> (settings.solver == Settings::gmg_mb)</div>
<div class="line">            assemble_multigrid();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      solve();</div>
<div class="line">      estimate();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (settings.output)</div>
<div class="line">        output_results(cycle);</div>
<div class="line"> </div>
<div class="line">      computing_timer.print_summary();</div>
<div class="line">      computing_timer.reset();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line">  <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(argc, argv, 1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> settings;</div>
<div class="line">  <span class="keywordflow">if</span> (!settings.try_parse((argc &gt; 1) ? (argv[1]) : <span class="stringliteral">&quot;&quot;</span>))</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fe_degree = 2;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">switch</span> (settings.dimension)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">case</span> 2:</div>
<div class="line">            {</div>
<div class="line">              LaplaceProblem&lt;2, fe_degree&gt; test(settings);</div>
<div class="line">              test.run();</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> 3:</div>
<div class="line">            {</div>
<div class="line">              LaplaceProblem&lt;3, fe_degree&gt; test(settings);</div>
<div class="line">              test.run();</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">default</span>:</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;This program only works in 2d and 3d.&quot;</span>));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      MPI_Abort(MPI_COMM_WORLD, 1);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      MPI_Abort(MPI_COMM_WORLD, 2);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
