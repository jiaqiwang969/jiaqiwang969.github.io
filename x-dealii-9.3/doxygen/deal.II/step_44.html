<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_44.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-44 tutorial program 。</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.3.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.3.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-44 tutorial program 。 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>本教程取决于 <a class="el" href="step_18.html">step-18</a> 。</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Listofreferences">List of references</a><a href="#Listofreferences">List of references</a>
        <li><a href="#Notation"> Notation </a><a href="#Notation"> Notation </a>
        <li><a href="#Kinematics">Kinematics</a><a href="#Kinematics">Kinematics</a>
        <li><a href="#Kinetics">Kinetics</a><a href="#Kinetics">Kinetics</a>
        <li><a href="#Pushforwardandpullbackoperators"> Push-forward and pull-back operators </a><a href="#Pushforwardandpullbackoperators"> Push-forward and pull-back operators </a>
        <li><a href="#Hyperelasticmaterials">Hyperelastic materials</a><a href="#Hyperelasticmaterials">Hyperelastic materials</a>
      <ul>
        <li><a href="#NeoHookeanmaterials"> Neo-Hookean materials </a><a href="#NeoHookeanmaterials"> Neo-Hookean materials </a>
      </ul>
        <li><a href="#Elasticitytensors">Elasticity tensors</a><a href="#Elasticitytensors">Elasticity tensors</a>
        <li><a href="#Principleofstationarypotentialenergyandthethreefieldformulation">Principle of stationary potential energy and the three-field formulation</a><a href="#Principleofstationarypotentialenergyandthethreefieldformulation">Principle of stationary potential energy and the three-field formulation</a>
        <li><a href="#Discretizationofgoverningequations"> Discretization of governing equations </a><a href="#Discretizationofgoverningequations"> Discretization of governing equations </a>
        <li><a href="#Thematerialclass"> The material class </a><a href="#Thematerialclass"> The material class </a>
        <li><a href="#Numericalexample"> Numerical example </a> ]<a href="#Numericalexample"> Numerical example </a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Runtimeparameters">Run-time parameters</a><a href="#Runtimeparameters">Run-time parameters</a>
      <ul>
        <li><a href="#FiniteElementsystem">Finite Element system</a><a href="#FiniteElementsystem">Finite Element system</a>
        <li><a href="#Geometry">Geometry</a><a href="#Geometry">Geometry</a>
        <li><a href="#Materials">Materials</a><a href="#Materials">Materials</a>
        <li><a href="#Linearsolver">Linear solver</a><a href="#Linearsolver">Linear solver</a>
        <li><a href="#Nonlinearsolver">Nonlinear solver</a><a href="#Nonlinearsolver">Nonlinear solver</a>
        <li><a href="#Time">Time</a><a href="#Time">Time</a>
        <li><a href="#Allparameters">All parameters</a><a href="#Allparameters">All parameters</a>
      </ul>
        <li><a href="#Timeclass">Time class</a><a href="#Timeclass">Time class</a>
        <li><a href="#CompressibleneoHookeanmaterialwithinathreefieldformulation">Compressible neo-Hookean material within a three-field formulation</a><a href="#CompressibleneoHookeanmaterialwithinathreefieldformulation">Compressible neo-Hookean material within a three-field formulation</a>
        <li><a href="#Quadraturepointhistory">Quadrature point history</a><a href="#Quadraturepointhistory">Quadrature point history</a>
        <li><a href="#Quasistaticquasiincompressiblefinitestrainsolid">Quasi-static quasi-incompressible finite-strain solid</a> ]<a href="#Quasistaticquasiincompressiblefinitestrainsolid">Quasi-static quasi-incompressible finite-strain solid</a>
        <li><a href="#ImplementationofthecodeSolidcodeclass">Implementation of the <code>Solid</code> class</a><a href="#ImplementationofthecodeSolidcodeclass">Implementation of the <code>Solid</code> class</a>
      <ul>
        <li><a href="#Publicinterface">Public interface</a><a href="#Publicinterface">Public interface</a>
      </ul>
        <li><a href="#Privateinterface">Private interface</a><a href="#Privateinterface">Private interface</a>
      <ul>
        <li><a href="#Threadingbuildingblocksstructures">Threading-building-blocks structures</a><a href="#Threadingbuildingblocksstructures">Threading-building-blocks structures</a>
        <li><a href="#Solidmake_grid">Solid::make_grid</a><a href="#Solidmake_grid">Solid::make_grid</a>
        <li><a href="#Solidsystem_setup">Solid::system_setup</a><a href="#Solidsystem_setup">Solid::system_setup</a>
        <li><a href="#Soliddetermine_component_extractors">Solid::determine_component_extractors</a><a href="#Soliddetermine_component_extractors">Solid::determine_component_extractors</a>
        <li><a href="#Solidsetup_qph">Solid::setup_qph</a><a href="#Solidsetup_qph">Solid::setup_qph</a>
        <li><a href="#Solidupdate_qph_incremental">Solid::update_qph_incremental</a><a href="#Solidupdate_qph_incremental">Solid::update_qph_incremental</a>
        <li><a href="#Solidsolve_nonlinear_timestep">Solid::solve_nonlinear_timestep</a><a href="#Solidsolve_nonlinear_timestep">Solid::solve_nonlinear_timestep</a>
        <li><a href="#Solidprint_conv_headerandSolidprint_conv_footer">Solid::print_conv_header and Solid::print_conv_footer</a><a href="#Solidprint_conv_headerandSolidprint_conv_footer">Solid::print_conv_header and Solid::print_conv_footer</a>
        <li><a href="#Solidget_error_dilation">Solid::get_error_dilation</a> ]<a href="#Solidget_error_dilation">Solid::get_error_dilation</a>
        <li><a href="#Solidget_error_residual">Solid::get_error_residual</a><a href="#Solidget_error_residual">Solid::get_error_residual</a>
        <li><a href="#Solidget_error_update">Solid::get_error_update</a><a href="#Solidget_error_update">Solid::get_error_update</a>
        <li><a href="#Solidget_total_solution">Solid::get_total_solution</a><a href="#Solidget_total_solution">Solid::get_total_solution</a>
        <li><a href="#Solidassemble_system">Solid::assemble_system</a><a href="#Solidassemble_system">Solid::assemble_system</a>
        <li><a href="#Solidmake_constraints">Solid::make_constraints</a><a href="#Solidmake_constraints">Solid::make_constraints</a>
        <li><a href="#Solidassemble_sc">Solid::assemble_sc</a><a href="#Solidassemble_sc">Solid::assemble_sc</a>
        <li><a href="#Solidsolve_linear_system">Solid::solve_linear_system</a><a href="#Solidsolve_linear_system">Solid::solve_linear_system</a>
        <li><a href="#Solidoutput_results">Solid::output_results</a><a href="#Solidoutput_results">Solid::output_results</a>
      </ul>
        <li><a href="#Mainfunction">Main function</a><a href="#Mainfunction">Main function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
</p>
<p><br  />
 <br  />
</p>
<p><em>This program was contributed by Jean-Paul Pelteret and Andrew McBride. <br  />
 This material is based upon work supported by the German Science Foundation (Deutsche Forschungsgemeinschaft, DFG), grant STE 544/39-1, and the National Research Foundation of South Africa. </em></p>
<dl class="section note"><dt>Note</dt><dd>If you use this program as a basis for your own work, please consider citing it in your list of references. The initial version of this work was contributed to the deal.II project by the authors listed in the following citation: <a href="https://doi.org/10.5281/zenodo.439772"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.439772.svg" alt="10.5281/zenodo.439772"/></a>  <br  />
</dd></dl>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a> </p><h1>Introduction</h1>
<p>本教程的主题是非线性固体力学。经典的单场方法（见例如 <a class="el" href="step_18.html">step-18</a> ）不能正确描述准不可压缩材料的响应。响应过于僵硬；这种现象被称为锁定。锁定问题可以通过各种替代策略来规避。其中一个策略是三场公式。在这里，它被用来模拟各向同性连续体的三维、完全非线性（几何和材料）响应。材料响应被近似为超弹性。此外，所采用的三场公式对准不可压缩和可压缩材料都有效。</p>
<p>本报告的目的是为使用deal.II处理非线性固体力学问题提供一个基础。线性问题在 <a class="el" href="step_8.html">step-8</a> 中已经解决。在 <a class="el" href="step_18.html">step-18</a> 中部分考虑了几何非线性问题的非标准、超弹性类型的形式：使用线性化构成关系的速率形式，问题域随着运动的进行而变化。围绕非线性运动学的重要概念在理论和实施中都没有。 然而， <a class="el" href="step_18.html">step-18</a> 确实描述了许多关键概念，以便在deal.II的框架内实现弹性。</p>
<p>我们从非线性运动学的速成课程开始。为了简单起见，我们将注意力限制在准静态问题上。此后，我们介绍了各种关键的应力测量，并描述了构成模型。然后，在解释用于管理材料的类的结构之前，我们详细描述了三场公式。然后介绍实例问题的设置。</p>
<dl class="section note"><dt>Note</dt><dd>本教程是针对三维空间的弹性问题而开发的（并在介绍中进行了描述）。 虽然空间维度可以在main()例程中改变，但需要注意的是。 一般来说，二维弹性问题只是作为三维问题的理想化而存在。 也就是说，它们要么是平面应变，要么是平面应力。 这些选择中的任何一个的假设都需要被一致地施加。 更多信息见 <a class="el" href="step_8.html">step-8</a> 中的说明。</dd></dl>
<p><a class="anchor" id="Listofreferences"></a></p><h3>List of references</h3>
<p>这里实现的三场公式是由Simo等人（1985）开创的，被称为混合雅各布-压力公式。重要的相关贡献包括Simo和Taylor（1991）以及Miehe（1994）的贡献。这里采用的符号在很大程度上借鉴了Holzapfel（2001）对非线性固体力学理论方面的出色概述。Hughes (2000)对与不可压缩弹性（小应变时）有关的问题作了很好的概述。</p>
<ol>
<li>
J.C. Simo, R.L. Taylor and K.S. Pister (1985), Variational and projection methods for the volume constraint in finite deformation elasto-plasticity, <em> Computer Methods in Applied Mechanics and Engineering </em> , <b> 51 </b>, 1-3, 177-208。 DOI: <a href="http://doi.org/10.1016/0045-7825(85)90033-7">10.1016/0045-7825(85)90033-7</a>; </li>
<li>
J.C. Simo and R.L. Taylor (1991), Quasi-incompressible finite elasticity in principal stretches. 连续体基础和数值算法, <em> 应用力学和工程的计算机方法 </em> , <b> 85 </b>, 3, 273-310. DOI: <a href="http://doi.org/10.1016/0045-7825(91)90100-K">10.1016/0045-7825(91)90100-K</a>; </li>
<li>
C. Miehe (1994), Aspects of the formulation and finite element implementation of large strain isotropic elasticity <em> International Journal for Numerical Methods in Engineering </em> <b> 37 /strong&gt;, 12, 1981-2004. DOI: <a href="http://doi.org/10.1002/nme.1620371202">10.1002/nme.1620371202</a>; </b></li>
<li>
<b> G.A. Holzapfel (2001), Nonlinear Solid Mechanics. A Continuum Approach for Engineering, John Wiley &amp; Sons. ISBN: 0-471-82304-X; </b></li>
<li>
<b> T.J.R. Hughes (2000), The Finite Element Method: 线性静态和动态有限元分析》，多佛。 ISBN: 978-0486411811 </b></li>
</ol>
<p>。</p>
<p><b>一个在耦合问题中使用这种三场公式的例子记录在 </p><ol>
<li>
J-P. V. Pelteret, D. Davydov, A. McBride, D. K. Vu, and P. Steinmann (2016), Computational electro- and magneto-elasticity for quasi-incompressible media immersed in free space, <em> International Journal for Numerical Methods in Engineering </em> 。 DOI: <a href="http://doi.org/10.1002/nme.5254">10.1002/nme.5254</a> </li>
</ol>
<p>。</b></p>
<p><b><a class="anchor" id="Notation"></a></p><h3>Notation </h3>
<p></b></p>
<p><b></b></p>
<p><b>我们可以把四阶张量看作是将二阶张量（矩阵）映射到自己身上的线性算子，其方式与矩阵将向量映射到向量上一样。有各种四阶单位张量，在即将到来的演讲中会被要求。四阶单位张量 \(\mathcal{I}\) 和 \(\overline{\mathcal{I}}\) 是由 </p><p class="formulaDsp">
\[ \mathbf{A} = \mathcal{I}:\mathbf{A} \qquad \text{and} \qquad \mathbf{A}^T = \overline{\mathcal{I}}:\mathbf{A} \, . \]
</p>
<p>注 \(\mathcal{I} \neq \overline{\mathcal{I}}^T\) 定义。此外，我们通过 </p><p class="formulaDsp">
\[ \mathcal{S} \dealcoloneq \dfrac{1}{2}[\mathcal{I} + \overline{\mathcal{I}}] \qquad \text{and} \qquad \mathcal{W} \dealcoloneq \dfrac{1}{2}[\mathcal{I} - \overline{\mathcal{I}}] \, , \]
</p>
<p>定义对称和偏斜对称的四阶单位张量，这样 </p><p class="formulaDsp">
\[ \dfrac{1}{2}[\mathbf{A} + \mathbf{A}^T] = \mathcal{S}:\mathbf{A} \qquad \text{and} \qquad \dfrac{1}{2}[\mathbf{A} - \mathbf{A}^T] = \mathcal{W}:\mathbf{A} \, . \]
</p>
<p> <a class="el" href="symmetric__tensor_8h.html#ab3e890348aa219805e84f7d367e098c3">identity_tensor()</a>返回的四阶 <code><a class="el" href="classSymmetricTensor.html">SymmetricTensor</a></code> 是 \(\mathcal{S}\) 。</b></p>
<p><b><a class="anchor" id="Kinematics"></a></p><h3>Kinematics</h3>
<p></b></p>
<p><b></b></p>
<p><b>让时间域表示为 \(\mathbb{T} = [0,T_{\textrm{end}}]\) ，其中 \(t \in \mathbb{T}\) 和 \(T_{\textrm{end}}\) 是总的问题时间。考虑一个连续体在时间 \(t=0\) 占据参考配置 \(\Omega_0\) 。参考配置中的粒子由位置矢量 \(\mathbf{X}\) 识别。身体在后来的时间 \(t&gt;0\) 的配置被称为当前配置，表示为 \(\Omega\) ，粒子由矢量 \(\mathbf{x}\) 识别。参考配置和当前配置之间的非线性映射，表示为 \(\boldsymbol{\varphi}\) ，作用如下。 </p><p class="formulaDsp">
\[ \mathbf{x} = \boldsymbol{\varphi}(\mathbf{X},t) \, . \]
</p>
<p> 粒子的位移的材料描述由 </p><p class="formulaDsp">
\[ \mathbf{U}(\mathbf{X},t) = \mathbf{x}(\mathbf{X},t) - \mathbf{X} \, . \]
</p>
<p>定义。</b></p>
<p><b>变形梯度 \(\mathbf{F}\) 被定义为运动的材料梯度。 </p><p class="formulaDsp">
\[ \mathbf{F}(\mathbf{X},t) \dealcoloneq \dfrac{\partial \boldsymbol{\varphi}(\mathbf{X},t)}{\partial \mathbf{X}} = \textrm{Grad}\ \mathbf{x}(\mathbf{X},t) = \mathbf{I} + \textrm{Grad}\ \mathbf{U} \, . \]
</p>
<p> 变形梯度 \(J(\mathbf{X},t) \dealcoloneq \textrm{det}\ \mathbf{F}(\mathbf{X},t) &gt; 0\) 的行列式在参考配置和当前配置中映射出相应的体积元素，分别表示为 \(\textrm{d}V\) 和 \(\textrm{d}v\) 。</b></p>
<p><b>就空间和材料坐标而言，变形的两个重要措施是左和右Cauchy-Green张量，分别表示为 \(\mathbf{b} \dealcoloneq \mathbf{F}\mathbf{F}^T\) 和 \(\mathbf{C} \dealcoloneq \mathbf{F}^T\mathbf{F}\) 。它们都是对称的和正定的。</b></p>
<p><b>格林-拉格朗日应变张量由 </p><p class="formulaDsp">
\[ \mathbf{E} \dealcoloneq \frac{1}{2}[\mathbf{C} - \mathbf{I} ] = \underbrace{\frac{1}{2}[\textrm{Grad}^T \mathbf{U} + \textrm{Grad}\mathbf{U}]}_{\boldsymbol{\varepsilon}} + \frac{1}{2}[\textrm{Grad}^T\ \mathbf{U}][\textrm{Grad}\ \mathbf{U}] \, . \]
</p>
<p>定义，如果假设变形为无限小，那么右边的第二项可以忽略， \(\boldsymbol{\varepsilon}\) （线性化应变张量）是应变张量的唯一组成部分。从问题的设置来看，这个假设在 <a class="el" href="step_18.html">step-18</a> 中是不成立的，因此在该教程程序中使用线性化的 \(\boldsymbol{\varepsilon}\) 作为应变度量是值得怀疑的。</b></p>
<p><b>为了处理材料在受到体型和剪切型变形时表现出的不同响应，我们考虑将变形梯度 \(\mathbf{F}\) 和左Cauchy-Green张量 \(\mathbf{b}\) 分解为体积变化（volumetric）和体积保留（isochoric）部分。 </p><p class="formulaDsp">
\[ \mathbf{F} = (J^{1/3}\mathbf{I})\overline{\mathbf{F}} \qquad \text{and} \qquad \mathbf{b} = (J^{2/3}\mathbf{I})\overline{\mathbf{F}}\,\overline{\mathbf{F}}^T = (J^{2/3}\mathbf{I})\overline{\mathbf{b}} \, . \]
</p>
<p> 很明显， \(\textrm{det}\ \mathbf{F} = \textrm{det}\ (J^{1/3}\mathbf{I}) = J\) 。</b></p>
<p><b>空间速度场被表示为 \(\mathbf{v}(\mathbf{x},t)\) 。空间速度场相对于空间坐标的导数给出空间速度梯度 \(\mathbf{l}(\mathbf{x},t)\) ，即 </p><p class="formulaDsp">
\[ \mathbf{l}(\mathbf{x},t) \dealcoloneq \dfrac{\partial \mathbf{v}(\mathbf{x},t)}{\partial \mathbf{x}} = \textrm{grad}\ \mathbf{v}(\mathbf{x},t) \, , \]
</p>
<p> 其中 \(\textrm{grad} \{\bullet \} = \frac{\partial \{ \bullet \} }{ \partial \mathbf{x}} = \frac{\partial \{ \bullet \} }{ \partial \mathbf{X}}\frac{\partial \mathbf{X} }{ \partial \mathbf{x}} = \textrm{Grad} \{ \bullet \} \mathbf{F}^{-1}\) 。</b></p>
<p><b><a class="anchor" id="Kinetics"></a></p><h3>Kinetics</h3>
<p></b></p>
<p><b></b></p>
<p><b>考奇应力定理将作用在当前构型 \(\mathrm{d}a\) 的无穷小表面元素上的考奇牵引力 \(\mathbf{t}\) 等同于考奇应力张量 \(\boldsymbol{\sigma}\) （一个空间量）与表面的外向单位法线 \(\mathbf{n}\) 的乘积，为 </p><p class="formulaDsp">
\[ \mathbf{t}(\mathbf{x},t, \mathbf{n}) = \boldsymbol{\sigma}\mathbf{n} \, . \]
</p>
<p> 考奇应力是对称的。同样，作用于参考构型中无限小的表面元素 \(\mathrm{d}A\) 的第一Piola-Kirchhoff牵引力 \(\mathbf{T}\) 是第一Piola-Kirchhoff应力张量 \(\mathbf{P}\) ] (两点张量)与表面的外向单位法线 \(\mathbf{N}\) 的乘积为 </p><p class="formulaDsp">
\[ \mathbf{T}(\mathbf{X},t, \mathbf{N}) = \mathbf{P}\mathbf{N} \, . \]
</p>
<p> Cauchy牵引力 \(\mathbf{t}\) 与第一Piola-Kirchhoff牵引力 \(\mathbf{T}\) 的关系为 </p><p class="formulaDsp">
\[ \mathbf{t}\mathrm{d}a = \mathbf{T}\mathrm{d}A \, . \]
</p>
<p> 这可以用<a href="http://en.wikipedia.org/wiki/Finite_strain_theory">Nanson's formula</a>证明。</b></p>
<p><b>第一Piola-Kirchhoff应力张量与Cauchy应力的关系为 </p><p class="formulaDsp">
\[ \mathbf{P} = J \boldsymbol{\sigma}\mathbf{F}^{-T} \, . \]
</p>
<p> 进一步的重要应力测量是（空间）Kirchhoff应力 \(\boldsymbol{\tau} = J \boldsymbol{\sigma}\) 和（参考）第二Piola-Kirchhoff应力 \(\mathbf{S} = {\mathbf{F}}^{-1} \boldsymbol{\tau} {\mathbf{F}}^{-T}\) 。</b></p>
<p><b><a class="anchor" id="Pushforwardandpullbackoperators"></a> </p><h3>Push-forward and pull-back operators </h3>
<p></b></p>
<p><b></b></p>
<p><b>前推和后拉运算符允许人们在材料和空间设置之间转换各种措施。这里使用的应力测量是逆变的，而应变测量是协变的。</b></p>
<p><b>二阶协变张量 \((\bullet)^{\text{cov}}\) 的前推和后拉运算分别由以下方式给出。 </p><p class="formulaDsp">
\[ \chi_{*}(\bullet)^{\text{cov}} \dealcoloneq \mathbf{F}^{-T} (\bullet)^{\text{cov}} \mathbf{F}^{-1} \qquad \text{and} \qquad \chi^{-1}_{*}(\bullet)^{\text{cov}} \dealcoloneq \mathbf{F}^{T} (\bullet)^{\text{cov}} \mathbf{F} \, . \]
</p>
<p></b></p>
<p><b>二阶协变张量 \((\bullet)^{\text{con}}\) 的前推和后拉操作分别由以下方法给出。 </p><p class="formulaDsp">
\[ \chi_{*}(\bullet)^{\text{con}} \dealcoloneq \mathbf{F} (\bullet)^{\text{con}} \mathbf{F}^T \qquad \text{and} \qquad \chi^{-1}_{*}(\bullet)^{\text{con}} \dealcoloneq \mathbf{F}^{-1} (\bullet)^{\text{con}} \mathbf{F}^{-T} \, . \]
</p>
<p> 例如 \(\boldsymbol{\tau} = \chi_{*}(\mathbf{S})\) 。</b></p>
<p><b><a class="anchor" id="Hyperelasticmaterials"></a></p><h3>Hyperelastic materials</h3>
<p></b></p>
<p><b></b></p>
<p><b>超弹性材料的反应受亥姆霍兹自由能函数 \(\Psi = \Psi(\mathbf{F}) = \Psi(\mathbf{C}) = \Psi(\mathbf{b})\) 的支配，该函数作为应力的势能。例如，如果Helmholtz自由能取决于右Cauchy-Green张量 \(\mathbf{C}\) ，那么各向同性的超弹性响应就是 </p><p class="formulaDsp">
\[ \mathbf{S} = 2 \dfrac{\partial \Psi(\mathbf{C})}{\partial \mathbf{C}} \, . \]
</p>
<p> 如果Helmholtz自由能取决于左Cauchy-Green张量 \(\mathbf{b}\) ，那么各向同性的超弹性响应就是 </p><p class="formulaDsp">
\[ \boldsymbol{\tau} = 2 \dfrac{\partial \Psi(\mathbf{b})}{\partial \mathbf{b}} \mathbf{b} = 2 \mathbf{b} \dfrac{\partial \Psi(\mathbf{b})}{\partial \mathbf{b}} \, . \]
</p>
<p> 。</b></p>
<p><b>按照变形梯度的乘法分解，亥姆霍兹自由能可以分解为 </p><p class="formulaDsp">
\[ \Psi(\mathbf{b}) = \Psi_{\text{vol}}(J) + \Psi_{\text{iso}}(\overline{\mathbf{b}}) \, . \]
</p>
<p> 同样，基尔霍夫应力可以分解为体积部分和等熵部分 \(\boldsymbol{\tau} = \boldsymbol{\tau}_{\text{vol}} + \boldsymbol{\tau}_{\text{iso}}\) ，其中。</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} \boldsymbol{\tau}_{\text{vol}} &amp;= 2 \mathbf{b} \dfrac{\partial \Psi_{\textrm{vol}}(J)}{\partial \mathbf{b}} \\ &amp;= p J\mathbf{I} \, , \\ \boldsymbol{\tau}_{\text{iso}} &amp;= 2 \mathbf{b} \dfrac{\partial \Psi_{\textrm{iso}} (\overline{\mathbf{b}})}{\partial \mathbf{b}} \\ &amp;= \underbrace{( \mathcal{I} - \dfrac{1}{3} \mathbf{I} \otimes \mathbf{I})}_{\mathbb{P}} : \overline{\boldsymbol{\tau}} \, , \end{align*}
</p>
<p></b></p>
<p><b>其中 \(p \dealcoloneq \dfrac{\partial \Psi_{\text{vol}}(J)}{\partial J}\) 是压力响应。 \(\mathbb{P}\) 是投影张量，它提供了欧拉环境下的偏离算子。虚构的基尔霍夫应力张量 \(\overline{\boldsymbol{\tau}}\) 由 </p><p class="formulaDsp">
\[ \overline{\boldsymbol{\tau}} \dealcoloneq 2 \overline{\mathbf{b}} \dfrac{\partial \Psi_{\textrm{iso}}(\overline{\mathbf{b}})}{\partial \overline{\mathbf{b}}} \, . \]
</p>
<p>定义。</b></p>
<p><b> </p><dl class="section note"><dt>Note</dt><dd>以上定义的压力响应与固体力学中广泛使用的压力定义不同，为 \(p = - 1/3 \textrm{tr} \boldsymbol{\sigma} = - 1/3 J^{-1} \textrm{tr} \boldsymbol{\tau}\) 。这里 \(p\) 是静水压力。我们在本教程中使用压力响应（尽管我们把它称为压力）。</dd></dl>
<p><a class="anchor" id="NeoHookeanmaterials"></a></p><h4>Neo-Hookean materials </h4>
<p></b></p>
<p><b></b></p>
<p><b>与可压缩<a href="http://en.wikipedia.org/wiki/Neo-Hookean_solid">neo-Hookean material</a>相对应的亥姆霍兹自由能由 </p><p class="formulaDsp">
\[ \Psi \equiv \underbrace{\kappa [ \mathcal{G}(J) ] }_{\Psi_{\textrm{vol}}(J)} + \underbrace{\bigl[c_1 [ \overline{I}_1 - 3] \bigr]}_{\Psi_{\text{iso}}(\overline{\mathbf{b}})} \, , \]
</p>
<p>给出，其中 \(\kappa \dealcoloneq \lambda + 2/3 \mu\) 是体积模量（ \(\lambda\) 和 \(\mu\) 是Lam&eacute; 参数）和 \(\overline{I}_1 \dealcoloneq \textrm{tr}\ \overline{\mathbf{b}}\) 。函数 \(\mathcal{G}(J)\) 被要求是严格凸的，并满足 \(\mathcal{G}(1) = 0\) 等条件，进一步细节见Holzapfel（2001）。在这项工作中 \(\mathcal{G} \dealcoloneq \frac{1}{4} [ J^2 - 1 - 2\textrm{ln}J ]\) 。</b></p>
<p><b>不可压缩性对所有运动施加了等时性约束 \(J=1\) \(\boldsymbol{\varphi}\) 。与不可压缩的新胡克材料相对应的亥姆霍兹自由能由 </p><p class="formulaDsp">
\[ \Psi \equiv \underbrace{\bigl[ c_1 [ I_1 - 3] \bigr] }_{\Psi_{\textrm{iso}}(\mathbf{b})} \, , \]
</p>
<p> 得到，其中 \( I_1 \dealcoloneq \textrm{tr}\mathbf{b} \) 。因此，通过从可压缩自由能中去除体积分量并执行 \(J=1\) 得到不可压缩响应。</b></p>
<p><b><a class="anchor" id="Elasticitytensors"></a></p><h3>Elasticity tensors</h3>
<p></b></p>
<p><b></b></p>
<p><b>我们将使用Newton-Raphson策略来解决非线性边界值问题。因此，我们将需要线性化构成关系。</b></p>
<p><b>材料描述中的四阶弹性张量定义为 </p><p class="formulaDsp">
\[ \mathfrak{C} = 2\dfrac{\partial \mathbf{S}(\mathbf{C})}{\partial \mathbf{C}} = 4\dfrac{\partial^2 \Psi(\mathbf{C})}{\partial \mathbf{C} \partial \mathbf{C}} \, . \]
</p>
<p> 空间描述中的四阶弹性张量 \(\mathfrak{c}\) 由 \(\mathfrak{C}\) 的前推得到 </p><p class="formulaDsp">
\[ \mathfrak{c} = J^{-1} \chi_{*}(\mathfrak{C}) \qquad \text{and thus} \qquad J\mathfrak{c} = 4 \mathbf{b} \dfrac{\partial^2 \Psi(\mathbf{b})} {\partial \mathbf{b} \partial \mathbf{b}} \mathbf{b} \, . \]
</p>
<p> 四阶弹性张量（对于超弹性材料）拥有主要和次要对称性。</b></p>
<p><b>四阶空间弹性张量可以写成以下解耦形式。 </p><p class="formulaDsp">
\[ \mathfrak{c} = \mathfrak{c}_{\text{vol}} + \mathfrak{c}_{\text{iso}} \, , \]
</p>
<p> 其中</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} J \mathfrak{c}_{\text{vol}} &amp;= 4 \mathbf{b} \dfrac{\partial^2 \Psi_{\text{vol}}(J)} {\partial \mathbf{b} \partial \mathbf{b}} \mathbf{b} \\ &amp;= J[\widehat{p}\, \mathbf{I} \otimes \mathbf{I} - 2p \mathcal{I}] \qquad \text{where} \qquad \widehat{p} \dealcoloneq p + \dfrac{\textrm{d} p}{\textrm{d}J} \, , \\ J \mathfrak{c}_{\text{iso}} &amp;= 4 \mathbf{b} \dfrac{\partial^2 \Psi_{\text{iso}}(\overline{\mathbf{b}})} {\partial \mathbf{b} \partial \mathbf{b}} \mathbf{b} \\ &amp;= \mathbb{P} : \mathfrak{\overline{c}} : \mathbb{P} + \dfrac{2}{3}[\overline{\boldsymbol{\tau}}:\mathbf{I}]\mathbb{P} - \dfrac{2}{3}[ \mathbf{I}\otimes\boldsymbol{\tau}_{\text{iso}} + \boldsymbol{\tau}_{\text{iso}} \otimes \mathbf{I} ] \, , \end{align*}
</p>
<p></b></p>
<p><b>其中空间描述中的虚构弹性张量 \(\overline{\mathfrak{c}}\) 由 </p><p class="formulaDsp">
\[ \overline{\mathfrak{c}} = 4 \overline{\mathbf{b}} \dfrac{ \partial^2 \Psi_{\textrm{iso}}(\overline{\mathbf{b}})} {\partial \overline{\mathbf{b}} \partial \overline{\mathbf{b}}} \overline{\mathbf{b}} \, . \]
</p>
<p>定义。</b></p>
<p><b><a class="anchor" id="Principleofstationarypotentialenergyandthethreefieldformulation"></a></p><h3>Principle of stationary potential energy and the three-field formulation</h3>
<p></b></p>
<p><b></b></p>
<p><b>系统的总势能 \(\Pi\) 是内部和外部势能之和，分别表示为 \(\Pi_{\textrm{int}}\) 和 \(\Pi_{\textrm{ext}}\) 。我们希望通过最小化势能找到平衡配置。</b></p>
<p><b>如上所述，我们采用了三场公式。我们用 \(\mathbf{\Xi} \dealcoloneq \{ \mathbf{u}, \widetilde{p}, \widetilde{J} \}\) 表示主要未知数的集合。独立运动变量 \(\widetilde{J}\) 作为对 \(J\) 的约束进入公式，由拉格朗日乘数 \(\widetilde{p}\) （压力，我们将看到）执行。</b></p>
<p><b>这里使用的三场变分原理由 </p><p class="formulaDsp">
\[ \Pi(\mathbf{\Xi}) \dealcoloneq \int_\Omega \bigl[ \Psi_{\textrm{vol}}(\widetilde{J}) + \widetilde{p}\,[J(\mathbf{u}) - \widetilde{J}] + \Psi_{\textrm{iso}}(\overline{\mathbf{b}}(\mathbf{u})) \bigr] \textrm{d}v + \Pi_{\textrm{ext}} \, , \]
</p>
<p>给出，其中外部势由 </p><p class="formulaDsp">
\[ \Pi_{\textrm{ext}} = - \int_\Omega \mathbf{b}^\text{p} \cdot \mathbf{u}~\textrm{d}v - \int_{\partial \Omega_{\sigma}} \mathbf{t}^\text{p} \cdot \mathbf{u}~\textrm{d}a \, . \]
</p>
<p>定义。 当前配置 \(\partial \Omega\) 的边界由两部分组成： \(\partial \Omega = \partial \Omega_{\mathbf{u}} \cup \partial \Omega_{\sigma}\) ，其中 \(\partial \Omega_{\mathbf{u}} \cap \partial \Omega_{\boldsymbol{\sigma}} = \emptyset\) 。规定的Cauchy牵引力，表示为 \(\mathbf{t}^\text{p}\) ，被应用于 \( \partial \Omega_{\boldsymbol{\sigma}}\) ，而运动被规定在边界的其余部分 \(\partial \Omega_{\mathbf{u}}\) 。每单位电流体积的体力表示为 \(\mathbf{b}^\text{p}\) 。</b></p>
<p><b>势的静止性如下</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} R(\mathbf\Xi;\delta \mathbf{\Xi}) &amp;= D_{\delta \mathbf{\Xi}}\Pi(\mathbf{\Xi}) \\ &amp;= \dfrac{\partial \Pi(\mathbf{\Xi})}{\partial \mathbf{u}} \cdot \delta \mathbf{u} + \dfrac{\partial \Pi(\mathbf{\Xi})}{\partial \widetilde{p}} \delta \widetilde{p} + \dfrac{\partial \Pi(\mathbf{\Xi})}{\partial \widetilde{J}} \delta \tilde{J} \\ &amp;= \int_{\Omega_0} \left[ \textrm{grad}\ \delta\mathbf{u} : [ \underbrace{[\widetilde{p} J \mathbf{I}]}_{\equiv \boldsymbol{\tau}_{\textrm{vol}}} + \boldsymbol{\tau}_{\textrm{iso}}] + \delta \widetilde{p}\, [ J(\mathbf{u}) - \widetilde{J}] + \delta \widetilde{J}\left[ \dfrac{\textrm{d} \Psi_{\textrm{vol}}(\widetilde{J})}{\textrm{d} \widetilde{J}} -\widetilde{p}\right] \right]~\textrm{d}V \\ &amp;\quad - \int_{\Omega_0} \delta \mathbf{u} \cdot \mathbf{B}^\text{p}~\textrm{d}V - \int_{\partial \Omega_{0,\boldsymbol{\sigma}}} \delta \mathbf{u} \cdot \mathbf{T}^\text{p}~\textrm{d}A \\ &amp;=0 \, , \end{align*}
</p>
<p></b></p>
<p><b>对于所有虚拟位移 \(\delta \mathbf{u} \in H^1(\Omega)\) ，受 \(\delta \mathbf{u} = \mathbf{0}\) 对 \(\partial \Omega_{\mathbf{u}}\) 的约束，以及所有虚拟压力 \(\delta \widetilde{p} \in L^2(\Omega)\) 和虚拟膨胀 \(\delta \widetilde{J} \in L^2(\Omega)\) 。</b></p>
<p><b>应该注意的是，三场公式中的体积基尔霍夫应力的定义 \(\boldsymbol{\tau}_{\textrm{vol}} \equiv \widetilde{p} J \mathbf{I}\) 和随后的体积正切与超弹性材料一节中给出的一般形式略有不同，其中 \(\boldsymbol{\tau}_{\textrm{vol}} \equiv p J\mathbf{I}\) 。这是因为压力 \(\widetilde{p}\) 现在是一个主要的场，而不是一个构成性的派生量。我们需要仔细区分主要场和从构成关系中得到的场。</b></p>
<p><b> </p><dl class="section note"><dt>Note</dt><dd>尽管变量都是以空间量来表示的，但积分的领域是初始配置。这种方法被称为 <em> 总拉格朗日公式 </em> 。在 <a class="el" href="step_18.html">step-18</a> 中给出的方法，积分域是当前配置，可称为 <em> 更新的拉格朗日公式 </em> 。这两种方法的各种优点在文献中被广泛讨论。然而，应该指出的是，它们是等价的。</dd></dl>
<p>对应于残差的欧拉-拉格朗日方程是。</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} &amp;\textrm{div}\ \boldsymbol{\sigma} + \mathbf{b}^\text{p} = \mathbf{0} &amp;&amp; \textrm{[equilibrium]} \\ &amp;J(\mathbf{u}) = \widetilde{J} &amp;&amp; \textrm{[dilatation]} \\ &amp;\widetilde{p} = \dfrac{\textrm{d} \Psi_{\textrm{vol}}(\widetilde{J})}{\textrm{d} \widetilde{J}} &amp;&amp; \textrm{[pressure]} \, . \end{align*}
</p>
<p></b></p>
<p><b>第一个方程是空间环境中的（准静态）平衡方程。第二个是约束条件： \(J(\mathbf{u}) = \widetilde{J}\) 。第三是压力的定义 \(\widetilde{p}\) 。</b></p>
<p><b> </p><dl class="section note"><dt>Note</dt><dd>下面简化的单场推导（ \(\mathbf{u}\) 是唯一的主变量）使我们清楚地知道如何将积分的极限转化为参考域。</dd></dl>
<p class="formulaDsp">
\begin{align*} \int_{\Omega}\delta \mathbf{u} \cdot [\textrm{div}\ \boldsymbol{\sigma} + \mathbf{b}^\text{p}]~\mathrm{d}v &amp;= \int_{\Omega} [-\mathrm{grad}\delta \mathbf{u}:\boldsymbol{\sigma} + \delta \mathbf{u} \cdot\mathbf{b}^\text{p}]~\mathrm{d}v + \int_{\partial \Omega} \delta \mathbf{u} \cdot \mathbf{t}^\text{p}~\mathrm{d}a \\ &amp;= - \int_{\Omega_0} \mathrm{grad}\delta \mathbf{u}:\boldsymbol{\tau}~\mathrm{d}V + \int_{\Omega_0} \delta \mathbf{u} \cdot J\mathbf{b}^\text{p}~\mathrm{d}V + \int_{\partial \Omega_0} \delta \mathbf{u} \cdot \mathbf{T}^\text{p}~\mathrm{d}A \\ &amp;= - \int_{\Omega_0} \mathrm{grad}\delta \mathbf{u}:\boldsymbol{\tau}~\mathrm{d}V + \int_{\Omega_0} \delta \mathbf{u} \cdot \mathbf{B}^\text{p}~\mathrm{d}V + \int_{\partial \Omega_{0,\sigma}} \delta \mathbf{u} \cdot \mathbf{T}^\text{p}~\mathrm{d}A \\ &amp;= - \int_{\Omega_0} [\mathrm{grad}\delta\mathbf{u}]^{\text{sym}} :\boldsymbol{\tau}~\mathrm{d}V + \int_{\Omega_0} \delta \mathbf{u} \cdot \mathbf{B}^\text{p}~\mathrm{d}V + \int_{\partial \Omega_{0,\sigma}} \delta \mathbf{u} \cdot \mathbf{T}^\text{p}~\mathrm{d}A \, , \end{align*}
</p>
<p></b></p>
<p><b>其中 \([\mathrm{grad}\delta\mathbf{u}]^{\text{sym}} = 1/2[ \mathrm{grad}\delta\mathbf{u} + [\mathrm{grad}\delta\mathbf{u}]^T] \) 。</b></p>
<p><b>我们将使用迭代牛顿-拉弗森方法来解决非线性残差方程 \(R\) 。为了简单起见，我们假设死荷载，即荷载不因变形而改变。</b></p>
<p><b>在 \(t_{\textrm{n}-1}\) 的已知状态和 \(t_{\textrm{n}}\) 的当前未知状态之间的一个量的变化被表示为 \(\varDelta \{ \bullet \} = { \{ \bullet \} }^{\textrm{n}} - { \{ \bullet \} }^{\textrm{n-1}}\) 。在当前迭代 \(\textrm{i}\) 的一个数量的值表示为 \({ \{ \bullet \} }^{\textrm{n}}_{\textrm{i}} = { \{ \bullet \} }_{\textrm{i}}\) 。迭代 \(\textrm{i}\) 和 \(\textrm{i}+1\) 之间的增量变化表示为 \(d \{ \bullet \} \dealcoloneq \{ \bullet \}_{\textrm{i}+1} - \{ \bullet \}_{\textrm{i}}\) 。</b></p>
<p><b>假设系统的状态在某个迭代中是已知的 \(\textrm{i}\) 。使用牛顿-拉弗森方法解决非线性治理方程的线性化近似为：找到 \(d \mathbf{\Xi}\) ，使 </p><p class="formulaDsp">
\[ R(\mathbf{\Xi}_{\mathsf{i}+1}) = R(\mathbf{\Xi}_{\mathsf{i}}) + D^2_{d \mathbf{\Xi}, \delta \mathbf{\Xi}} \Pi(\mathbf{\Xi_{\mathsf{i}}}) \cdot d \mathbf{\Xi} \equiv 0 \, , \]
</p>
<p>，然后设置 \(\mathbf{\Xi}_{\textrm{i}+1} = \mathbf{\Xi}_{\textrm{i}} + d \mathbf{\Xi}\) 。正切线由</b></p>
<p><b> </p><p class="formulaDsp">
\[ D^2_{d \mathbf{\Xi}, \delta \mathbf{\Xi}} \Pi( \mathbf{\Xi}_{\mathsf{i}} ) = D_{d \mathbf{\Xi}} R( \mathbf{\Xi}_{\mathsf{i}}; \delta \mathbf{\Xi}) =: K(\mathbf{\Xi}_{\mathsf{i}}; d \mathbf{\Xi}, \delta \mathbf{\Xi}) \, . \]
</p>
<p> 因此。</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} K(\mathbf{\Xi}_{\mathsf{i}}; d \mathbf{\Xi}, \delta \mathbf{\Xi}) &amp;= D_{d \mathbf{u}} R( \mathbf{\Xi}_{\mathsf{i}}; \delta \mathbf{\Xi}) \cdot d \mathbf{u} \\ &amp;\quad + D_{d \widetilde{p}} R( \mathbf{\Xi}_{\mathsf{i}}; \delta \mathbf{\Xi}) d \widetilde{p} \\ &amp;\quad + D_{d \widetilde{J}} R( \mathbf{\Xi}_{\mathsf{i}}; \delta \mathbf{\Xi}) d \widetilde{J} \, , \end{align*}
</p>
<p></b></p>
<p><b>其中</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} D_{d \mathbf{u}} R( \mathbf{\Xi}; \delta \mathbf{\Xi}) &amp;= \int_{\Omega_0} \bigl[ \textrm{grad}\ \delta \mathbf{u} : \textrm{grad}\ d \mathbf{u} [\boldsymbol{\tau}_{\textrm{iso}} + \boldsymbol{\tau}_{\textrm{vol}}] + \textrm{grad}\ \delta \mathbf{u} :[ \underbrace{[\widetilde{p}J[\mathbf{I}\otimes\mathbf{I} - 2 \mathcal{I}]}_{\equiv J\mathfrak{c}_{\textrm{vol}}} + J\mathfrak{c}_{\textrm{iso}}] :\textrm{grad} d \mathbf{u} \bigr]~\textrm{d}V \, , \\ &amp;\quad + \int_{\Omega_0} \delta \widetilde{p} J \mathbf{I} : \textrm{grad}\ d \mathbf{u} ~\textrm{d}V \\ D_{d \widetilde{p}} R( \mathbf{\Xi}; \delta \mathbf{\Xi}) &amp;= \int_{\Omega_0} \textrm{grad}\ \delta \mathbf{u} : J \mathbf{I} d \widetilde{p} ~\textrm{d}V - \int_{\Omega_0} \delta \widetilde{J} d \widetilde{p} ~\textrm{d}V \, , \\ D_{d \widetilde{J}} R( \mathbf{\Xi}; \delta \mathbf{\Xi}) &amp;= -\int_{\Omega_0} \delta \widetilde{p} d \widetilde{J}~\textrm{d}V + \int_{\Omega_0} \delta \widetilde{J} \dfrac{\textrm{d}^2 \Psi_{\textrm{vol}}(\widetilde{J})}{\textrm{d} \widetilde{J}\textrm{d}\widetilde{J}} d \widetilde{J} ~\textrm{d}V \, . \end{align*}
</p>
<p></b></p>
<p><b>注意，以下条款被称为切线矩阵的几何应力和材料贡献。</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} &amp; \int_{\Omega_0} \textrm{grad}\ \delta \mathbf{u} : \textrm{grad}\ d \mathbf{u} [\boldsymbol{\tau}_{\textrm{iso}} + \boldsymbol{\tau}_{\textrm{vol}}]~\textrm{d}V &amp;&amp; \quad {[\textrm{Geometrical stress}]} \, , \\ &amp; \int_{\Omega_0} \textrm{grad} \delta \mathbf{u} : [J\mathfrak{c}_{\textrm{vol}} + J\mathfrak{c}_{\textrm{iso}}] :\textrm{grad}\ d \mathbf{u} ~\textrm{d}V &amp;&amp; \quad {[\textrm{Material}]} \, . \end{align*}
</p>
<p></b></p>
<p><b><a class="anchor" id="Discretizationofgoverningequations"></a></p><h3>Discretization of governing equations </h3>
<p></b></p>
<p><b></b></p>
<p><b>这里使用的三场公式对准不可压缩材料是有效的，即在 \(\nu \rightarrow 0.5\) （其中 \(\nu\) 是<a href="http://en.wikipedia.org/wiki/Poisson&#39;s_ratio">Poisson's ratio</a>）的情况下，对 \(\mathbf{u},~\widetilde{p}\) 和 \(\widetilde{J}\) 的插值场进行良好选择。通常情况下，选择 \(Q_n \times DGPM_{n-1} \times DGPM_{n-1}\) 。这里 \(DGPM\) 是FE_DGPMonomial类。一个流行的选择是 \(Q_1 \times DGPM_0 \times DGPM_0\) ，它被称为平均扩张法（见Hughes（2000）的直观讨论）。这个代码可以容纳一个 \(Q_n \times DGPM_{n-1} \times DGPM_{n-1}\) 的表述。不连续的近似允许 \(\widetilde{p}\) 和 \(\widetilde{J}\) 被浓缩出来，并恢复了基于位移的经典方法。</b></p>
<p><b>对于完全不可压缩的材料 \(\nu = 0.5\) 和三场公式仍将表现出锁定行为。这可以通过在自由能中引入一个额外的约束条件来克服 \(\int_{\Omega_0} \Lambda [ \widetilde{J} - 1]~\textrm{d}V\) 。这里 \(\Lambda\) 是一个拉格朗日乘数，用于强制执行等时约束条件。进一步的细节见Miehe (1994)。</b></p>
<p><b>线性化问题可以写成 </p><p class="formulaDsp">
\[ \mathbf{\mathsf{K}}( \mathbf{\Xi}_{\textrm{i}}) d\mathbf{\Xi} = \mathbf{ \mathsf{F}}(\mathbf{\Xi}_{\textrm{i}}) \]
</p>
<p>，其中</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} \underbrace{\begin{bmatrix} \mathbf{\mathsf{K}}_{uu} &amp; \mathbf{\mathsf{K}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathbf{\mathsf{K}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}} \\ \mathbf{0} &amp; \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}} &amp; \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}} \end{bmatrix}}_{\mathbf{\mathsf{K}}(\mathbf{\Xi}_{\textrm{i}})} \underbrace{\begin{bmatrix} d \mathbf{\mathsf{u}}\\ d \widetilde{\mathbf{\mathsf{p}}} \\ d \widetilde{\mathbf{\mathsf{J}}} \end{bmatrix}}_{d \mathbf{\Xi}} = \underbrace{\begin{bmatrix} -\mathbf{\mathsf{R}}_{u}(\mathbf{u}_{\textrm{i}}) \\ -\mathbf{\mathsf{R}}_{\widetilde{p}}(\widetilde{p}_{\textrm{i}}) \\ -\mathbf{\mathsf{R}}_{\widetilde{J}}(\widetilde{J}_{\textrm{i}}) \end{bmatrix}}_{ -\mathbf{\mathsf{R}}(\mathbf{\Xi}_{\textrm{i}}) } = \underbrace{\begin{bmatrix} \mathbf{\mathsf{F}}_{u}(\mathbf{u}_{\textrm{i}}) \\ \mathbf{\mathsf{F}}_{\widetilde{p}}(\widetilde{p}_{\textrm{i}}) \\ \mathbf{\mathsf{F}}_{\widetilde{J}}(\widetilde{J}_{\textrm{i}}) \end{bmatrix}}_{ \mathbf{\mathsf{F}}(\mathbf{\Xi}_{\textrm{i}}) } \, . \end{align*}
</p>
<p></b></p>
<p><b>该公式中没有压力和膨胀（主要）变量的导数存在。因此，压力和膨胀的不连续有限元插值产生了 \(\mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}\) 、 \(\mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}\) 和 \(\mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}}\) 的块对角矩阵。因此，我们可以很容易地表达每个单元上的场 \(\widetilde{p}\) 和 \(\widetilde{J}\) ，只需倒置一个局部矩阵并乘以局部右手。然后我们可以将结果插入其余的方程中，并恢复一个经典的基于位移的方法。为了在元素水平上凝结出压力和膨胀的贡献，我们需要以下结果。</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} d \widetilde{\mathbf{\mathsf{p}}} &amp; = \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \bigl[ \mathbf{\mathsf{F}}_{\widetilde{J}} - \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathbf{\mathsf{J}}} \bigr] \\ d \widetilde{\mathbf{\mathsf{J}}} &amp; = \mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \bigl[ \mathbf{\mathsf{F}}_{\widetilde{p}} - \mathbf{\mathsf{K}}_{\widetilde{p}u} d \mathbf{\mathsf{u}} \bigr] \\ \Rightarrow d \widetilde{\mathbf{\mathsf{p}}} &amp;= \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathbf{\mathsf{F}}_{\widetilde{J}} - \underbrace{\bigl[\mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}} \mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}^{-1}\bigr]}_{\overline{\mathbf{\mathsf{K}}}}\bigl[ \mathbf{\mathsf{F}}_{\widetilde{p}} - \mathbf{\mathsf{K}}_{\widetilde{p}u} d \mathbf{\mathsf{u}} \bigr] \end{align*}
</p>
<p></b></p>
<p><b>因此 </p><p class="formulaDsp">
\[ \underbrace{\bigl[ \mathbf{\mathsf{K}}_{uu} + \overline{\overline{\mathbf{\mathsf{K}}}}~ \bigr] }_{\mathbf{\mathsf{K}}_{\textrm{con}}} d \mathbf{\mathsf{u}} = \underbrace{ \Bigl[ \mathbf{\mathsf{F}}_{u} - \mathbf{\mathsf{K}}_{u\widetilde{p}} \bigl[ \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathbf{\mathsf{F}}_{\widetilde{J}} - \overline{\mathbf{\mathsf{K}}}\mathbf{\mathsf{F}}_{\widetilde{p}} \bigr] \Bigr]}_{\mathbf{\mathsf{F}}_{\textrm{con}}} \]
</p>
<p>，其中 </p><p class="formulaDsp">
\[ \overline{\overline{\mathbf{\mathsf{K}}}} \dealcoloneq \mathbf{\mathsf{K}}_{u\widetilde{p}} \overline{\mathbf{\mathsf{K}}} \mathbf{\mathsf{K}}_{\widetilde{p}u} \, . \]
</p>
<p>注意，由于 \(\widetilde{p}\) 和 \(\widetilde{J}\) 被选择为元素级的不连续，所有需要反转的矩阵都在元素级定义。</b></p>
<p><b>构建各种贡献的程序如下。</b></p>
<p><b></p><ul>
<li>构建 \(\mathbf{\mathsf{K}}\) 。</li>
<li>形成 \(\mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}^{-1}\) 的元素，并存储在 \(\mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}\) 被存储的地方 \(\mathbf{\mathsf{K}}\) 。</li>
<li>形成 \(\overline{\overline{\mathbf{\mathsf{K}}}}\) 并与 \(\mathbf{\mathsf{K}}_{uu}\) 相加，得到 \(\mathbf{\mathsf{K}}_{\textrm{con}}\) 。</li>
<li>修改后的系统矩阵被称为 \({\mathbf{\mathsf{K}}}_{\textrm{store}}\) 。 也就是 <p class="formulaDsp">
\[ \mathbf{\mathsf{K}}_{\textrm{store}} \dealcoloneq \begin{bmatrix} \mathbf{\mathsf{K}}_{\textrm{con}} &amp; \mathbf{\mathsf{K}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathbf{\mathsf{K}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \\ \mathbf{0} &amp; \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}} &amp; \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}} \end{bmatrix} \, . \]
</p>
</li>
</ul>
<p></b></p>
<p><b><a class="anchor" id="Thematerialclass"></a></p><h3>The material class </h3>
<p></b></p>
<p><b></b></p>
<p><b>一个好的面向对象的材料类的设计将有利于本教程扩展到广泛的材料类型。在本教程中，我们只有一个名为Material_Compressible_Neo_Hook_Three_Field的材料类。理想情况下，这个类会派生自超弹性材料（HyperelasticMaterial），而超弹性材料会派生自基类Material。这里使用的三场性质的表述也使问题复杂化。</b></p>
<p><b>三场公式的亥姆霍兹自由能函数是 \(\Psi = \Psi_\text{vol}(\widetilde{J}) + \Psi_\text{iso}(\overline{\mathbf{b}})\) 。Kirchhoff应力的等效部分 \({\boldsymbol{\tau}}_{\text{iso}}(\overline{\mathbf{b}})\) 与使用超弹性材料的单场公式得到的完全相同。然而，自由能的体积部分现在是一个主要变量的函数 \(\widetilde{J}\) 。因此，对于三场公式来说，基尔霍夫应力 \({\boldsymbol{\tau}}_{\text{vol}}\) 的体积部分的构成反应（和正切）并不像单场公式那样由超弹性构成法给出。我们可以将术语 \(\boldsymbol{\tau}_{\textrm{vol}} \equiv \widetilde{p} J \mathbf{I}\) 标记为体积Kirchhoff应力，但压力 \(\widetilde{p}\) 不是由自由能得出的；它是一个主场。</b></p>
<p><b>为了有一个灵活的方法，我们决定Material_Compressible_Neo_Hook_Three_Field仍然能够计算并返回体积Kirchhoff应力和切线。为了做到这一点，我们选择在与正交点相关的Material_Compressible_Neo_Hook_Three_Field类中存储插值的主域 \(\widetilde{p}\) 和 \(\widetilde{J}\) 。这个决定应该在以后的阶段，当教程扩展到考虑其他材料时，再重新审视。</b></p>
<p><b><a class="anchor" id="Numericalexample"></a></p><h3>Numerical example </h3>
<p></b></p>
<p><b></b></p>
<p><b>这里考虑的数值例子是一个在压缩下的几乎不可压缩的块。这个基准问题取自</b></p>
<p><b></p><ul>
<li><p class="startli">S. Reese, P. Wriggers, B.D. Reddy (2000), A new locking-free brick element technique for large deformation problems in elasticity, <em> Computers and Structures </em> , <b> 75 </b>, 291-304. DOI：<a href="http://doi.org/10.1016/S0045-7949(99)00137-6">10.1016/S0045-7949(99)00137-6</a> 。</p>
<p class="startli"><img src="https://www.dealii.org/images/steps/developer/step-44.setup.png" alt="" class="inline"/> <br  />
</p>
</li>
</ul>
<p></b></p>
<p><b>该材料是准不可压缩的新胡克，具有 <a href="http://en.wikipedia.org/wiki/Shear_modulus">shear modulus</a> \(\mu = 80.194e6\) 和 \(\nu = 0.4999\) 。对于这样一个材料特性的选择，传统的单场 \(Q_1\) 方法会被锁定。也就是说，响应会过于僵硬。初始和最终配置显示在上面的图片中。利用对称性，我们只求解四分之一的几何体（即一个尺寸为 \(0.001\) 的立方体）。域的上表面的内四分之一受到 \(p_0\) 的载荷。<a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p></b></p>
<p><b></b></p>
<p><b>我们首先包括所有必要的deal.II头文件和一些C++相关的文件。它们已经在以前的教程程序中详细讨论过了，所以你只需要参考过去的教程就可以了。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2point_8h.html">deal.II/base/point.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="symmetric__tensor_8h.html">deal.II/base/symmetric_tensor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tensor_8h.html">deal.II/base/tensor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="work__stream_8h.html">deal.II/base/work_stream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="ttc" id="abase_2point_8h_html"><div class="ttname"><a href="base_2point_8h.html">point.h</a></div></div>
<div class="ttc" id="adof__renumbering_8h_html"><div class="ttname"><a href="dof__renumbering_8h.html">dof_renumbering.h</a></div></div>
<div class="ttc" id="adof__tools_8h_html"><div class="ttname"><a href="dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="afunction_8h_html"><div class="ttname"><a href="function_8h.html">function.h</a></div></div>
<div class="ttc" id="aparameter__handler_8h_html"><div class="ttname"><a href="parameter__handler_8h.html">parameter_handler.h</a></div></div>
<div class="ttc" id="aquadrature__lib_8h_html"><div class="ttname"><a href="quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="asymmetric__tensor_8h_html"><div class="ttname"><a href="symmetric__tensor_8h.html">symmetric_tensor.h</a></div></div>
<div class="ttc" id="atensor_8h_html"><div class="ttname"><a href="tensor_8h.html">tensor.h</a></div></div>
<div class="ttc" id="atimer_8h_html"><div class="ttname"><a href="timer_8h.html">timer.h</a></div></div>
<div class="ttc" id="awork__stream_8h_html"><div class="ttname"><a href="work__stream_8h.html">work_stream.h</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>这个头文件为我们提供了在正交点存储数据的功能</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__point__data_8h.html">deal.II/base/quadrature_point_data.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__dgp__monomial_8h.html">deal.II/fe/fe_dgp_monomial.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__tools_8h.html">deal.II/fe/fe_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mapping__q__eulerian_8h.html">deal.II/fe/mapping_q_eulerian.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__sparse__matrix_8h.html">deal.II/lac/block_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition__selector_8h.html">deal.II/lac/precondition_selector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__selector_8h.html">deal.II/lac/solver_selector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__direct_8h.html">deal.II/lac/sparse_direct.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="ttc" id="aaffine__constraints_8h_html"><div class="ttname"><a href="affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="ablock__sparse__matrix_8h_html"><div class="ttname"><a href="block__sparse__matrix_8h.html">block_sparse_matrix.h</a></div></div>
<div class="ttc" id="ablock__vector_8h_html"><div class="ttname"><a href="block__vector_8h.html">block_vector.h</a></div></div>
<div class="ttc" id="adynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="afe__dgp__monomial_8h_html"><div class="ttname"><a href="fe__dgp__monomial_8h.html">fe_dgp_monomial.h</a></div></div>
<div class="ttc" id="afe__q_8h_html"><div class="ttname"><a href="fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="afe__system_8h_html"><div class="ttname"><a href="fe__system_8h.html">fe_system.h</a></div></div>
<div class="ttc" id="afe__tools_8h_html"><div class="ttname"><a href="fe__tools_8h.html">fe_tools.h</a></div></div>
<div class="ttc" id="afull__matrix_8h_html"><div class="ttname"><a href="full__matrix_8h.html">full_matrix.h</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="agrid__generator_8h_html"><div class="ttname"><a href="grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="agrid__in_8h_html"><div class="ttname"><a href="grid__in_8h.html">grid_in.h</a></div></div>
<div class="ttc" id="agrid__tools_8h_html"><div class="ttname"><a href="grid__tools_8h.html">grid_tools.h</a></div></div>
<div class="ttc" id="amapping__q__eulerian_8h_html"><div class="ttname"><a href="mapping__q__eulerian_8h.html">mapping_q_eulerian.h</a></div></div>
<div class="ttc" id="aprecondition__selector_8h_html"><div class="ttname"><a href="precondition__selector_8h.html">precondition_selector.h</a></div></div>
<div class="ttc" id="aquadrature__point__data_8h_html"><div class="ttname"><a href="quadrature__point__data_8h.html">quadrature_point_data.h</a></div></div>
<div class="ttc" id="asolver__cg_8h_html"><div class="ttname"><a href="solver__cg_8h.html">solver_cg.h</a></div></div>
<div class="ttc" id="asolver__selector_8h_html"><div class="ttname"><a href="solver__selector_8h.html">solver_selector.h</a></div></div>
<div class="ttc" id="asparse__direct_8h_html"><div class="ttname"><a href="sparse__direct_8h.html">sparse_direct.h</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>这里是使用LinearOperator类所需的头文件。这些也都被方便地打包到一个头文件中，即&lt;deal.II/lac/linear_operator_tools.h&gt;，但为了透明起见，我们在此列出那些特别需要的头文件。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="linear__operator_8h.html">deal.II/lac/linear_operator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="packaged__operation_8h.html">deal.II/lac/packaged_operation.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="ttc" id="alinear__operator_8h_html"><div class="ttname"><a href="linear__operator_8h.html">linear_operator.h</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="apackaged__operation_8h_html"><div class="ttname"><a href="packaged__operation_8h.html">packaged_operation.h</a></div></div>
<div class="ttc" id="avector__tools_8h_html"><div class="ttname"><a href="vector__tools_8h.html">vector_tools.h</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>这两个头文件中定义了一些与有限应变弹性有关的操作。第一个将帮助我们计算一些运动量，第二个提供一些标准的张量定义。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kinematics_8h.html">deal.II/physics/elasticity/kinematics.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="standard__tensors_8h.html">deal.II/physics/elasticity/standard_tensors.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="ttc" id="akinematics_8h_html"><div class="ttname"><a href="kinematics_8h.html">kinematics.h</a></div></div>
<div class="ttc" id="astandard__tensors_8h_html"><div class="ttname"><a href="standard__tensors_8h.html">standard_tensors.h</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后，我们将所有与本教程程序有关的东西都放入一个自己的命名空间，并将所有deal.II的函数和类名导入其中。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">namespace </span>Step44</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="namespace__dealii_8h_source.html#l00025">namespace_dealii.h:26</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Runtimeparameters"></a> </p><h3>Run-time parameters</h3>
<p></b></p>
<p><b> <br  />
</b></p>
<p><b>有几个参数可以在代码中设置，所以我们设置了一个ParameterHandler对象，在运行时读入选择。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">namespace </span>Parameters</div>
<div class="line">{</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="FiniteElementsystem"></a> </p><h4>Finite Element system</h4>
<p></b></p>
<p><b></b></p>
<p><b>正如在介绍中提到的，对于位移 \(\mathbf{u}\) 应该使用不同的插值顺序，而对于压力 \(\widetilde{p}\) 和膨胀 \(\widetilde{J}\) 则是如此。 选择 \(\widetilde{p}\) 和 \(\widetilde{J}\) 作为元素层面的不连续（常数）函数，导致平均扩张方法。不连续的近似允许 \(\widetilde{p}\) 和 \(\widetilde{J}\) 被浓缩出来，并恢复了一个基于位移的经典方法。这里我们指定用于近似解的多项式阶数。正交阶数应作相应调整。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="classFESystem.html">FESystem</a></div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly_degree;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> quad_order;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> FESystem::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Displacement system polynomial order&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;3&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Gauss quadrature order&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> FESystem::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    poly_degree = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>);</div>
<div class="line">    quad_order  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassFESystem_html"><div class="ttname"><a href="classFESystem.html">FESystem</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__system_8h_source.html#l00215">fe_system.h:216</a></div></div>
<div class="ttc" id="aclassParameterHandler_html"><div class="ttname"><a href="classParameterHandler.html">ParameterHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8h_source.html#l00840">parameter_handler.h:841</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a599462cacd492e2f712bf7369507dcff"><div class="ttname"><a href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">ParameterHandler::leave_subsection</a></div><div class="ttdeci">void leave_subsection()</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00953">parameter_handler.cc:953</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a61fa98fdc0c52980a5b1de0ee1fc5bb2"><div class="ttname"><a href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">ParameterHandler::get_integer</a></div><div class="ttdeci">long int get_integer(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01025">parameter_handler.cc:1025</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6d65f458be69e23a348221cb67fc411d"><div class="ttname"><a href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a></div><div class="ttdeci">void declare_entry(const std::string &amp;entry, const std::string &amp;default_value, const Patterns::PatternBase &amp;pattern=Patterns::Anything(), const std::string &amp;documentation=&quot;&quot;, const bool has_to_be_set=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00796">parameter_handler.cc:796</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_af29c20cde6d44186806d559beb468696"><div class="ttname"><a href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">ParameterHandler::enter_subsection</a></div><div class="ttdeci">void enter_subsection(const std::string &amp;subsection)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00939">parameter_handler.cc:939</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Integer_html"><div class="ttname"><a href="classPatterns_1_1Integer.html">Patterns::Integer</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00189">patterns.h:190</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Geometry"></a></p><h4>Geometry</h4>
<p></b></p>
<p><b></b></p>
<p><b>对问题的几何形状和施加的载荷进行调整。 由于这里所模拟的问题相当特殊，可以将载荷比例改变为特定值，以便与文献中给出的结果进行比较。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">struct </span>Geometry</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> global_refinement;</div>
<div class="line">  <span class="keywordtype">double</span>       <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>;</div>
<div class="line">  <span class="keywordtype">double</span>       p_p0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Geometry::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Global refinement level&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-3&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Global grid scaling factor&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Pressure ratio p/p0&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;100&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;20|40|60|80|100&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Ratio of applied pressure to reference pressure&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Geometry::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    global_refinement = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>);</div>
<div class="line">    <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>);</div>
<div class="line">    p_p0              = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Pressure ratio p/p0&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassParameterHandler_html_aeaf3c7846747695b1f327677e3716ec5"><div class="ttname"><a href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">ParameterHandler::get_double</a></div><div class="ttdeci">double get_double(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01068">parameter_handler.cc:1068</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Double_html"><div class="ttname"><a href="classPatterns_1_1Double.html">Patterns::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00292">patterns.h:293</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Selection_html"><div class="ttname"><a href="classPatterns_1_1Selection.html">Patterns::Selection</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00382">patterns.h:383</a></div></div>
<div class="ttc" id="anamespaceGridTools_html_a0967563badadd81f77f62622dd8bc2cd"><div class="ttname"><a href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a></div><div class="ttdeci">void scale(const double scaling_factor, Triangulation&lt; dim, spacedim &gt; &amp;triangulation)</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l02043">grid_tools.cc:2043</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Materials"></a> </p><h4>Materials</h4>
<p></b></p>
<p><b></b></p>
<p><b>我们还需要新胡克材料的剪切模量 \( \mu \) 和泊松率 \( \nu \) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">struct </span>Materials</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">double</span> nu;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespacemu.html">mu</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Materials::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.4999&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(-1.0, 0.5),</div>
<div class="line">                      <span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Shear modulus&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;80.194e6&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Shear modulus&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Materials::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    nu = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div>
<div class="line">    <a class="code" href="namespacemu.html">mu</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Shear modulus&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="anamespacemu_html"><div class="ttname"><a href="namespacemu.html">mu</a></div><div class="ttdef"><b>Definition:</b> <a href="function__parser_8h_source.html#l00032">function_parser.h:33</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Linearsolver"></a> </p><h4>Linear solver</h4>
<p></b></p>
<p><b></b></p>
<p><b>接下来，我们同时选择求解器和预处理器的设置。 当牛顿增量内发生大的非线性运动时，使用有效的预处理程序对于确保收敛性至关重要。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">struct </span>LinearSolver</div>
<div class="line">{</div>
<div class="line">  std::string type_lin;</div>
<div class="line">  <span class="keywordtype">double</span>      tol_lin;</div>
<div class="line">  <span class="keywordtype">double</span>      max_iterations_lin;</div>
<div class="line">  <span class="keywordtype">bool</span>        use_static_condensation;</div>
<div class="line">  std::string preconditioner_type;</div>
<div class="line">  <span class="keywordtype">double</span>      preconditioner_relaxation;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> LinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Solver type&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;CG&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;CG|Direct&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Type of solver used to solve the linear system&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Residual&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-6&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Linear solver residual (scaled by residual norm)&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;Max iteration multiplier&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">      <span class="stringliteral">&quot;Linear solver iterations (multiples of the system matrix size)&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Use static condensation&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Solve the full block system or a reduced problem&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Preconditioner type&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;ssor&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;jacobi|ssor&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Type of preconditioner&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Preconditioner relaxation&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.65&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Preconditioner relaxation value&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> LinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    type_lin                  = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Solver type&quot;</span>);</div>
<div class="line">    tol_lin                   = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line">    max_iterations_lin        = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Max iteration multiplier&quot;</span>);</div>
<div class="line">    use_static_condensation   = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Use static condensation&quot;</span>);</div>
<div class="line">    preconditioner_type       = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Preconditioner type&quot;</span>);</div>
<div class="line">    preconditioner_relaxation = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Preconditioner relaxation&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassParameterHandler_html_a6bb45dc67787e3fab7882461929b5fbe"><div class="ttname"><a href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">ParameterHandler::get_bool</a></div><div class="ttdeci">bool get_bool(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01113">parameter_handler.cc:1113</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a91cfbaca954f444047302446a4e87125"><div class="ttname"><a href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">ParameterHandler::get</a></div><div class="ttdeci">std::string get(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00987">parameter_handler.cc:987</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Bool_html"><div class="ttname"><a href="classPatterns_1_1Bool.html">Patterns::Bool</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00981">patterns.h:982</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Nonlinearsolver"></a></p><h4>Nonlinear solver</h4>
<p></b></p>
<p><b></b></p>
<p><b>牛顿-拉弗森方案被用来解决非线性治理方程组。 我们现在定义牛顿-拉普森非线性求解器的公差和最大迭代次数。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">struct </span>NonlinearSolver</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iterations_NR;</div>
<div class="line">  <span class="keywordtype">double</span>       tol_f;</div>
<div class="line">  <span class="keywordtype">double</span>       tol_u;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> NonlinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;10&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Number of Newton-Raphson iterations allowed&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1.0e-9&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Force residual tolerance&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1.0e-6&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Displacement error tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> NonlinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    max_iterations_NR = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>);</div>
<div class="line">    tol_f             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>);</div>
<div class="line">    tol_u             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Time"></a> </p><h4>Time</h4>
<p></b></p>
<p><b></b></p>
<p><b>设置时间步长 \( \varDelta t \) 和仿真结束时间。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">struct </span>Time</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">double</span> delta_t;</div>
<div class="line">  <span class="keywordtype">double</span> end_time;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Time::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;End time&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(), <span class="stringliteral">&quot;End time&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Time step size&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Time step size&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Time::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    end_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;End time&quot;</span>);</div>
<div class="line">    delta_t  = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Time step size&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Allparameters"></a> </p><h4>All parameters</h4>
<p></b></p>
<p><b></b></p>
<p><b>最后，我们把上述所有的结构合并到一个容器中，这个容器中存放着我们所有的运行时选择。</b></p>
<p><b></p><div class="fragment"><div class="line">  <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> <a class="code" href="classFESystem.html">FESystem</a>,</div>
<div class="line">                         <span class="keyword">public</span> Geometry,</div>
<div class="line">                         <span class="keyword">public</span> Materials,</div>
<div class="line">                         <span class="keyword">public</span> LinearSolver,</div>
<div class="line">                         <span class="keyword">public</span> NonlinearSolver,</div>
<div class="line">                         <span class="keyword">public</span> Time</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    AllParameters(<span class="keyword">const</span> std::string &amp;input_file);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  AllParameters::AllParameters(<span class="keyword">const</span> std::string &amp;input_file)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">    declare_parameters(prm);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_file);</div>
<div class="line">    parse_parameters(prm);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> AllParameters::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    FESystem::declare_parameters(prm);</div>
<div class="line">    Geometry::declare_parameters(prm);</div>
<div class="line">    Materials::declare_parameters(prm);</div>
<div class="line">    LinearSolver::declare_parameters(prm);</div>
<div class="line">    NonlinearSolver::declare_parameters(prm);</div>
<div class="line">    Time::declare_parameters(prm);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> AllParameters::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    FESystem::parse_parameters(prm);</div>
<div class="line">    Geometry::parse_parameters(prm);</div>
<div class="line">    Materials::parse_parameters(prm);</div>
<div class="line">    LinearSolver::parse_parameters(prm);</div>
<div class="line">    NonlinearSolver::parse_parameters(prm);</div>
<div class="line">    Time::parse_parameters(prm);</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Parameters</span></div>
<div class="ttc" id="aclassParameterHandler_html_a0ddaa05c5463c6c0b7701e18005717a9"><div class="ttname"><a href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">ParameterHandler::parse_input</a></div><div class="ttdeci">virtual void parse_input(std::istream &amp;input, const std::string &amp;filename=&quot;input file&quot;, const std::string &amp;last_line=&quot;&quot;, const bool skip_undefined=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00399">parameter_handler.cc:399</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Timeclass"></a> </p><h3>Time class</h3>
<p></b></p>
<p><b></b></p>
<p><b>一个简单的类来存储时间数据。它的功能是透明的，所以没有必要讨论。为了简单起见，我们假设时间步长是恒定的。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">class </span>Time</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Time(<span class="keyword">const</span> <span class="keywordtype">double</span> time_end, <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t)</div>
<div class="line">    : timestep(0)</div>
<div class="line">    , time_current(0.0)</div>
<div class="line">    , time_end(time_end)</div>
<div class="line">    , delta_t(delta_t)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> ~Time() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> current()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> time_current;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> time_end;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">double</span> get_delta_t()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> delta_t;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> get_timestep()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> timestep;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> increment()</div>
<div class="line">  {</div>
<div class="line">    time_current += delta_t;</div>
<div class="line">    ++timestep;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep;</div>
<div class="line">  <span class="keywordtype">double</span>       time_current;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> time_end;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t;</div>
<div class="line">};</div>
<div class="ttc" id="anamespaceTrilinosWrappers_1_1internal_html_aee42c8e3004e2e81eac3c3356d3ec46b"><div class="ttname"><a href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">TrilinosWrappers::internal::end</a></div><div class="ttdeci">VectorType::value_type * end(VectorType &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8cc_source.html#l00067">trilinos_sparse_matrix.cc:67</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="CompressibleneoHookeanmaterialwithinathreefieldformulation"></a> </p><h3>Compressible neo-Hookean material within a three-field formulation</h3>
<p></b></p>
<p><b></b></p>
<p><b>正如介绍中所讨论的，新胡克材料是一种超弹性材料。 整个领域被假定为由可压缩的新胡克材料组成。 这类材料在三场公式中定义了这种材料的行为。 可压缩的新Hookean材料可以用应变能量函数（SEF）来描述 \( \Psi = \Psi_{\text{iso}}(\overline{\mathbf{b}}) + \Psi_{\text{vol}}(\widetilde{J}) \) 。</b></p>
<p><b>等效响应由 \( \Psi_{\text{iso}}(\overline{\mathbf{b}}) = c_{1} [\overline{I}_{1} - 3] \) 给出，其中 \( c_{1} = \frac{\mu}{2} \) 和 \(\overline{I}_{1}\) 是左或右等效Cauchy-Green变形张量的第一不变量。这就是 \(\overline{I}_1 \dealcoloneq \textrm{tr}(\overline{\mathbf{b}})\) 。在这个例子中，支配体积响应的SEF被定义为 \( \Psi_{\text{vol}}(\widetilde{J}) = \kappa \frac{1}{4} [ \widetilde{J}^2 - 1 - 2\textrm{ln}\; \widetilde{J} ]\) ，其中 \(\kappa \dealcoloneq \lambda + 2/3 \mu\) 是<a href="http://en.wikipedia.org/wiki/Bulk_modulus">bulk modulus</a>， \(\lambda\) 是<a href="http://en.wikipedia.org/wiki/Lam%C3%A9_parameters">Lam&eacute;'s first parameter</a>。 <br  />
</b></p>
<p><b>下面的类将被用来描述我们工作中的材料特征，并提供一个中心点，如果要实现不同的材料模型，就需要对其进行修改。为了工作，我们将在每个正交点存储一个这种类型的对象，并在每个对象中存储当前状态（由三个场的值或度量来表征），以便我们能够计算围绕当前状态的线性化弹性系数。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>Material_Compressible_Neo_Hook_Three_Field</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Material_Compressible_Neo_Hook_Three_Field(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacemu.html">mu</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> nu)</div>
<div class="line">    : kappa((2.0 * <a class="code" href="namespacemu.html">mu</a> * (1.0 + nu)) / (3.0 * (1.0 - 2.0 * nu)))</div>
<div class="line">    , c_1(<a class="code" href="namespacemu.html">mu</a> / 2.0)</div>
<div class="line">    , det_F(1.0)</div>
<div class="line">    , p_tilde(0.0)</div>
<div class="line">    , J_tilde(1.0)</div>
<div class="line">    , b_bar(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(kappa &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  }</div>
<div class="ttc" id="agroup__Exceptions_html_ga31978c026b8b6b5116df30b8e748f6b7"><div class="ttname"><a href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">StandardExceptions::ExcInternalError</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcInternalError()</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01473">exceptions.h:1473</a></div></div>
<div class="ttc" id="anamespacePhysics_html"><div class="ttname"><a href="namespacePhysics.html">Physics</a></div><div class="ttdef"><b>Definition:</b> <a href="physics_8h_source.html#l00028">physics.h:29</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>我们用基于 \(F\) 和压力 \(\widetilde{p}\) 及膨胀 \(\widetilde{J}\) 的各种变形相关数据更新材料模型，并在函数的最后包括一个内部一致性的物理检查。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> update_material_data(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">double</span>          p_tilde_in,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">double</span>          J_tilde_in)</div>
<div class="line">{</div>
<div class="line">  det_F                      = <a class="code" href="classSymmetricTensor.html#a7c03a03a5fe823733e7af9f7e4267f81">determinant</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_bar = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae8c571720db885e3636e396f6e153317">Physics::Elasticity::Kinematics::F_iso</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">  b_bar                      = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">Physics::Elasticity::Kinematics::b</a>(F_bar);</div>
<div class="line">  p_tilde                    = p_tilde_in;</div>
<div class="line">  J_tilde                    = J_tilde_in;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(det_F &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">}</div>
<div class="ttc" id="aclassSymmetricTensor_html_a7c03a03a5fe823733e7af9f7e4267f81"><div class="ttname"><a href="classSymmetricTensor.html#a7c03a03a5fe823733e7af9f7e4267f81">SymmetricTensor::determinant</a></div><div class="ttdeci">constexpr Number determinant(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02622">symmetric_tensor.h:2622</a></div></div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 2, dim &gt;</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_aa87528a28ad8a95fa89a3876e6f986c8"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a></div><div class="ttdeci">Tensor&lt; 2, dim, Number &gt; F(const Tensor&lt; 2, dim, Number &gt; &amp;Grad_u)</div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_ae880749870e5b45fbb6a441fd96c1a07"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">Physics::Elasticity::Kinematics::b</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; b(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_ae8c571720db885e3636e396f6e153317"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae8c571720db885e3636e396f6e153317">Physics::Elasticity::Kinematics::F_iso</a></div><div class="ttdeci">Tensor&lt; 2, dim, Number &gt; F_iso(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
</div><!-- fragment --><p></b></p>
<p><b>第二个函数确定基尔霍夫应力 \(\boldsymbol{\tau} = \boldsymbol{\tau}_{\textrm{iso}} + \boldsymbol{\tau}_{\textrm{vol}}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> get_tau_iso() + get_tau_vol();</div>
<div class="line">}</div>
<div class="ttc" id="aclassSymmetricTensor_html"><div class="ttname"><a href="classSymmetricTensor.html">SymmetricTensor&lt; 2, dim &gt;</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>空间设置中的四阶弹性张量 \(\mathfrak{c}\) 由SEF \(\Psi\) 计算为 \( J \mathfrak{c}_{ijkl} = F_{iA} F_{jB} \mathfrak{C}_{ABCD} F_{kC} F_{lD}\) 其中 \( \mathfrak{C} = 4 \frac{\partial^2 \Psi(\mathbf{C})}{\partial \mathbf{C} \partial \mathbf{C}}\)</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> get_Jc_vol() + get_Jc_iso();</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>体积自由能相对于 \(\widetilde{J}\) 的导数，返回 \(\frac{\partial \Psi_{\text{vol}}(\widetilde{J})}{\partial \widetilde{J}}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">double</span> get_dPsi_vol_dJ()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> (kappa / 2.0) * (J_tilde - 1.0 / J_tilde);</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>体积自由能相对于 \(\widetilde{J}\) 的二次导数。我们需要在切线中明确地进行以下计算，所以我们将其公开。 我们计算出 \(\frac{\partial^2 \Psi_{\textrm{vol}}(\widetilde{J})}{\partial \widetilde{J} \partial \widetilde{J}}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">double</span> get_d2Psi_vol_dJ2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> ((kappa / 2.0) * (1.0 + 1.0 / (J_tilde * J_tilde)));</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>接下来的几个函数返回各种数据，我们选择与材料一起存储。</b></p>
<p><b></p><div class="fragment"><div class="line">  <span class="keywordtype">double</span> get_det_F()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> det_F;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> get_p_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> p_tilde;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> get_J_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> J_tilde;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
</div><!-- fragment --><p></b></p>
<p><b>定义构成模型参数 \(\kappa\) （体积模量）和新胡克模型参数 \(c_1\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> kappa;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> c_1;</div>
</div><!-- fragment --><p></b></p>
<p><b>方便与材料一起存储的模型具体数据。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">double</span>                  det_F;</div>
<div class="line"><span class="keywordtype">double</span>                  p_tilde;</div>
<div class="line"><span class="keywordtype">double</span>                  J_tilde;</div>
<div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> b_bar;</div>
</div><!-- fragment --><p></b></p>
<p><b>以下函数在内部用于确定上述一些公共函数的结果。第一个是确定体积基尔霍夫应力 \(\boldsymbol{\tau}_{\textrm{vol}}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_vol()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> p_tilde * det_F * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassPhysics_1_1Elasticity_1_1StandardTensors_html"><div class="ttname"><a href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors</a></div><div class="ttdef"><b>Definition:</b> <a href="standard__tensors_8h_source.html#l00046">standard_tensors.h:47</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>接下来，确定等效基尔霍夫应力 \(\boldsymbol{\tau}_{\textrm{iso}} = \mathcal{P}:\overline{\boldsymbol{\tau}}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_iso()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * get_tau_bar();</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>然后，确定虚构的基尔霍夫应力 \(\overline{\boldsymbol{\tau}}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_bar()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> 2.0 * c_1 * b_bar;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>计算切线的体积部分 \(J \mathfrak{c}_\textrm{vol}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_vol()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> p_tilde * det_F *</div>
<div class="line">         (<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::IxI</a> -</div>
<div class="line">          (2.0 * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::S</a>));</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>计算正切的等值部分 \(J \mathfrak{c}_\textrm{iso}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_iso()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_bar = get_tau_bar();</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_iso = get_tau_iso();</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> tau_iso_x_I =</div>
<div class="line">    <a class="code" href="classSymmetricTensor.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a>(tau_iso, <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> I_x_tau_iso =</div>
<div class="line">    <a class="code" href="classSymmetricTensor.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a>(<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>, tau_iso);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> c_bar = get_c_bar();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> (2.0 / dim) * <a class="code" href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">trace</a>(tau_bar) *</div>
<div class="line">           <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> -</div>
<div class="line">         (2.0 / dim) * (tau_iso_x_I + I_x_tau_iso) +</div>
<div class="line">         <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * c_bar *</div>
<div class="line">           <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassSymmetricTensor_html_a8c727eebb2d3d1870cbf4e77a3f45a6b"><div class="ttname"><a href="classSymmetricTensor.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">SymmetricTensor::outer_product</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 4, dim, Number &gt; outer_product(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t1, const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t2)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03466">symmetric_tensor.h:3466</a></div></div>
<div class="ttc" id="aclassSymmetricTensor_html_a9137b6052702150e8e5b1188d1971906"><div class="ttname"><a href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">SymmetricTensor::trace</a></div><div class="ttdeci">constexpr Number trace(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02680">symmetric_tensor.h:2680</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>计算虚构的弹性张量 \(\overline{\mathfrak{c}}\) 。对于所选择的材料模型，这只是零。</b></p>
<p><b></p><div class="fragment"><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_c_bar()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a>();</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Quadraturepointhistory"></a> </p><h3><a class="el" href="classQuadrature.html">Quadrature</a> point history</h3>
<p></b></p>
<p><b></b></p>
<p><b>正如在 <a class="el" href="step_18.html">step-18</a> 中看到的， <code> PointHistory </code> 类提供了一种在正交点存储数据的方法。 这里每个正交点都持有一个指向材料描述的指针。 因此，不同的材料模型可以用在域的不同区域。 在其他数据中，我们选择为正交点存储Kirchhoff应力 \(\boldsymbol{\tau}\) 和正切 \(J\mathfrak{c}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>PointHistory</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  PointHistory()</div>
<div class="line">    : F_inv(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div>
<div class="line">    , tau(<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt;())</div>
<div class="line">    , d2Psi_vol_dJ2(0.0)</div>
<div class="line">    , dPsi_vol_dJ(0.0)</div>
<div class="line">    , Jc(<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;4, dim&gt;())</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> ~PointHistory() = <span class="keywordflow">default</span>;</div>
</div><!-- fragment --><p></b></p>
<p><b>第一个函数用于创建材料对象并正确初始化所有张量。第二个函数根据当前的变形量 \(\textrm{Grad}\mathbf{u}_{\textrm{n}}\) 、压力 \(\widetilde{p}\) 和扩张 \(\widetilde{J}\) 场值更新存储的值和应力。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> setup_lqp(<span class="keyword">const</span> Parameters::AllParameters &amp;parameters)</div>
<div class="line">{</div>
<div class="line">  material =</div>
<div class="line">    std::make_shared&lt;Material_Compressible_Neo_Hook_Three_Field&lt;dim&gt;&gt;(</div>
<div class="line">      parameters.mu, parameters.nu);</div>
<div class="line">  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>(<a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a>(), 0.0, 1.0);</div>
<div class="line">}</div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00078">fe_update_flags.h:78</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>为此，我们从位移梯度 \(\textrm{Grad}\ \mathbf{u}\) 计算变形梯度 \(\mathbf{F}\) ，即 \(\mathbf{F}(\mathbf{u}) = \mathbf{I} + \textrm{Grad}\ \mathbf{u}\) ，然后让与该正交点相关的材料模型进行自我更新。当计算变形梯度时，我们必须注意和 \(\mathbf{I} + \textrm{Grad}\ \mathbf{u}\) 的数据类型：由于 \(I\) 的数据类型是SymmetricTensor，只要写出 <code>I + Grad_u_n</code> 就可以将第二个参数转换成对称张量，执行和，然后将结果投给Tensor（即，可能是非对称张量的类型）。然而，由于 <code>Grad_u_n</code> 在一般情况下是非对称的，转换为SymmetricTensor将失败。我们可以通过先将 \(I\) 转换为张量，然后在非对称张量之间执行加法，来避免这种来回折腾。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;Grad_u_n,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">double</span>          p_tilde,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">double</span>          J_tilde)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a> = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a>(Grad_u_n);</div>
<div class="line">  material-&gt;update_material_data(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>, p_tilde, J_tilde);</div>
</div><!-- fragment --><p></b></p>
<p><b>材料已经更新，所以我们现在计算基尔霍夫应力 \(\mathbf{\tau}\) 、正切 \(J\mathfrak{c}\) 和体积自由能的一、二次导数。 <br  />
</b></p>
<p><b>我们还存储了变形梯度的逆值，因为我们经常使用它。</b></p>
<p><b></p><div class="fragment"><div class="line">  F_inv         = <a class="code" href="classSymmetricTensor.html#a33cd1a6c91c24a5ca34dfbc43c338d1c">invert</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">  tau           = material-&gt;get_tau();</div>
<div class="line">  Jc            = material-&gt;get_Jc();</div>
<div class="line">  dPsi_vol_dJ   = material-&gt;get_dPsi_vol_dJ();</div>
<div class="line">  d2Psi_vol_dJ2 = material-&gt;get_d2Psi_vol_dJ2();</div>
<div class="line">}</div>
<div class="ttc" id="aclassSymmetricTensor_html_a33cd1a6c91c24a5ca34dfbc43c338d1c"><div class="ttname"><a href="classSymmetricTensor.html#a33cd1a6c91c24a5ca34dfbc43c338d1c">SymmetricTensor::invert</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 2, dim, Number &gt; invert(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03415">symmetric_tensor.h:3415</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>我们提供一个接口来检索某些数据。 这里是运动学变量。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">double</span> get_J_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> material-&gt;get_J_tilde();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_det_F()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> material-&gt;get_det_F();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;get_F_inv()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> F_inv;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>...和运动变量。 这些在材料和全局切线矩阵和残余装配操作中使用。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">double</span> get_p_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> material-&gt;get_p_tilde();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;get_tau()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> tau;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_dPsi_vol_dJ()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> dPsi_vol_dJ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_d2Psi_vol_dJ2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> d2Psi_vol_dJ2;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>最后是切线。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> &amp;get_Jc()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> Jc;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>在成员函数方面，该类为正交点存储了它所代表的材料类型的副本，以备在域的不同区域使用不同的材料，以及变形梯度的逆值...</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::shared_ptr&lt;Material_Compressible_Neo_Hook_Three_Field&lt;dim&gt;&gt; material;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv;</div>
</div><!-- fragment --><p></b></p>
<p><b>......和应力型变量与切线一起 \(J\mathfrak{c}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau;</div>
<div class="line">  <span class="keywordtype">double</span>                  d2Psi_vol_dJ2;</div>
<div class="line">  <span class="keywordtype">double</span>                  dPsi_vol_dJ;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc;</div>
<div class="line">};</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Quasistaticquasiincompressiblefinitestrainsolid"></a> </p><h3>Quasi-static quasi-incompressible finite-strain solid</h3>
<p></b></p>
<p><b></b></p>
<p><b>固体类是中心类，因为它代表了手头的问题。它遵循通常的方案，即它真正拥有的是一个构造函数、析构函数和一个 <code><a class="el" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run()</a></code> 函数，该函数将所有工作分派给该类的私有函数。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>Solid</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Solid(<span class="keyword">const</span> std::string &amp;input_file);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="ttc" id="anamespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00691">work_stream.h:691</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>在这个类的私有部分，我们首先向前声明了一些对象，这些对象用于使用WorkStream对象的并行工作（关于这方面的更多信息，见 <a class="el" href="group__threads.html">Parallel computing with multiple processors accessing shared memory</a> 模块）。 <br  />
</b></p>
<p><b>我们声明这样的结构，用于正切（刚度）矩阵和右手边矢量的计算，静态凝结，以及更新正交点。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">struct </span>PerTaskData_ASM;</div>
<div class="line"><span class="keyword">struct </span>ScratchData_ASM;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>PerTaskData_SC;</div>
<div class="line"><span class="keyword">struct </span>ScratchData_SC;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>PerTaskData_UQPH;</div>
<div class="line"><span class="keyword">struct </span>ScratchData_UQPH;</div>
</div><!-- fragment --><p></b></p>
<p><b>我们以一个建立网格的成员函数开始收集。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> make_grid();</div>
</div><!-- fragment --><p></b></p>
<p><b>设置要解决的有限元系统。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> system_setup();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> determine_component_extractors();</div>
</div><!-- fragment --><p></b></p>
<p><b>为增量位移场建立Dirichlet约束。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> it_nr);</div>
</div><!-- fragment --><p></b></p>
<p><b>使用多线程的几个函数来组装系统和右手边的矩阵。它们中的每一个都是包装函数，一个被执行以在WorkStream模型中对一个单元做工作，另一个将在这一个单元上做的工作复制到代表它的全局对象中。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> assemble_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> assemble_system_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">  PerTaskData_ASM &amp;                                     data) <span class="keyword">const</span>;</div>
<div class="ttc" id="agroup__Iterators_html_ga6b8bbcafed8847f3030ea30c6990eb2d"><div class="ttname"><a href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler::active_cell_iterator</a></div><div class="ttdeci">typename ActiveSelector::active_cell_iterator active_cell_iterator</div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00438">dof_handler.h:438</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>还有类似的，执行全局静态凝结。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> assemble_sc();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> assemble_sc_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_SC &amp;                                      scratch,</div>
<div class="line">  PerTaskData_SC &amp;                                      data);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> copy_local_to_global_sc(<span class="keyword">const</span> PerTaskData_SC &amp;data);</div>
</div><!-- fragment --><p></b></p>
<p><b>创建并更新正交点。这里，没有数据需要被复制到全局对象中，所以copy_local_to_global函数是空的。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> setup_qph();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> update_qph_incremental(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> update_qph_incremental_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_UQPH &amp;                                    scratch,</div>
<div class="line">  PerTaskData_UQPH &amp;                                    data);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> copy_local_to_global_UQPH(<span class="keyword">const</span> PerTaskData_UQPH &amp; <span class="comment">/*data*/</span>)</div>
<div class="line">{}</div>
<div class="ttc" id="aclassBlockVector_html"><div class="ttname"><a href="classBlockVector.html">BlockVector</a></div><div class="ttdef"><b>Definition:</b> <a href="block__vector_8h_source.html#l00070">block_vector.h:71</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>使用Newton-Raphson方法求解位移。我们把这个函数分成非线性循环和解决线性化的Newton-Raphson步骤的函数。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> solve_nonlinear_timestep(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::pair&lt;unsigned int, double&gt;</div>
<div class="line">solve_linear_system(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update);</div>
</div><!-- fragment --><p></b></p>
<p><b>解的检索以及后处理和写数据到文件。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a></div>
<div class="line">get_total_solution(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p></b></p>
<p><b>最后，一些描述当前状态的成员变量。用于描述问题设置的参数的集合...</b></p>
<p><b></p><div class="fragment"><div class="line">Parameters::AllParameters parameters;</div>
</div><!-- fragment --><p></b></p>
<p><b>...参考配置的体积...</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">double</span> vol_reference;</div>
</div><!-- fragment --><p></b></p>
<p><b>...以及对解决问题的几何形状的描述。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01127">tria.h:1128</a></div></div>
<div class="ttc" id="ap4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>此外，还要记录当前时间和评估某些函数的时间</b></p>
<p><b></p><div class="fragment"><div class="line">Time                time;</div>
<div class="line"><span class="keyword">mutable</span> <a class="code" href="classTimerOutput.html">TimerOutput</a> timer;</div>
<div class="ttc" id="aclassTimerOutput_html"><div class="ttname"><a href="classTimerOutput.html">TimerOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00544">timer.h:545</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>一个用于正交点信息的存储对象。与 <a class="el" href="step_18.html">step-18</a> 相反，这里采用了deal.II的本地正交点数据管理器。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classCellDataStorage.html">CellDataStorage&lt;typename Triangulation&lt;dim&gt;::cell_iterator</a>,</div>
<div class="line">                PointHistory&lt;dim&gt;&gt;</div>
<div class="line">  quadrature_point_history;</div>
<div class="ttc" id="aclassCellDataStorage_html"><div class="ttname"><a href="classCellDataStorage.html">CellDataStorage</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__point__data_8h_source.html#l00062">quadrature_point_data.h:63</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>对有限元系统的描述，包括位移多项式程度、自由度处理程序、每个单元的DoF数量以及用于从解向量中检索信息的提取器对象。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               degree;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>              fe;</div>
<div class="line"><a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>                  dof_handler;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               dofs_per_cell;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> u_fe;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> p_fe;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> J_fe;</div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00314">dof_handler.h:315</a></div></div>
<div class="ttc" id="astructFEValuesExtractors_1_1Scalar_html"><div class="ttname"><a href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__values__extractors_8h_source.html#l00095">fe_values_extractors.h:96</a></div></div>
<div class="ttc" id="astructFEValuesExtractors_1_1Vector_html"><div class="ttname"><a href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__values__extractors_8h_source.html#l00150">fe_values_extractors.h:151</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>说明区块系统是如何安排的。有3个块，第一个包含一个矢量DOF \(\mathbf{u}\) ，而另外两个描述标量DOF， \(\widetilde{p}\) 和 \(\widetilde{J}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>          = 3;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_components      = dim + 2;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_u_component = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p_component       = dim;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> J_component       = dim + 1;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">  u_dof = 0,</div>
<div class="line">  p_dof = 1,</div>
<div class="line">  J_dof = 2</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::vector&lt;types::global_dof_index&gt; dofs_per_block;</div>
<div class="line">std::vector&lt;types::global_dof_index&gt; element_indices_u;</div>
<div class="line">std::vector&lt;types::global_dof_index&gt; element_indices_p;</div>
<div class="line">std::vector&lt;types::global_dof_index&gt; element_indices_J;</div>
<div class="ttc" id="anamespaceMatrixFreeOperators_1_1BlockHelper_html_a42c347ac5bcdd69aceb58ab14bacd2b7"><div class="ttname"><a href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">MatrixFreeOperators::BlockHelper::n_blocks</a></div><div class="ttdeci">std::enable_if&lt; IsBlockVector&lt; VectorType &gt;::value, unsigned int &gt;::type n_blocks(const VectorType &amp;vector)</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l00049">operators.h:49</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>单元和面的高斯正交规则。单元和面的正交点的数量被记录。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     qf_cell;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt; qf_face;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points_f;</div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00038">quadrature_lib.h:39</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>存储收敛的解和右手边向量以及切线矩阵的对象。有一个AffineConstraints对象，用于记录约束条件。 我们利用了为块状系统设计的稀疏性模式。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"><a class="code" href="classBlockSparsityPattern.html">BlockSparsityPattern</a>      sparsity_pattern;</div>
<div class="line"><a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> tangent_matrix;</div>
<div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a>       system_rhs;</div>
<div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a>       solution_n;</div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassBlockSparseMatrix_html"><div class="ttname"><a href="classBlockSparseMatrix.html">BlockSparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparse__matrix_8h_source.html#l00049">block_sparse_matrix.h:50</a></div></div>
<div class="ttc" id="aclassBlockSparsityPattern_html"><div class="ttname"><a href="classBlockSparsityPattern.html">BlockSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparsity__pattern_8h_source.html#l00406">block_sparsity_pattern.h:407</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后定义一些变量来存储规范，更新规范和归一化因子。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">struct </span>Errors</div>
<div class="line">{</div>
<div class="line">  Errors()</div>
<div class="line">    : <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a>(1.0)</div>
<div class="line">    , u(1.0)</div>
<div class="line">    , p(1.0)</div>
<div class="line">    , J(1.0)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> = 1.0;</div>
<div class="line">    u    = 1.0;</div>
<div class="line">    p    = 1.0;</div>
<div class="line">    J    = 1.0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> normalize(<span class="keyword">const</span> Errors &amp;rhs)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (rhs.norm != 0.0)</div>
<div class="line">      <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> /= rhs.norm;</div>
<div class="line">    <span class="keywordflow">if</span> (rhs.u != 0.0)</div>
<div class="line">      u /= rhs.u;</div>
<div class="line">    <span class="keywordflow">if</span> (rhs.p != 0.0)</div>
<div class="line">      p /= rhs.p;</div>
<div class="line">    <span class="keywordflow">if</span> (rhs.J != 0.0)</div>
<div class="line">      J /= rhs.J;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a>, u, p, J;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Errors error_residual, error_residual_0, error_residual_norm, error_update,</div>
<div class="line">  error_update_0, error_update_norm;</div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Divergence_html_a8bcfc37d2a2be8faa18628a601ecf112"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">LocalIntegrators::Divergence::norm</a></div><div class="ttdeci">double norm(const FEValuesBase&lt; dim &gt; &amp;fe, const ArrayView&lt; const std::vector&lt; Tensor&lt; 1, dim &gt;&gt;&gt; &amp;Du)</div><div class="ttdef"><b>Definition:</b> <a href="divergence_8h_source.html#l00472">divergence.h:472</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>计算误差措施的方法</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> get_error_residual(Errors &amp;error_residual);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> get_error_update(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update,</div>
<div class="line">                      Errors &amp;                   error_update);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::pair&lt;double, double&gt; get_error_dilation() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p></b></p>
<p><b>计算空间配置中的体积</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">double</span> compute_vol_current() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p></b></p>
<p><b>以赏心悦目的方式向屏幕打印信息...</b></p>
<p><b></p><div class="fragment"><div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> print_conv_header();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> print_conv_footer();</div>
<div class="line">};</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="ImplementationofthecodeSolidcodeclass"></a> </p><h3>Implementation of the <code>Solid</code> class</h3>
<p></b></p>
<p><b></b></p>
<p><b><a class="anchor" id="Publicinterface"></a> </p><h4>Public interface</h4>
<p></b></p>
<p><b></b></p>
<p><b>我们使用从参数文件中提取的数据来初始化Solid类。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">Solid&lt;dim&gt;::Solid(<span class="keyword">const</span> std::string &amp;input_file)</div>
<div class="line">  : parameters(input_file)</div>
<div class="line">  , vol_reference(0.)</div>
<div class="line">  , <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::maximum_smoothing)</div>
<div class="line">  , time(parameters.end_time, parameters.delta_t)</div>
<div class="line">  , timer(std::cout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::summary, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">  , degree(parameters.poly_degree)</div>
<div class="line">  ,</div>
</div><!-- fragment --><p></b></p>
<p><b>有限元系统由昏暗的连续位移DOF，以及不连续的压力和膨胀DOF组成。为了满足Babuska-Brezzi或LBB稳定性条件（见Hughes（2000）），我们设置了一个 \(Q_n \times DGPM_{n-1} \times DGPM_{n-1}\) 系统。 \(Q_2 \times DGPM_1 \times DGPM_1\) 元素满足这一条件，而 \(Q_1 \times DGPM_0 \times DGPM_0\) 元素不满足。然而，事实证明，后者还是表现出良好的收敛特性。</b></p>
<p><b></p><div class="fragment"><div class="line">  fe(<a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>(parameters.poly_degree),</div>
<div class="line">     dim, <span class="comment">// displacement</span></div>
<div class="line">     <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial&lt;dim&gt;</a>(parameters.poly_degree - 1),</div>
<div class="line">     1, <span class="comment">// pressure</span></div>
<div class="line">     <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial&lt;dim&gt;</a>(parameters.poly_degree - 1),</div>
<div class="line">     1)</div>
<div class="line">  , <span class="comment">// dilatation</span></div>
<div class="line">  dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , dofs_per_cell(fe.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>())</div>
<div class="line">  , u_fe(first_u_component)</div>
<div class="line">  , p_fe(p_component)</div>
<div class="line">  , J_fe(J_component)</div>
<div class="line">  , dofs_per_block(<a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>)</div>
<div class="line">  , qf_cell(parameters.quad_order)</div>
<div class="line">  , qf_face(parameters.quad_order)</div>
<div class="line">  , n_q_points(qf_cell.<a class="code" href="classQuadrature.html#af9f7d82770fa8126e19113f3e3db755b">size</a>())</div>
<div class="line">  , n_q_points_f(qf_face.size())</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim == 2 || dim == 3,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;This problem only works in 2 or 3 space dimensions.&quot;</span>));</div>
<div class="line">  determine_component_extractors();</div>
<div class="line">}</div>
<div class="ttc" id="aclassFE__DGPMonomial_html"><div class="ttname"><a href="classFE__DGPMonomial.html">FE_DGPMonomial</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__dgp__monomial_8h_source.html#l00284">fe_dgp_monomial.h:285</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8h_source.html#l00548">fe_q.h:549</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a33b522422da89e5c080e7405ad49d7c7"><div class="ttname"><a href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">FiniteElementData::n_dofs_per_cell</a></div><div class="ttdeci">unsigned int n_dofs_per_cell() const</div></div>
<div class="ttc" id="aclassQuadrature_html_af9f7d82770fa8126e19113f3e3db755b"><div class="ttname"><a href="classQuadrature.html#af9f7d82770fa8126e19113f3e3db755b">Quadrature::size</a></div><div class="ttdeci">unsigned int size() const</div></div>
<div class="ttc" id="agroup__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
</div><!-- fragment --><p></b></p>
<p><b>在解决准静态问题时，时间成为一个加载参数，即我们随着时间线性增加加载，使得这两个概念可以互换。我们选择用一个恒定的时间步长来线性增加时间。 <br  />
</b></p>
<p><b>我们从预处理开始，设置初始扩张值，然后输出初始网格，再以第一次时间（和载荷）递增开始模拟。 <br  />
</b></p>
<p><b>在对初始解场施加约束 \(\widetilde{J}=1\) 时，必须注意（或者至少要考虑一下）。该约束对应于未变形构型中变形梯度的行列式，也就是身份张量。我们使用FE_DGPMonomial基数来插值扩张场，因此我们不能简单地将相应的dof设置为unity，因为它们对应于单项式系数。因此，我们使用 <a class="el" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a> 函数来为我们做这个工作。 <a class="el" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a> 函数需要一个参数，表明悬挂节点的约束。我们在这个程序中没有 所以我们必须创建一个约束对象。在原始状态下，约束对象是没有排序的，必须先进行排序（使用 <a class="el" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a> 函数）才能使用。请看 <a class="el" href="step_21.html">step-21</a> 以了解更多信息。我们只需要强制执行扩张的初始条件。为了做到这一点，我们使用ComponentSelectFunction，它作为一个掩码，将n_components的J_component设置为1。 这正是我们想要的。请看 <a class="el" href="step_20.html">step-20</a> 中的用法，以了解更多信息。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">Solid&lt;dim&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  make_grid();</div>
<div class="line">  system_setup();</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a> J_mask(J_component, n_components);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a>(</div>
<div class="line">      dof_handler, constraints, <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(degree + 2), J_mask, solution_n);</div>
<div class="line">  }</div>
<div class="line">  output_results();</div>
<div class="line">  time.increment();</div>
<div class="ttc" id="aclassAffineConstraints_html_a1611aa37f754086388ca76bcd421cce5"><div class="ttname"><a href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a></div><div class="ttdeci">void close()</div></div>
<div class="ttc" id="aclassComponentSelectFunction_html"><div class="ttname"><a href="classComponentSelectFunction.html">ComponentSelectFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00583">function.h:585</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ac6b404bf03cb2a742b290421cc2789fe"><div class="ttname"><a href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a></div><div class="ttdeci">void project(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const AffineConstraints&lt; typename VectorType::value_type &gt; &amp;constraints, const Quadrature&lt; dim &gt; &amp;quadrature, const Function&lt; spacedim, typename VectorType::value_type &gt; &amp;function, VectorType &amp;vec, const bool enforce_zero_boundary=false, const Quadrature&lt; dim - 1 &gt; &amp;q_boundary=(dim &gt; 1 ? QGauss&lt; dim - 1 &gt;(2) :Quadrature&lt; dim - 1 &gt;(0)), const bool project_to_boundary_first=false)</div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后我们声明增量解决方案更新 \(\varDelta \mathbf{\Xi} \dealcoloneq \{\varDelta \mathbf{u},\varDelta \widetilde{p}, \varDelta \widetilde{J} \}\) 并开始在时域上循环。</b></p>
<p><b>在开始时，我们重新设定这个时间步长的解决方案更新...</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_delta(dofs_per_block);</div>
<div class="line"><span class="keywordflow">while</span> (time.current() &lt; time.end())</div>
<div class="line">  {</div>
<div class="line">    solution_delta = 0.0;</div>
</div><!-- fragment --><p></b></p>
<p><b>...求解当前时间步长并更新总解向量 \(\mathbf{\Xi}_{\textrm{n}} = \mathbf{\Xi}_{\textrm{n-1}} + \varDelta \mathbf{\Xi}\) ...</b></p>
<p><b></p><div class="fragment"><div class="line">solve_nonlinear_timestep(solution_delta);</div>
<div class="line">solution_n += solution_delta;</div>
</div><!-- fragment --><p></b></p>
<p><b>...在愉快地进入下一个时间步长之前，绘制结果。</b></p>
<p><b></p><div class="fragment"><div class="line">      output_results();</div>
<div class="line">      time.increment();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Privateinterface"></a> </p><h3>Private interface</h3>
<p></b></p>
<p><b></b></p>
<p><b><a class="anchor" id="Threadingbuildingblocksstructures"></a> </p><h4>Threading-building-blocks structures</h4>
<p></b></p>
<p><b></b></p>
<p><b>第一组私有成员函数与并行化有关。我们使用线程积木库（TBB）来执行尽可能多的计算密集型分布式任务。特别是，我们使用TBB组装正切矩阵和右手向量、静态凝结贡献，以及更新存储在正交点的数据。我们在这方面的主要工具是WorkStream类（更多信息见 <a class="el" href="group__threads.html">Parallel computing with multiple processors accessing shared memory</a> 模块）。</b></p>
<p><b>首先我们要处理正切矩阵和右手边的装配结构。PerTaskData对象存储本地对全局系统的贡献。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_ASM</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  PerTaskData_ASM(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell)</div>
<div class="line">    : <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell)</div>
<div class="line">    , cell_rhs(dofs_per_cell)</div>
<div class="line">    , local_dof_indices(dofs_per_cell)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0.0;</div>
<div class="line">    cell_rhs    = 0.0;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Advection_html_a8bc7b8136646134f73a4193adefe15f8"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">LocalIntegrators::Advection::cell_matrix</a></div><div class="ttdeci">void cell_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const FEValuesBase&lt; dim &gt; &amp;fetest, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="advection_8h_source.html#l00075">advection.h:75</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>另一方面，ScratchData对象存储较大的对象，如形状函数值数组（ <code>Nx</code> ）和形状函数梯度和对称梯度向量，我们将在装配时使用。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_ASM</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>     fe_values;</div>
<div class="line">  <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a> fe_face_values;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;std::vector&lt;double&gt;&gt;                  Nx;</div>
<div class="line">  std::vector&lt;std::vector&lt;Tensor&lt;2, dim&gt;&gt;&gt;          grad_Nx;</div>
<div class="line">  std::vector&lt;std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt;&gt; symm_grad_Nx;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  ScratchData_ASM(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe_cell,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;       qf_cell,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         uf_cell,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim - 1&gt;</a> &amp;   qf_face,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         uf_face)</div>
<div class="line">    : fe_values(fe_cell, qf_cell, uf_cell)</div>
<div class="line">    , fe_face_values(fe_cell, qf_face, uf_face)</div>
<div class="line">    , Nx(qf_cell.size(), std::vector&lt;<a class="code" href="classdouble.html">double</a>&gt;(fe_cell.n_dofs_per_cell()))</div>
<div class="line">    , grad_Nx(qf_cell.size(),</div>
<div class="line">              std::vector&lt;<a class="code" href="classTensor.html">Tensor</a>&lt;2, dim&gt;&gt;(fe_cell.n_dofs_per_cell()))</div>
<div class="line">    , symm_grad_Nx(qf_cell.size(),</div>
<div class="line">                   std::vector&lt;<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt;&gt;(</div>
<div class="line">                     fe_cell.n_dofs_per_cell()))</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  ScratchData_ASM(<span class="keyword">const</span> ScratchData_ASM &amp;rhs)</div>
<div class="line">    : fe_values(rhs.fe_values.get_fe(),</div>
<div class="line">                rhs.fe_values.get_quadrature(),</div>
<div class="line">                rhs.fe_values.get_update_flags())</div>
<div class="line">    , fe_face_values(rhs.fe_face_values.get_fe(),</div>
<div class="line">                     rhs.fe_face_values.get_quadrature(),</div>
<div class="line">                     rhs.fe_face_values.get_update_flags())</div>
<div class="line">    , Nx(rhs.Nx)</div>
<div class="line">    , grad_Nx(rhs.grad_Nx)</div>
<div class="line">    , symm_grad_Nx(rhs.symm_grad_Nx)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points      = Nx.size();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs_per_cell = Nx[0].size();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(Nx[q_point].size() == n_dofs_per_cell, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(grad_Nx[q_point].size() == n_dofs_per_cell,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(symm_grad_Nx[q_point].size() == n_dofs_per_cell,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; n_dofs_per_cell; ++k)</div>
<div class="line">          {</div>
<div class="line">            Nx[q_point][k]           = 0.0;</div>
<div class="line">            grad_Nx[q_point][k]      = 0.0;</div>
<div class="line">            symm_grad_Nx[q_point][k] = 0.0;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassFEFaceValues_html"><div class="ttname"><a href="classFEFaceValues.html">FEFaceValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l04157">fe_values.h:4158</a></div></div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l03905">fe_values.h:3906</a></div></div>
<div class="ttc" id="aclassFiniteElement_html"><div class="ttname"><a href="classFiniteElement.html">FiniteElement</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l00645">fe.h:646</a></div></div>
<div class="ttc" id="aclassdouble_html"><div class="ttname"><a href="classdouble.html">double</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52f"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div><div class="ttdeci">UpdateFlags</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00066">fe_update_flags.h:67</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后我们定义结构来组装静态凝结的切线矩阵。回顾一下，我们希望解决一个基于位移的公式。由于 \(\widetilde{p}\) 和 \(\widetilde{J}\) 字段是元素不连续的，所以我们在元素层面上进行缩合。 由于这些操作是基于矩阵的，我们需要设置一些矩阵来存储一些切线矩阵子块的局部贡献。 我们将这些放在PerTaskData结构中。 <br  />
</b></p>
<p><b>我们选择不在 <code>reset()</code> 函数中重置任何数据，因为矩阵提取和替换工具会处理这个问题</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_SC</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_orig;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pu;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pJ;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_JJ;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pJ_inv;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_bbar;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> B;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  PerTaskData_SC(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_u,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_p,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_J)</div>
<div class="line">    : <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell)</div>
<div class="line">    , local_dof_indices(dofs_per_cell)</div>
<div class="line">    , k_orig(dofs_per_cell, dofs_per_cell)</div>
<div class="line">    , k_pu(n_p, n_u)</div>
<div class="line">    , k_pJ(n_p, n_J)</div>
<div class="line">    , k_JJ(n_J, n_J)</div>
<div class="line">    , k_pJ_inv(n_p, n_J)</div>
<div class="line">    , k_bbar(n_u, n_u)</div>
<div class="line">    , <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>(n_J, n_u)</div>
<div class="line">    , B(n_J, n_u)</div>
<div class="line">    , <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>(n_p, n_u)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {}</div>
<div class="line">};</div>
<div class="ttc" id="anamespaceLAPACKSupport_html_a40707d49114d54318c823f3b750e89a4"><div class="ttname"><a href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">LAPACKSupport::A</a></div><div class="ttdeci">static const char A</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00153">lapack_support.h:153</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a09916360abaee5f1fb31994dbc96787b"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">Physics::Elasticity::Kinematics::C</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; C(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
</div><!-- fragment --><p></b></p>
<p><b>由于我们不需要临时数据，所以我们希望在这里执行的操作的ScratchData对象是空的，但它仍然需要在deal.II中为TBB的当前实现定义。 所以我们为此创建了一个假结构。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_SC</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {}</div>
<div class="line">};</div>
</div><!-- fragment --><p></b></p>
<p><b>最后我们定义结构以协助更新正交点信息。与SC组装过程类似，我们不需要PerTaskData对象（因为这里没有什么可存储的），但还是必须定义一个。请注意，这是因为对于我们这里的操作&ndash;更新正交点的数据&ndash;是纯粹的局部操作：我们在每个单元上做的事情在每个单元上都会被消耗掉，没有像使用WorkStream类时通常会有的全局聚合操作。我们仍然必须定义每个任务的数据结构，这表明WorkStream类可能不适合这种操作（原则上，我们可以简单地使用 <a class="el" href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a> 为每个单元创建一个新的任务），但无论如何这样做并没有什么坏处。此外，如果有不同的材料模型与一个正交点相关联，需要不同程度的计算费用，那么这里使用的方法可能是有利的。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_UQPH</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {}</div>
<div class="line">};</div>
</div><!-- fragment --><p></b></p>
<p><b>ScratchData对象将被用来存储解向量的别名，这样我们就不必复制这个大的数据结构。然后我们定义一些向量来提取正交点的解值和梯度。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_UQPH</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_total;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Tensor&lt;2, dim&gt;&gt; solution_grads_u_total;</div>
<div class="line">  std::vector&lt;double&gt;         solution_values_p_total;</div>
<div class="line">  std::vector&lt;double&gt;         solution_values_J_total;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  ScratchData_UQPH(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe_cell,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;        qf_cell,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>          uf_cell,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_total)</div>
<div class="line">    : solution_total(solution_total)</div>
<div class="line">    , solution_grads_u_total(qf_cell.size())</div>
<div class="line">    , solution_values_p_total(qf_cell.size())</div>
<div class="line">    , solution_values_J_total(qf_cell.size())</div>
<div class="line">    , fe_values(fe_cell, qf_cell, uf_cell)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  ScratchData_UQPH(<span class="keyword">const</span> ScratchData_UQPH &amp;rhs)</div>
<div class="line">    : solution_total(rhs.solution_total)</div>
<div class="line">    , solution_grads_u_total(rhs.solution_grads_u_total)</div>
<div class="line">    , solution_values_p_total(rhs.solution_values_p_total)</div>
<div class="line">    , solution_values_J_total(rhs.solution_values_J_total)</div>
<div class="line">    , fe_values(rhs.fe_values.get_fe(),</div>
<div class="line">                rhs.fe_values.get_quadrature(),</div>
<div class="line">                rhs.fe_values.get_update_flags())</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = solution_grads_u_total.size();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        solution_grads_u_total[q]  = 0.0;</div>
<div class="line">        solution_values_p_total[q] = 0.0;</div>
<div class="line">        solution_values_J_total[q] = 0.0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidmake_grid"></a> </p><h4>Solid::make_grid</h4>
<p></b></p>
<p><b></b></p>
<p><b>接着是第一个私有成员函数。在这里，我们创建域的三角形，为此我们选择按比例的立方体，每个面都有一个边界ID号。 对于压痕问题，网格必须至少被细化一次。 <br  />
</b></p>
<p><b>然后我们确定参考配置的体积，并将其打印出来进行比较。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::make_grid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#a56019d263ae45708302d5d7599f0d458">GridGenerator::hyper_rectangle</a>(</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">    (dim == 3 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0.0, 0.0, 0.0) : <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0.0, 0.0)),</div>
<div class="line">    (dim == 3 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(1.0, 1.0, 1.0) : <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(1.0, 1.0)),</div>
<div class="line">    <span class="keyword">true</span>);</div>
<div class="line">  <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a>(parameters.scale, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(1U, parameters.global_refinement));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  vol_reference = <a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">GridTools::volume</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Grid:\n\t Reference volume: &quot;</span> &lt;&lt; vol_reference &lt;&lt; std::endl;</div>
<div class="ttc" id="aclassPoint_html"><div class="ttname"><a href="classPoint.html">Point</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2point_8h_source.html#l00110">point.h:111</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_a56019d263ae45708302d5d7599f0d458"><div class="ttname"><a href="namespaceGridGenerator.html#a56019d263ae45708302d5d7599f0d458">GridGenerator::hyper_rectangle</a></div><div class="ttdeci">void hyper_rectangle(Triangulation&lt; dim, spacedim &gt; &amp;tria, const Point&lt; dim &gt; &amp;p1, const Point&lt; dim &gt; &amp;p2, const bool colorize=false)</div></div>
<div class="ttc" id="anamespaceGridTools_html_a9e8169dc4981e90ba5d2386a87efa042"><div class="ttname"><a href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">GridTools::volume</a></div><div class="ttdeci">double volume(const Triangulation&lt; dim, spacedim &gt; &amp;tria, const Mapping&lt; dim, spacedim &gt; &amp;mapping=(ReferenceCells::get_hypercube&lt; dim &gt;() .template get_default_linear_mapping&lt; dim, spacedim &gt;()))</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l00137">grid_tools.cc:137</a></div></div>
<div class="ttc" id="anamespaceVectorTools_1_1EvaluationFlags_html_ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420"><div class="ttname"><a href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">VectorTools::EvaluationFlags::max</a></div><div class="ttdeci">@ max</div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__evaluate_8h_source.html#l00053">vector_tools_evaluate.h:53</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>由于我们希望将Neumann BC应用于顶面的一个补丁，我们必须找到域的这一部分的单元面，并用一个明显的边界ID号标记它们。 我们要找的面在+y面上，将得到边界ID 6（0到5已经在创建立方体域的六个面时使用了）。</b></p>
<p><b></p><div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (face-&gt;at_boundary() == <span class="keyword">true</span> &amp;&amp;</div>
<div class="line">            face-&gt;center()[1] == 1.0 * parameters.scale)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">if</span> (dim == 3)</div>
<div class="line">              {</div>
<div class="line">                <span class="keywordflow">if</span> (face-&gt;center()[0] &lt; 0.5 * parameters.scale &amp;&amp;</div>
<div class="line">                    face-&gt;center()[2] &lt; 0.5 * parameters.scale)</div>
<div class="line">                  face-&gt;set_boundary_id(6);</div>
<div class="line">              }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              {</div>
<div class="line">                <span class="keywordflow">if</span> (face-&gt;center()[0] &lt; 0.5 * parameters.scale)</div>
<div class="line">                  face-&gt;set_boundary_id(6);</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidsystem_setup"></a> </p><h4>Solid::system_setup</h4>
<p></b></p>
<p><b></b></p>
<p><b>接下来我们描述一下FE系统是如何设置的。 我们首先确定每块的分量数量。由于位移是一个矢量分量，前两个分量属于它，而后两个分量描述标量压力和扩张DOF。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::system_setup()</div>
<div class="line">{</div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned int&gt; block_component(n_components,</div>
<div class="line">                                            u_dof); <span class="comment">// Displacement</span></div>
<div class="line">  block_component[p_component] = p_dof;             <span class="comment">// Pressure</span></div>
<div class="line">  block_component[J_component] = J_dof;             <span class="comment">// Dilatation</span></div>
<div class="ttc" id="aclassTimerOutput_html_ae730ff220ae414208dc85e76920c3e45"><div class="ttname"><a href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">TimerOutput::enter_subsection</a></div><div class="ttdeci">void enter_subsection(const std::string &amp;section_name)</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00403">timer.cc:403</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后，DOF处理程序被初始化，我们以一种有效的方式对网格重新编号。我们还记录了每个区块的DOFs的数量。</b></p>
<p><b></p><div class="fragment"><div class="line">dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line"><a class="code" href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a>(dof_handler);</div>
<div class="line"><a class="code" href="namespaceDoFRenumbering.html#a52c1941406d1ce2937e29a46edf111f4">DoFRenumbering::component_wise</a>(dof_handler, block_component);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">dofs_per_block =</div>
<div class="line">  <a class="code" href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a>(dof_handler, block_component);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Triangulation:&quot;</span></div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;\n\t Number of active cells: &quot;</span></div>
<div class="line">          &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells()</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;\n\t Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">          &lt;&lt; std::endl;</div>
<div class="ttc" id="aclassDoFHandler_html_a553ca864aaf70330d9be86bc78f36d1e"><div class="ttname"><a href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">DoFHandler::distribute_dofs</a></div><div class="ttdeci">void distribute_dofs(const FiniteElement&lt; dim, spacedim &gt; &amp;fe)</div></div>
<div class="ttc" id="aclassDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="anamespaceDoFRenumbering_html_a52c1941406d1ce2937e29a46edf111f4"><div class="ttname"><a href="namespaceDoFRenumbering.html#a52c1941406d1ce2937e29a46edf111f4">DoFRenumbering::component_wise</a></div><div class="ttdeci">void component_wise(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const std::vector&lt; unsigned int &gt; &amp;target_component=std::vector&lt; unsigned int &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l00681">dof_renumbering.cc:681</a></div></div>
<div class="ttc" id="anamespaceDoFRenumbering_html_a68651164485490b86d901d9ae1fbfc3b"><div class="ttname"><a href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a></div><div class="ttdeci">void Cuthill_McKee(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const bool reversed_numbering=false, const bool use_constraints=false, const std::vector&lt; types::global_dof_index &gt; &amp;starting_indices=std::vector&lt; types::global_dof_index &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l00366">dof_renumbering.cc:366</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a796721b56b3a90e4e3973c7caae4c3d8"><div class="ttname"><a href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a></div><div class="ttdeci">std::vector&lt; types::global_dof_index &gt; count_dofs_per_fe_block(const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::vector&lt; unsigned int &gt; &amp;target_block=std::vector&lt; unsigned int &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l02047">dof_tools.cc:2047</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>设置稀疏模式和切线矩阵</b></p>
<p><b></p><div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#gacf098688a1a7db16a6582be07dcbeb6a">clear</a>();</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_u = dofs_per_block[u_dof];</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_p = dofs_per_block[p_dof];</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_J = dofs_per_block[J_dof];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a> dsp(<a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>, <a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dsp.block(u_dof, u_dof).reinit(n_dofs_u, n_dofs_u);</div>
<div class="line">  dsp.block(u_dof, p_dof).reinit(n_dofs_u, n_dofs_p);</div>
<div class="line">  dsp.block(u_dof, J_dof).reinit(n_dofs_u, n_dofs_J);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dsp.block(p_dof, u_dof).reinit(n_dofs_p, n_dofs_u);</div>
<div class="line">  dsp.block(p_dof, p_dof).reinit(n_dofs_p, n_dofs_p);</div>
<div class="line">  dsp.block(p_dof, J_dof).reinit(n_dofs_p, n_dofs_J);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dsp.block(J_dof, u_dof).reinit(n_dofs_J, n_dofs_u);</div>
<div class="line">  dsp.block(J_dof, p_dof).reinit(n_dofs_J, n_dofs_p);</div>
<div class="line">  dsp.block(J_dof, J_dof).reinit(n_dofs_J, n_dofs_J);</div>
<div class="line">  dsp.collect_sizes();</div>
<div class="ttc" id="aclassBlockDynamicSparsityPattern_html"><div class="ttname"><a href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparsity__pattern_8h_source.html#l00524">block_sparsity_pattern.h:526</a></div></div>
<div class="ttc" id="agroup__Matrix1_html_gacf098688a1a7db16a6582be07dcbeb6a"><div class="ttname"><a href="group__Matrix1.html#gacf098688a1a7db16a6582be07dcbeb6a">BlockSparseMatrix::clear</a></div><div class="ttdeci">void clear()</div></div>
<div class="ttc" id="anamespacetypes_html_a3543786f7dc7c57385fc923a6afd5917"><div class="ttname"><a href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a></div><div class="ttdeci">unsigned int global_dof_index</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00076">types.h:76</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>全局系统矩阵最初具有以下结构</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} \underbrace{\begin{bmatrix} \mathsf{\mathbf{K}}_{uu} &amp; \mathsf{\mathbf{K}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathsf{\mathbf{K}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}} \\ \mathbf{0} &amp; \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}} &amp; \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} \end{bmatrix}}_{\mathsf{\mathbf{K}}(\mathbf{\Xi}_{\textrm{i}})} \underbrace{\begin{bmatrix} d \mathsf{u} \\ d \widetilde{\mathsf{\mathbf{p}}} \\ d \widetilde{\mathsf{\mathbf{J}}} \end{bmatrix}}_{d \mathbf{\Xi}} = \underbrace{\begin{bmatrix} \mathsf{\mathbf{F}}_{u}(\mathbf{u}_{\textrm{i}}) \\ \mathsf{\mathbf{F}}_{\widetilde{p}}(\widetilde{p}_{\textrm{i}}) \\ \mathsf{\mathbf{F}}_{\widetilde{J}}(\widetilde{J}_{\textrm{i}}) \end{bmatrix}}_{ \mathsf{\mathbf{F}}(\mathbf{\Xi}_{\textrm{i}}) } \, . \end{align*}
</p>
<p></b></p>
<p><b>我们对稀疏模式进行优化，以反映这一结构，并防止为右对角块成分创建不必要的数据。</b></p>
<p><b></p><div class="fragment"><div class="line">  <a class="code" href="classTable.html">Table&lt;2, DoFTools::Coupling&gt;</a> coupling(n_components, n_components);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0; ii &lt; n_components; ++ii)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jj = 0; jj &lt; n_components; ++jj)</div>
<div class="line">      <span class="keywordflow">if</span> (((ii &lt; p_component) &amp;&amp; (jj == J_component)) ||</div>
<div class="line">          ((ii == J_component) &amp;&amp; (jj &lt; p_component)) ||</div>
<div class="line">          ((ii == p_component) &amp;&amp; (jj == p_component)))</div>
<div class="line">        coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba">DoFTools::none</a>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">DoFTools::always</a>;</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(</div>
<div class="line">    dof_handler, coupling, dsp, constraints, <span class="keyword">false</span>);</div>
<div class="line">  sparsity_pattern.<a class="code" href="group__Exceptions.html#ga923288e4b4093f86b680e7045e9b4984">copy_from</a>(dsp);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e0a45e360458e7350bd93487d6bf1e5">reinit</a>(sparsity_pattern);</div>
<div class="ttc" id="aclassTable_html"><div class="ttname"><a href="classTable.html">Table</a></div><div class="ttdef"><b>Definition:</b> <a href="table_8h_source.html#l00666">table.h:667</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga923288e4b4093f86b680e7045e9b4984"><div class="ttname"><a href="group__Exceptions.html#ga923288e4b4093f86b680e7045e9b4984">BlockSparsityPattern::copy_from</a></div><div class="ttdeci">void copy_from(const BlockDynamicSparsityPattern &amp;dsp)</div><div class="ttdef"><b>Definition:</b> <a href="block__sparsity__pattern_8cc_source.html#l00449">block_sparsity_pattern.cc:449</a></div></div>
<div class="ttc" id="agroup__Matrix1_html_ga1e0a45e360458e7350bd93487d6bf1e5"><div class="ttname"><a href="group__Matrix1.html#ga1e0a45e360458e7350bd93487d6bf1e5">BlockSparseMatrix::reinit</a></div><div class="ttdeci">virtual void reinit(const BlockSparsityPattern &amp;sparsity)</div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba"><div class="ttname"><a href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba">DoFTools::none</a></div><div class="ttdeci">@ none</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8h_source.html#l00231">dof_tools.h:231</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec"><div class="ttname"><a href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">DoFTools::always</a></div><div class="ttdeci">@ always</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8h_source.html#l00235">dof_tools.h:235</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后我们设置存储向量</b></p>
<p><b></p><div class="fragment"><div class="line">system_rhs.<a class="code" href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">reinit</a>(dofs_per_block);</div>
<div class="line">system_rhs.<a class="code" href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">collect_sizes</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">solution_n.<a class="code" href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">reinit</a>(dofs_per_block);</div>
<div class="line">solution_n.<a class="code" href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">collect_sizes</a>();</div>
<div class="ttc" id="agroup__Exceptions_html_ga6a27b2a48e5b5780cd0a6640b928d794"><div class="ttname"><a href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">BlockVectorBase::collect_sizes</a></div><div class="ttdeci">void collect_sizes()</div></div>
<div class="ttc" id="agroup__Vectors_html_gadf4d1d6c3538af95309a95da2ded758c"><div class="ttname"><a href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">BlockVector::reinit</a></div><div class="ttdeci">void reinit(const unsigned int n_blocks, const size_type block_size=0, const bool omit_zeroing_entries=false)</div></div>
</div><!-- fragment --><p></b></p>
<p><b>...最后设置正交点历史。</b></p>
<p><b></p><div class="fragment"><div class="line">  setup_qph();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassTimerOutput_html_a4d27dbc569819f3bbcb5e066e47212ea"><div class="ttname"><a href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">TimerOutput::leave_subsection</a></div><div class="ttdeci">void leave_subsection(const std::string &amp;section_name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00445">timer.cc:445</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Soliddetermine_component_extractors"></a> </p><h4>Solid::determine_component_extractors</h4>
<p></b></p>
<p><b> 接下来我们从FE系统中计算一些信息，描述哪些局部元素DOF连接到哪个块状部件。 这将在后面用于从全局矩阵中提取子块。 <br  />
</b></p>
<p><b>从本质上讲，我们所需要的是FESystem对象指出参考单元上的DOF连接到哪个块状部件上。 目前，插值场的设置是：0表示位移DOF，1表示压力DOF，2表示膨胀DOF。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::determine_component_extractors()</div>
<div class="line">{</div>
<div class="line">  element_indices_u.clear();</div>
<div class="line">  element_indices_p.clear();</div>
<div class="line">  element_indices_J.clear();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; fe.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++k)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(k).first.first;</div>
<div class="line">      <span class="keywordflow">if</span> (k_group == u_dof)</div>
<div class="line">        element_indices_u.push_back(k);</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_dof)</div>
<div class="line">        element_indices_p.push_back(k);</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_dof)</div>
<div class="line">        element_indices_J.push_back(k);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassFiniteElement_html_ad88459d21a0e6c8b8882eb5dc981cf31"><div class="ttname"><a href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">FiniteElement::system_to_base_index</a></div><div class="ttdeci">std::pair&lt; std::pair&lt; unsigned int, unsigned int &gt;, unsigned int &gt; system_to_base_index(const unsigned int index) const</div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidsetup_qph"></a> </p><h4>Solid::setup_qph</h4>
<p></b></p>
<p><b> 用于存储正交信息的方法已经在 step-18 中描述。这里我们为SMP机器实现了一个类似的设置。 <br  />
</b></p>
<p><b>首先，实际的QPH数据对象被创建。这必须在网格被细化到最精细的程度后才能完成。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::setup_qph()</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;    Setting up quadrature point data...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  quadrature_point_history.<a class="code" href="classCellDataStorage.html#a9ce38927ac1a1f96618c2624da89d65b">initialize</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.begin_active(),</div>
<div class="line">                                      <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.end(),</div>
<div class="line">                                      n_q_points);</div>
<div class="ttc" id="aclassCellDataStorage_html_a9ce38927ac1a1f96618c2624da89d65b"><div class="ttname"><a href="classCellDataStorage.html#a9ce38927ac1a1f96618c2624da89d65b">CellDataStorage::initialize</a></div><div class="ttdeci">void initialize(const CellIteratorType &amp;cell, const unsigned int number_of_data_points_per_cell)</div></div>
</div><!-- fragment --><p></b></p>
<p><b>接下来我们设置初始正交点数据。注意，当正交点数据被检索时，它将以智能指针的矢量形式返回。</b></p>
<p><b></p><div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">        lqph[q_point]-&gt;setup_lqp(parameters);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassCellDataStorage_html_ac9702fd0e031af11ccdc28e7908ec487"><div class="ttname"><a href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">CellDataStorage::get_data</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; T &gt; &gt; get_data(const CellIteratorType &amp;cell)</div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidupdate_qph_incremental"></a> </p><h4>Solid::update_qph_incremental</h4>
<p></b></p>
<p><b> 由于QP信息的更新经常发生，并涉及一些昂贵的操作，我们定义了一个多线程的方法，将任务分布在若干CPU核上。 <br  />
</b></p>
<p><b>为了开始这个工作，我们首先需要获得这个牛顿增量时的总解，然后创建初始的从头开始和复制数据对象的副本。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">Solid&lt;dim&gt;::update_qph_incremental(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)</div>
<div class="line">{</div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Update QPH data&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; UQPH &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_total(</div>
<div class="line">    get_total_solution(solution_delta));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_UQPH(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>);</div>
<div class="line">  PerTaskData_UQPH  per_task_data_UQPH;</div>
<div class="line">  ScratchData_UQPH  scratch_data_UQPH(fe, qf_cell, uf_UQPH, solution_total);</div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00084">fe_update_flags.h:84</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后我们将它们和单细胞更新函数传递给WorkStream进行处理。</b></p>
<p><b></p><div class="fragment"><div class="line">  <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">                  *<span class="keyword">this</span>,</div>
<div class="line">                  &amp;Solid::update_qph_incremental_one_cell,</div>
<div class="line">                  &amp;Solid::copy_local_to_global_UQPH,</div>
<div class="line">                  scratch_data_UQPH,</div>
<div class="line">                  per_task_data_UQPH);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__CPP11_html_gaace8c98aca00e7e48a619bb5e08084aa"><div class="ttname"><a href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div></div>
<div class="ttc" id="anamespaceWorkStream_html_ab8ceb010811941c351803b671a19fb73"><div class="ttname"><a href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a></div><div class="ttdeci">void run(const std::vector&lt; std::vector&lt; Iterator &gt;&gt; &amp;colored_iterators, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length=2 *MultithreadInfo::n_threads(), const unsigned int chunk_size=8)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l01337">work_stream.h:1337</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们描述一下我们如何从解决方案矢量中提取数据并将其传递给每个QP存储对象进行处理。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::update_qph_incremental_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_UQPH &amp;                                    scratch,</div>
<div class="line">  PerTaskData_UQPH &amp; <span class="comment">/*data*/</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">    quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_grads_u_total.size() == n_q_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_values_p_total.size() == n_q_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_values_J_total.size() == n_q_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  scratch.reset();</div>
</div><!-- fragment --><p></b></p>
<p><b>我们首先需要找到当前单元内正交点的值和梯度，然后利用位移梯度和总压力及扩张解值更新每个局部QP。</b></p>
<p><b></p><div class="fragment"><div class="line">  scratch.fe_values.reinit(cell);</div>
<div class="line">  scratch.fe_values[u_fe].get_function_gradients(</div>
<div class="line">    scratch.solution_total, scratch.solution_grads_u_total);</div>
<div class="line">  scratch.fe_values[p_fe].get_function_values(</div>
<div class="line">    scratch.solution_total, scratch.solution_values_p_total);</div>
<div class="line">  scratch.fe_values[J_fe].get_function_values(</div>
<div class="line">    scratch.solution_total, scratch.solution_values_J_total);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">       scratch.fe_values.quadrature_point_indices())</div>
<div class="line">    lqph[q_point]-&gt;update_values(scratch.solution_grads_u_total[q_point],</div>
<div class="line">                                 scratch.solution_values_p_total[q_point],</div>
<div class="line">                                 scratch.solution_values_J_total[q_point]);</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidsolve_nonlinear_timestep"></a> </p><h4>Solid::solve_nonlinear_timestep</h4>
<p></b></p>
<p><b></b></p>
<p><b>下一个函数是Newton-Raphson方案的驱动方法。在它的顶部，我们创建一个新的向量来存储当前的牛顿更新步骤，重置误差存储对象并打印求解器的标题。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::solve_nonlinear_timestep(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Timestep &quot;</span> &lt;&lt; time.get_timestep() &lt;&lt; <span class="stringliteral">&quot; @ &quot;</span> &lt;&lt; time.current()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> newton_update(dofs_per_block);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  error_residual.reset();</div>
<div class="line">  error_residual_0.reset();</div>
<div class="line">  error_residual_norm.reset();</div>
<div class="line">  error_update.reset();</div>
<div class="line">  error_update_0.reset();</div>
<div class="line">  error_update_norm.reset();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  print_conv_header();</div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们执行一些牛顿迭代来迭代解决非线性问题。 由于问题是完全非线性的，而且我们使用的是完全牛顿方法，所以存储在正切矩阵和右手边向量中的数据是不能重复使用的，必须在每个牛顿步骤中清除。然后，我们最初建立线性系统并检查收敛性（并在第一次迭代中存储这个值）。rhs向量的无约束DOFs保持失衡的力，并共同决定是否达到了平衡解。 <br  />
</b></p>
<p><b>尽管对于这个特定的问题，我们可以在组装系统矩阵之前构建RHS向量，但为了扩展性，我们选择不这样做。分别组装RHS向量和系统矩阵的好处是，后者是一个昂贵的操作，我们可以通过在达到收敛时不组装切线矩阵来避免一个额外的组装过程。然而，这使得使用MPI并行化代码变得更加困难。此外，当把问题扩展到瞬态情况时，由于时间离散化和对速度和加速度场的约束应用，可能会对RHS产生额外的贡献。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_iteration = 0;</div>
<div class="line"><span class="keywordflow">for</span> (; newton_iteration &lt; parameters.max_iterations_NR; ++newton_iteration)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; newton_iteration &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">              &lt;&lt; std::flush;</div>
</div><!-- fragment --><p></b></p>
<p><b>我们构建线性系统，但暂不对其进行求解（这一步骤应该比装配要昂贵得多）。</b></p>
<p><b></p><div class="fragment"><div class="line">make_constraints(newton_iteration);</div>
<div class="line">assemble_system();</div>
</div><!-- fragment --><p></b></p>
<p><b>我们现在可以确定归一化残余误差，并检查解决方案的收敛性。</b></p>
<p><b></p><div class="fragment"><div class="line">get_error_residual(error_residual);</div>
<div class="line"><span class="keywordflow">if</span> (newton_iteration == 0)</div>
<div class="line">  error_residual_0 = error_residual;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">error_residual_norm = error_residual;</div>
<div class="line">error_residual_norm.normalize(error_residual_0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (newton_iteration &gt; 0 &amp;&amp; error_update_norm.u &lt;= parameters.tol_u &amp;&amp;</div>
<div class="line">    error_residual_norm.u &lt;= parameters.tol_f)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; CONVERGED! &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    print_conv_footer();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
</div><!-- fragment --><p></b></p>
<p><b>如果我们已经决定要继续迭代，我们就解决线性化系统。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> std::pair&lt;unsigned int, double&gt; lin_solver_output =</div>
<div class="line">  solve_linear_system(newton_update);</div>
</div><!-- fragment --><p></b></p>
<p><b>我们现在可以确定归一化的牛顿更新误差。</b></p>
<p><b></p><div class="fragment"><div class="line">get_error_update(newton_update, error_update);</div>
<div class="line"><span class="keywordflow">if</span> (newton_iteration == 0)</div>
<div class="line">  error_update_0 = error_update;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">error_update_norm = error_update;</div>
<div class="line">error_update_norm.normalize(error_update_0);</div>
</div><!-- fragment --><p></b></p>
<p><b>最后，由于我们隐含地接受了求解步骤，我们可以对当前时间步骤的求解增量进行实际更新，更新与这个新位移和应力状态有关的所有正交点信息，并继续迭代。</b></p>
<p><b></p><div class="fragment"><div class="line">  solution_delta += newton_update;</div>
<div class="line">  update_qph_incremental(solution_delta);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; std::fixed &lt;&lt; std::setprecision(3) &lt;&lt; std::setw(7)</div>
<div class="line">            &lt;&lt; std::scientific &lt;&lt; lin_solver_output.first &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">            &lt;&lt; lin_solver_output.second &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">            &lt;&lt; error_residual_norm.norm &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.u</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.p &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">            &lt;&lt; error_residual_norm.J &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.norm</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.u &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.p</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.J &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>最后，如果发现我们事实上做了比参数文件允许的更多的迭代，我们会引发一个异常，可以在main()函数中捕获。调用<code><a class="el" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow(condition, exc_object)</a></code>实质上等同于<code>if (!cond) throw exc_object;</code>，但前一种形式在异常对象中填充了某些字段，以确定异常发生的位置（文件名和行号），使之更容易确定问题发生在哪里。</b></p>
<p><b></p><div class="fragment"><div class="line">  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(newton_iteration &lt; parameters.max_iterations_NR,</div>
<div class="line">              <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver!&quot;</span>));</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Exceptions_html_gafc0ca7ad85b3ebd64e8e51689ac85caf"><div class="ttname"><a href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a></div><div class="ttdeci">#define AssertThrow(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01583">exceptions.h:1583</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidprint_conv_headerandSolidprint_conv_footer"></a> </p><h4>Solid::print_conv_header and Solid::print_conv_footer</h4>
<p></b></p>
<p><b></b></p>
<p><b>这个程序在一个漂亮的表格中打印出数据，这个表格在每次迭代的基础上更新。接下来的两个函数设置了表头和表脚。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_header()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_width = 150;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;               SOLVER STEP               &quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; |  LIN_IT   LIN_RES    RES_NORM    &quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; RES_U     RES_P      RES_J     NU_NORM     &quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; NU_U       NU_P       NU_J &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_footer()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_width = 150;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::pair&lt;double, double&gt; error_dil = get_error_dilation();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Relative errors:&quot;</span> &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Displacement:\t&quot;</span> &lt;&lt; error_update.u / error_update_0.u</div>
<div class="line">            &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Force: \t\t&quot;</span> &lt;&lt; error_residual.u / error_residual_0.u</div>
<div class="line">            &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Dilatation:\t&quot;</span> &lt;&lt; error_dil.first &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;v / V_0:\t&quot;</span> &lt;&lt; error_dil.second * vol_reference &lt;&lt; <span class="stringliteral">&quot; / &quot;</span></div>
<div class="line">            &lt;&lt; vol_reference &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; error_dil.second &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidget_error_dilation"></a> </p><h4>Solid::get_error_dilation</h4>
<p></b></p>
<p><b></b></p>
<p><b>计算空间配置中的域的体积</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> Solid&lt;dim&gt;::compute_vol_current()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordtype">double</span> vol_current = 0.0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe, qf_cell, <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="ttc" id="aclassFEValues_html_a21f914e63d588e2652a9514620653d77"><div class="ttname"><a href="classFEValues.html#a21f914e63d588e2652a9514620653d77">FEValues::reinit</a></div><div class="ttdeci">void reinit(const TriaIterator&lt; DoFCellAccessor&lt; dim, spacedim, level_dof_access &gt;&gt; &amp;cell)</div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00129">fe_update_flags.h:129</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>与之前要求的不同，在这个例子中，正交点数据是特别不可修改的，因为我们将只访问数据。我们通过将这个更新函数标记为常数来确保正确的get_data函数被调用。</b></p>
<p><b></p><div class="fragment"><div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point : fe_values.<a class="code" href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">quadrature_point_indices</a>())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> JxW      = fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          vol_current += det_F_qp * JxW;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(vol_current &gt; 0.0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  <span class="keywordflow">return</span> vol_current;</div>
<div class="line">}</div>
<div class="ttc" id="aclassFEValuesBase_html_aada8380792b5e6a1f91dcba94b558cb8"><div class="ttname"><a href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">FEValuesBase::quadrature_point_indices</a></div><div class="ttdeci">std_cxx20::ranges::iota_view&lt; unsigned int, unsigned int &gt; quadrature_point_indices() const</div></div>
<div class="ttc" id="aclassFEValuesBase_html_abade89efb068b71b7ced7082012a2441"><div class="ttname"><a href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">FEValuesBase::JxW</a></div><div class="ttdeci">double JxW(const unsigned int quadrature_point) const</div></div>
</div><!-- fragment --><p></b></p>
<p><b>计算扩张 \(\widetilde{J}\) 与 \(J \dealcoloneq \textrm{det}\ \mathbf{F}\) 的一致程度，从 \(L^2\) 的误差 \( \bigl[ \int_{\Omega_0} {[ J - \widetilde{J}]}^{2}\textrm{d}V \bigr]^{1/2}\) 。我们还返回域的当前体积与参考体积的比率。这对不可压缩介质很有意义，因为我们要检查等压线约束的执行情况如何。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::pair&lt;double, double&gt; Solid&lt;dim&gt;::get_error_dilation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordtype">double</span> dil_L2_error = 0.0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe, qf_cell, <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point : fe_values.<a class="code" href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">quadrature_point_indices</a>())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp   = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> J_tilde_qp = lqph[q_point]-&gt;get_J_tilde();</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> the_error_qp_squared =</div>
<div class="line">            <a class="code" href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a>((det_F_qp - J_tilde_qp), 2);</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          dil_L2_error += the_error_qp_squared * JxW;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> std::make_pair(std::sqrt(dil_L2_error),</div>
<div class="line">                        compute_vol_current() / vol_reference);</div>
<div class="line">}</div>
<div class="ttc" id="anumbers_8h_html_af44aee1db5cdcd0bab54e3c011d2be66"><div class="ttname"><a href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; pow(const ::VectorizedArray&lt; Number, width &gt; &amp;, const Number p)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05422">vectorization.h:5422</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidget_error_residual"></a></p><h4>Solid::get_error_residual</h4>
<p></b></p>
<p><b></b></p>
<p><b>确定问题的真实剩余误差。 也就是说，确定未受约束的自由度的残差误差。 注意，要做到这一点，我们需要忽略受约束的自由度，将这些向量分量的残差设置为零。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_residual(Errors &amp;error_residual)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> error_res(dofs_per_block);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++i)</div>
<div class="line">    <span class="keywordflow">if</span> (!constraints.<a class="code" href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">is_constrained</a>(i))</div>
<div class="line">      error_res(i) = system_rhs(i);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  error_residual.norm = error_res.l2_norm();</div>
<div class="line">  error_residual.u    = error_res.block(u_dof).l2_norm();</div>
<div class="line">  error_residual.p    = error_res.block(p_dof).l2_norm();</div>
<div class="line">  error_residual.J    = error_res.block(J_dof).l2_norm();</div>
<div class="line">}</div>
<div class="ttc" id="aclassAffineConstraints_html_a885d18f0044979873f5e5a6f33772f73"><div class="ttname"><a href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">AffineConstraints::is_constrained</a></div><div class="ttdeci">bool is_constrained(const size_type line_n) const</div><div class="ttdef"><b>Definition:</b> <a href="affine__constraints_8h_source.html#l02122">affine_constraints.h:2122</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidget_error_update"></a></p><h4>Solid::get_error_update</h4>
<p></b></p>
<p><b></b></p>
<p><b>确定问题的真实牛顿更新误差</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_update(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update,</div>
<div class="line">                                  Errors &amp;                   error_update)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> error_ud(dofs_per_block);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++i)</div>
<div class="line">    <span class="keywordflow">if</span> (!constraints.<a class="code" href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">is_constrained</a>(i))</div>
<div class="line">      error_ud(i) = newton_update(i);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  error_update.norm = error_ud.l2_norm();</div>
<div class="line">  error_update.u    = error_ud.block(u_dof).l2_norm();</div>
<div class="line">  error_update.p    = error_ud.block(p_dof).l2_norm();</div>
<div class="line">  error_update.J    = error_ud.block(J_dof).l2_norm();</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidget_total_solution"></a></p><h4>Solid::get_total_solution</h4>
<p></b></p>
<p><b> </p><h4>Solid::get_total_solution</h4>
<p></b></p>
<p><b></b></p>
<p><b>这个函数提供了总的解决方案，它在任何牛顿步骤中都是有效的。这是必要的，因为为了减少计算误差，总解只在时间步数结束时更新。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> Solid&lt;dim&gt;::get_total_solution(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_total(solution_n);</div>
<div class="line">  solution_total += solution_delta;</div>
<div class="line">  <span class="keywordflow">return</span> solution_total;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidassemble_system"></a></p><h4>Solid::assemble_system</h4>
<p></b></p>
<p><b></b></p>
<p><b>由于我们使用TBB进行装配，所以我们只需设置过程所需的数据结构的副本，并将其与装配函数一起传递给WorkStream对象进行处理。请注意，我们必须确保在任何装配操作发生之前，矩阵和RHS向量被重置。此外，由于我们描述的是诺伊曼BC的问题，我们将需要面的法线，所以必须在面的更新标志中指定这一点。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Assemble system&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; ASM_SYS &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  tangent_matrix = 0.0;</div>
<div class="line">  system_rhs     = 0.0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_cell(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_face(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  PerTaskData_ASM per_task_data(dofs_per_cell);</div>
<div class="line">  ScratchData_ASM scratch_data(fe, qf_cell, uf_cell, qf_face, uf_face);</div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a></div><div class="ttdeci">@ update_normal_vectors</div><div class="ttdoc">Normal vectors.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00136">fe_update_flags.h:136</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>这里用于向WorkStream类传递数据的语法在 <a class="el" href="step_13.html">step-13</a> 中讨论。</b></p>
<p><b></p><div class="fragment"><div class="line">  <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(</div>
<div class="line">    dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">    [<span class="keyword">this</span>](<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">           ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">           PerTaskData_ASM &amp;                                     data) {</div>
<div class="line">      this-&gt;assemble_system_one_cell(cell, scratch, data);</div>
<div class="line">    },</div>
<div class="line">    [<span class="keyword">this</span>](<span class="keyword">const</span> PerTaskData_ASM &amp;data) {</div>
<div class="line">      this-&gt;constraints.distribute_local_to_global(data.cell_matrix,</div>
<div class="line">                                                   data.cell_rhs,</div>
<div class="line">                                                   data.local_dof_indices,</div>
<div class="line">                                                   tangent_matrix,</div>
<div class="line">                                                   system_rhs);</div>
<div class="line">    },</div>
<div class="line">    scratch_data,</div>
<div class="line">    per_task_data);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>当然，我们仍然要定义如何为单个单元组装正切矩阵的贡献。 我们首先需要重置和初始化一些从头开始的数据结构，并检索一些关于这个单元上DOF编号的基本信息。 我们可以预先计算单元的形状函数值和梯度。请注意，形状函数梯度是针对当前配置而定义的。 也就是 \(\textrm{grad}\ \boldsymbol{\varphi} = \textrm{Grad}\ \boldsymbol{\varphi} \ \mathbf{F}^{-1}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">  PerTaskData_ASM &amp;                                     data)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  data.reset();</div>
<div class="line">  scratch.reset();</div>
<div class="line">  scratch.fe_values.reinit(cell);</div>
<div class="line">  cell-&gt;get_dof_indices(data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">    quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">       scratch.fe_values.quadrature_point_indices())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv = lqph[q_point]-&gt;get_F_inv();</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k : scratch.fe_values.dof_indices())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(k).first.first;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (k_group == u_dof)</div>
<div class="line">            {</div>
<div class="line">              scratch.grad_Nx[q_point][k] =</div>
<div class="line">                scratch.fe_values[u_fe].gradient(k, q_point) * F_inv;</div>
<div class="line">              scratch.symm_grad_Nx[q_point][k] =</div>
<div class="line">                <a class="code" href="classSymmetricTensor.html#a1b2101a1d45267f1fd4664ed178cb636">symmetrize</a>(scratch.grad_Nx[q_point][k]);</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_dof)</div>
<div class="line">            scratch.Nx[q_point][k] =</div>
<div class="line">              scratch.fe_values[p_fe].value(k, q_point);</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_dof)</div>
<div class="line">            scratch.Nx[q_point][k] =</div>
<div class="line">              scratch.fe_values[J_fe].value(k, q_point);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="ttc" id="aclassSymmetricTensor_html_a1b2101a1d45267f1fd4664ed178cb636"><div class="ttname"><a href="classSymmetricTensor.html#a1b2101a1d45267f1fd4664ed178cb636">SymmetricTensor::symmetrize</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 2, dim, Number &gt; symmetrize(const Tensor&lt; 2, dim, Number &gt; &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03492">symmetric_tensor.h:3492</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们建立本地单元刚度矩阵和RHS向量。由于全局和局部系统矩阵是对称的，我们可以利用这一特性，只建立局部矩阵的下半部分，并将其值复制到上半部分。 所以我们只组装一半的 \(\mathsf{\mathbf{k}}_{uu}\) , \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{p}} = \mathbf{0}\) , \(\mathsf{\mathbf{k}}_{\widetilde{J} \widetilde{J}}\) 块，而整个 \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\) , \(\mathsf{\mathbf{k}}_{u \widetilde{J}} = \mathbf{0}\) , \(\mathsf{\mathbf{k}}_{u \widetilde{p}}\) 块是建立的。</b></p>
<p><b>在这样做时，我们首先从我们的正交历史对象中提取一些配置相关的变量，用于当前的正交点。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">     scratch.fe_values.quadrature_point_indices())</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau     = lqph[q_point]-&gt;get_tau();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a>          tau_ns  = lqph[q_point]-&gt;get_tau();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc      = lqph[q_point]-&gt;get_Jc();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                  det_F   = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                  p_tilde = lqph[q_point]-&gt;get_p_tilde();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                  J_tilde = lqph[q_point]-&gt;get_J_tilde();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> dPsi_vol_dJ   = lqph[q_point]-&gt;get_dPsi_vol_dJ();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> d2Psi_vol_dJ2 = lqph[q_point]-&gt;get_d2Psi_vol_dJ2();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;I =</div>
<div class="line">      <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div>
</div><!-- fragment --><p></b></p>
<p><b>这两个张量存储了一些预计算的数据。它们的用途将很快得到解释。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> symm_grad_Nx_i_x_Jc;</div>
<div class="line"><a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>          grad_Nx_i_comp_i_x_tau;</div>
</div><!-- fragment --><p></b></p>
<p><b>接下来我们定义一些别名，使装配过程更容易操作。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> std::vector&lt;double&gt; &amp;                 <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> = scratch.Nx[q_point];</div>
<div class="line"><span class="keyword">const</span> std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt; &amp;symm_grad_Nx =</div>
<div class="line">  scratch.symm_grad_Nx[q_point];</div>
<div class="line"><span class="keyword">const</span> std::vector&lt;Tensor&lt;2, dim&gt;&gt; &amp;grad_Nx = scratch.grad_Nx[q_point];</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>                       JxW = scratch.fe_values.JxW(q_point);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">      fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(i).first.first;</div>
<div class="ttc" id="aclassFiniteElement_html_a23200d54e40cd719a183d47b6cfb719f"><div class="ttname"><a href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">FiniteElement::system_to_component_index</a></div><div class="ttdeci">std::pair&lt; unsigned int, unsigned int &gt; system_to_component_index(const unsigned int index) const</div></div>
<div class="ttc" id="anamespaceLAPACKSupport_html_a8edacd69ab93285f82b7f63c733a86b7"><div class="ttname"><a href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">LAPACKSupport::N</a></div><div class="ttdeci">static const char N</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00157">lapack_support.h:157</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>我们首先计算来自内力的贡献。 注意，通过定义rhs为残差的负数，这些贡献被减去。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">  data.cell_rhs(i) -= (symm_grad_Nx[i] * tau) * JxW;</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == p_dof)</div>
<div class="line">  data.cell_rhs(i) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * (det_F - J_tilde) * JxW;</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == J_dof)</div>
<div class="line">  data.cell_rhs(i) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * (dPsi_vol_dJ - p_tilde) * JxW;</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(i_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
</div><!-- fragment --><p></b></p>
<p><b>在我们进入内循环之前，我们还有最后一次机会来引入一些优化。我们已经考虑到了系统的对称性，现在我们可以预先计算一些在内循环中反复应用的常用项。我们在这里不会过分，而是将重点放在昂贵的操作上，即那些涉及等级4材料刚度张量和等级2应力张量的操作。 <br  />
</b></p>
<p><b>我们可以观察到的是，这两个张量都是以 "i "DoF为索引的形状函数梯度收缩的。这意味着，当我们在 "j "DoF上循环时，这个特殊的操作保持不变。出于这个原因，我们可以从内循环中提取这个操作，并节省许多操作，对于每个正交点和DoF索引 "i"，并在索引 "j "上重复，需要用等级4对称张量对等级2对称张量进行双重收缩，用等级2张量对等级1张量进行双重收缩。 <br  />
</b></p>
<p><b>在损失一些可读性的情况下，当使用模拟默认参数时，这个小变化将使对称系统的装配时间减少约一半，并且随着h-精化水平的提高而变得更加显著。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">  {</div>
<div class="line">    symm_grad_Nx_i_x_Jc    = symm_grad_Nx[i] * Jc;</div>
<div class="line">    grad_Nx_i_comp_i_x_tau = grad_Nx[i][component_i] * tau_ns;</div>
<div class="line">  }</div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们准备计算切线矩阵的贡献。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j :</div>
<div class="line">     scratch.fe_values.dof_indices_ending_at(i))</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_j =</div>
<div class="line">      fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(j).first;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j_group =</div>
<div class="line">      fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(j).first.first;</div>
</div><!-- fragment --><p></b></p>
<p><b>这就是 \(\mathsf{\mathbf{k}}_{uu}\) 贡献。它包括一个材料贡献，和一个几何应力贡献，只沿局部矩阵对角线添加。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">if</span> ((i_group == j_group) &amp;&amp; (i_group == u_dof))</div>
<div class="line">  {</div>
</div><!-- fragment --><p></b></p>
<p><b>材料贡献。</b></p>
<p><b></p><div class="fragment"><div class="line">data.cell_matrix(i, j) += symm_grad_Nx_i_x_Jc *  </div>
<div class="line">                          symm_grad_Nx[j] * JxW; </div>
</div><!-- fragment --><p></b></p>
<p><b>几何应力贡献。</b></p>
<p><b></p><div class="fragment"><div class="line">  <span class="keywordflow">if</span> (component_i == component_j)</div>
<div class="line">    data.cell_matrix(i, j) +=</div>
<div class="line">      grad_Nx_i_comp_i_x_tau * grad_Nx[j][component_j] * JxW;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>接下来是 \(\mathsf{\mathbf{k}}_{ \widetilde{p} u}\) 的贡献</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == p_dof) &amp;&amp; (j_group == u_dof))</div>
<div class="line">  {</div>
<div class="line">    data.cell_matrix(i, j) += <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * det_F *               </div>
<div class="line">                              (symm_grad_Nx[j] * I) * JxW; </div>
<div class="line">  }</div>
</div><!-- fragment --><p></b></p>
<p><b>最后是 \(\mathsf{\mathbf{k}}_{ \widetilde{J} \widetilde{p}}\) 和 \(\mathsf{\mathbf{k}}_{ \widetilde{J} \widetilde{J}}\) 贡献。</b></p>
<p><b></p><div class="fragment"><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == J_dof) &amp;&amp; (j_group == p_dof))</div>
<div class="line">            data.cell_matrix(i, j) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[j] * JxW;</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == j_group) &amp;&amp; (i_group == J_dof))</div>
<div class="line">            data.cell_matrix(i, j) += <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * d2Psi_vol_dJ2 * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[j] * JxW;</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>((i_group &lt;= J_dof) &amp;&amp; (j_group &lt;= J_dof),</div>
<div class="line">                   <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>接下来我们组装诺伊曼贡献。我们首先检查单元格面是否存在于施加了牵引力的边界上，如果是这样的话，就加入贡献。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div>
<div class="line">  <span class="keywordflow">if</span> (face-&gt;at_boundary() &amp;&amp; face-&gt;boundary_id() == 6)</div>
<div class="line">    {</div>
<div class="line">      scratch.fe_face_values.reinit(cell, face);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> f_q_point :</div>
<div class="line">           scratch.fe_face_values.quadrature_point_indices())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> =</div>
<div class="line">            scratch.fe_face_values.normal_vector(f_q_point);</div>
</div><!-- fragment --><p></b></p>
<p><b>使用这个正交点的面的法线，我们指定参考配置中的牵引力。对于这个问题，在参考构型中应用一个定义的压力。所施加的牵引力的方向被假定为不随领域的变形而变化。牵引力是用第一个Piola-Kirchhoff应力来定义的，即 \(\mathbf{t} = \mathbf{P}\mathbf{N} = [p_0 \mathbf{I}] \mathbf{N} = p_0 \mathbf{N}\) 我们用时间变量来线性提升压力负荷。</b></p>
<p><b>请注意，我们在这里计算的对右侧向量的贡献只存在于向量的位移分量中。</b></p>
<p><b></p><div class="fragment"><div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> p0 =</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        -4.0 / (parameters.scale * parameters.scale);</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>         time_ramp = (time.current() / time.end());</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>         pressure  = p0 * parameters.p_p0 * time_ramp;</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> traction  = pressure * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group =</div>
<div class="line">            fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(i).first.first;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> Ni =</div>
<div class="line">                scratch.fe_face_values.shape_value(i, f_q_point);</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = scratch.fe_face_values.JxW(f_q_point);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              data.cell_rhs(i) += (Ni * traction[component_i]) * JxW;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>最后，我们需要将局部矩阵的下半部分复制到上半部分。</b></p>
<p><b></p><div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j :</div>
<div class="line">         scratch.fe_values.dof_indices_starting_at(i + 1))</div>
<div class="line">      data.cell_matrix(i, j) = data.cell_matrix(j, i);</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidmake_constraints"></a> </p><h4>Solid::make_constraints</h4>
<p></b></p>
<p><b> 这个问题的约束条件很容易描述。在这个特殊的例子中，边界值将被计算为牛顿算法的两次第一次迭代。一般来说，我们会在第2次迭代中建立非均质约束（也就是在后面的代码块中<code>apply_dirichlet_bc == true</code>时），在接下来的步骤中只建立相应的均质约束。虽然目前的例子只有同质约束，但以前的经验表明，一个常见的错误是在重构代码到特定用途时忘记添加额外的条件。这可能导致难以调试的错误。本着这种精神，我们选择让代码在每个牛顿步骤中执行什么操作方面变得更加啰嗦。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> it_nr)</div>
<div class="line">{</div>
</div><!-- fragment --><p></b></p>
<p><b>由于我们(a)处理的是牛顿迭代方法，(b)对位移使用增量公式，(c)对增量位移场应用约束，所以对位移更新的任何非同质约束只应在第2次迭代时指定。由于该迭代后约束条件将被完全满足，因此不需要做出后续贡献。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span> apply_dirichlet_bc = (it_nr == 0);</div>
</div><!-- fragment --><p></b></p>
<p><b>此外，在一个时间步长内的第一次牛顿迭代之后，约束条件保持不变，只要不清除 <code>constraints</code> 对象，我们就不需要修改或重建它们。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (it_nr &gt; 1)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; --- &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot; CST &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (apply_dirichlet_bc)</div>
<div class="line">  {</div>
</div><!-- fragment --><p></b></p>
<p><b>在牛顿第2次迭代时，我们希望应用代表位移增量边界条件的全套非均质和均质约束。由于一般情况下，每个时间步长的约束条件可能是不同的，我们需要清除约束矩阵并完全重建它。一个例子是，如果一个表面正在加速，在这种情况下，每个时间步骤之间的位移变化是不恒定的。</b></p>
<p><b></p><div class="fragment"><div class="line">constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="ttc" id="aclassAffineConstraints_html_addd15bc409c61d6f795f0132c574335b"><div class="ttname"><a href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">AffineConstraints::clear</a></div><div class="ttdeci">void clear()</div></div>
</div><!-- fragment --><p></b></p>
<p><b>三维压痕问题的边界条件如下。在-x、-y和-z面（IDs 0,2,4）我们设置了一个对称条件，只允许平面运动，而+x和+z面（IDs 1,5）无牵引力。在这个设计好的问题中，+y面的一部分（ID 3）被设定为在x-和z-分量上没有运动。最后，如前所述，+y面的另一部分有一个施加的压力，但在x和z方向上也受到约束。 <br  />
</b></p>
<p><b>在下文中，我们将不得不告诉函数插值的边界值，解向量的哪些分量应该受到约束（也就是说，是x-、y-、z-位移还是它们的组合）。这是用ComponentMask对象完成的（见 <a class="el" href="DEALGlossary.html#GlossComponentMask">GlossComponentMask</a> ），如果我们为有限元提供一个我们希望选择的分量的提取器对象，我们可以从有限元中得到这些对象。为此，我们首先设置这样的提取器对象，然后在生成相关构件掩码时使用它。</b></p>
<p><b></p><div class="fragment"><div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> x_displacement(0);</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> y_displacement(1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">        dof_handler,</div>
<div class="line">        <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">        <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">        constraints,</div>
<div class="line">        fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement));</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 2;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">        dof_handler,</div>
<div class="line">        <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">        <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">        constraints,</div>
<div class="line">        fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dim == 3)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> z_displacement(2);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 3;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement) |</div>
<div class="line">             fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement)));</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 4;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 6;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement) |</div>
<div class="line">             fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement)));</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 3;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement)));</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 6;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement)));</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="ttc" id="aclassFiniteElement_html_a4409f54175f279ac24cc982cfcfcbd2f"><div class="ttname"><a href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">FiniteElement::component_mask</a></div><div class="ttdeci">ComponentMask component_mask(const FEValuesExtractors::Scalar &amp;scalar) const</div></div>
<div class="ttc" id="aclassFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00510">function.h:511</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="anamespacetypes_html_aed8813fee8c8a2edcc6005e6a48c321a"><div class="ttname"><a href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">types::boundary_id</a></div><div class="ttdeci">unsigned int boundary_id</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00129">types.h:129</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>由于所有的Dirichlet约束在牛顿第2次迭代后被完全满足，我们要确保对这些条目不做进一步的修改。这意味着我们要将所有非均质的Dirichlet约束转换成均质的约束。 <br  />
</b></p>
<p><b>在这个例子中，这样做的程序是非常直接的，事实上，当只应用同质边界条件时，我们可以（也将）规避任何不必要的操作。在一个更普遍的问题中，我们应该注意悬挂节点和周期性约束，这也可能引入一些不均匀性。那么，为不同类型的约束保留不同的对象可能是有利的，一旦构建了同质Dirichlet约束，就将它们合并在一起。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (constraints.<a class="code" href="classAffineConstraints.html#a0df947a828e8496cd04087c58b382da5">has_inhomogeneities</a>())</div>
<div class="line">  {</div>
<div class="ttc" id="aclassAffineConstraints_html_a0df947a828e8496cd04087c58b382da5"><div class="ttname"><a href="classAffineConstraints.html#a0df947a828e8496cd04087c58b382da5">AffineConstraints::has_inhomogeneities</a></div><div class="ttdeci">bool has_inhomogeneities() const</div></div>
</div><!-- fragment --><p></b></p>
<p><b>由于仿生约束是在上一次牛顿迭代中确定的，因此不能直接修改。因此，我们需要将它们复制到另一个临时对象，并在那里进行修改。一旦我们完成了，我们将把它们转移回主 <code>constraints</code> 对象。</b></p>
<p><b></p><div class="fragment"><div class="line">          <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> homogeneous_constraints(constraints);</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof = 0; dof != dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++dof)</div>
<div class="line">            <span class="keywordflow">if</span> (homogeneous_constraints.is_inhomogeneously_constrained(dof))</div>
<div class="line">              homogeneous_constraints.set_inhomogeneity(dof, 0.0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">          constraints.<a class="code" href="classAffineConstraints.html#ac15d04ef931b4ff581b9a4b3d7b5123e">copy_from</a>(homogeneous_constraints);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassAffineConstraints_html_ac15d04ef931b4ff581b9a4b3d7b5123e"><div class="ttname"><a href="classAffineConstraints.html#ac15d04ef931b4ff581b9a4b3d7b5123e">AffineConstraints::copy_from</a></div><div class="ttdeci">void copy_from(const AffineConstraints&lt; other_number &gt; &amp;other)</div><div class="ttdef"><b>Definition:</b> <a href="affine__constraints_8h_source.html#l02425">affine_constraints.h:2425</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidassemble_sc"></a> </p><h4>Solid::assemble_sc</h4>
<p></b></p>
<p><b> 解决整个块系统有点问题，因为对 \(\mathsf{\mathbf{K}}_{ \widetilde{J} \widetilde{J}}\) 块没有贡献，使其不可逆转（当使用迭代求解器时）。由于压力和扩张变量DOF是不连续的，我们可以把它们浓缩出来，形成一个较小的仅有位移的系统，然后我们将解决这个问题，并随后进行后处理以检索压力和扩张的解决方案。</b></p>
<p><b>静态凝结过程可以在全局层面上进行，但我们需要其中一个块的逆。然而，由于压力和扩张变量是不连续的，静态凝结（SC）操作也可以在每个单元的基础上进行，我们可以通过反转局部块来产生块对角线 \(\mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}\) 块的逆。我们可以再次使用TBB来做这件事，因为每个操作将是相互独立的。 <br  />
</b></p>
<p><b>通过WorkStream类使用TBB，我们将每个元素的贡献集合起来，形成 \( \mathsf{\mathbf{K}}_{\textrm{con}} = \bigl[ \mathsf{\mathbf{K}}_{uu} + \overline{\overline{\mathsf{\mathbf{K}}}}~ \bigr] \) 。然后，这些贡献被添加到全局刚度矩阵中。鉴于这一描述，以下两个函数应该是清楚的。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_sc()</div>
<div class="line">{</div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Perform static condensation&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; ASM_SC &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  PerTaskData_SC per_task_data(dofs_per_cell,</div>
<div class="line">                               element_indices_u.size(),</div>
<div class="line">                               element_indices_p.size(),</div>
<div class="line">                               element_indices_J.size());</div>
<div class="line">  ScratchData_SC scratch_data;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">                  *<span class="keyword">this</span>,</div>
<div class="line">                  &amp;Solid::assemble_sc_one_cell,</div>
<div class="line">                  &amp;Solid::copy_local_to_global_sc,</div>
<div class="line">                  scratch_data,</div>
<div class="line">                  per_task_data);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::copy_local_to_global_sc(<span class="keyword">const</span> PerTaskData_SC &amp;data)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">      tangent_matrix.<a class="code" href="group__Matrix1.html#gad8fe7a35a3336d251a4b3aa2c3ed9748">add</a>(data.local_dof_indices[i],</div>
<div class="line">                         data.local_dof_indices[j],</div>
<div class="line">                         data.cell_matrix(i, j));</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Matrix1_html_gad8fe7a35a3336d251a4b3aa2c3ed9748"><div class="ttname"><a href="group__Matrix1.html#gad8fe7a35a3336d251a4b3aa2c3ed9748">BlockMatrixBase::add</a></div><div class="ttdeci">void add(const size_type i, const size_type j, const value_type value)</div></div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们描述静态凝结过程。按照惯例，我们必须首先找出这个单元上的自由度有哪些全局数字，并重置一些数据结构。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_sc_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_SC &amp;                                      scratch,</div>
<div class="line">  PerTaskData_SC &amp;                                      data)</div>
<div class="line">{</div>
<div class="line">  data.reset();</div>
<div class="line">  scratch.reset();</div>
<div class="line">  cell-&gt;get_dof_indices(data.local_dof_indices);</div>
</div><!-- fragment --><p></b></p>
<p><b>我们现在提取与当前单元相关的自由度对全局刚度矩阵的贡献。 \(\widetilde{p}\) 和 \(\widetilde{J}\) 插值的不连续性质意味着它们在全局层面没有局部贡献的耦合。而 \(\mathbf{u}\) 道夫则不是这样。 换句话说， \(\mathsf{\mathbf{k}}_{\widetilde{J} \widetilde{p}}\) 、 \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{p}}\) 和 \(\mathsf{\mathbf{k}}_{\widetilde{J} \widetilde{p}}\) ，当从全局刚度矩阵中提取时是元素贡献。 而 \(\mathsf{\mathbf{k}}_{uu}\) 则不是这种情况。 <br  />
</b></p>
<p><b>注意：小写的符号用于表示元素刚度矩阵。</b></p>
<p><b>目前，与当前元素相关的道夫矩阵（松散地表示为 \(\mathsf{\mathbf{k}}\) ）的形式是：。</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} \begin{bmatrix} \mathsf{\mathbf{k}}_{uu} &amp; \mathsf{\mathbf{k}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathsf{\mathbf{k}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathsf{\mathbf{k}}_{\widetilde{p}\widetilde{J}} \\ \mathbf{0} &amp; \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{p}} &amp; \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{J}} \end{bmatrix} \end{align*}
</p>
<p></b></p>
<p><b>我们现在需要修改它，使其显示为</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} \begin{bmatrix} \mathsf{\mathbf{k}}_{\textrm{con}} &amp; \mathsf{\mathbf{k}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathsf{\mathbf{k}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathsf{\mathbf{k}}_{\widetilde{p}\widetilde{J}}^{-1} \\ \mathbf{0} &amp; \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{p}} &amp; \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{J}} \end{bmatrix} \end{align*}
</p>
<p></b></p>
<p><b>与 \(\mathsf{\mathbf{k}}_{\textrm{con}} = \bigl[ \mathsf{\mathbf{k}}_{uu} +\overline{\overline{\mathsf{\mathbf{k}}}}~ \bigr]\) ，其中 \( \overline{\overline{\mathsf{\mathbf{k}}}} \dealcoloneq \mathsf{\mathbf{k}}_{u\widetilde{p}} \overline{\mathsf{\mathbf{k}}} \mathsf{\mathbf{k}}_{\widetilde{p}u} \) 和 \( \overline{\mathsf{\mathbf{k}}} = \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{p}}^{-1} \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p}\widetilde{J}}^{-1} \) 。</b></p>
<p><b>在这一点上，我们需要注意的是，全局数据已经存在于 \(\mathsf{\mathbf{K}}_{uu}\) 、 \(\mathsf{\mathbf{K}}_{\widetilde{p} \widetilde{J}}\) 和 \(\mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{p}}\) 子区块。 因此，如果我们要修改它们，我们必须考虑到已经存在的数据（也就是说，如果需要的话，简单地添加到它或删除它）。 由于copy_local_to_global操作是一个 "+="操作，我们需要考虑到这一点 <br  />
</b></p>
<p><b>特别是对于 \(\mathsf{\mathbf{K}}_{uu}\) 块，这意味着从周围的单元格中增加了贡献，所以我们在操作这个块时需要小心。 我们不能直接擦除子块。 <br  />
</b></p>
<p><b>这就是我们将采用的策略，以获得我们想要的子块。</b></p>
<p><b></p><ul>
<li>\( {\mathsf{\mathbf{k}}}_{\textrm{store}}\) : 由于我们不能访问 \(\mathsf{\mathbf{k}}_{uu}\) ，但我们知道它的贡献被添加到全局 \(\mathsf{\mathbf{K}}_{uu}\) 矩阵中，我们只想添加元素明智的静态凝结 \(\overline{\overline{\mathsf{\mathbf{k}}}}\) 。</li>
<li>\(\mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}}\) : 同样， \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\) 也存在于子块中。由于复制操作是一个+=操作，我们需要减去现有的 \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\) 子矩阵，此外还需要 "添加 "我们希望替换它的子矩阵。</li>
<li>\(\mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{p}}\) : 由于全局矩阵是对称的，这个块与上面的块相同，我们可以简单地用 \(\mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}}\) 来代替这个块。 <br  />
</li>
</ul>
<p></b></p>
<p><b>我们首先从系统矩阵中提取元素数据。因此，首先我们得到单元格的整个子块，然后提取 \(\mathsf{\mathbf{k}}\) 作为与当前元素相关的道夫。</b></p>
<p><b></p><div class="fragment"><div class="line">data.k_orig.extract_submatrix_from(tangent_matrix,</div>
<div class="line">                                   data.local_dof_indices,</div>
<div class="line">                                   data.local_dof_indices);</div>
</div><!-- fragment --><p></b></p>
<p><b>接下来是 \(\mathsf{\mathbf{k}}_{ \widetilde{p} u}\) \(\mathsf{\mathbf{k}}_{ \widetilde{p} \widetilde{J}}\) 和 \(\mathsf{\mathbf{k}}_{ \widetilde{J} \widetilde{J}}\) 的局部矩阵。</b></p>
<p><b></p><div class="fragment"><div class="line">data.k_pu.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                 element_indices_p,</div>
<div class="line">                                 element_indices_u);</div>
<div class="line">data.k_pJ.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                 element_indices_p,</div>
<div class="line">                                 element_indices_J);</div>
<div class="line">data.k_JJ.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                 element_indices_J,</div>
<div class="line">                                 element_indices_J);</div>
</div><!-- fragment --><p></b></p>
<p><b>为了得到 \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\) 的逆值，我们直接将其反转。 这个操作相对便宜，因为 \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\) 是块对角线。</b></p>
<p><b></p><div class="fragment"><div class="line">data.k_pJ_inv.invert(data.k_pJ);</div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们可以做凝结项来添加到 \(\mathsf{\mathbf{k}}_{uu}\) 块中，并把它们放在单元格局部矩阵 \( \mathsf{\mathbf{A}} = \mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p} u} \) 中。</b></p>
<p><b></p><div class="fragment"><div class="line">data.k_pJ_inv.mmult(data.A, data.k_pu);</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{B}} = \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p} u} \)</b></p>
<p><b></p><div class="fragment"><div class="line">data.k_JJ.mmult(data.B, data.A);</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{C}} = \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{p}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p} u} \)</b></p>
<p><b></p><div class="fragment"><div class="line">data.k_pJ_inv.Tmmult(data.C, data.B);</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \overline{\overline{\mathsf{\mathbf{k}}}} = \mathsf{\mathbf{k}}_{u \widetilde{p}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{p}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p} u} \)</b></p>
<p><b></p><div class="fragment"><div class="line">data.k_pu.Tmmult(data.k_bbar, data.C);</div>
<div class="line">data.k_bbar.scatter_matrix_to(element_indices_u,</div>
<div class="line">                              element_indices_u,</div>
<div class="line">                              data.cell_matrix);</div>
</div><!-- fragment --><p></b></p>
<p><b>接下来我们将 \(\mathsf{\mathbf{k}}^{-1}_{ \widetilde{p} \widetilde{J}}\) 放在 \(\mathsf{\mathbf{k}}_{ \widetilde{p} \widetilde{J}}\) 块中进行后处理。 再次注意，我们需要删除那里已经存在的贡献。</b></p>
<p><b></p><div class="fragment"><div class="line">  data.k_pJ_inv.add(-1.0, data.k_pJ);</div>
<div class="line">  data.k_pJ_inv.scatter_matrix_to(element_indices_p,</div>
<div class="line">                                  element_indices_J,</div>
<div class="line">                                  data.cell_matrix);</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidsolve_linear_system"></a> </p><h4>Solid::solve_linear_system</h4>
<p></b></p>
<p><b> 我们现在拥有所有必要的组件，可以使用两种可能的方法之一来解决线性化系统。首先是在元素层面上进行静态凝结，这需要对切线矩阵和RHS向量进行一些修改。或者，可以通过在全局层面上进行凝结来解决全块系统。下面我们实现这两种方法。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::pair&lt;unsigned int, double&gt;</div>
<div class="line">Solid&lt;dim&gt;::solve_linear_system(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lin_it  = 0;</div>
<div class="line">  <span class="keywordtype">double</span>       lin_res = 0.0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (parameters.use_static_condensation == <span class="keyword">true</span>)</div>
<div class="line">    {</div>
</div><!-- fragment --><p></b></p>
<p><b>首先，这里是使用切线矩阵的（永久）增量的方法。对于下文，请回顾</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} \mathsf{\mathbf{K}}_{\textrm{store}} \dealcoloneq \begin{bmatrix} \mathsf{\mathbf{K}}_{\textrm{con}} &amp; \mathsf{\mathbf{K}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathsf{\mathbf{K}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \\ \mathbf{0} &amp; \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}} &amp; \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} \end{bmatrix} \, . \end{align*}
</p>
<p></b></p>
<p><b>和</b></p>
<p><b> </p><p class="formulaDsp">
\begin{align*} d \widetilde{\mathsf{\mathbf{p}}} &amp; = \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \bigr] \\ d \widetilde{\mathsf{\mathbf{J}}} &amp; = \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{p}} - \mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \bigr] \\ \Rightarrow d \widetilde{\mathsf{\mathbf{p}}} &amp;= \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathsf{\mathbf{F}}_{\widetilde{J}} - \underbrace{\bigl[\mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1}\bigr]}_{\overline{\mathsf{\mathbf{K}}}}\bigl[ \mathsf{\mathbf{F}}_{\widetilde{p}} - \mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \bigr] \end{align*}
</p>
<p></b></p>
<p><b>从而 </p><p class="formulaDsp">
\[ \underbrace{\bigl[ \mathsf{\mathbf{K}}_{uu} + \overline{\overline{\mathsf{\mathbf{K}}}}~ \bigr] }_{\mathsf{\mathbf{K}}_{\textrm{con}}} d \mathsf{\mathbf{u}} = \underbrace{ \Bigl[ \mathsf{\mathbf{F}}_{u} - \mathsf{\mathbf{K}}_{u\widetilde{p}} \bigl[ \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathsf{\mathbf{F}}_{\widetilde{J}} - \overline{\mathsf{\mathbf{K}}}\mathsf{\mathbf{F}}_{\widetilde{p}} \bigr] \Bigr]}_{\mathsf{\mathbf{F}}_{\textrm{con}}} \]
</p>
<p>，其中 </p><p class="formulaDsp">
\[ \overline{\overline{\mathsf{\mathbf{K}}}} \dealcoloneq \mathsf{\mathbf{K}}_{u\widetilde{p}} \overline{\mathsf{\mathbf{K}}} \mathsf{\mathbf{K}}_{\widetilde{p}u} \, . \]
</p>
<p>。</b></p>
<p><b>在顶部，我们分配了两个临时向量来帮助静态凝结，还有一些变量来存储线性求解器的迭代次数和（希望是收敛的）残差。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>(dofs_per_block);</div>
<div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> B(dofs_per_block);</div>
</div><!-- fragment --><p></b></p>
<p><b>在这个函数的第一步，我们求解增量位移 \(d\mathbf{u}\) 。 为此，我们进行静态浓缩，使 \(\mathsf{\mathbf{K}}_{\textrm{con}} = \bigl[ \mathsf{\mathbf{K}}_{uu} + \overline{\overline{\mathsf{\mathbf{K}}}}~ \bigr]\) ，并将 \(\mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}}\) 放在原来的 \(\mathsf{\mathbf{K}}_{\widetilde{p} \widetilde{J}}\) 块中。也就是说，我们做出 \(\mathsf{\mathbf{K}}_{\textrm{store}}\) 。</b></p>
<p><b></p><div class="fragment"><div class="line">{</div>
<div class="line">  assemble_sc();</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} \)</b></p>
<p><b></p><div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof), system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof));</div>
<div class="ttc" id="aclassSparseMatrix_html_a7706b5f721efc5ea1966f5a5cdaad0e6"><div class="ttname"><a href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">SparseMatrix::vmult</a></div><div class="ttdeci">void vmult(OutVector &amp;dst, const InVector &amp;src) const</div></div>
<div class="ttc" id="agroup__Exceptions_html_gae05a0e26814f032473ed2ef66da018bd"><div class="ttname"><a href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">BlockVectorBase::block</a></div><div class="ttdeci">BlockType &amp; block(const unsigned int i)</div></div>
<div class="ttc" id="agroup__Matrix1_html_ga1e54eb8c095bf2191a29c36a7784a5b6"><div class="ttname"><a href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">BlockMatrixBase::block</a></div><div class="ttdeci">BlockType &amp; block(const unsigned int row, const unsigned int column)</div></div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{B}}_{\widetilde{J}} = \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} \)</b></p>
<p><b></p><div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(B.block(J_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} \)</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) -= B.block(J_dof);</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{K}}^{-1}_{\widetilde{J} \widetilde{p}} [ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} ] \)</b></p>
<p><b></p><div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">Tvmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="ttc" id="aclassSparseMatrix_html_a224a78133e7b655e3a2c26647097c2c7"><div class="ttname"><a href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">SparseMatrix::Tvmult</a></div><div class="ttdeci">void Tvmult(OutVector &amp;dst, const InVector &amp;src) const</div></div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{u} = \mathsf{\mathbf{K}}_{u \widetilde{p}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{J} \widetilde{p}} [ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} ] \)</b></p>
<p><b></p><div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, p_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(u_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof));</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{F}}_{\text{con}} = \mathsf{\mathbf{F}}_{u} - \mathsf{\mathbf{K}}_{u \widetilde{p}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{J} \widetilde{p}} [ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} ] \)</b></p>
<p><b></p><div class="fragment"><div class="line">system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof) -= <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(u_dof);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"><span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;CG&quot;</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> solver_its = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line">      tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">      parameters.max_iterations_lin);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> tol_sol =</div>
<div class="line">      parameters.tol_lin * system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof).l2_norm();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(solver_its, tol_sol);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classGrowingVectorMemory.html">GrowingVectorMemory&lt;Vector&lt;double&gt;</a>&gt; GVM;</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; solver_CG(solver_control, GVM);</div>
<div class="ttc" id="aclassGrowingVectorMemory_html"><div class="ttname"><a href="classGrowingVectorMemory.html">GrowingVectorMemory</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2lac_2vector__memory_8h_source.html#l00313">vector_memory.h:314</a></div></div>
<div class="ttc" id="aclassSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__cg_8h_source.html#l00095">solver_cg.h:96</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00065">solver_control.h:66</a></div></div>
<div class="ttc" id="aclassSparseMatrix_html_acff5838afad6b9d4cc0c0eb5f6c515b5"><div class="ttname"><a href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">SparseMatrix::m</a></div><div class="ttdeci">size_type m() const</div></div>
</div><!-- fragment --><p></b></p>
<p><b>我们默认选择了SSOR预处理，因为它似乎为这个问题在单线程机器上提供了最快的求解器收敛特性。 然而，对于不同的问题规模，这可能不是真的。</b></p>
<p><b></p><div class="fragment"><div class="line">    <a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">      preconditioner(parameters.preconditioner_type,</div>
<div class="line">                     parameters.preconditioner_relaxation);</div>
<div class="line">    preconditioner.use_matrix(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    solver_CG.solve(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof),</div>
<div class="line">                    newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                    system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                    preconditioner);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    lin_it  = solver_control.last_step();</div>
<div class="line">    lin_res = solver_control.last_value();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;Direct&quot;</span>)</div>
<div class="line">  {</div>
<div class="ttc" id="aclassPreconditionSelector_html"><div class="ttname"><a href="classPreconditionSelector.html">PreconditionSelector</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition__selector_8h_source.html#l00100">precondition_selector.h:101</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>否则，如果问题足够小，可以利用直接求解器。</b></p>
<p><b></p><div class="fragment"><div class="line">      <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">      A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line">      A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                     system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      lin_it  = 1;</div>
<div class="line">      lin_res = 0.0;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Linear solver type not implemented&quot;</span>));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html"><div class="ttname"><a href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8h_source.html#l00087">sparse_direct.h:88</a></div></div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html_a25b1d3c7dbb88158a76165a4a56a16d6"><div class="ttname"><a href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">SparseDirectUMFPACK::initialize</a></div><div class="ttdeci">void initialize(const SparsityPattern &amp;sparsity_pattern)</div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8cc_source.html#l00049">sparse_direct.cc:49</a></div></div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html_adc154e4830b0e16be265f10a5c8b7103"><div class="ttname"><a href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">SparseDirectUMFPACK::vmult</a></div><div class="ttdeci">void vmult(Vector&lt; double &gt; &amp;dst, const Vector&lt; double &gt; &amp;src) const</div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8cc_source.html#l00762">sparse_direct.cc:762</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们有了位移更新，将约束条件分配回牛顿更新。</b></p>
<p><b></p><div class="fragment"><div class="line">constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot; PP &quot;</span> &lt;&lt; std::flush;</div>
<div class="ttc" id="aclassAffineConstraints_html_a7b3d3f295bb56d6cd6856bdc6cbe8a01"><div class="ttname"><a href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">AffineConstraints::distribute</a></div><div class="ttdeci">void distribute(VectorType &amp;vec) const</div></div>
</div><!-- fragment --><p></b></p>
<p><b>解决位移问题后的下一步是进行后处理，从置换中得到扩张解。 \( d \widetilde{\mathsf{\mathbf{J}}} = \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{p}} - \mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \bigr] \)</b></p>
<p><b></p><div class="fragment"><div class="line">{</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{p}} = \mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \)</b></p>
<p><b></p><div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, u_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof), newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof));</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{p}} = -\mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \)</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof) *= -1.0;</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{p}} = \mathsf{\mathbf{F}}_{\widetilde{p}} -\mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \)</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof) += system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
</div><!-- fragment --><p></b></p>
<p><b> \( d\mathsf{\mathbf{\widetilde{J}}} = \mathsf{\mathbf{K}}^{-1}_{\widetilde{p}\widetilde{J}} [ \mathsf{\mathbf{F}}_{\widetilde{p}} -\mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} ] \)</b></p>
<p><b></p><div class="fragment"><div class="line">  tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">    .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof));</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>我们在此确保任何迪里切特约束都分布在更新的解决方案上。</b></p>
<p><b></p><div class="fragment"><div class="line">constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
</div><!-- fragment --><p></b></p>
<p><b>最后我们用代入法求解压力的更新。 \( d \widetilde{\mathsf{\mathbf{p}}} = \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \bigr] \)</b></p>
<p><b></p><div class="fragment"><div class="line">{</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \)</b></p>
<p><b></p><div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof), newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof));</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{J}} = -\mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \)</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) *= -1.0;</div>
</div><!-- fragment --><p></b></p>
<p><b> \( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \)</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) += system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
</div><!-- fragment --><p></b></p>
<p><b>和最后.... \( d \widetilde{\mathsf{\mathbf{p}}} = \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \bigr] \)</b></p>
<p><b></p><div class="fragment"><div class="line">  tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">    .<a class="code" href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">Tvmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b>我们现在已经到了终点，所以我们将所有受限的道夫分配回牛顿更新。</b></p>
<p><b></p><div class="fragment"><div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; ------ &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;CG&quot;</span>)</div>
<div class="line">      {</div>
</div><!-- fragment --><p></b></p>
<p><b>在局部水平上手动凝结膨胀和压力场，以及随后的后处理，需要花费相当多的精力才能实现。简而言之，我们必须产生逆矩阵 \(\mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1}\) ，并将其永久写入全局切线矩阵中。然后我们对 \(\mathsf{\mathbf{K}}_{uu}\) 进行永久修改，产生 \(\mathsf{\mathbf{K}}_{\textrm{con}}\) 。这涉及到对切线矩阵局部子块的提取和处理。在对位移进行求解后，对扩张和压力进行求解所需的各个矩阵-向量操作被仔细地执行。将这些众多的步骤与使用LinearOperator类提供的功能的更简单和透明的实现进行对比。</b></p>
<p><b>为了便于以后使用，我们为RHS向量中的块定义了一些别名</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_u = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_p = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_J = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
</div><!-- fragment --><p></b></p>
<p><b>...以及牛顿更新向量中的块。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_u = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof);</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_p = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_J = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
</div><!-- fragment --><p></b></p>
<p><b>我们接下来为切线矩阵子块定义一些线性算子 我们将利用系统的对称性，所以不需要所有块。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_uu =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_up =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, p_dof));</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_pu =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, u_dof));</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_Jp =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof));</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_JJ =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof));</div>
<div class="ttc" id="agroup__LAOperators_html_ga6b74b7ed76e4aeea2c67c0bbb03e3e24"><div class="ttname"><a href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">LinearOperator::linear_operator</a></div><div class="ttdeci">LinearOperator&lt; Range, Domain, Payload &gt; linear_operator(const Matrix &amp;matrix)</div><div class="ttdef"><b>Definition:</b> <a href="linear__operator_8h_source.html#l01379">linear_operator.h:1379</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后我们构造一个线性算子，表示（方形块）的逆 \(\mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}\) 。由于它是对角线的（或者，当使用高阶解析时，几乎是对角线的），雅可比预处理器是合适的。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">  preconditioner_K_Jp_inv(<span class="stringliteral">&quot;jacobi&quot;</span>);</div>
<div class="line">preconditioner_K_Jp_inv.use_matrix(</div>
<div class="line">  tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof));</div>
<div class="line"><a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_Jp_inv(</div>
<div class="line">  <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                            parameters.max_iterations_lin),</div>
<div class="line">  1.0e-30,</div>
<div class="line">  parameters.tol_lin);</div>
<div class="line"><a class="code" href="classSolverSelector.html">SolverSelector&lt;Vector&lt;double&gt;</a>&gt; solver_K_Jp_inv;</div>
<div class="line">solver_K_Jp_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(<span class="stringliteral">&quot;cg&quot;</span>);</div>
<div class="line">solver_K_Jp_inv.<a class="code" href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">set_control</a>(solver_control_K_Jp_inv);</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_Jp_inv =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_Jp, solver_K_Jp_inv, preconditioner_K_Jp_inv);</div>
<div class="ttc" id="aclassReductionControl_html"><div class="ttname"><a href="classReductionControl.html">ReductionControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00423">solver_control.h:424</a></div></div>
<div class="ttc" id="aclassSolverSelector_html"><div class="ttname"><a href="classSolverSelector.html">SolverSelector</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__selector_8h_source.html#l00089">solver_selector.h:90</a></div></div>
<div class="ttc" id="aclassSolverSelector_html_a3da215c843356cdab3b603ce98991b53"><div class="ttname"><a href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">SolverSelector::select</a></div><div class="ttdeci">void select(const std::string &amp;name)</div><div class="ttdef"><b>Definition:</b> <a href="solver__selector_8h_source.html#l00258">solver_selector.h:258</a></div></div>
<div class="ttc" id="aclassSolverSelector_html_a5732b402440fb4d9494e431254b3b15e"><div class="ttname"><a href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">SolverSelector::set_control</a></div><div class="ttdeci">void set_control(SolverControl &amp;ctrl)</div><div class="ttdef"><b>Definition:</b> <a href="solver__selector_8h_source.html#l00311">solver_selector.h:311</a></div></div>
<div class="ttc" id="agroup__LAOperators_html_ga87e38fbde431397c069a88692bd24ae7"><div class="ttname"><a href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">LinearOperator::inverse_operator</a></div><div class="ttdeci">LinearOperator&lt; Domain, Range, Payload &gt; inverse_operator(const LinearOperator&lt; Range, Domain, Payload &gt; &amp;op, Solver &amp;solver, const Preconditioner &amp;preconditioner)</div><div class="ttdef"><b>Definition:</b> <a href="linear__operator_8h_source.html#l00701">linear_operator.h:701</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们可以构建 \(\mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1}\) 的转置和一个线性算子，表示凝结操作 \(\overline{\mathsf{\mathbf{K}}}\) 和 \(\overline{\overline{\mathsf{\mathbf{K}}}}\) 以及最后的增强矩阵 \(\mathsf{\mathbf{K}}_{\textrm{con}}\) 。请注意，schur_complement()算子在这里也能派上用场，但为了清楚起见，也为了展示线性求解方案的表述和实现之间的相似性，我们将手动执行这些操作。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_pJ_inv     = <a class="code" href="group__LAOperators.html#ga6bdc65fb2db56230e6bc7d545e81295d">transpose_operator</a>(K_Jp_inv);</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_pp_bar     = K_Jp_inv * K_JJ * K_pJ_inv;</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_uu_bar_bar = K_up * K_pp_bar * K_pu;</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con     = K_uu + K_uu_bar_bar;</div>
<div class="ttc" id="agroup__LAOperators_html_ga6bdc65fb2db56230e6bc7d545e81295d"><div class="ttname"><a href="group__LAOperators.html#ga6bdc65fb2db56230e6bc7d545e81295d">LinearOperator::transpose_operator</a></div><div class="ttdeci">LinearOperator&lt; Domain, Range, Payload &gt; transpose_operator(const LinearOperator&lt; Range, Domain, Payload &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="linear__operator_8h_source.html#l00660">linear_operator.h:660</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>最后，我们定义了一个增强刚度矩阵的逆运算，即 \(\mathsf{\mathbf{K}}_{\textrm{con}}^{-1}\) 。请注意，增强刚度矩阵的预处理程序与我们使用静态凝结的情况不同。在这种情况下，预处理程序是基于未修改的 \(\mathsf{\mathbf{K}}_{uu}\) ，而在第一种方法中，我们实际上修改了这个子块的条目。然而，由于 \(\mathsf{\mathbf{K}}_{\textrm{con}}\) 和 \(\mathsf{\mathbf{K}}_{uu}\) 在同一空间操作，它对这个问题仍然足够。</b></p>
<p><b></p><div class="fragment"><div class="line"><a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">  preconditioner_K_con_inv(parameters.preconditioner_type,</div>
<div class="line">                           parameters.preconditioner_relaxation);</div>
<div class="line">preconditioner_K_con_inv.use_matrix(</div>
<div class="line">  tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line"><a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_con_inv(</div>
<div class="line">  <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                            parameters.max_iterations_lin),</div>
<div class="line">  1.0e-30,</div>
<div class="line">  parameters.tol_lin);</div>
<div class="line"><a class="code" href="classSolverSelector.html">SolverSelector&lt;Vector&lt;double&gt;</a>&gt; solver_K_con_inv;</div>
<div class="line">solver_K_con_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(<span class="stringliteral">&quot;cg&quot;</span>);</div>
<div class="line">solver_K_con_inv.<a class="code" href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">set_control</a>(solver_control_K_con_inv);</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con_inv =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_uu_con,</div>
<div class="line">                   solver_K_con_inv,</div>
<div class="line">                   preconditioner_K_con_inv);</div>
</div><!-- fragment --><p></b></p>
<p><b>现在我们可以解决位移场的问题了。我们可以对线性运算进行嵌套，其结果立即被写入牛顿更新矢量。很明显，这个实现紧密地模仿了介绍中所说的推导。</b></p>
<p><b></p><div class="fragment"><div class="line">d_u =</div>
<div class="line">  K_uu_con_inv * (f_u - K_up * (K_Jp_inv * f_J - K_pp_bar * f_p));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
</div><!-- fragment --><p></b></p>
<p><b>需要对扩张场和压力场进行后处理的操作也同样容易表达。</b></p>
<p><b></p><div class="fragment"><div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; PP &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    d_J = K_pJ_inv * (f_p - K_pu * d_u);</div>
<div class="line">    d_p = K_Jp_inv * (f_J - K_JJ * d_J);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    lin_it  = solver_control_K_con_inv.last_step();</div>
<div class="line">    lin_res = solver_control_K_con_inv.last_value();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;Direct&quot;</span>)</div>
<div class="line">  {</div>
</div><!-- fragment --><p></b></p>
<p><b>用直接求解器求解全块系统。由于它是相对稳健的，它可能对因零 \(\mathsf{\mathbf{K}}_{ \widetilde{J} \widetilde{J}}\) 块的存在而产生的问题免疫。</b></p>
<p><b></p><div class="fragment"><div class="line">    <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">    A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(tangent_matrix);</div>
<div class="line">    A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(newton_update, system_rhs);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    lin_it  = 1;</div>
<div class="line">    lin_res = 0.0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; -- &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Linear solver type not implemented&quot;</span>));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
</div><!-- fragment --><p></b></p>
<p><b>最后，我们在此再次确保任何Dirichlet约束都分布在更新的解上。</b></p>
<p><b></p><div class="fragment"><div class="line">      constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> std::make_pair(lin_it, lin_res);</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Solidoutput_results"></a> </p><h4>Solid::output_results</h4>
<p></b></p>
<p><b> 这里我们介绍了如何将结果写入文件，以便使用ParaView或Viscit查看。该方法与以前的教程中显示的方法类似，因此将不作详细讨论。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    data_component_interpretation(</div>
<div class="line">      dim, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;std::string&gt; solution_name(dim, <span class="stringliteral">&quot;displacement&quot;</span>);</div>
<div class="line">  solution_name.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line">  solution_name.emplace_back(<span class="stringliteral">&quot;dilatation&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> output_flags;</div>
<div class="line">  output_flags.<a class="code" href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">write_higher_order_cells</a> = <span class="keyword">true</span>;</div>
<div class="line">  data_out.<a class="code" href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">set_flags</a>(output_flags);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_n,</div>
<div class="line">                           solution_name,</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                           data_component_interpretation);</div>
<div class="ttc" id="aclassDataOut__DoFData_html_ac1eb26168177faa30ffbcf9cbb9c3cd5"><div class="ttname"><a href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandlerType &amp;)</div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_ace4b76e565ba0701c4d32c26075ed3b9"><div class="ttname"><a href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="data__out__dof__data_8h_source.html#l01087">data_out_dof_data.h:1087</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8h_source.html#l00147">data_out.h:150</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gaa9dd1830c0ff35a2431704c4d45453eb"><div class="ttname"><a href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">DataOutBase::VtkFlags::write_higher_order_cells</a></div><div class="ttdeci">bool write_higher_order_cells</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01170">data_out_base.h:1170</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gac7280a24690b117454acfb0fa058299c"><div class="ttname"><a href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">DataOutInterface::set_flags</a></div><div class="ttdeci">void set_flags(const FlagType &amp;flags)</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l08166">data_out_base.cc:8166</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a></div><div class="ttdeci">@ component_is_scalar</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00053">data_component_interpretation.h:53</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a></div><div class="ttdeci">@ component_is_part_of_vector</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00059">data_component_interpretation.h:59</a></div></div>
<div class="ttc" id="astructDataOutBase_1_1VtkFlags_html"><div class="ttname"><a href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a></div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01087">data_out_base.h:1088</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>由于我们要处理的是一个大的变形问题，如果能在一个位移网格上显示结果就更好了 与DataOut类相连的MappingQEulerian类提供了一个接口，通过该接口可以实现这一目的，而不需要我们自己物理性地移动三角测量对象中的网格点。 我们首先需要将解决方案复制到一个临时矢量，然后创建欧拉映射。我们还向DataOut对象指定了多项式的程度，以便在使用高阶多项式时产生更精细的输出数据集。</b></p>
<p><b></p><div class="fragment"><div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> soln(solution_n.<a class="code" href="group__Exceptions.html#ga69b8dc1f71903659eb44f12e02359ac6">size</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; soln.size(); ++i)</div>
<div class="line">      soln(i) = solution_n(i);</div>
<div class="line">    <a class="code" href="classMappingQEulerian.html">MappingQEulerian&lt;dim&gt;</a> q_mapping(degree, dof_handler, soln);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>(q_mapping, degree);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::ofstream output(<span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(dim) + <span class="stringliteral">&quot;d-&quot;</span> +</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(time.get_timestep()) + <span class="stringliteral">&quot;.vtu&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace Step44</span></div>
<div class="ttc" id="aclassDataOut_html_a5eb51872b8736849bb7e8d2007fae086"><div class="ttname"><a href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01085">data_out.cc:1085</a></div></div>
<div class="ttc" id="aclassMappingQEulerian_html"><div class="ttname"><a href="classMappingQEulerian.html">MappingQEulerian</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q__eulerian_8h_source.html#l00093">mapping_q_eulerian.h:94</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga69b8dc1f71903659eb44f12e02359ac6"><div class="ttname"><a href="group__Exceptions.html#ga69b8dc1f71903659eb44f12e02359ac6">BlockVectorBase::size</a></div><div class="ttdeci">std::size_t size() const</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga72743302dcb1a0fb1f2f8dc5122d299e"><div class="ttname"><a href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">Patterns::Tools::to_string</a></div><div class="ttdeci">std::string to_string(const T &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l02329">patterns.h:2329</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga93c780f93105e0daaa76c6c43694b4ae"><div class="ttname"><a href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">DataOutInterface::write_vtu</a></div><div class="ttdeci">void write_vtu(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07188">data_out_base.cc:7188</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Mainfunction"></a> </p><h3>Main function</h3>
<p></b></p>
<p><b> 最后，我们提供了主要的驱动函数，它看起来与其他教程没有什么不同。</b></p>
<p><b></p><div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span>Step44;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 3;</div>
<div class="line">      Solid&lt;dim&gt;         solid(<span class="stringliteral">&quot;parameters.prm&quot;</span>);</div>
<div class="line">      solid.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p></b></p>
<p><b><a class="anchor" id="Results"></a> </p><h1>Results</h1>
<p></b></p>
<p><b></b></p>
<p><b>首先，我们介绍了一系列3-d结果与文献中的结果的比较（见Reese等人（2000）），以证明该程序按预期工作。</b></p>
<p><b>我们首先比较了 \(Q_1-DGPM_0-DGPM_0\) 和 \(Q_2-DGPM_1-DGPM_1\) 公式随着网格细化的收敛性，如下图所总结的。块的上表面的中点的垂直位移被用来评估收敛性。对于不同的载荷参数值 \(p/p_0\) ，两种方案都表现出良好的收敛特性。这些结果与文献中的结果一致。低阶公式通常高估了低层次细化的位移，而高阶插值方案则低估了位移，但程度较轻。这个基准，以及其他一系列没有在这里显示的基准，给了我们信心，代码正在按照它应该的方式工作。</b></p>
<p><b> </p><table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q1-P0_convergence.png" alt="" class="inline"/> </p>
<p class="intertd">Convergence of the \(Q_1-DGPM_0-DGPM_0\) formulation in 3-d. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q2-P1_convergence.png" alt="" class="inline"/> </p>
<p class="intertd">Convergence of the \(Q_2-DGPM_1-DGPM_1\) formulation in 3-d. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p><br  />
</b></p>
<p><b>下面是运行该问题产生的典型屏幕输出。所展示的特殊情况是 \(Q_2-DGPM_1-DGPM_1\) 公式的情况。很明显，使用牛顿-拉弗森方法，可以得到二次收敛的解决方案。在所有的时间步长中，解的收敛是在5个牛顿增量内实现的。收敛后的位移的 \(L_2\) -norm比几何尺度小几个数量级。</b></p>
<p><b></p><div class="fragment"><div class="line">Grid:</div>
<div class="line">         Reference <a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">volume</a>: 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-09</div>
<div class="line"><a class="code" href="namespaceparallel.html#a36161bdee34defd46d214e5098ac1a5e">Triangulation</a>:</div>
<div class="line">         Number of active cells: 64</div>
<div class="line">         Number of degrees of freedom: 2699</div>
<div class="line">    Setting up quadrature <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> data...</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Timestep 1 @ 0.1s</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">                 SOLVER STEP                   |  LIN_IT   LIN_RES    RES_NORM     RES_U     RES_P      RES_J     NU_NORM      NU_U       NU_P       NU_J</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">  0  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     786  2.118e-06  1.000e+00  1.000e+00  0.000e+00  0.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00</div>
<div class="line">  1  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     552  1.031e-03  8.563e-02  8.563e-02  9.200e-13  3.929e-08  1.060e-01  3.816e-02  1.060e-01  1.060e-01</div>
<div class="line">  2  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     667  5.602e-06  2.482e-03  2.482e-03  3.373e-15  2.982e-10  2.936e-03  2.053e-04  2.936e-03  2.936e-03</div>
<div class="line">  3  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     856  6.469e-10  2.129e-06  2.129e-06  2.245e-19  1.244e-13  1.887e-06  7.289e-07  1.887e-06  1.887e-06</div>
<div class="line">  4  ASM_R  CONVERGED!</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">Relative errors:</div>
<div class="line">Displacement:   7.289e-07</div>
<div class="line">Force:          2.451e-10</div>
<div class="line">Dilatation:     1.353e-07</div>
<div class="line">v / V_0:        1.000e-09 / 1.000e-09 = 1.000e+00</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[...]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Timestep 10 @ 1.000e+00s</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">                 SOLVER STEP                   |  LIN_IT   LIN_RES    RES_NORM     RES_U     RES_P      RES_J     NU_NORM      NU_U       NU_P       NU_J</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">  0  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     874  2.358e-06  1.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00</div>
<div class="line">  1  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     658  2.942e-04  1.544e-01  1.544e-01  1.208e+13  1.855e+06  6.014e-02  7.398e-02  6.014e-02  6.014e-02</div>
<div class="line">  2  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     790  2.206e-06  2.908e-03  2.908e-03  7.302e+10  2.067e+03  2.716e-03  1.433e-03  2.716e-03  2.717e-03</div>
<div class="line">  3  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     893  2.374e-09  1.919e-06  1.919e-06  4.527e+07  4.100e+00  1.672e-06  6.842e-07  1.672e-06  1.672e-06</div>
<div class="line">  4  ASM_R  CONVERGED!</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">Relative errors:</div>
<div class="line">Displacement:   6.842e-07</div>
<div class="line">Force:          8.995e-10</div>
<div class="line">Dilatation:     1.528e-06</div>
<div class="line">v / V_0:        1.000e-09 / 1.000e-09 = 1.000e+00</div>
<div class="ttc" id="anamespaceOpenCASCADE_html_a7b0b2393711bae58d859be1bb9761781"><div class="ttname"><a href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">OpenCASCADE::point</a></div><div class="ttdeci">Point&lt; spacedim &gt; point(const gp_Pnt &amp;p, const double tolerance=1e-10)</div><div class="ttdef"><b>Definition:</b> <a href="opencascade_2utilities_8cc_source.html#l00188">utilities.cc:188</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="anamespaceparallel_html_a36161bdee34defd46d214e5098ac1a5e"><div class="ttname"><a href="namespaceparallel.html#a36161bdee34defd46d214e5098ac1a5e">parallel::Triangulation</a></div><div class="ttdeci">TriangulationBase&lt; dim, spacedim &gt; Triangulation</div><div class="ttdef"><b>Definition:</b> <a href="tria__base_8h_source.html#l00396">tria_base.h:396</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>使用定时器类，我们可以分辨出代码的哪些部分需要最高的计算费用。对于一个有大量自由度的案例（即高度精细化），下面给出了定时器的典型输出。本教程中的大部分代码都是基于 <a class="el" href="step_18.html">step-18</a> 和其他文献中描述、讨论和演示的优化而开发的。超过93的时间花在线性求解器上，很明显，对于大型三维问题，可能有必要投资一个更好的求解器。SSOR预处理程序不是多线程的，但对于这类实体问题是有效的。研究使用另一种求解器可能是有益的，比如通过Trilinos库提供的那些求解器。</b></p>
<p><b></p><div class="fragment"><div class="line">+---------------------------------------------+------------+------------+</div>
<div class="line">| Total wallclock time elapsed since start    | 9.874e+02s |            |</div>
<div class="line">|                                             |            |            |</div>
<div class="line">| Section                         | no. calls |  wall time | % of total |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">| Assemble system right-hand side |        53 | 1.727e+00s |  1.75e-01% |</div>
<div class="line">| Assemble tangent <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a>         |        43 | 2.707e+01s |  2.74e+00% |</div>
<div class="line">| Linear solver                   |        43 | 9.248e+02s |  9.37e+01% |</div>
<div class="line">| Linear solver postprocessing    |        43 | 2.743e-02s |  2.78e-03% |</div>
<div class="line">| Perform <span class="keyword">static</span> condensation     |        43 | 1.437e+01s |  1.46e+00% |</div>
<div class="line">| Setup system                    |         1 | 3.897e-01s |  3.95e-02% |</div>
<div class="line">| Update QPH data                 |        43 | 5.770e-01s |  5.84e-02% |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="ttc" id="anamespaceLAPACKSupport_html_a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003"><div class="ttname"><a href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">LAPACKSupport::matrix</a></div><div class="ttdeci">@ matrix</div><div class="ttdoc">Contents is actually a matrix.</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00058">lapack_support.h:58</a></div></div>
</div><!-- fragment --><p></b></p>
<p><b>然后，我们使用ParaView对两种情况的结果进行了可视化。第一个是最粗的网格和最低阶插值方法。 \(Q_1-DGPM_0-DGPM_0\) . 第二种是在细化网格上使用 \(Q_2-DGPM_1-DGPM_1\) 公式。位移的垂直分量、压力 \(\widetilde{p}\) 和扩张 \(\widetilde{J}\) 场显示如下。</b></p>
<p><b>对于第一种情况，很明显，粗略的空间离散化加上大的位移导致了低质量的解决方案（负载率为 \(p/p_0=80\) ）。此外，元素之间的压力差非常大。元素上的恒定压力场意味着大的压力梯度没有被捕获。然而，应该注意的是，即使在这种离散性差的情况下，在标准 \(Q_1\) 位移公式中会出现的锁定现象也不会出现。块体顶面的跟踪节点的最终垂直位移仍在收敛解的12.5以内。压力解决方案是非常粗略的，在相邻的单元之间有很大的跳跃。很明显，离施加的牵引力最近的体积经历了压缩，而域的外延则处于膨胀状态。膨胀解场和压力场明显相关，正的膨胀表示正压区域，负的表示压缩区域。正如介绍中所讨论的，压缩性压力有一个负号，而扩张性压力有一个正号。这源于体积应变能量函数的定义，与压力的物理现实解释相反。</b></p>
<p><b> </p><table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q1-P0_gr_1_p_ratio_80-displacement.png" alt="" class="inline"/> </p>
<p class="intertd">Z-displacement solution for the 3-d problem. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q1-P0_gr_1_p_ratio_80-pressure.png" alt="" class="inline"/> </p>
<p class="intertd">Discontinuous piece-wise constant pressure field. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q1-P0_gr_1_p_ratio_80-dilatation.png" alt="" class="inline"/> </p>
<p class="intertd">Discontinuous piece-wise constant dilatation field. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p><br  />
</b></p>
<p><b>结合空间细化和高阶插值方案可以得到高质量的解决方案。三个网格细化加上 \(Q_2-DGPM_1-DGPM_1\) 公式产生的结果清楚地抓住了问题的力学原理。牵引面的变形得到了很好的解决。我们现在可以观察到所施加的牵引力的实际范围，最大的力被施加在表面的中心点，造成最大的压缩。尽管领域中出现了很高的应变，特别是在施加牵引力的区域的边界，但解决方案仍然是准确的。压力场被捕捉到的细节比以前多得多。压缩和膨胀区域之间有明显的区别和过渡，压力场的线性近似允许在子元素尺度上对压力进行精细的可视化。然而，应该注意的是，压力场仍然是不连续的，可以在一个连续的网格上进行平滑处理，以达到后处理的目的。</b></p>
<p><b> </p><table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q2-P1_gr_3_p_ratio_80-displacement.png" alt="" class="inline"/> </p>
<p class="intertd">Z-displacement solution for the 3-d problem. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q2-P1_gr_3_p_ratio_80-pressure.png" alt="" class="inline"/> </p>
<p class="intertd">Discontinuous linear pressure field. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q2-P1_gr_3_p_ratio_80-dilatation.png" alt="" class="inline"/> </p>
<p class="intertd">Discontinuous linear dilatation field. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p><br  />
</b></p>
<p><b>对结果的这一简要分析表明，三场公式能有效地规避高度不可压缩介质的体积锁定问题。混合公式能够准确模拟近乎不可压缩的块体在压缩状态下的位移。命令行输出表明，在泊松比为0.4999的情况下，极端压缩下的体积变化导致体积变化小于0.01。</b></p>
<p><b>在运行时间方面，对于类似的自由度数量， \(Q_2-DGPM_1-DGPM_1\) 公式往往比 \(Q_1-DGPM_0-DGPM_0\) 的计算成本更高（通过为低阶插值增加一个额外的网格细化级别产生）。下图显示了在一台4核（8线程）机器上连续运行的一批测试的情况。高阶方法计算时间的增加可能是由于高阶元素所需的带宽增加。如前所述，使用更好的求解器和预处理程序可以减轻使用高阶公式的费用。据观察，对于给定的问题，与单线程的SSOR预处理程序相比，使用多线程的Jacobi预处理程序可以减少72的计算运行时间（在最坏的情况下是具有大量自由度的高阶公式）。然而，根据作者的经验，雅可比预处理方法可能不适合某些涉及替代构成模型的有限应变问题。</b></p>
<p><b> </p><table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Normalised_runtime.png" alt="" class="inline"/> </p>
<p class="intertd">Runtime on a 4-core machine, normalised against the lowest grid resolution \(Q_1-DGPM_0-DGPM_0\) solution that utilised a SSOR preconditioner. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p><br  />
</b></p>
<p><b>最后，下面展示了两个不同级别的网格细化的2维问题的位移解结果。很明显，由于二维模拟的额外约束，所产生的位移场虽然在质量上相似，但与三维模拟的情况不同。</b></p>
<p><b> </p><table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.2d-gr_2.png" alt="" class="inline"/> </p>
<p class="intertd">Y-displacement solution in 2-d for 2 global grid refinement levels. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.2d-gr_5.png" alt="" class="inline"/> </p>
<p class="intertd">Y-displacement solution in 2-d for 5 global grid refinement levels. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p><br  />
</b></p>
<p><b><a class="anchor" id="extensions"></a> <a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p></b></p>
<p><b></b></p>
<p><b>这项工作有一些明显的扩展。</b></p>
<p><b></p><ul>
<li>首先，可以在自由能函数中加入一个额外的约束条件，以便在材料中强制执行高度的不可压缩性。一个额外的拉格朗日乘数将被引入，但这可以最容易地使用增强的拉格朗日乘数的原则来处理。这在 <em> Simo和Taylor (1991) </em> 中得到了证明。</li>
<li>这个模型中使用的构成关系是比较基本的。将材料类分成两个独立的类，一个处理体积响应，另一个处理等熵响应，并产生一个通用的材料类（即有抽象的虚拟函数，派生类必须实现），允许增加更复杂的材料模型，这可能是有益的。这种模型可以包括其他超弹性材料、塑性和粘弹性材料以及其他材料。</li>
<li>该程序是为解决单节点多核机器上的问题而开发的。只要稍加努力，该程序就可以通过使用Petsc或Trilinos扩展到大规模的计算环境，使用的技术与 <a class="el" href="step_40.html">step-40</a> 中演示的类似。这主要涉及对设置、装配、 <code>PointHistory</code> 和线性求解器程序的修改。</li>
<li>由于该程序假定为准静态平衡，为了研究惯性效应重要的问题，例如涉及冲击的问题，有必要进行扩展以包括动态效应。</li>
<li>对于高度非线性的问题，负载和解决方案的限制程序可能是必要的。有可能增加一个线搜索算法，将步长限制在牛顿增量内，以确保最佳收敛性。也可能需要使用负载限制方法，如Riks方法，来解决涉及几何不稳定性的不稳定问题，如屈曲和快穿。</li>
<li>许多物理问题涉及接触。有可能将物体之间的摩擦或无摩擦接触的影响纳入这个程序。这将涉及到在自由能函数中增加一个额外的项，因此需要增加装配程序。我们还需要管理接触问题（检测和应力计算）本身。在自由能函数中增加惩罚项的一个替代方法是使用主动集方法，如 <a class="el" href="step_41.html">step-41</a> 中使用的方法。</li>
<li>使用LinearOperators的完整凝结程序已经被编码到线性求解器例程中。这也可以通过应用schur_complement()操作符来实现，以更自动化的方式缩减一个或多个场。</li>
<li>最后，自适应网格细化，如 step-6 和 step-18 所示，可以提供额外的求解精度。<a class="anchor" id="PlainProg"></a> <h1>The plain program</h1>
</li>
</ul>
<p></b></p>
<p><b> </p><div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2010 - 2020 by the deal.II authors and</span></div>
<div class="line"><span class="comment"> *                              &amp; Jean-Paul Pelteret and Andrew McBride</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Authors: Jean-Paul Pelteret, University of Cape Town,</span></div>
<div class="line"><span class="comment"> *          Andrew McBride, University of Erlangen-Nuremberg, 2010</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2point_8h.html">deal.II/base/point.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="symmetric__tensor_8h.html">deal.II/base/symmetric_tensor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tensor_8h.html">deal.II/base/tensor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="work__stream_8h.html">deal.II/base/work_stream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__point__data_8h.html">deal.II/base/quadrature_point_data.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__dgp__monomial_8h.html">deal.II/fe/fe_dgp_monomial.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__tools_8h.html">deal.II/fe/fe_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mapping__q__eulerian_8h.html">deal.II/fe/mapping_q_eulerian.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__sparse__matrix_8h.html">deal.II/lac/block_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition__selector_8h.html">deal.II/lac/precondition_selector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__selector_8h.html">deal.II/lac/solver_selector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__direct_8h.html">deal.II/lac/sparse_direct.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="linear__operator_8h.html">deal.II/lac/linear_operator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="packaged__operation_8h.html">deal.II/lac/packaged_operation.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kinematics_8h.html">deal.II/physics/elasticity/kinematics.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="standard__tensors_8h.html">deal.II/physics/elasticity/standard_tensors.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step44</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">namespace </span>Parameters</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="classFESystem.html">FESystem</a></div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly_degree;</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> quad_order;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> FESystem::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;Displacement system polynomial order&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;3&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;Gauss quadrature order&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> FESystem::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        poly_degree = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>);</div>
<div class="line">        quad_order  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Geometry</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> global_refinement;</div>
<div class="line">      <span class="keywordtype">double</span>       <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>;</div>
<div class="line">      <span class="keywordtype">double</span>       p_p0;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Geometry::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;Global refinement level&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-3&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Global grid scaling factor&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Pressure ratio p/p0&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;100&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;20|40|60|80|100&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;Ratio of applied pressure to reference pressure&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Geometry::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        global_refinement = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>);</div>
<div class="line">        <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>);</div>
<div class="line">        p_p0              = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Pressure ratio p/p0&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Materials</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">double</span> nu;</div>
<div class="line">      <span class="keywordtype">double</span> <a class="code" href="namespacemu.html">mu</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Materials::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.4999&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(-1.0, 0.5),</div>
<div class="line">                          <span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Shear modulus&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;80.194e6&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Shear modulus&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Materials::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        nu = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div>
<div class="line">        <a class="code" href="namespacemu.html">mu</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Shear modulus&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>LinearSolver</div>
<div class="line">    {</div>
<div class="line">      std::string type_lin;</div>
<div class="line">      <span class="keywordtype">double</span>      tol_lin;</div>
<div class="line">      <span class="keywordtype">double</span>      max_iterations_lin;</div>
<div class="line">      <span class="keywordtype">bool</span>        use_static_condensation;</div>
<div class="line">      std::string preconditioner_type;</div>
<div class="line">      <span class="keywordtype">double</span>      preconditioner_relaxation;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> LinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Solver type&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;CG&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;CG|Direct&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;Type of solver used to solve the linear system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Residual&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-6&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Linear solver residual (scaled by residual norm)&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">          <span class="stringliteral">&quot;Max iteration multiplier&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">          <span class="stringliteral">&quot;Linear solver iterations (multiples of the system matrix size)&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Use static condensation&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Solve the full block system or a reduced problem&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Preconditioner type&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;ssor&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;jacobi|ssor&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;Type of preconditioner&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Preconditioner relaxation&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.65&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Preconditioner relaxation value&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> LinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        type_lin                  = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Solver type&quot;</span>);</div>
<div class="line">        tol_lin                   = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line">        max_iterations_lin        = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Max iteration multiplier&quot;</span>);</div>
<div class="line">        use_static_condensation   = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Use static condensation&quot;</span>);</div>
<div class="line">        preconditioner_type       = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Preconditioner type&quot;</span>);</div>
<div class="line">        preconditioner_relaxation = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Preconditioner relaxation&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>NonlinearSolver</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iterations_NR;</div>
<div class="line">      <span class="keywordtype">double</span>       tol_f;</div>
<div class="line">      <span class="keywordtype">double</span>       tol_u;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> NonlinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;10&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;Number of Newton-Raphson iterations allowed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1.0e-9&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Force residual tolerance&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1.0e-6&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Displacement error tolerance&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> NonlinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        max_iterations_NR = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>);</div>
<div class="line">        tol_f             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>);</div>
<div class="line">        tol_u             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Time</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">double</span> delta_t;</div>
<div class="line">      <span class="keywordtype">double</span> end_time;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Time::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;End time&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(), <span class="stringliteral">&quot;End time&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Time step size&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Time step size&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Time::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        end_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;End time&quot;</span>);</div>
<div class="line">        delta_t  = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Time step size&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> <a class="code" href="classFESystem.html">FESystem</a>,</div>
<div class="line">                           <span class="keyword">public</span> Geometry,</div>
<div class="line">                           <span class="keyword">public</span> Materials,</div>
<div class="line">                           <span class="keyword">public</span> LinearSolver,</div>
<div class="line">                           <span class="keyword">public</span> NonlinearSolver,</div>
<div class="line">                           <span class="keyword">public</span> Time</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      AllParameters(<span class="keyword">const</span> std::string &amp;input_file);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    AllParameters::AllParameters(<span class="keyword">const</span> std::string &amp;input_file)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">      declare_parameters(prm);</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_file);</div>
<div class="line">      parse_parameters(prm);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> AllParameters::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      FESystem::declare_parameters(prm);</div>
<div class="line">      Geometry::declare_parameters(prm);</div>
<div class="line">      Materials::declare_parameters(prm);</div>
<div class="line">      LinearSolver::declare_parameters(prm);</div>
<div class="line">      NonlinearSolver::declare_parameters(prm);</div>
<div class="line">      Time::declare_parameters(prm);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> AllParameters::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      FESystem::parse_parameters(prm);</div>
<div class="line">      Geometry::parse_parameters(prm);</div>
<div class="line">      Materials::parse_parameters(prm);</div>
<div class="line">      LinearSolver::parse_parameters(prm);</div>
<div class="line">      NonlinearSolver::parse_parameters(prm);</div>
<div class="line">      Time::parse_parameters(prm);</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// namespace Parameters</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">class </span>Time</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Time(<span class="keyword">const</span> <span class="keywordtype">double</span> time_end, <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t)</div>
<div class="line">      : timestep(0)</div>
<div class="line">      , time_current(0.0)</div>
<div class="line">      , time_end(time_end)</div>
<div class="line">      , delta_t(delta_t)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> ~Time() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> current()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> time_current;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> time_end;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> get_delta_t()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> delta_t;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> get_timestep()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> timestep;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">void</span> increment()</div>
<div class="line">    {</div>
<div class="line">      time_current += delta_t;</div>
<div class="line">      ++timestep;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep;</div>
<div class="line">    <span class="keywordtype">double</span>       time_current;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> time_end;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>Material_Compressible_Neo_Hook_Three_Field</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Material_Compressible_Neo_Hook_Three_Field(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacemu.html">mu</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> nu)</div>
<div class="line">      : kappa((2.0 * <a class="code" href="namespacemu.html">mu</a> * (1.0 + nu)) / (3.0 * (1.0 - 2.0 * nu)))</div>
<div class="line">      , c_1(<a class="code" href="namespacemu.html">mu</a> / 2.0)</div>
<div class="line">      , det_F(1.0)</div>
<div class="line">      , p_tilde(0.0)</div>
<div class="line">      , J_tilde(1.0)</div>
<div class="line">      , b_bar(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(kappa &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> update_material_data(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>          p_tilde_in,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>          J_tilde_in)</div>
<div class="line">    {</div>
<div class="line">      det_F                      = <a class="code" href="symmetric__tensor_8h.html#a31fa20712aae4f3b8ab9f62729b464d3">determinant</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_bar = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae8c571720db885e3636e396f6e153317">Physics::Elasticity::Kinematics::F_iso</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">      b_bar                      = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">Physics::Elasticity::Kinematics::b</a>(F_bar);</div>
<div class="line">      p_tilde                    = p_tilde_in;</div>
<div class="line">      J_tilde                    = J_tilde_in;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(det_F &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau()</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> get_tau_iso() + get_tau_vol();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> get_Jc_vol() + get_Jc_iso();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_dPsi_vol_dJ()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> (kappa / 2.0) * (J_tilde - 1.0 / J_tilde);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_d2Psi_vol_dJ2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> ((kappa / 2.0) * (1.0 + 1.0 / (J_tilde * J_tilde)));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_det_F()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> det_F;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_p_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> p_tilde;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_J_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> J_tilde;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> kappa;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> c_1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span>                  det_F;</div>
<div class="line">    <span class="keywordtype">double</span>                  p_tilde;</div>
<div class="line">    <span class="keywordtype">double</span>                  J_tilde;</div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> b_bar;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_vol()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> p_tilde * det_F * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_iso()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * get_tau_bar();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_bar()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> 2.0 * c_1 * b_bar;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_vol()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> p_tilde * det_F *</div>
<div class="line">             (<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::IxI</a> -</div>
<div class="line">              (2.0 * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::S</a>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_iso()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_bar = get_tau_bar();</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_iso = get_tau_iso();</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> tau_iso_x_I =</div>
<div class="line">        <a class="code" href="symmetric__tensor_8h.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a>(tau_iso, <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>);</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> I_x_tau_iso =</div>
<div class="line">        <a class="code" href="symmetric__tensor_8h.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a>(<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>, tau_iso);</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> c_bar = get_c_bar();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> (2.0 / dim) * <a class="code" href="symmetric__tensor_8h.html#a4248760c880275bab1f288fc80f27039">trace</a>(tau_bar) *</div>
<div class="line">               <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> -</div>
<div class="line">             (2.0 / dim) * (tau_iso_x_I + I_x_tau_iso) +</div>
<div class="line">             <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * c_bar *</div>
<div class="line">               <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_c_bar()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a>();</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>PointHistory</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    PointHistory()</div>
<div class="line">      : F_inv(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div>
<div class="line">      , tau(<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt;())</div>
<div class="line">      , d2Psi_vol_dJ2(0.0)</div>
<div class="line">      , dPsi_vol_dJ(0.0)</div>
<div class="line">      , Jc(<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;4, dim&gt;())</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> ~PointHistory() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_lqp(<span class="keyword">const</span> Parameters::AllParameters &amp;parameters)</div>
<div class="line">    {</div>
<div class="line">      material =</div>
<div class="line">        std::make_shared&lt;Material_Compressible_Neo_Hook_Three_Field&lt;dim&gt;&gt;(</div>
<div class="line">          parameters.mu, parameters.nu);</div>
<div class="line">      <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>(<a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a>(), 0.0, 1.0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;Grad_u_n,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">double</span>          p_tilde,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">double</span>          J_tilde)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a> = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a>(Grad_u_n);</div>
<div class="line">      material-&gt;update_material_data(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>, p_tilde, J_tilde);</div>
<div class="line"> </div>
<div class="line">      F_inv         = <a class="code" href="symmetric__tensor_8h.html#a3656e2f6095f612536b06139a6a2ca39">invert</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">      tau           = material-&gt;get_tau();</div>
<div class="line">      Jc            = material-&gt;get_Jc();</div>
<div class="line">      dPsi_vol_dJ   = material-&gt;get_dPsi_vol_dJ();</div>
<div class="line">      d2Psi_vol_dJ2 = material-&gt;get_d2Psi_vol_dJ2();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_J_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> material-&gt;get_J_tilde();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_det_F()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> material-&gt;get_det_F();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;get_F_inv()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> F_inv;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_p_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> material-&gt;get_p_tilde();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;get_tau()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> tau;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_dPsi_vol_dJ()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> dPsi_vol_dJ;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_d2Psi_vol_dJ2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> d2Psi_vol_dJ2;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> &amp;get_Jc()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> Jc;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    std::shared_ptr&lt;Material_Compressible_Neo_Hook_Three_Field&lt;dim&gt;&gt; material;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau;</div>
<div class="line">    <span class="keywordtype">double</span>                  d2Psi_vol_dJ2;</div>
<div class="line">    <span class="keywordtype">double</span>                  dPsi_vol_dJ;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>Solid</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Solid(<span class="keyword">const</span> std::string &amp;input_file);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">struct </span>PerTaskData_ASM;</div>
<div class="line">    <span class="keyword">struct </span>ScratchData_ASM;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>PerTaskData_SC;</div>
<div class="line">    <span class="keyword">struct </span>ScratchData_SC;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>PerTaskData_UQPH;</div>
<div class="line">    <span class="keyword">struct </span>ScratchData_UQPH;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> make_grid();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> system_setup();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> determine_component_extractors();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> it_nr);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system_one_cell(</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">      ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">      PerTaskData_ASM &amp;                                     data) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_sc();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_sc_one_cell(</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">      ScratchData_SC &amp;                                      scratch,</div>
<div class="line">      PerTaskData_SC &amp;                                      data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> copy_local_to_global_sc(<span class="keyword">const</span> PerTaskData_SC &amp;data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_qph();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> update_qph_incremental(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> update_qph_incremental_one_cell(</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">      ScratchData_UQPH &amp;                                    scratch,</div>
<div class="line">      PerTaskData_UQPH &amp;                                    data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> copy_local_to_global_UQPH(<span class="keyword">const</span> PerTaskData_UQPH &amp; <span class="comment">/*data*/</span>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> solve_nonlinear_timestep(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta);</div>
<div class="line"> </div>
<div class="line">    std::pair&lt;unsigned int, double&gt;</div>
<div class="line">    solve_linear_system(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a></div>
<div class="line">    get_total_solution(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    Parameters::AllParameters parameters;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> vol_reference;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line"> </div>
<div class="line">    Time                time;</div>
<div class="line">    <span class="keyword">mutable</span> <a class="code" href="classTimerOutput.html">TimerOutput</a> timer;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classCellDataStorage.html">CellDataStorage&lt;typename Triangulation&lt;dim&gt;::cell_iterator</a>,</div>
<div class="line">                    PointHistory&lt;dim&gt;&gt;</div>
<div class="line">      quadrature_point_history;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               degree;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>              fe;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>                  dof_handler;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               dofs_per_cell;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> u_fe;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> p_fe;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> J_fe;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>          = 3;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_components      = dim + 2;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_u_component = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p_component       = dim;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> J_component       = dim + 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span></div>
<div class="line">    {</div>
<div class="line">      u_dof = 0,</div>
<div class="line">      p_dof = 1,</div>
<div class="line">      J_dof = 2</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; dofs_per_block;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; element_indices_u;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; element_indices_p;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; element_indices_J;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     qf_cell;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt; qf_face;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points_f;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line">    <a class="code" href="classBlockSparsityPattern.html">BlockSparsityPattern</a>      sparsity_pattern;</div>
<div class="line">    <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> tangent_matrix;</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a>       system_rhs;</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a>       solution_n;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Errors</div>
<div class="line">    {</div>
<div class="line">      Errors()</div>
<div class="line">        : <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a>(1.0)</div>
<div class="line">        , u(1.0)</div>
<div class="line">        , p(1.0)</div>
<div class="line">        , J(1.0)</div>
<div class="line">      {}</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> reset()</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> = 1.0;</div>
<div class="line">        u    = 1.0;</div>
<div class="line">        p    = 1.0;</div>
<div class="line">        J    = 1.0;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordtype">void</span> normalize(<span class="keyword">const</span> Errors &amp;rhs)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (rhs.norm != 0.0)</div>
<div class="line">          <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> /= rhs.norm;</div>
<div class="line">        <span class="keywordflow">if</span> (rhs.u != 0.0)</div>
<div class="line">          u /= rhs.u;</div>
<div class="line">        <span class="keywordflow">if</span> (rhs.p != 0.0)</div>
<div class="line">          p /= rhs.p;</div>
<div class="line">        <span class="keywordflow">if</span> (rhs.J != 0.0)</div>
<div class="line">          J /= rhs.J;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a>, u, p, J;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    Errors error_residual, error_residual_0, error_residual_norm, error_update,</div>
<div class="line">      error_update_0, error_update_norm;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> get_error_residual(Errors &amp;error_residual);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> get_error_update(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update,</div>
<div class="line">                          Errors &amp;                   error_update);</div>
<div class="line"> </div>
<div class="line">    std::pair&lt;double, double&gt; get_error_dilation() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> compute_vol_current() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> print_conv_header();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> print_conv_footer();</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  Solid&lt;dim&gt;::Solid(<span class="keyword">const</span> std::string &amp;input_file)</div>
<div class="line">    : parameters(input_file)</div>
<div class="line">    , vol_reference(0.)</div>
<div class="line">    , <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::maximum_smoothing)</div>
<div class="line">    , time(parameters.end_time, parameters.delta_t)</div>
<div class="line">    , timer(std::cout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::summary, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">    , degree(parameters.poly_degree)</div>
<div class="line">    ,</div>
<div class="line">    fe(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;dim&gt;(parameters.poly_degree),</div>
<div class="line">       dim, <span class="comment">// displacement</span></div>
<div class="line">       <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial</a>&lt;dim&gt;(parameters.poly_degree - 1),</div>
<div class="line">       1, <span class="comment">// pressure</span></div>
<div class="line">       <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial</a>&lt;dim&gt;(parameters.poly_degree - 1),</div>
<div class="line">       1)</div>
<div class="line">    , <span class="comment">// dilatation</span></div>
<div class="line">    dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">    , dofs_per_cell(fe.n_dofs_per_cell())</div>
<div class="line">    , u_fe(first_u_component)</div>
<div class="line">    , p_fe(p_component)</div>
<div class="line">    , J_fe(J_component)</div>
<div class="line">    , dofs_per_block(<a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>)</div>
<div class="line">    , qf_cell(parameters.quad_order)</div>
<div class="line">    , qf_face(parameters.quad_order)</div>
<div class="line">    , n_q_points(qf_cell.size())</div>
<div class="line">    , n_q_points_f(qf_face.size())</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim == 2 || dim == 3,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;This problem only works in 2 or 3 space dimensions.&quot;</span>));</div>
<div class="line">    determine_component_extractors();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">Solid&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    make_grid();</div>
<div class="line">    system_setup();</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line">      constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a> J_mask(J_component, n_components);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a>(</div>
<div class="line">        dof_handler, constraints, <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(degree + 2), J_mask, solution_n);</div>
<div class="line">    }</div>
<div class="line">    output_results();</div>
<div class="line">    time.increment();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_delta(dofs_per_block);</div>
<div class="line">    <span class="keywordflow">while</span> (time.current() &lt; time.end())</div>
<div class="line">      {</div>
<div class="line">        solution_delta = 0.0;</div>
<div class="line"> </div>
<div class="line">        solve_nonlinear_timestep(solution_delta);</div>
<div class="line">        solution_n += solution_delta;</div>
<div class="line"> </div>
<div class="line">        output_results();</div>
<div class="line">        time.increment();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_ASM</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line"> </div>
<div class="line">    PerTaskData_ASM(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell)</div>
<div class="line">      : <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell)</div>
<div class="line">      , cell_rhs(dofs_per_cell)</div>
<div class="line">      , local_dof_indices(dofs_per_cell)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0.0;</div>
<div class="line">      cell_rhs    = 0.0;</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_ASM</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>     fe_values;</div>
<div class="line">    <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a> fe_face_values;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::vector&lt;double&gt;&gt;                  Nx;</div>
<div class="line">    std::vector&lt;std::vector&lt;Tensor&lt;2, dim&gt;&gt;&gt;          grad_Nx;</div>
<div class="line">    std::vector&lt;std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt;&gt; symm_grad_Nx;</div>
<div class="line"> </div>
<div class="line">    ScratchData_ASM(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe_cell,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;       qf_cell,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         uf_cell,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim - 1&gt;</a> &amp;   qf_face,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         uf_face)</div>
<div class="line">      : fe_values(fe_cell, qf_cell, uf_cell)</div>
<div class="line">      , fe_face_values(fe_cell, qf_face, uf_face)</div>
<div class="line">      , Nx(qf_cell.size(), std::vector&lt;<a class="code" href="classdouble.html">double</a>&gt;(fe_cell.n_dofs_per_cell()))</div>
<div class="line">      , grad_Nx(qf_cell.size(),</div>
<div class="line">                std::vector&lt;<a class="code" href="classTensor.html">Tensor</a>&lt;2, dim&gt;&gt;(fe_cell.n_dofs_per_cell()))</div>
<div class="line">      , symm_grad_Nx(qf_cell.size(),</div>
<div class="line">                     std::vector&lt;<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt;&gt;(</div>
<div class="line">                       fe_cell.n_dofs_per_cell()))</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    ScratchData_ASM(<span class="keyword">const</span> ScratchData_ASM &amp;rhs)</div>
<div class="line">      : fe_values(rhs.fe_values.get_fe(),</div>
<div class="line">                  rhs.fe_values.get_quadrature(),</div>
<div class="line">                  rhs.fe_values.get_update_flags())</div>
<div class="line">      , fe_face_values(rhs.fe_face_values.get_fe(),</div>
<div class="line">                       rhs.fe_face_values.get_quadrature(),</div>
<div class="line">                       rhs.fe_face_values.get_update_flags())</div>
<div class="line">      , Nx(rhs.Nx)</div>
<div class="line">      , grad_Nx(rhs.grad_Nx)</div>
<div class="line">      , symm_grad_Nx(rhs.symm_grad_Nx)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points      = Nx.size();</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs_per_cell = Nx[0].size();</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(Nx[q_point].size() == n_dofs_per_cell, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(grad_Nx[q_point].size() == n_dofs_per_cell,</div>
<div class="line">                 <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(symm_grad_Nx[q_point].size() == n_dofs_per_cell,</div>
<div class="line">                 <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; n_dofs_per_cell; ++k)</div>
<div class="line">            {</div>
<div class="line">              Nx[q_point][k]           = 0.0;</div>
<div class="line">              grad_Nx[q_point][k]      = 0.0;</div>
<div class="line">              symm_grad_Nx[q_point][k] = 0.0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_SC</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_orig;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pu;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pJ;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_JJ;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pJ_inv;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_bbar;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> B;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>;</div>
<div class="line"> </div>
<div class="line">    PerTaskData_SC(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_u,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_p,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_J)</div>
<div class="line">      : <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell)</div>
<div class="line">      , local_dof_indices(dofs_per_cell)</div>
<div class="line">      , k_orig(dofs_per_cell, dofs_per_cell)</div>
<div class="line">      , k_pu(n_p, n_u)</div>
<div class="line">      , k_pJ(n_p, n_J)</div>
<div class="line">      , k_JJ(n_J, n_J)</div>
<div class="line">      , k_pJ_inv(n_p, n_J)</div>
<div class="line">      , k_bbar(n_u, n_u)</div>
<div class="line">      , <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>(n_J, n_u)</div>
<div class="line">      , B(n_J, n_u)</div>
<div class="line">      , <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>(n_p, n_u)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_SC</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_UQPH</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_UQPH</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_total;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Tensor&lt;2, dim&gt;&gt; solution_grads_u_total;</div>
<div class="line">    std::vector&lt;double&gt;         solution_values_p_total;</div>
<div class="line">    std::vector&lt;double&gt;         solution_values_J_total;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line"> </div>
<div class="line">    ScratchData_UQPH(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe_cell,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;        qf_cell,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>          uf_cell,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_total)</div>
<div class="line">      : solution_total(solution_total)</div>
<div class="line">      , solution_grads_u_total(qf_cell.size())</div>
<div class="line">      , solution_values_p_total(qf_cell.size())</div>
<div class="line">      , solution_values_J_total(qf_cell.size())</div>
<div class="line">      , fe_values(fe_cell, qf_cell, uf_cell)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    ScratchData_UQPH(<span class="keyword">const</span> ScratchData_UQPH &amp;rhs)</div>
<div class="line">      : solution_total(rhs.solution_total)</div>
<div class="line">      , solution_grads_u_total(rhs.solution_grads_u_total)</div>
<div class="line">      , solution_values_p_total(rhs.solution_values_p_total)</div>
<div class="line">      , solution_values_J_total(rhs.solution_values_J_total)</div>
<div class="line">      , fe_values(rhs.fe_values.get_fe(),</div>
<div class="line">                  rhs.fe_values.get_quadrature(),</div>
<div class="line">                  rhs.fe_values.get_update_flags())</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = solution_grads_u_total.size();</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          solution_grads_u_total[q]  = 0.0;</div>
<div class="line">          solution_values_p_total[q] = 0.0;</div>
<div class="line">          solution_values_J_total[q] = 0.0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::make_grid()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#a56019d263ae45708302d5d7599f0d458">GridGenerator::hyper_rectangle</a>(</div>
<div class="line">      <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">      (dim == 3 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0.0, 0.0, 0.0) : <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0.0, 0.0)),</div>
<div class="line">      (dim == 3 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(1.0, 1.0, 1.0) : <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(1.0, 1.0)),</div>
<div class="line">      <span class="keyword">true</span>);</div>
<div class="line">    <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a>(parameters.scale, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(1U, parameters.global_refinement));</div>
<div class="line"> </div>
<div class="line">    vol_reference = <a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">GridTools::volume</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Grid:\n\t Reference volume: &quot;</span> &lt;&lt; vol_reference &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> (face-&gt;at_boundary() == <span class="keyword">true</span> &amp;&amp;</div>
<div class="line">              face-&gt;center()[1] == 1.0 * parameters.scale)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">if</span> (dim == 3)</div>
<div class="line">                {</div>
<div class="line">                  <span class="keywordflow">if</span> (face-&gt;center()[0] &lt; 0.5 * parameters.scale &amp;&amp;</div>
<div class="line">                      face-&gt;center()[2] &lt; 0.5 * parameters.scale)</div>
<div class="line">                    face-&gt;set_boundary_id(6);</div>
<div class="line">                }</div>
<div class="line">              <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                  <span class="keywordflow">if</span> (face-&gt;center()[0] &lt; 0.5 * parameters.scale)</div>
<div class="line">                    face-&gt;set_boundary_id(6);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::system_setup()</div>
<div class="line">  {</div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned int&gt; block_component(n_components,</div>
<div class="line">                                              u_dof); <span class="comment">// Displacement</span></div>
<div class="line">    block_component[p_component] = p_dof;             <span class="comment">// Pressure</span></div>
<div class="line">    block_component[J_component] = J_dof;             <span class="comment">// Dilatation</span></div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a>(dof_handler);</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a52c1941406d1ce2937e29a46edf111f4">DoFRenumbering::component_wise</a>(dof_handler, block_component);</div>
<div class="line"> </div>
<div class="line">    dofs_per_block =</div>
<div class="line">      <a class="code" href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a>(dof_handler, block_component);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Triangulation:&quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\n\t Number of active cells: &quot;</span></div>
<div class="line">              &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\n\t Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    tangent_matrix.<a class="code" href="group__Matrix1.html#gacf098688a1a7db16a6582be07dcbeb6a">clear</a>();</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_u = dofs_per_block[u_dof];</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_p = dofs_per_block[p_dof];</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_J = dofs_per_block[J_dof];</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a> dsp(<a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>, <a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>);</div>
<div class="line"> </div>
<div class="line">      dsp.block(u_dof, u_dof).reinit(n_dofs_u, n_dofs_u);</div>
<div class="line">      dsp.block(u_dof, p_dof).reinit(n_dofs_u, n_dofs_p);</div>
<div class="line">      dsp.block(u_dof, J_dof).reinit(n_dofs_u, n_dofs_J);</div>
<div class="line"> </div>
<div class="line">      dsp.block(p_dof, u_dof).reinit(n_dofs_p, n_dofs_u);</div>
<div class="line">      dsp.block(p_dof, p_dof).reinit(n_dofs_p, n_dofs_p);</div>
<div class="line">      dsp.block(p_dof, J_dof).reinit(n_dofs_p, n_dofs_J);</div>
<div class="line"> </div>
<div class="line">      dsp.block(J_dof, u_dof).reinit(n_dofs_J, n_dofs_u);</div>
<div class="line">      dsp.block(J_dof, p_dof).reinit(n_dofs_J, n_dofs_p);</div>
<div class="line">      dsp.block(J_dof, J_dof).reinit(n_dofs_J, n_dofs_J);</div>
<div class="line">      dsp.collect_sizes();</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classTable.html">Table&lt;2, DoFTools::Coupling&gt;</a> coupling(n_components, n_components);</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0; ii &lt; n_components; ++ii)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jj = 0; jj &lt; n_components; ++jj)</div>
<div class="line">          <span class="keywordflow">if</span> (((ii &lt; p_component) &amp;&amp; (jj == J_component)) ||</div>
<div class="line">              ((ii == J_component) &amp;&amp; (jj &lt; p_component)) ||</div>
<div class="line">              ((ii == p_component) &amp;&amp; (jj == p_component)))</div>
<div class="line">            coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba">DoFTools::none</a>;</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">DoFTools::always</a>;</div>
<div class="line">      <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(</div>
<div class="line">        dof_handler, coupling, dsp, constraints, <span class="keyword">false</span>);</div>
<div class="line">      sparsity_pattern.<a class="code" href="group__Exceptions.html#ga923288e4b4093f86b680e7045e9b4984">copy_from</a>(dsp);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e0a45e360458e7350bd93487d6bf1e5">reinit</a>(sparsity_pattern);</div>
<div class="line"> </div>
<div class="line">    system_rhs.<a class="code" href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">reinit</a>(dofs_per_block);</div>
<div class="line">    system_rhs.<a class="code" href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">collect_sizes</a>();</div>
<div class="line"> </div>
<div class="line">    solution_n.<a class="code" href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">reinit</a>(dofs_per_block);</div>
<div class="line">    solution_n.<a class="code" href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">collect_sizes</a>();</div>
<div class="line"> </div>
<div class="line">    setup_qph();</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::determine_component_extractors()</div>
<div class="line">  {</div>
<div class="line">    element_indices_u.clear();</div>
<div class="line">    element_indices_p.clear();</div>
<div class="line">    element_indices_J.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; fe.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++k)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(k).first.first;</div>
<div class="line">        <span class="keywordflow">if</span> (k_group == u_dof)</div>
<div class="line">          element_indices_u.push_back(k);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_dof)</div>
<div class="line">          element_indices_p.push_back(k);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_dof)</div>
<div class="line">          element_indices_J.push_back(k);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::setup_qph()</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;    Setting up quadrature point data...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    quadrature_point_history.<a class="code" href="classCellDataStorage.html#a9ce38927ac1a1f96618c2624da89d65b">initialize</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.begin_active(),</div>
<div class="line">                                        <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.end(),</div>
<div class="line">                                        n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">          quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">          lqph[q_point]-&gt;setup_lqp(parameters);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  Solid&lt;dim&gt;::update_qph_incremental(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)</div>
<div class="line">  {</div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Update QPH data&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; UQPH &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_total(</div>
<div class="line">      get_total_solution(solution_delta));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_UQPH(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>);</div>
<div class="line">    PerTaskData_UQPH  per_task_data_UQPH;</div>
<div class="line">    ScratchData_UQPH  scratch_data_UQPH(fe, qf_cell, uf_UQPH, solution_total);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">                    *<span class="keyword">this</span>,</div>
<div class="line">                    &amp;Solid::update_qph_incremental_one_cell,</div>
<div class="line">                    &amp;Solid::copy_local_to_global_UQPH,</div>
<div class="line">                    scratch_data_UQPH,</div>
<div class="line">                    per_task_data_UQPH);</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::update_qph_incremental_one_cell(</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">    ScratchData_UQPH &amp;                                    scratch,</div>
<div class="line">    PerTaskData_UQPH &amp; <span class="comment">/*data*/</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">      quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_grads_u_total.size() == n_q_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_values_p_total.size() == n_q_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_values_J_total.size() == n_q_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    scratch.reset();</div>
<div class="line"> </div>
<div class="line">    scratch.fe_values.reinit(cell);</div>
<div class="line">    scratch.fe_values[u_fe].get_function_gradients(</div>
<div class="line">      scratch.solution_total, scratch.solution_grads_u_total);</div>
<div class="line">    scratch.fe_values[p_fe].get_function_values(</div>
<div class="line">      scratch.solution_total, scratch.solution_values_p_total);</div>
<div class="line">    scratch.fe_values[J_fe].get_function_values(</div>
<div class="line">      scratch.solution_total, scratch.solution_values_J_total);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">         scratch.fe_values.quadrature_point_indices())</div>
<div class="line">      lqph[q_point]-&gt;update_values(scratch.solution_grads_u_total[q_point],</div>
<div class="line">                                   scratch.solution_values_p_total[q_point],</div>
<div class="line">                                   scratch.solution_values_J_total[q_point]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::solve_nonlinear_timestep(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;Timestep &quot;</span> &lt;&lt; time.get_timestep() &lt;&lt; <span class="stringliteral">&quot; @ &quot;</span> &lt;&lt; time.current()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> newton_update(dofs_per_block);</div>
<div class="line"> </div>
<div class="line">    error_residual.reset();</div>
<div class="line">    error_residual_0.reset();</div>
<div class="line">    error_residual_norm.reset();</div>
<div class="line">    error_update.reset();</div>
<div class="line">    error_update_0.reset();</div>
<div class="line">    error_update_norm.reset();</div>
<div class="line"> </div>
<div class="line">    print_conv_header();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_iteration = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (; newton_iteration &lt; parameters.max_iterations_NR; ++newton_iteration)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; newton_iteration &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                  &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        make_constraints(newton_iteration);</div>
<div class="line">        assemble_system();</div>
<div class="line"> </div>
<div class="line">        get_error_residual(error_residual);</div>
<div class="line">        <span class="keywordflow">if</span> (newton_iteration == 0)</div>
<div class="line">          error_residual_0 = error_residual;</div>
<div class="line"> </div>
<div class="line">        error_residual_norm = error_residual;</div>
<div class="line">        error_residual_norm.normalize(error_residual_0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (newton_iteration &gt; 0 &amp;&amp; error_update_norm.u &lt;= parameters.tol_u &amp;&amp;</div>
<div class="line">            error_residual_norm.u &lt;= parameters.tol_f)</div>
<div class="line">          {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; CONVERGED! &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            print_conv_footer();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::pair&lt;unsigned int, double&gt; lin_solver_output =</div>
<div class="line">          solve_linear_system(newton_update);</div>
<div class="line"> </div>
<div class="line">        get_error_update(newton_update, error_update);</div>
<div class="line">        <span class="keywordflow">if</span> (newton_iteration == 0)</div>
<div class="line">          error_update_0 = error_update;</div>
<div class="line"> </div>
<div class="line">        error_update_norm = error_update;</div>
<div class="line">        error_update_norm.normalize(error_update_0);</div>
<div class="line"> </div>
<div class="line">        solution_delta += newton_update;</div>
<div class="line">        update_qph_incremental(solution_delta);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; std::fixed &lt;&lt; std::setprecision(3) &lt;&lt; std::setw(7)</div>
<div class="line">                  &lt;&lt; std::scientific &lt;&lt; lin_solver_output.first &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">                  &lt;&lt; lin_solver_output.second &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">                  &lt;&lt; error_residual_norm.norm &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.u</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.p &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">                  &lt;&lt; error_residual_norm.J &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.norm</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.u &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.p</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.J &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(newton_iteration &lt; parameters.max_iterations_NR,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver!&quot;</span>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_header()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_width = 150;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;               SOLVER STEP               &quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; |  LIN_IT   LIN_RES    RES_NORM    &quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; RES_U     RES_P      RES_J     NU_NORM     &quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; NU_U       NU_P       NU_J &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_footer()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_width = 150;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;double, double&gt; error_dil = get_error_dilation();</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Relative errors:&quot;</span> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;Displacement:\t&quot;</span> &lt;&lt; error_update.u / error_update_0.u</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;Force: \t\t&quot;</span> &lt;&lt; error_residual.u / error_residual_0.u</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;Dilatation:\t&quot;</span> &lt;&lt; error_dil.first &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;v / V_0:\t&quot;</span> &lt;&lt; error_dil.second * vol_reference &lt;&lt; <span class="stringliteral">&quot; / &quot;</span></div>
<div class="line">              &lt;&lt; vol_reference &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; error_dil.second &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> Solid&lt;dim&gt;::compute_vol_current()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordtype">double</span> vol_current = 0.0;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe, qf_cell, <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">          quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point : fe_values.<a class="code" href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">quadrature_point_indices</a>())</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> JxW      = fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div>
<div class="line"> </div>
<div class="line">            vol_current += det_F_qp * JxW;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(vol_current &gt; 0.0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <span class="keywordflow">return</span> vol_current;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::pair&lt;double, double&gt; Solid&lt;dim&gt;::get_error_dilation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordtype">double</span> dil_L2_error = 0.0;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe, qf_cell, <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">          quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point : fe_values.<a class="code" href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">quadrature_point_indices</a>())</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp   = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> J_tilde_qp = lqph[q_point]-&gt;get_J_tilde();</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> the_error_qp_squared =</div>
<div class="line">              <a class="code" href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a>((det_F_qp - J_tilde_qp), 2);</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div>
<div class="line"> </div>
<div class="line">            dil_L2_error += the_error_qp_squared * JxW;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> std::make_pair(std::sqrt(dil_L2_error),</div>
<div class="line">                          compute_vol_current() / vol_reference);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_residual(Errors &amp;error_residual)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> error_res(dofs_per_block);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++i)</div>
<div class="line">      <span class="keywordflow">if</span> (!constraints.<a class="code" href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">is_constrained</a>(i))</div>
<div class="line">        error_res(i) = system_rhs(i);</div>
<div class="line"> </div>
<div class="line">    error_residual.norm = error_res.l2_norm();</div>
<div class="line">    error_residual.u    = error_res.block(u_dof).l2_norm();</div>
<div class="line">    error_residual.p    = error_res.block(p_dof).l2_norm();</div>
<div class="line">    error_residual.J    = error_res.block(J_dof).l2_norm();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_update(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update,</div>
<div class="line">                                    Errors &amp;                   error_update)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> error_ud(dofs_per_block);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++i)</div>
<div class="line">      <span class="keywordflow">if</span> (!constraints.<a class="code" href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">is_constrained</a>(i))</div>
<div class="line">        error_ud(i) = newton_update(i);</div>
<div class="line"> </div>
<div class="line">    error_update.norm = error_ud.l2_norm();</div>
<div class="line">    error_update.u    = error_ud.block(u_dof).l2_norm();</div>
<div class="line">    error_update.p    = error_ud.block(p_dof).l2_norm();</div>
<div class="line">    error_update.J    = error_ud.block(J_dof).l2_norm();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> Solid&lt;dim&gt;::get_total_solution(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_total(solution_n);</div>
<div class="line">    solution_total += solution_delta;</div>
<div class="line">    <span class="keywordflow">return</span> solution_total;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system()</div>
<div class="line">  {</div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Assemble system&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; ASM_SYS &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    tangent_matrix = 0.0;</div>
<div class="line">    system_rhs     = 0.0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_cell(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                              <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_face(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> |</div>
<div class="line">                              <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    PerTaskData_ASM per_task_data(dofs_per_cell);</div>
<div class="line">    ScratchData_ASM scratch_data(fe, qf_cell, uf_cell, qf_face, uf_face);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(</div>
<div class="line">      dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">      [<span class="keyword">this</span>](<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">             ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">             PerTaskData_ASM &amp;                                     data) {</div>
<div class="line">        this-&gt;assemble_system_one_cell(cell, scratch, data);</div>
<div class="line">      },</div>
<div class="line">      [<span class="keyword">this</span>](<span class="keyword">const</span> PerTaskData_ASM &amp;data) {</div>
<div class="line">        this-&gt;constraints.distribute_local_to_global(data.cell_matrix,</div>
<div class="line">                                                     data.cell_rhs,</div>
<div class="line">                                                     data.local_dof_indices,</div>
<div class="line">                                                     tangent_matrix,</div>
<div class="line">                                                     system_rhs);</div>
<div class="line">      },</div>
<div class="line">      scratch_data,</div>
<div class="line">      per_task_data);</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system_one_cell(</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">    ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">    PerTaskData_ASM &amp;                                     data)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    data.reset();</div>
<div class="line">    scratch.reset();</div>
<div class="line">    scratch.fe_values.reinit(cell);</div>
<div class="line">    cell-&gt;get_dof_indices(data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">      quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">         scratch.fe_values.quadrature_point_indices())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv = lqph[q_point]-&gt;get_F_inv();</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k : scratch.fe_values.dof_indices())</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(k).first.first;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (k_group == u_dof)</div>
<div class="line">              {</div>
<div class="line">                scratch.grad_Nx[q_point][k] =</div>
<div class="line">                  scratch.fe_values[u_fe].gradient(k, q_point) * F_inv;</div>
<div class="line">                scratch.symm_grad_Nx[q_point][k] =</div>
<div class="line">                  <a class="code" href="classSymmetricTensor.html#a1b2101a1d45267f1fd4664ed178cb636">symmetrize</a>(scratch.grad_Nx[q_point][k]);</div>
<div class="line">              }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_dof)</div>
<div class="line">              scratch.Nx[q_point][k] =</div>
<div class="line">                scratch.fe_values[p_fe].value(k, q_point);</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_dof)</div>
<div class="line">              scratch.Nx[q_point][k] =</div>
<div class="line">                scratch.fe_values[J_fe].value(k, q_point);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">         scratch.fe_values.quadrature_point_indices())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau     = lqph[q_point]-&gt;get_tau();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a>          tau_ns  = lqph[q_point]-&gt;get_tau();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc      = lqph[q_point]-&gt;get_Jc();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                  det_F   = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                  p_tilde = lqph[q_point]-&gt;get_p_tilde();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                  J_tilde = lqph[q_point]-&gt;get_J_tilde();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> dPsi_vol_dJ   = lqph[q_point]-&gt;get_dPsi_vol_dJ();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> d2Psi_vol_dJ2 = lqph[q_point]-&gt;get_d2Psi_vol_dJ2();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;I =</div>
<div class="line">          <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> symm_grad_Nx_i_x_Jc;</div>
<div class="line">        <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>          grad_Nx_i_comp_i_x_tau;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;double&gt; &amp;                 <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> = scratch.Nx[q_point];</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt; &amp;symm_grad_Nx =</div>
<div class="line">          scratch.symm_grad_Nx[q_point];</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;Tensor&lt;2, dim&gt;&gt; &amp;grad_Nx = scratch.grad_Nx[q_point];</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                       JxW = scratch.fe_values.JxW(q_point);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">              fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(i).first.first;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">              data.cell_rhs(i) -= (symm_grad_Nx[i] * tau) * JxW;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == p_dof)</div>
<div class="line">              data.cell_rhs(i) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * (det_F - J_tilde) * JxW;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == J_dof)</div>
<div class="line">              data.cell_rhs(i) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * (dPsi_vol_dJ - p_tilde) * JxW;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(i_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">              {</div>
<div class="line">                symm_grad_Nx_i_x_Jc    = symm_grad_Nx[i] * Jc;</div>
<div class="line">                grad_Nx_i_comp_i_x_tau = grad_Nx[i][component_i] * tau_ns;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j :</div>
<div class="line">                 scratch.fe_values.dof_indices_ending_at(i))</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_j =</div>
<div class="line">                  fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(j).first;</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j_group =</div>
<div class="line">                  fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(j).first.first;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> ((i_group == j_group) &amp;&amp; (i_group == u_dof))</div>
<div class="line">                  {</div>
<div class="line">                    data.cell_matrix(i, j) += symm_grad_Nx_i_x_Jc *  </div>
<div class="line">                                              symm_grad_Nx[j] * JxW; </div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (component_i == component_j)</div>
<div class="line">                      data.cell_matrix(i, j) +=</div>
<div class="line">                        grad_Nx_i_comp_i_x_tau * grad_Nx[j][component_j] * JxW;</div>
<div class="line">                  }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == p_dof) &amp;&amp; (j_group == u_dof))</div>
<div class="line">                  {</div>
<div class="line">                    data.cell_matrix(i, j) += <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * det_F *               </div>
<div class="line">                                              (symm_grad_Nx[j] * I) * JxW; </div>
<div class="line">                  }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == J_dof) &amp;&amp; (j_group == p_dof))</div>
<div class="line">                  data.cell_matrix(i, j) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[j] * JxW;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == j_group) &amp;&amp; (i_group == J_dof))</div>
<div class="line">                  data.cell_matrix(i, j) += <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * d2Psi_vol_dJ2 * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[j] * JxW;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>((i_group &lt;= J_dof) &amp;&amp; (j_group &lt;= J_dof),</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div>
<div class="line">      <span class="keywordflow">if</span> (face-&gt;at_boundary() &amp;&amp; face-&gt;boundary_id() == 6)</div>
<div class="line">        {</div>
<div class="line">          scratch.fe_face_values.reinit(cell, face);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> f_q_point :</div>
<div class="line">               scratch.fe_face_values.quadrature_point_indices())</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> =</div>
<div class="line">                scratch.fe_face_values.normal_vector(f_q_point);</div>
<div class="line"> </div>
<div class="line">              <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> p0 =</div>
<div class="line">                -4.0 / (parameters.scale * parameters.scale);</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         time_ramp = (time.current() / time.end());</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         pressure  = p0 * parameters.p_p0 * time_ramp;</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> traction  = pressure * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>;</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group =</div>
<div class="line">                    fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(i).first.first;</div>
<div class="line"> </div>
<div class="line">                  <span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">                    {</div>
<div class="line">                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                        fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">                      <span class="keyword">const</span> <span class="keywordtype">double</span> Ni =</div>
<div class="line">                        scratch.fe_face_values.shape_value(i, f_q_point);</div>
<div class="line">                      <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = scratch.fe_face_values.JxW(f_q_point);</div>
<div class="line"> </div>
<div class="line">                      data.cell_rhs(i) += (Ni * traction[component_i]) * JxW;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j :</div>
<div class="line">           scratch.fe_values.dof_indices_starting_at(i + 1))</div>
<div class="line">        data.cell_matrix(i, j) = data.cell_matrix(j, i);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> it_nr)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> apply_dirichlet_bc = (it_nr == 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (it_nr &gt; 1)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; --- &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; CST &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (apply_dirichlet_bc)</div>
<div class="line">      {</div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> x_displacement(0);</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> y_displacement(1);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 0;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement));</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 2;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (dim == 3)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> z_displacement(2);</div>
<div class="line"> </div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 3;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement) |</div>
<div class="line">                 fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement)));</div>
<div class="line">            }</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 4;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement));</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 6;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement) |</div>
<div class="line">                 fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement)));</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 3;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement)));</div>
<div class="line">            }</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 6;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement)));</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (constraints.<a class="code" href="classAffineConstraints.html#a0df947a828e8496cd04087c58b382da5">has_inhomogeneities</a>())</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> homogeneous_constraints(constraints);</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof = 0; dof != dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++dof)</div>
<div class="line">              <span class="keywordflow">if</span> (homogeneous_constraints.is_inhomogeneously_constrained(dof))</div>
<div class="line">                homogeneous_constraints.set_inhomogeneity(dof, 0.0);</div>
<div class="line"> </div>
<div class="line">            constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">            constraints.<a class="code" href="classAffineConstraints.html#ac15d04ef931b4ff581b9a4b3d7b5123e">copy_from</a>(homogeneous_constraints);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_sc()</div>
<div class="line">  {</div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Perform static condensation&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; ASM_SC &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    PerTaskData_SC per_task_data(dofs_per_cell,</div>
<div class="line">                                 element_indices_u.size(),</div>
<div class="line">                                 element_indices_p.size(),</div>
<div class="line">                                 element_indices_J.size());</div>
<div class="line">    ScratchData_SC scratch_data;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">                    *<span class="keyword">this</span>,</div>
<div class="line">                    &amp;Solid::assemble_sc_one_cell,</div>
<div class="line">                    &amp;Solid::copy_local_to_global_sc,</div>
<div class="line">                    scratch_data,</div>
<div class="line">                    per_task_data);</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::copy_local_to_global_sc(<span class="keyword">const</span> PerTaskData_SC &amp;data)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">        tangent_matrix.<a class="code" href="group__Matrix1.html#gad8fe7a35a3336d251a4b3aa2c3ed9748">add</a>(data.local_dof_indices[i],</div>
<div class="line">                           data.local_dof_indices[j],</div>
<div class="line">                           data.cell_matrix(i, j));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_sc_one_cell(</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">    ScratchData_SC &amp;                                      scratch,</div>
<div class="line">    PerTaskData_SC &amp;                                      data)</div>
<div class="line">  {</div>
<div class="line">    data.reset();</div>
<div class="line">    scratch.reset();</div>
<div class="line">    cell-&gt;get_dof_indices(data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    data.k_orig.extract_submatrix_from(tangent_matrix,</div>
<div class="line">                                       data.local_dof_indices,</div>
<div class="line">                                       data.local_dof_indices);</div>
<div class="line">    data.k_pu.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                     element_indices_p,</div>
<div class="line">                                     element_indices_u);</div>
<div class="line">    data.k_pJ.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                     element_indices_p,</div>
<div class="line">                                     element_indices_J);</div>
<div class="line">    data.k_JJ.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                     element_indices_J,</div>
<div class="line">                                     element_indices_J);</div>
<div class="line"> </div>
<div class="line">    data.k_pJ_inv.invert(data.k_pJ);</div>
<div class="line"> </div>
<div class="line">    data.k_pJ_inv.mmult(data.A, data.k_pu);</div>
<div class="line">    data.k_JJ.mmult(data.B, data.A);</div>
<div class="line">    data.k_pJ_inv.Tmmult(data.C, data.B);</div>
<div class="line">    data.k_pu.Tmmult(data.k_bbar, data.C);</div>
<div class="line">    data.k_bbar.scatter_matrix_to(element_indices_u,</div>
<div class="line">                                  element_indices_u,</div>
<div class="line">                                  data.cell_matrix);</div>
<div class="line"> </div>
<div class="line">    data.k_pJ_inv.add(-1.0, data.k_pJ);</div>
<div class="line">    data.k_pJ_inv.scatter_matrix_to(element_indices_p,</div>
<div class="line">                                    element_indices_J,</div>
<div class="line">                                    data.cell_matrix);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::pair&lt;unsigned int, double&gt;</div>
<div class="line">  Solid&lt;dim&gt;::solve_linear_system(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lin_it  = 0;</div>
<div class="line">    <span class="keywordtype">double</span>       lin_res = 0.0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (parameters.use_static_condensation == <span class="keyword">true</span>)</div>
<div class="line">      {</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>(dofs_per_block);</div>
<div class="line">        <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> B(dofs_per_block);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          assemble_sc();</div>
<div class="line"> </div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof), system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof));</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(B.block(J_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) -= B.block(J_dof);</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">Tvmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, p_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(u_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof));</div>
<div class="line">          system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof) -= <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(u_dof);</div>
<div class="line"> </div>
<div class="line">          timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">          <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;CG&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keyword">auto</span> solver_its = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line">                tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                parameters.max_iterations_lin);</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> tol_sol =</div>
<div class="line">                parameters.tol_lin * system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof).l2_norm();</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(solver_its, tol_sol);</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="classGrowingVectorMemory.html">GrowingVectorMemory&lt;Vector&lt;double&gt;</a>&gt; GVM;</div>
<div class="line">              <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; solver_CG(solver_control, GVM);</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">                preconditioner(parameters.preconditioner_type,</div>
<div class="line">                               parameters.preconditioner_relaxation);</div>
<div class="line">              preconditioner.use_matrix(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line"> </div>
<div class="line">              solver_CG.solve(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof),</div>
<div class="line">                              newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                              system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                              preconditioner);</div>
<div class="line"> </div>
<div class="line">              lin_it  = solver_control.last_step();</div>
<div class="line">              lin_res = solver_control.last_value();</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;Direct&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">              <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">              A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line">              A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                             system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof));</div>
<div class="line"> </div>
<div class="line">              lin_it  = 1;</div>
<div class="line">              lin_res = 0.0;</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Linear solver type not implemented&quot;</span>));</div>
<div class="line"> </div>
<div class="line">          timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; PP &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, u_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof), newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof));</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof) *= -1.0;</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof) += system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof), newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof));</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) *= -1.0;</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) += system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">Tvmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; ------ &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;CG&quot;</span>)</div>
<div class="line">          {</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_u = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof);</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_p = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_J = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_u = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof);</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_p = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_J = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_uu =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_up =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, p_dof));</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_pu =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, u_dof));</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_Jp =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof));</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_JJ =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof));</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">              preconditioner_K_Jp_inv(<span class="stringliteral">&quot;jacobi&quot;</span>);</div>
<div class="line">            preconditioner_K_Jp_inv.use_matrix(</div>
<div class="line">              tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof));</div>
<div class="line">            <a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_Jp_inv(</div>
<div class="line">              <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                                        parameters.max_iterations_lin),</div>
<div class="line">              1.0e-30,</div>
<div class="line">              parameters.tol_lin);</div>
<div class="line">            <a class="code" href="classSolverSelector.html">SolverSelector&lt;Vector&lt;double&gt;</a>&gt; solver_K_Jp_inv;</div>
<div class="line">            solver_K_Jp_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(<span class="stringliteral">&quot;cg&quot;</span>);</div>
<div class="line">            solver_K_Jp_inv.<a class="code" href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">set_control</a>(solver_control_K_Jp_inv);</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_Jp_inv =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_Jp, solver_K_Jp_inv, preconditioner_K_Jp_inv);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_pJ_inv     = <a class="code" href="group__LAOperators.html#ga6bdc65fb2db56230e6bc7d545e81295d">transpose_operator</a>(K_Jp_inv);</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_pp_bar     = K_Jp_inv * K_JJ * K_pJ_inv;</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_bar_bar = K_up * K_pp_bar * K_pu;</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con     = K_uu + K_uu_bar_bar;</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">              preconditioner_K_con_inv(parameters.preconditioner_type,</div>
<div class="line">                                       parameters.preconditioner_relaxation);</div>
<div class="line">            preconditioner_K_con_inv.use_matrix(</div>
<div class="line">              tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line">            <a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_con_inv(</div>
<div class="line">              <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                                        parameters.max_iterations_lin),</div>
<div class="line">              1.0e-30,</div>
<div class="line">              parameters.tol_lin);</div>
<div class="line">            <a class="code" href="classSolverSelector.html">SolverSelector&lt;Vector&lt;double&gt;</a>&gt; solver_K_con_inv;</div>
<div class="line">            solver_K_con_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(<span class="stringliteral">&quot;cg&quot;</span>);</div>
<div class="line">            solver_K_con_inv.<a class="code" href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">set_control</a>(solver_control_K_con_inv);</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con_inv =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_uu_con,</div>
<div class="line">                               solver_K_con_inv,</div>
<div class="line">                               preconditioner_K_con_inv);</div>
<div class="line"> </div>
<div class="line">            d_u =</div>
<div class="line">              K_uu_con_inv * (f_u - K_up * (K_Jp_inv * f_J - K_pp_bar * f_p));</div>
<div class="line"> </div>
<div class="line">            timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">            timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; PP &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">            d_J = K_pJ_inv * (f_p - K_pu * d_u);</div>
<div class="line">            d_p = K_Jp_inv * (f_J - K_JJ * d_J);</div>
<div class="line"> </div>
<div class="line">            lin_it  = solver_control_K_con_inv.last_step();</div>
<div class="line">            lin_res = solver_control_K_con_inv.last_value();</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;Direct&quot;</span>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">            A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(tangent_matrix);</div>
<div class="line">            A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(newton_update, system_rhs);</div>
<div class="line"> </div>
<div class="line">            lin_it  = 1;</div>
<div class="line">            lin_res = 0.0;</div>
<div class="line"> </div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -- &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Linear solver type not implemented&quot;</span>));</div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> std::make_pair(lin_it, lin_res);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">      data_component_interpretation(</div>
<div class="line">        dim, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">    data_component_interpretation.push_back(</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">    data_component_interpretation.push_back(</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::string&gt; solution_name(dim, <span class="stringliteral">&quot;displacement&quot;</span>);</div>
<div class="line">    solution_name.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line">    solution_name.emplace_back(<span class="stringliteral">&quot;dilatation&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> output_flags;</div>
<div class="line">    output_flags.<a class="code" href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">write_higher_order_cells</a> = <span class="keyword">true</span>;</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">set_flags</a>(output_flags);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_n,</div>
<div class="line">                             solution_name,</div>
<div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                             data_component_interpretation);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> soln(solution_n.<a class="code" href="group__Exceptions.html#ga69b8dc1f71903659eb44f12e02359ac6">size</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; soln.size(); ++i)</div>
<div class="line">      soln(i) = solution_n(i);</div>
<div class="line">    <a class="code" href="classMappingQEulerian.html">MappingQEulerian&lt;dim&gt;</a> q_mapping(degree, dof_handler, soln);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>(q_mapping, degree);</div>
<div class="line"> </div>
<div class="line">    std::ofstream output(<span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(dim) + <span class="stringliteral">&quot;d-&quot;</span> +</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(time.get_timestep()) + <span class="stringliteral">&quot;.vtu&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace Step44</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span>Step44;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 3;</div>
<div class="line">      Solid&lt;dim&gt;         solid(<span class="stringliteral">&quot;parameters.prm&quot;</span>);</div>
<div class="line">      solid.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="asymmetric__tensor_8h_html_a31fa20712aae4f3b8ab9f62729b464d3"><div class="ttname"><a href="symmetric__tensor_8h.html#a31fa20712aae4f3b8ab9f62729b464d3">determinant</a></div><div class="ttdeci">constexpr Number determinant(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02622">symmetric_tensor.h:2622</a></div></div>
<div class="ttc" id="asymmetric__tensor_8h_html_a3656e2f6095f612536b06139a6a2ca39"><div class="ttname"><a href="symmetric__tensor_8h.html#a3656e2f6095f612536b06139a6a2ca39">invert</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 2, dim, Number &gt; invert(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03415">symmetric_tensor.h:3415</a></div></div>
<div class="ttc" id="asymmetric__tensor_8h_html_a4248760c880275bab1f288fc80f27039"><div class="ttname"><a href="symmetric__tensor_8h.html#a4248760c880275bab1f288fc80f27039">trace</a></div><div class="ttdeci">constexpr Number trace(const SymmetricTensor&lt; 2, dim2, Number &gt; &amp;)</div></div>
<div class="ttc" id="asymmetric__tensor_8h_html_a8c727eebb2d3d1870cbf4e77a3f45a6b"><div class="ttname"><a href="symmetric__tensor_8h.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 4, dim, Number &gt; outer_product(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t1, const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t2)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03466">symmetric_tensor.h:3466</a></div></div>
</div><!-- fragment --><p> 。 </b></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
