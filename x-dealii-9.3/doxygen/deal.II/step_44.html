<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_44.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-44 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.3.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.3.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-44 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_18.html">step-18</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Listofreferences">List of references</a>
        <li><a href="#Notation"> Notation </a>
        <li><a href="#Kinematics">Kinematics</a>
        <li><a href="#Kinetics">Kinetics</a>
        <li><a href="#Pushforwardandpullbackoperators"> Push-forward and pull-back operators </a>
        <li><a href="#Hyperelasticmaterials">Hyperelastic materials</a>
      <ul>
        <li><a href="#NeoHookeanmaterials"> Neo-Hookean materials </a>
      </ul>
        <li><a href="#Elasticitytensors">Elasticity tensors</a>
        <li><a href="#Principleofstationarypotentialenergyandthethreefieldformulation">Principle of stationary potential energy and the three-field formulation</a>
        <li><a href="#Discretizationofgoverningequations"> Discretization of governing equations </a>
        <li><a href="#Thematerialclass"> The material class </a>
        <li><a href="#Numericalexample"> Numerical example </a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Runtimeparameters">Run-time parameters</a>
      <ul>
        <li><a href="#FiniteElementsystem">Finite Element system</a>
        <li><a href="#Geometry">Geometry</a>
        <li><a href="#Materials">Materials</a>
        <li><a href="#Linearsolver">Linear solver</a>
        <li><a href="#Nonlinearsolver">Nonlinear solver</a>
        <li><a href="#Time">Time</a>
        <li><a href="#Allparameters">All parameters</a>
      </ul>
        <li><a href="#Timeclass">Time class</a>
        <li><a href="#CompressibleneoHookeanmaterialwithinathreefieldformulation">Compressible neo-Hookean material within a three-field formulation</a>
        <li><a href="#Quadraturepointhistory">Quadrature point history</a>
        <li><a href="#Quasistaticquasiincompressiblefinitestrainsolid">Quasi-static quasi-incompressible finite-strain solid</a>
        <li><a href="#ImplementationofthecodeSolidcodeclass">Implementation of the <code>Solid</code> class</a>
      <ul>
        <li><a href="#Publicinterface">Public interface</a>
      </ul>
        <li><a href="#Privateinterface">Private interface</a>
      <ul>
        <li><a href="#Threadingbuildingblocksstructures">Threading-building-blocks structures</a>
        <li><a href="#Solidmake_grid">Solid::make_grid</a>
        <li><a href="#Solidsystem_setup">Solid::system_setup</a>
        <li><a href="#Soliddetermine_component_extractors">Solid::determine_component_extractors</a>
        <li><a href="#Solidsetup_qph">Solid::setup_qph</a>
        <li><a href="#Solidupdate_qph_incremental">Solid::update_qph_incremental</a>
        <li><a href="#Solidsolve_nonlinear_timestep">Solid::solve_nonlinear_timestep</a>
        <li><a href="#Solidprint_conv_headerandSolidprint_conv_footer">Solid::print_conv_header and Solid::print_conv_footer</a>
        <li><a href="#Solidget_error_dilation">Solid::get_error_dilation</a>
        <li><a href="#Solidget_error_residual">Solid::get_error_residual</a>
        <li><a href="#Solidget_error_update">Solid::get_error_update</a>
        <li><a href="#Solidget_total_solution">Solid::get_total_solution</a>
        <li><a href="#Solidassemble_system">Solid::assemble_system</a>
        <li><a href="#Solidmake_constraints">Solid::make_constraints</a>
        <li><a href="#Solidassemble_sc">Solid::assemble_sc</a>
        <li><a href="#Solidsolve_linear_system">Solid::solve_linear_system</a>
        <li><a href="#Solidoutput_results">Solid::output_results</a>
      </ul>
        <li><a href="#Mainfunction">Main function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 <br  />
</p>
<p><em>This program was contributed by Jean-Paul Pelteret and Andrew McBride. <br  />
 This material is based upon work supported by the German Science Foundation (Deutsche Forschungsgemeinschaft, DFG), grant STE 544/39-1, and the National Research Foundation of South Africa. </em></p>
<dl class="section note"><dt>Note</dt><dd>If you use this program as a basis for your own work, please consider citing it in your list of references. The initial version of this work was contributed to the deal.II project by the authors listed in the following citation: <a href="https://doi.org/10.5281/zenodo.439772"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.439772.svg" alt="10.5281/zenodo.439772"/></a> </dd></dl>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>The subject of this tutorial is nonlinear solid mechanics. Classical single-field approaches (see e.g. <a class="el" href="step_18.html">step-18</a>) can not correctly describe the response of quasi-incompressible materials. The response is overly stiff; a phenomenon known as locking. Locking problems can be circumvented using a variety of alternative strategies. One such strategy is the three-field formulation. It is used here to model the three-dimensional, fully-nonlinear (geometrical and material) response of an isotropic continuum body. The material response is approximated as hyperelastic. Additionally, the three-field formulation employed is valid for quasi-incompressible as well as compressible materials.</p>
<p>The objective of this presentation is to provide a basis for using deal.II for problems in nonlinear solid mechanics. The linear problem was addressed in <a class="el" href="step_8.html">step-8</a>. A non-standard, hypoelastic-type form of the geometrically nonlinear problem was partially considered in <a class="el" href="step_18.html">step-18</a>: a rate form of the linearised constitutive relations is used and the problem domain evolves with the motion. Important concepts surrounding the nonlinear kinematics are absent in the theory and implementation. <a class="el" href="step_18.html">step-18</a> does, however, describe many of the key concepts to implement elasticity within the framework of deal.II.</p>
<p>We begin with a crash-course in nonlinear kinematics. For the sake of simplicity, we restrict our attention to the quasi-static problem. Thereafter, various key stress measures are introduced and the constitutive model described. We then describe the three-field formulation in detail prior to explaining the structure of the class used to manage the material. The setup of the example problem is then presented.</p>
<dl class="section note"><dt>Note</dt><dd>This tutorial has been developed (and is described in the introduction) for the problem of elasticity in three dimensions. While the space dimension could be changed in the main() routine, care needs to be taken. Two-dimensional elasticity problems, in general, exist only as idealizations of three-dimensional ones. That is, they are either plane strain or plane stress. The assumptions that follow either of these choices needs to be consistently imposed. For more information see the note in <a class="el" href="step_8.html">step-8</a>.</dd></dl>
<p><a class="anchor" id="Listofreferences"></a></p><h3>List of references</h3>
<p>The three-field formulation implemented here was pioneered by Simo et al. (1985) and is known as the mixed Jacobian-pressure formulation. Important related contributions include those by Simo and Taylor (1991), and Miehe (1994). The notation adopted here draws heavily on the excellent overview of the theoretical aspects of nonlinear solid mechanics by Holzapfel (2001). A nice overview of issues pertaining to incompressible elasticity (at small strains) is given in Hughes (2000).</p>
<ol>
<li>
J.C. Simo, R.L. Taylor and K.S. Pister (1985), Variational and projection methods for the volume constraint in finite deformation elasto-plasticity, <em> Computer Methods in Applied Mechanics and Engineering </em>, <b> 51 </b>, 1-3, 177-208. DOI: <a href="http://doi.org/10.1016/0045-7825(85)90033-7">10.1016/0045-7825(85)90033-7</a>; </li>
<li>
J.C. Simo and R.L. Taylor (1991), Quasi-incompressible finite elasticity in principal stretches. Continuum basis and numerical algorithms, <em> Computer Methods in Applied Mechanics and Engineering </em>, <b> 85 </b>, 3, 273-310. DOI: <a href="http://doi.org/10.1016/0045-7825(91)90100-K">10.1016/0045-7825(91)90100-K</a>; </li>
<li>
C. Miehe (1994), Aspects of the formulation and finite element implementation of large strain isotropic elasticity <em> International Journal for Numerical Methods in Engineering </em> <b> 37 </b>, 12, 1981-2004. DOI: <a href="http://doi.org/10.1002/nme.1620371202">10.1002/nme.1620371202</a>; </li>
<li>
G.A. Holzapfel (2001), Nonlinear Solid Mechanics. A Continuum Approach for Engineering, John Wiley &amp; Sons. ISBN: 0-471-82304-X; </li>
<li>
T.J.R. Hughes (2000), The Finite Element Method: Linear Static and Dynamic Finite Element Analysis, Dover. ISBN: 978-0486411811 </li>
</ol>
<p>An example where this three-field formulation is used in a coupled problem is documented in </p><ol>
<li>
J-P. V. Pelteret, D. Davydov, A. McBride, D. K. Vu, and P. Steinmann (2016), Computational electro- and magneto-elasticity for quasi-incompressible media immersed in free space, <em> International Journal for Numerical Methods in Engineering </em>. DOI: <a href="http://doi.org/10.1002/nme.5254">10.1002/nme.5254</a> </li>
</ol>
<p><a class="anchor" id="Notation"></a></p><h3>Notation </h3>
<p>One can think of fourth-order tensors as linear operators mapping second-order tensors (matrices) onto themselves in much the same way as matrices map vectors onto vectors. There are various fourth-order unit tensors that will be required in the forthcoming presentation. The fourth-order unit tensors \(\mathcal{I}\) and \(\overline{\mathcal{I}}\) are defined by </p><p class="formulaDsp">
\[ \mathbf{A} = \mathcal{I}:\mathbf{A} \qquad \text{and} \qquad \mathbf{A}^T = \overline{\mathcal{I}}:\mathbf{A} \, . \]
</p>
<p> Note \(\mathcal{I} \neq \overline{\mathcal{I}}^T\). Furthermore, we define the symmetric and skew-symmetric fourth-order unit tensors by </p><p class="formulaDsp">
\[ \mathcal{S} \dealcoloneq \dfrac{1}{2}[\mathcal{I} + \overline{\mathcal{I}}] \qquad \text{and} \qquad \mathcal{W} \dealcoloneq \dfrac{1}{2}[\mathcal{I} - \overline{\mathcal{I}}] \, , \]
</p>
<p> such that </p><p class="formulaDsp">
\[ \dfrac{1}{2}[\mathbf{A} + \mathbf{A}^T] = \mathcal{S}:\mathbf{A} \qquad \text{and} \qquad \dfrac{1}{2}[\mathbf{A} - \mathbf{A}^T] = \mathcal{W}:\mathbf{A} \, . \]
</p>
<p> The fourth-order <code><a class="el" href="classSymmetricTensor.html">SymmetricTensor</a></code> returned by <a class="el" href="symmetric__tensor_8h.html#ab3e890348aa219805e84f7d367e098c3">identity_tensor()</a> is \(\mathcal{S}\).</p>
<p><a class="anchor" id="Kinematics"></a></p><h3>Kinematics</h3>
<p>Let the time domain be denoted \(\mathbb{T} = [0,T_{\textrm{end}}]\), where \(t \in \mathbb{T}\) and \(T_{\textrm{end}}\) is the total problem duration. Consider a continuum body that occupies the reference configuration \(\Omega_0\) at time \(t=0\). Particles in the reference configuration are identified by the position vector \(\mathbf{X}\). The configuration of the body at a later time \(t&gt;0\) is termed the current configuration, denoted \(\Omega\), with particles identified by the vector \(\mathbf{x}\). The nonlinear map between the reference and current configurations, denoted \(\boldsymbol{\varphi}\), acts as follows: </p><p class="formulaDsp">
\[ \mathbf{x} = \boldsymbol{\varphi}(\mathbf{X},t) \, . \]
</p>
<p> The material description of the displacement of a particle is defined by </p><p class="formulaDsp">
\[ \mathbf{U}(\mathbf{X},t) = \mathbf{x}(\mathbf{X},t) - \mathbf{X} \, . \]
</p>
<p>The deformation gradient \(\mathbf{F}\) is defined as the material gradient of the motion: </p><p class="formulaDsp">
\[ \mathbf{F}(\mathbf{X},t) \dealcoloneq \dfrac{\partial \boldsymbol{\varphi}(\mathbf{X},t)}{\partial \mathbf{X}} = \textrm{Grad}\ \mathbf{x}(\mathbf{X},t) = \mathbf{I} + \textrm{Grad}\ \mathbf{U} \, . \]
</p>
<p> The determinant of the of the deformation gradient \(J(\mathbf{X},t) \dealcoloneq \textrm{det}\ \mathbf{F}(\mathbf{X},t) &gt; 0\) maps corresponding volume elements in the reference and current configurations, denoted \(\textrm{d}V\) and \(\textrm{d}v\), respectively, as </p><p class="formulaDsp">
\[ \textrm{d}v = J(\mathbf{X},t)\; \textrm{d}V \, . \]
</p>
<p>Two important measures of the deformation in terms of the spatial and material coordinates are the left and right Cauchy-Green tensors, respectively, and denoted \(\mathbf{b} \dealcoloneq \mathbf{F}\mathbf{F}^T\) and \(\mathbf{C} \dealcoloneq \mathbf{F}^T\mathbf{F}\). They are both symmetric and positive definite.</p>
<p>The Green-Lagrange strain tensor is defined by </p><p class="formulaDsp">
\[ \mathbf{E} \dealcoloneq \frac{1}{2}[\mathbf{C} - \mathbf{I} ] = \underbrace{\frac{1}{2}[\textrm{Grad}^T \mathbf{U} + \textrm{Grad}\mathbf{U}]}_{\boldsymbol{\varepsilon}} + \frac{1}{2}[\textrm{Grad}^T\ \mathbf{U}][\textrm{Grad}\ \mathbf{U}] \, . \]
</p>
<p> If the assumption of infinitesimal deformations is made, then the second term on the right can be neglected, and \(\boldsymbol{\varepsilon}\) (the linearised strain tensor) is the only component of the strain tensor. This assumption is, looking at the setup of the problem, not valid in <a class="el" href="step_18.html">step-18</a>, making the use of the linearized \(\boldsymbol{\varepsilon}\) as the strain measure in that tutorial program questionable.</p>
<p>In order to handle the different response that materials exhibit when subjected to bulk and shear type deformations we consider the following decomposition of the deformation gradient \(\mathbf{F}\) and the left Cauchy-Green tensor \(\mathbf{b}\) into volume-changing (volumetric) and volume-preserving (isochoric) parts: </p><p class="formulaDsp">
\[ \mathbf{F} = (J^{1/3}\mathbf{I})\overline{\mathbf{F}} \qquad \text{and} \qquad \mathbf{b} = (J^{2/3}\mathbf{I})\overline{\mathbf{F}}\,\overline{\mathbf{F}}^T = (J^{2/3}\mathbf{I})\overline{\mathbf{b}} \, . \]
</p>
<p> Clearly, \(\textrm{det}\ \mathbf{F} = \textrm{det}\ (J^{1/3}\mathbf{I}) = J\).</p>
<p>The spatial velocity field is denoted \(\mathbf{v}(\mathbf{x},t)\). The derivative of the spatial velocity field with respect to the spatial coordinates gives the spatial velocity gradient \(\mathbf{l}(\mathbf{x},t)\), that is </p><p class="formulaDsp">
\[ \mathbf{l}(\mathbf{x},t) \dealcoloneq \dfrac{\partial \mathbf{v}(\mathbf{x},t)}{\partial \mathbf{x}} = \textrm{grad}\ \mathbf{v}(\mathbf{x},t) \, , \]
</p>
<p> where \(\textrm{grad} \{\bullet \} = \frac{\partial \{ \bullet \} }{ \partial \mathbf{x}} = \frac{\partial \{ \bullet \} }{ \partial \mathbf{X}}\frac{\partial \mathbf{X} }{ \partial \mathbf{x}} = \textrm{Grad} \{ \bullet \} \mathbf{F}^{-1}\).</p>
<p><a class="anchor" id="Kinetics"></a></p><h3>Kinetics</h3>
<p>Cauchy's stress theorem equates the Cauchy traction \(\mathbf{t}\) acting on an infinitesimal surface element in the current configuration \(\mathrm{d}a\) to the product of the Cauchy stress tensor \(\boldsymbol{\sigma}\) (a spatial quantity) and the outward unit normal to the surface \(\mathbf{n}\) as </p><p class="formulaDsp">
\[ \mathbf{t}(\mathbf{x},t, \mathbf{n}) = \boldsymbol{\sigma}\mathbf{n} \, . \]
</p>
<p> The Cauchy stress is symmetric. Similarly, the first Piola-Kirchhoff traction \(\mathbf{T}\) which acts on an infinitesimal surface element in the reference configuration \(\mathrm{d}A\) is the product of the first Piola-Kirchhoff stress tensor \(\mathbf{P}\) (a two-point tensor) and the outward unit normal to the surface \(\mathbf{N}\) as </p><p class="formulaDsp">
\[ \mathbf{T}(\mathbf{X},t, \mathbf{N}) = \mathbf{P}\mathbf{N} \, . \]
</p>
<p> The Cauchy traction \(\mathbf{t}\) and the first Piola-Kirchhoff traction \(\mathbf{T}\) are related as </p><p class="formulaDsp">
\[ \mathbf{t}\mathrm{d}a = \mathbf{T}\mathrm{d}A \, . \]
</p>
<p> This can be demonstrated using <a href="http://en.wikipedia.org/wiki/Finite_strain_theory">Nanson's formula</a>.</p>
<p>The first Piola-Kirchhoff stress tensor is related to the Cauchy stress as </p><p class="formulaDsp">
\[ \mathbf{P} = J \boldsymbol{\sigma}\mathbf{F}^{-T} \, . \]
</p>
<p> Further important stress measures are the (spatial) Kirchhoff stress \(\boldsymbol{\tau} = J \boldsymbol{\sigma}\) and the (referential) second Piola-Kirchhoff stress \(\mathbf{S} = {\mathbf{F}}^{-1} \boldsymbol{\tau} {\mathbf{F}}^{-T}\).</p>
<p><a class="anchor" id="Pushforwardandpullbackoperators"></a></p><h3>Push-forward and pull-back operators </h3>
<p>Push-forward and pull-back operators allow one to transform various measures between the material and spatial settings. The stress measures used here are contravariant, while the strain measures are covariant.</p>
<p>The push-forward and-pull back operations for second-order covariant tensors \((\bullet)^{\text{cov}}\) are respectively given by: </p><p class="formulaDsp">
\[ \chi_{*}(\bullet)^{\text{cov}} \dealcoloneq \mathbf{F}^{-T} (\bullet)^{\text{cov}} \mathbf{F}^{-1} \qquad \text{and} \qquad \chi^{-1}_{*}(\bullet)^{\text{cov}} \dealcoloneq \mathbf{F}^{T} (\bullet)^{\text{cov}} \mathbf{F} \, . \]
</p>
<p>The push-forward and pull back operations for second-order contravariant tensors \((\bullet)^{\text{con}}\) are respectively given by: </p><p class="formulaDsp">
\[ \chi_{*}(\bullet)^{\text{con}} \dealcoloneq \mathbf{F} (\bullet)^{\text{con}} \mathbf{F}^T \qquad \text{and} \qquad \chi^{-1}_{*}(\bullet)^{\text{con}} \dealcoloneq \mathbf{F}^{-1} (\bullet)^{\text{con}} \mathbf{F}^{-T} \, . \]
</p>
<p> For example \(\boldsymbol{\tau} = \chi_{*}(\mathbf{S})\).</p>
<p><a class="anchor" id="Hyperelasticmaterials"></a></p><h3>Hyperelastic materials</h3>
<p>A hyperelastic material response is governed by a Helmholtz free energy function \(\Psi = \Psi(\mathbf{F}) = \Psi(\mathbf{C}) = \Psi(\mathbf{b})\) which serves as a potential for the stress. For example, if the Helmholtz free energy depends on the right Cauchy-Green tensor \(\mathbf{C}\) then the isotropic hyperelastic response is </p><p class="formulaDsp">
\[ \mathbf{S} = 2 \dfrac{\partial \Psi(\mathbf{C})}{\partial \mathbf{C}} \, . \]
</p>
<p> If the Helmholtz free energy depends on the left Cauchy-Green tensor \(\mathbf{b}\) then the isotropic hyperelastic response is </p><p class="formulaDsp">
\[ \boldsymbol{\tau} = 2 \dfrac{\partial \Psi(\mathbf{b})}{\partial \mathbf{b}} \mathbf{b} = 2 \mathbf{b} \dfrac{\partial \Psi(\mathbf{b})}{\partial \mathbf{b}} \, . \]
</p>
<p>Following the multiplicative decomposition of the deformation gradient, the Helmholtz free energy can be decomposed as </p><p class="formulaDsp">
\[ \Psi(\mathbf{b}) = \Psi_{\text{vol}}(J) + \Psi_{\text{iso}}(\overline{\mathbf{b}}) \, . \]
</p>
<p> Similarly, the Kirchhoff stress can be decomposed into volumetric and isochoric parts as \(\boldsymbol{\tau} = \boldsymbol{\tau}_{\text{vol}} + \boldsymbol{\tau}_{\text{iso}}\) where: </p><p class="formulaDsp">
\begin{align*} \boldsymbol{\tau}_{\text{vol}} &amp;= 2 \mathbf{b} \dfrac{\partial \Psi_{\textrm{vol}}(J)}{\partial \mathbf{b}} \\ &amp;= p J\mathbf{I} \, , \\ \boldsymbol{\tau}_{\text{iso}} &amp;= 2 \mathbf{b} \dfrac{\partial \Psi_{\textrm{iso}} (\overline{\mathbf{b}})}{\partial \mathbf{b}} \\ &amp;= \underbrace{( \mathcal{I} - \dfrac{1}{3} \mathbf{I} \otimes \mathbf{I})}_{\mathbb{P}} : \overline{\boldsymbol{\tau}} \, , \end{align*}
</p>
<p> where \(p \dealcoloneq \dfrac{\partial \Psi_{\text{vol}}(J)}{\partial J}\) is the pressure response. \(\mathbb{P}\) is the projection tensor which provides the deviatoric operator in the Eulerian setting. The fictitious Kirchhoff stress tensor \(\overline{\boldsymbol{\tau}}\) is defined by </p><p class="formulaDsp">
\[ \overline{\boldsymbol{\tau}} \dealcoloneq 2 \overline{\mathbf{b}} \dfrac{\partial \Psi_{\textrm{iso}}(\overline{\mathbf{b}})}{\partial \overline{\mathbf{b}}} \, . \]
</p>
<dl class="section note"><dt>Note</dt><dd>The pressure response as defined above differs from the widely-used definition of the pressure in solid mechanics as \(p = - 1/3 \textrm{tr} \boldsymbol{\sigma} = - 1/3 J^{-1} \textrm{tr} \boldsymbol{\tau}\). Here \(p\) is the hydrostatic pressure. We make use of the pressure response throughout this tutorial (although we refer to it as the pressure).</dd></dl>
<p><a class="anchor" id="NeoHookeanmaterials"></a></p><h4>Neo-Hookean materials </h4>
<p>The Helmholtz free energy corresponding to a compressible <a href="http://en.wikipedia.org/wiki/Neo-Hookean_solid">neo-Hookean material</a> is given by </p><p class="formulaDsp">
\[ \Psi \equiv \underbrace{\kappa [ \mathcal{G}(J) ] }_{\Psi_{\textrm{vol}}(J)} + \underbrace{\bigl[c_1 [ \overline{I}_1 - 3] \bigr]}_{\Psi_{\text{iso}}(\overline{\mathbf{b}})} \, , \]
</p>
<p> where \(\kappa \dealcoloneq \lambda + 2/3 \mu\) is the bulk modulus ( \(\lambda\) and \(\mu\) are the Lam&eacute; parameters) and \(\overline{I}_1 \dealcoloneq \textrm{tr}\ \overline{\mathbf{b}}\). The function \(\mathcal{G}(J)\) is required to be strictly convex and satisfy the condition \(\mathcal{G}(1) = 0\), among others, see Holzapfel (2001) for further details. In this work \(\mathcal{G} \dealcoloneq \frac{1}{4} [ J^2 - 1 - 2\textrm{ln}J ]\).</p>
<p>Incompressibility imposes the isochoric constraint that \(J=1\) for all motions \(\boldsymbol{\varphi}\). The Helmholtz free energy corresponding to an incompressible neo-Hookean material is given by </p><p class="formulaDsp">
\[ \Psi \equiv \underbrace{\bigl[ c_1 [ I_1 - 3] \bigr] }_{\Psi_{\textrm{iso}}(\mathbf{b})} \, , \]
</p>
<p> where \( I_1 \dealcoloneq \textrm{tr}\mathbf{b} \). Thus, the incompressible response is obtained by removing the volumetric component from the compressible free energy and enforcing \(J=1\).</p>
<p><a class="anchor" id="Elasticitytensors"></a></p><h3>Elasticity tensors</h3>
<p>We will use a Newton-Raphson strategy to solve the nonlinear boundary value problem. Thus, we will need to linearise the constitutive relations.</p>
<p>The fourth-order elasticity tensor in the material description is defined by </p><p class="formulaDsp">
\[ \mathfrak{C} = 2\dfrac{\partial \mathbf{S}(\mathbf{C})}{\partial \mathbf{C}} = 4\dfrac{\partial^2 \Psi(\mathbf{C})}{\partial \mathbf{C} \partial \mathbf{C}} \, . \]
</p>
<p> The fourth-order elasticity tensor in the spatial description \(\mathfrak{c}\) is obtained from the push-forward of \(\mathfrak{C}\) as </p><p class="formulaDsp">
\[ \mathfrak{c} = J^{-1} \chi_{*}(\mathfrak{C}) \qquad \text{and thus} \qquad J\mathfrak{c} = 4 \mathbf{b} \dfrac{\partial^2 \Psi(\mathbf{b})} {\partial \mathbf{b} \partial \mathbf{b}} \mathbf{b} \, . \]
</p>
<p> The fourth-order elasticity tensors (for hyperelastic materials) possess both major and minor symmetries.</p>
<p>The fourth-order spatial elasticity tensor can be written in the following decoupled form: </p><p class="formulaDsp">
\[ \mathfrak{c} = \mathfrak{c}_{\text{vol}} + \mathfrak{c}_{\text{iso}} \, , \]
</p>
<p> where </p><p class="formulaDsp">
\begin{align*} J \mathfrak{c}_{\text{vol}} &amp;= 4 \mathbf{b} \dfrac{\partial^2 \Psi_{\text{vol}}(J)} {\partial \mathbf{b} \partial \mathbf{b}} \mathbf{b} \\ &amp;= J[\widehat{p}\, \mathbf{I} \otimes \mathbf{I} - 2p \mathcal{I}] \qquad \text{where} \qquad \widehat{p} \dealcoloneq p + \dfrac{\textrm{d} p}{\textrm{d}J} \, , \\ J \mathfrak{c}_{\text{iso}} &amp;= 4 \mathbf{b} \dfrac{\partial^2 \Psi_{\text{iso}}(\overline{\mathbf{b}})} {\partial \mathbf{b} \partial \mathbf{b}} \mathbf{b} \\ &amp;= \mathbb{P} : \mathfrak{\overline{c}} : \mathbb{P} + \dfrac{2}{3}[\overline{\boldsymbol{\tau}}:\mathbf{I}]\mathbb{P} - \dfrac{2}{3}[ \mathbf{I}\otimes\boldsymbol{\tau}_{\text{iso}} + \boldsymbol{\tau}_{\text{iso}} \otimes \mathbf{I} ] \, , \end{align*}
</p>
<p> where the fictitious elasticity tensor \(\overline{\mathfrak{c}}\) in the spatial description is defined by </p><p class="formulaDsp">
\[ \overline{\mathfrak{c}} = 4 \overline{\mathbf{b}} \dfrac{ \partial^2 \Psi_{\textrm{iso}}(\overline{\mathbf{b}})} {\partial \overline{\mathbf{b}} \partial \overline{\mathbf{b}}} \overline{\mathbf{b}} \, . \]
</p>
<p><a class="anchor" id="Principleofstationarypotentialenergyandthethreefieldformulation"></a></p><h3>Principle of stationary potential energy and the three-field formulation</h3>
<p>The total potential energy of the system \(\Pi\) is the sum of the internal and external potential energies, denoted \(\Pi_{\textrm{int}}\) and \(\Pi_{\textrm{ext}}\), respectively. We wish to find the equilibrium configuration by minimising the potential energy.</p>
<p>As mentioned above, we adopt a three-field formulation. We denote the set of primary unknowns by \(\mathbf{\Xi} \dealcoloneq \{ \mathbf{u}, \widetilde{p}, \widetilde{J} \}\). The independent kinematic variable \(\widetilde{J}\) enters the formulation as a constraint on \(J\) enforced by the Lagrange multiplier \(\widetilde{p}\) (the pressure, as we shall see).</p>
<p>The three-field variational principle used here is given by </p><p class="formulaDsp">
\[ \Pi(\mathbf{\Xi}) \dealcoloneq \int_\Omega \bigl[ \Psi_{\textrm{vol}}(\widetilde{J}) + \widetilde{p}\,[J(\mathbf{u}) - \widetilde{J}] + \Psi_{\textrm{iso}}(\overline{\mathbf{b}}(\mathbf{u})) \bigr] \textrm{d}v + \Pi_{\textrm{ext}} \, , \]
</p>
<p> where the external potential is defined by </p><p class="formulaDsp">
\[ \Pi_{\textrm{ext}} = - \int_\Omega \mathbf{b}^\text{p} \cdot \mathbf{u}~\textrm{d}v - \int_{\partial \Omega_{\sigma}} \mathbf{t}^\text{p} \cdot \mathbf{u}~\textrm{d}a \, . \]
</p>
<p> The boundary of the current configuration \(\partial \Omega\) is composed into two parts as \(\partial \Omega = \partial \Omega_{\mathbf{u}} \cup \partial \Omega_{\sigma}\), where \(\partial \Omega_{\mathbf{u}} \cap \partial \Omega_{\boldsymbol{\sigma}} = \emptyset\). The prescribed Cauchy traction, denoted \(\mathbf{t}^\text{p}\), is applied to \( \partial \Omega_{\boldsymbol{\sigma}}\) while the motion is prescribed on the remaining portion of the boundary \(\partial \Omega_{\mathbf{u}}\). The body force per unit current volume is denoted \(\mathbf{b}^\text{p}\).</p>
<p>The stationarity of the potential follows as </p><p class="formulaDsp">
\begin{align*} R(\mathbf\Xi;\delta \mathbf{\Xi}) &amp;= D_{\delta \mathbf{\Xi}}\Pi(\mathbf{\Xi}) \\ &amp;= \dfrac{\partial \Pi(\mathbf{\Xi})}{\partial \mathbf{u}} \cdot \delta \mathbf{u} + \dfrac{\partial \Pi(\mathbf{\Xi})}{\partial \widetilde{p}} \delta \widetilde{p} + \dfrac{\partial \Pi(\mathbf{\Xi})}{\partial \widetilde{J}} \delta \tilde{J} \\ &amp;= \int_{\Omega_0} \left[ \textrm{grad}\ \delta\mathbf{u} : [ \underbrace{[\widetilde{p} J \mathbf{I}]}_{\equiv \boldsymbol{\tau}_{\textrm{vol}}} + \boldsymbol{\tau}_{\textrm{iso}}] + \delta \widetilde{p}\, [ J(\mathbf{u}) - \widetilde{J}] + \delta \widetilde{J}\left[ \dfrac{\textrm{d} \Psi_{\textrm{vol}}(\widetilde{J})}{\textrm{d} \widetilde{J}} -\widetilde{p}\right] \right]~\textrm{d}V \\ &amp;\quad - \int_{\Omega_0} \delta \mathbf{u} \cdot \mathbf{B}^\text{p}~\textrm{d}V - \int_{\partial \Omega_{0,\boldsymbol{\sigma}}} \delta \mathbf{u} \cdot \mathbf{T}^\text{p}~\textrm{d}A \\ &amp;=0 \, , \end{align*}
</p>
<p> for all virtual displacements \(\delta \mathbf{u} \in H^1(\Omega)\) subject to the constraint that \(\delta \mathbf{u} = \mathbf{0}\) on \(\partial \Omega_{\mathbf{u}}\), and all virtual pressures \(\delta \widetilde{p} \in L^2(\Omega)\) and virtual dilatations \(\delta \widetilde{J} \in L^2(\Omega)\).</p>
<p>One should note that the definitions of the volumetric Kirchhoff stress in the three field formulation \(\boldsymbol{\tau}_{\textrm{vol}} \equiv \widetilde{p} J \mathbf{I}\) and the subsequent volumetric tangent differs slightly from the general form given in the section on hyperelastic materials where \(\boldsymbol{\tau}_{\textrm{vol}} \equiv p J\mathbf{I}\). This is because the pressure \(\widetilde{p}\) is now a primary field as opposed to a constitutively derived quantity. One needs to carefully distinguish between the primary fields and those obtained from the constitutive relations.</p>
<dl class="section note"><dt>Note</dt><dd>Although the variables are all expressed in terms of spatial quantities, the domain of integration is the initial configuration. This approach is called a <em> total-Lagrangian formulation </em>. The approach given in <a class="el" href="step_18.html">step-18</a>, where the domain of integration is the current configuration, could be called an <em> updated Lagrangian formulation </em>. The various merits of these two approaches are discussed widely in the literature. It should be noted however that they are equivalent.</dd></dl>
<p>The Euler-Lagrange equations corresponding to the residual are: </p><p class="formulaDsp">
\begin{align*} &amp;\textrm{div}\ \boldsymbol{\sigma} + \mathbf{b}^\text{p} = \mathbf{0} &amp;&amp; \textrm{[equilibrium]} \\ &amp;J(\mathbf{u}) = \widetilde{J} &amp;&amp; \textrm{[dilatation]} \\ &amp;\widetilde{p} = \dfrac{\textrm{d} \Psi_{\textrm{vol}}(\widetilde{J})}{\textrm{d} \widetilde{J}} &amp;&amp; \textrm{[pressure]} \, . \end{align*}
</p>
<p> The first equation is the (quasi-static) equilibrium equation in the spatial setting. The second is the constraint that \(J(\mathbf{u}) = \widetilde{J}\). The third is the definition of the pressure \(\widetilde{p}\).</p>
<dl class="section note"><dt>Note</dt><dd>The simplified single-field derivation ( \(\mathbf{u}\) is the only primary variable) below makes it clear how we transform the limits of integration to the reference domain: <p class="formulaDsp">
\begin{align*} \int_{\Omega}\delta \mathbf{u} \cdot [\textrm{div}\ \boldsymbol{\sigma} + \mathbf{b}^\text{p}]~\mathrm{d}v &amp;= \int_{\Omega} [-\mathrm{grad}\delta \mathbf{u}:\boldsymbol{\sigma} + \delta \mathbf{u} \cdot\mathbf{b}^\text{p}]~\mathrm{d}v + \int_{\partial \Omega} \delta \mathbf{u} \cdot \mathbf{t}^\text{p}~\mathrm{d}a \\ &amp;= - \int_{\Omega_0} \mathrm{grad}\delta \mathbf{u}:\boldsymbol{\tau}~\mathrm{d}V + \int_{\Omega_0} \delta \mathbf{u} \cdot J\mathbf{b}^\text{p}~\mathrm{d}V + \int_{\partial \Omega_0} \delta \mathbf{u} \cdot \mathbf{T}^\text{p}~\mathrm{d}A \\ &amp;= - \int_{\Omega_0} \mathrm{grad}\delta \mathbf{u}:\boldsymbol{\tau}~\mathrm{d}V + \int_{\Omega_0} \delta \mathbf{u} \cdot \mathbf{B}^\text{p}~\mathrm{d}V + \int_{\partial \Omega_{0,\sigma}} \delta \mathbf{u} \cdot \mathbf{T}^\text{p}~\mathrm{d}A \\ &amp;= - \int_{\Omega_0} [\mathrm{grad}\delta\mathbf{u}]^{\text{sym}} :\boldsymbol{\tau}~\mathrm{d}V + \int_{\Omega_0} \delta \mathbf{u} \cdot \mathbf{B}^\text{p}~\mathrm{d}V + \int_{\partial \Omega_{0,\sigma}} \delta \mathbf{u} \cdot \mathbf{T}^\text{p}~\mathrm{d}A \, , \end{align*}
</p>
 where \([\mathrm{grad}\delta\mathbf{u}]^{\text{sym}} = 1/2[ \mathrm{grad}\delta\mathbf{u} + [\mathrm{grad}\delta\mathbf{u}]^T] \).</dd></dl>
<p>We will use an iterative Newton-Raphson method to solve the nonlinear residual equation \(R\). For the sake of simplicity we assume dead loading, i.e. the loading does not change due to the deformation.</p>
<p>The change in a quantity between the known state at \(t_{\textrm{n}-1}\) and the currently unknown state at \(t_{\textrm{n}}\) is denoted \(\varDelta \{ \bullet \} = { \{ \bullet \} }^{\textrm{n}} - { \{ \bullet \} }^{\textrm{n-1}}\). The value of a quantity at the current iteration \(\textrm{i}\) is denoted \({ \{ \bullet \} }^{\textrm{n}}_{\textrm{i}} = { \{ \bullet \} }_{\textrm{i}}\). The incremental change between iterations \(\textrm{i}\) and \(\textrm{i}+1\) is denoted \(d \{ \bullet \} \dealcoloneq \{ \bullet \}_{\textrm{i}+1} - \{ \bullet \}_{\textrm{i}}\).</p>
<p>Assume that the state of the system is known for some iteration \(\textrm{i}\). The linearised approximation to nonlinear governing equations to be solved using the Newton-Raphson method is: Find \(d \mathbf{\Xi}\) such that </p><p class="formulaDsp">
\[ R(\mathbf{\Xi}_{\mathsf{i}+1}) = R(\mathbf{\Xi}_{\mathsf{i}}) + D^2_{d \mathbf{\Xi}, \delta \mathbf{\Xi}} \Pi(\mathbf{\Xi_{\mathsf{i}}}) \cdot d \mathbf{\Xi} \equiv 0 \, , \]
</p>
<p> then set \(\mathbf{\Xi}_{\textrm{i}+1} = \mathbf{\Xi}_{\textrm{i}} + d \mathbf{\Xi}\). The tangent is given by</p>
<p class="formulaDsp">
\[ D^2_{d \mathbf{\Xi}, \delta \mathbf{\Xi}} \Pi( \mathbf{\Xi}_{\mathsf{i}} ) = D_{d \mathbf{\Xi}} R( \mathbf{\Xi}_{\mathsf{i}}; \delta \mathbf{\Xi}) =: K(\mathbf{\Xi}_{\mathsf{i}}; d \mathbf{\Xi}, \delta \mathbf{\Xi}) \, . \]
</p>
<p> Thus, </p><p class="formulaDsp">
\begin{align*} K(\mathbf{\Xi}_{\mathsf{i}}; d \mathbf{\Xi}, \delta \mathbf{\Xi}) &amp;= D_{d \mathbf{u}} R( \mathbf{\Xi}_{\mathsf{i}}; \delta \mathbf{\Xi}) \cdot d \mathbf{u} \\ &amp;\quad + D_{d \widetilde{p}} R( \mathbf{\Xi}_{\mathsf{i}}; \delta \mathbf{\Xi}) d \widetilde{p} \\ &amp;\quad + D_{d \widetilde{J}} R( \mathbf{\Xi}_{\mathsf{i}}; \delta \mathbf{\Xi}) d \widetilde{J} \, , \end{align*}
</p>
<p> where </p><p class="formulaDsp">
\begin{align*} D_{d \mathbf{u}} R( \mathbf{\Xi}; \delta \mathbf{\Xi}) &amp;= \int_{\Omega_0} \bigl[ \textrm{grad}\ \delta \mathbf{u} : \textrm{grad}\ d \mathbf{u} [\boldsymbol{\tau}_{\textrm{iso}} + \boldsymbol{\tau}_{\textrm{vol}}] + \textrm{grad}\ \delta \mathbf{u} :[ \underbrace{[\widetilde{p}J[\mathbf{I}\otimes\mathbf{I} - 2 \mathcal{I}]}_{\equiv J\mathfrak{c}_{\textrm{vol}}} + J\mathfrak{c}_{\textrm{iso}}] :\textrm{grad} d \mathbf{u} \bigr]~\textrm{d}V \, , \\ &amp;\quad + \int_{\Omega_0} \delta \widetilde{p} J \mathbf{I} : \textrm{grad}\ d \mathbf{u} ~\textrm{d}V \\ D_{d \widetilde{p}} R( \mathbf{\Xi}; \delta \mathbf{\Xi}) &amp;= \int_{\Omega_0} \textrm{grad}\ \delta \mathbf{u} : J \mathbf{I} d \widetilde{p} ~\textrm{d}V - \int_{\Omega_0} \delta \widetilde{J} d \widetilde{p} ~\textrm{d}V \, , \\ D_{d \widetilde{J}} R( \mathbf{\Xi}; \delta \mathbf{\Xi}) &amp;= -\int_{\Omega_0} \delta \widetilde{p} d \widetilde{J}~\textrm{d}V + \int_{\Omega_0} \delta \widetilde{J} \dfrac{\textrm{d}^2 \Psi_{\textrm{vol}}(\widetilde{J})}{\textrm{d} \widetilde{J}\textrm{d}\widetilde{J}} d \widetilde{J} ~\textrm{d}V \, . \end{align*}
</p>
<p>Note that the following terms are termed the geometrical stress and the material contributions to the tangent matrix: </p><p class="formulaDsp">
\begin{align*} &amp; \int_{\Omega_0} \textrm{grad}\ \delta \mathbf{u} : \textrm{grad}\ d \mathbf{u} [\boldsymbol{\tau}_{\textrm{iso}} + \boldsymbol{\tau}_{\textrm{vol}}]~\textrm{d}V &amp;&amp; \quad {[\textrm{Geometrical stress}]} \, , \\ &amp; \int_{\Omega_0} \textrm{grad} \delta \mathbf{u} : [J\mathfrak{c}_{\textrm{vol}} + J\mathfrak{c}_{\textrm{iso}}] :\textrm{grad}\ d \mathbf{u} ~\textrm{d}V &amp;&amp; \quad {[\textrm{Material}]} \, . \end{align*}
</p>
<p><a class="anchor" id="Discretizationofgoverningequations"></a></p><h3>Discretization of governing equations </h3>
<p>The three-field formulation used here is effective for quasi-incompressible materials, that is where \(\nu \rightarrow 0.5\) (where \(\nu\) is <a href="http://en.wikipedia.org/wiki/Poisson&#39;s_ratio">Poisson's ratio</a>), subject to a good choice of the interpolation fields for \(\mathbf{u},~\widetilde{p}\) and \(\widetilde{J}\). Typically a choice of \(Q_n \times DGPM_{n-1} \times DGPM_{n-1}\) is made. Here \(DGPM\) is the <a class="el" href="classFE__DGPMonomial.html">FE_DGPMonomial</a> class. A popular choice is \(Q_1 \times DGPM_0 \times DGPM_0\) which is known as the mean dilatation method (see Hughes (2000) for an intuitive discussion). This code can accommodate a \(Q_n \times DGPM_{n-1} \times DGPM_{n-1}\) formulation. The discontinuous approximation allows \(\widetilde{p}\) and \(\widetilde{J}\) to be condensed out and a classical displacement based method is recovered.</p>
<p>For fully-incompressible materials \(\nu = 0.5\) and the three-field formulation will still exhibit locking behavior. This can be overcome by introducing an additional constraint into the free energy of the form \(\int_{\Omega_0} \Lambda [ \widetilde{J} - 1]~\textrm{d}V\). Here \(\Lambda\) is a Lagrange multiplier to enforce the isochoric constraint. For further details see Miehe (1994).</p>
<p>The linearised problem can be written as </p><p class="formulaDsp">
\[ \mathbf{\mathsf{K}}( \mathbf{\Xi}_{\textrm{i}}) d\mathbf{\Xi} = \mathbf{ \mathsf{F}}(\mathbf{\Xi}_{\textrm{i}}) \]
</p>
<p> where </p><p class="formulaDsp">
\begin{align*} \underbrace{\begin{bmatrix} \mathbf{\mathsf{K}}_{uu} &amp; \mathbf{\mathsf{K}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathbf{\mathsf{K}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}} \\ \mathbf{0} &amp; \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}} &amp; \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}} \end{bmatrix}}_{\mathbf{\mathsf{K}}(\mathbf{\Xi}_{\textrm{i}})} \underbrace{\begin{bmatrix} d \mathbf{\mathsf{u}}\\ d \widetilde{\mathbf{\mathsf{p}}} \\ d \widetilde{\mathbf{\mathsf{J}}} \end{bmatrix}}_{d \mathbf{\Xi}} = \underbrace{\begin{bmatrix} -\mathbf{\mathsf{R}}_{u}(\mathbf{u}_{\textrm{i}}) \\ -\mathbf{\mathsf{R}}_{\widetilde{p}}(\widetilde{p}_{\textrm{i}}) \\ -\mathbf{\mathsf{R}}_{\widetilde{J}}(\widetilde{J}_{\textrm{i}}) \end{bmatrix}}_{ -\mathbf{\mathsf{R}}(\mathbf{\Xi}_{\textrm{i}}) } = \underbrace{\begin{bmatrix} \mathbf{\mathsf{F}}_{u}(\mathbf{u}_{\textrm{i}}) \\ \mathbf{\mathsf{F}}_{\widetilde{p}}(\widetilde{p}_{\textrm{i}}) \\ \mathbf{\mathsf{F}}_{\widetilde{J}}(\widetilde{J}_{\textrm{i}}) \end{bmatrix}}_{ \mathbf{\mathsf{F}}(\mathbf{\Xi}_{\textrm{i}}) } \, . \end{align*}
</p>
<p>There are no derivatives of the pressure and dilatation (primary) variables present in the formulation. Thus the discontinuous finite element interpolation of the pressure and dilatation yields a block diagonal matrix for \(\mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}\), \(\mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}\) and \(\mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}}\). Therefore we can easily express the fields \(\widetilde{p}\) and \(\widetilde{J}\) on each cell simply by inverting a local matrix and multiplying it by the local right hand side. We can then insert the result into the remaining equations and recover a classical displacement-based method. In order to condense out the pressure and dilatation contributions at the element level we need the following results: </p><p class="formulaDsp">
\begin{align*} d \widetilde{\mathbf{\mathsf{p}}} &amp; = \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \bigl[ \mathbf{\mathsf{F}}_{\widetilde{J}} - \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathbf{\mathsf{J}}} \bigr] \\ d \widetilde{\mathbf{\mathsf{J}}} &amp; = \mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \bigl[ \mathbf{\mathsf{F}}_{\widetilde{p}} - \mathbf{\mathsf{K}}_{\widetilde{p}u} d \mathbf{\mathsf{u}} \bigr] \\ \Rightarrow d \widetilde{\mathbf{\mathsf{p}}} &amp;= \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathbf{\mathsf{F}}_{\widetilde{J}} - \underbrace{\bigl[\mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}} \mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}^{-1}\bigr]}_{\overline{\mathbf{\mathsf{K}}}}\bigl[ \mathbf{\mathsf{F}}_{\widetilde{p}} - \mathbf{\mathsf{K}}_{\widetilde{p}u} d \mathbf{\mathsf{u}} \bigr] \end{align*}
</p>
<p> and thus </p><p class="formulaDsp">
\[ \underbrace{\bigl[ \mathbf{\mathsf{K}}_{uu} + \overline{\overline{\mathbf{\mathsf{K}}}}~ \bigr] }_{\mathbf{\mathsf{K}}_{\textrm{con}}} d \mathbf{\mathsf{u}} = \underbrace{ \Bigl[ \mathbf{\mathsf{F}}_{u} - \mathbf{\mathsf{K}}_{u\widetilde{p}} \bigl[ \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathbf{\mathsf{F}}_{\widetilde{J}} - \overline{\mathbf{\mathsf{K}}}\mathbf{\mathsf{F}}_{\widetilde{p}} \bigr] \Bigr]}_{\mathbf{\mathsf{F}}_{\textrm{con}}} \]
</p>
<p> where </p><p class="formulaDsp">
\[ \overline{\overline{\mathbf{\mathsf{K}}}} \dealcoloneq \mathbf{\mathsf{K}}_{u\widetilde{p}} \overline{\mathbf{\mathsf{K}}} \mathbf{\mathsf{K}}_{\widetilde{p}u} \, . \]
</p>
<p> Note that due to the choice of \(\widetilde{p}\) and \(\widetilde{J}\) as discontinuous at the element level, all matrices that need to be inverted are defined at the element level.</p>
<p>The procedure to construct the various contributions is as follows:</p><ul>
<li>Construct \(\mathbf{\mathsf{K}}\).</li>
<li>Form \(\mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}^{-1}\) for element and store where \(\mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}\) was stored in \(\mathbf{\mathsf{K}}\).</li>
<li>Form \(\overline{\overline{\mathbf{\mathsf{K}}}}\) and add to \(\mathbf{\mathsf{K}}_{uu}\) to get \(\mathbf{\mathsf{K}}_{\textrm{con}}\)</li>
<li>The modified system matrix is called \({\mathbf{\mathsf{K}}}_{\textrm{store}}\). That is <p class="formulaDsp">
\[ \mathbf{\mathsf{K}}_{\textrm{store}} \dealcoloneq \begin{bmatrix} \mathbf{\mathsf{K}}_{\textrm{con}} &amp; \mathbf{\mathsf{K}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathbf{\mathsf{K}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathbf{\mathsf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \\ \mathbf{0} &amp; \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{p}} &amp; \mathbf{\mathsf{K}}_{\widetilde{J}\widetilde{J}} \end{bmatrix} \, . \]
</p>
</li>
</ul>
<p><a class="anchor" id="Thematerialclass"></a></p><h3>The material class </h3>
<p>A good object-oriented design of a Material class would facilitate the extension of this tutorial to a wide range of material types. In this tutorial we simply have one Material class named Material_Compressible_Neo_Hook_Three_Field. Ideally this class would derive from a class HyperelasticMaterial which would derive from the base class Material. The three-field nature of the formulation used here also complicates the matter.</p>
<p>The Helmholtz free energy function for the three field formulation is \(\Psi = \Psi_\text{vol}(\widetilde{J}) + \Psi_\text{iso}(\overline{\mathbf{b}})\). The isochoric part of the Kirchhoff stress \({\boldsymbol{\tau}}_{\text{iso}}(\overline{\mathbf{b}})\) is identical to that obtained using a one-field formulation for a hyperelastic material. However, the volumetric part of the free energy is now a function of the primary variable \(\widetilde{J}\). Thus, for a three field formulation the constitutive response for the volumetric part of the Kirchhoff stress \({\boldsymbol{\tau}}_{\text{vol}}\) (and the tangent) is not given by the hyperelastic constitutive law as in a one-field formulation. One can label the term \(\boldsymbol{\tau}_{\textrm{vol}} \equiv \widetilde{p} J \mathbf{I}\) as the volumetric Kirchhoff stress, but the pressure \(\widetilde{p}\) is not derived from the free energy; it is a primary field.</p>
<p>In order to have a flexible approach, it was decided that the Material_Compressible_Neo_Hook_Three_Field would still be able to calculate and return a volumetric Kirchhoff stress and tangent. In order to do this, we choose to store the interpolated primary fields \(\widetilde{p}\) and \(\widetilde{J}\) in the Material_Compressible_Neo_Hook_Three_Field class associated with the quadrature point. This decision should be revisited at a later stage when the tutorial is extended to account for other materials.</p>
<p><a class="anchor" id="Numericalexample"></a></p><h3>Numerical example </h3>
<p>The numerical example considered here is a nearly-incompressible block under compression. This benchmark problem is taken from</p><ul>
<li><p class="startli">S. Reese, P. Wriggers, B.D. Reddy (2000), A new locking-free brick element technique for large deformation problems in elasticity, <em> Computers and Structures </em>, <b> 75 </b>, 291-304. DOI: <a href="http://doi.org/10.1016/S0045-7949(99)00137-6">10.1016/S0045-7949(99)00137-6</a></p>
<p class="startli"><img src="https://www.dealii.org/images/steps/developer/step-44.setup.png" alt="" class="inline"/></p>
</li>
</ul>
<p>The material is quasi-incompressible neo-Hookean with <a href="http://en.wikipedia.org/wiki/Shear_modulus">shear modulus</a> \(\mu = 80.194e6\) and \(\nu = 0.4999\). For such a choice of material properties a conventional single-field \(Q_1\) approach would lock. That is, the response would be overly stiff. The initial and final configurations are shown in the image above. Using symmetry, we solve for only one quarter of the geometry (i.e. a cube with dimension \(0.001\)). The inner-quarter of the upper surface of the domain is subject to a load of \(p_0\).</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p>We start by including all the necessary deal.II header files and some C++ related ones. They have been discussed in detail in previous tutorial programs, so you need only refer to past tutorials for details.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2point_8h.html">deal.II/base/point.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="symmetric__tensor_8h.html">deal.II/base/symmetric_tensor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tensor_8h.html">deal.II/base/tensor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="work__stream_8h.html">deal.II/base/work_stream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="ttc" id="abase_2point_8h_html"><div class="ttname"><a href="base_2point_8h.html">point.h</a></div></div>
<div class="ttc" id="adof__renumbering_8h_html"><div class="ttname"><a href="dof__renumbering_8h.html">dof_renumbering.h</a></div></div>
<div class="ttc" id="adof__tools_8h_html"><div class="ttname"><a href="dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="afunction_8h_html"><div class="ttname"><a href="function_8h.html">function.h</a></div></div>
<div class="ttc" id="aparameter__handler_8h_html"><div class="ttname"><a href="parameter__handler_8h.html">parameter_handler.h</a></div></div>
<div class="ttc" id="aquadrature__lib_8h_html"><div class="ttname"><a href="quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="asymmetric__tensor_8h_html"><div class="ttname"><a href="symmetric__tensor_8h.html">symmetric_tensor.h</a></div></div>
<div class="ttc" id="atensor_8h_html"><div class="ttname"><a href="tensor_8h.html">tensor.h</a></div></div>
<div class="ttc" id="atimer_8h_html"><div class="ttname"><a href="timer_8h.html">timer.h</a></div></div>
<div class="ttc" id="awork__stream_8h_html"><div class="ttname"><a href="work__stream_8h.html">work_stream.h</a></div></div>
</div><!-- fragment --><p>This header gives us the functionality to store data at quadrature points</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__point__data_8h.html">deal.II/base/quadrature_point_data.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__dgp__monomial_8h.html">deal.II/fe/fe_dgp_monomial.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__tools_8h.html">deal.II/fe/fe_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mapping__q__eulerian_8h.html">deal.II/fe/mapping_q_eulerian.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__sparse__matrix_8h.html">deal.II/lac/block_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition__selector_8h.html">deal.II/lac/precondition_selector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__selector_8h.html">deal.II/lac/solver_selector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__direct_8h.html">deal.II/lac/sparse_direct.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="ttc" id="aaffine__constraints_8h_html"><div class="ttname"><a href="affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="ablock__sparse__matrix_8h_html"><div class="ttname"><a href="block__sparse__matrix_8h.html">block_sparse_matrix.h</a></div></div>
<div class="ttc" id="ablock__vector_8h_html"><div class="ttname"><a href="block__vector_8h.html">block_vector.h</a></div></div>
<div class="ttc" id="adynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="afe__dgp__monomial_8h_html"><div class="ttname"><a href="fe__dgp__monomial_8h.html">fe_dgp_monomial.h</a></div></div>
<div class="ttc" id="afe__q_8h_html"><div class="ttname"><a href="fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="afe__system_8h_html"><div class="ttname"><a href="fe__system_8h.html">fe_system.h</a></div></div>
<div class="ttc" id="afe__tools_8h_html"><div class="ttname"><a href="fe__tools_8h.html">fe_tools.h</a></div></div>
<div class="ttc" id="afull__matrix_8h_html"><div class="ttname"><a href="full__matrix_8h.html">full_matrix.h</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="agrid__generator_8h_html"><div class="ttname"><a href="grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="agrid__in_8h_html"><div class="ttname"><a href="grid__in_8h.html">grid_in.h</a></div></div>
<div class="ttc" id="agrid__tools_8h_html"><div class="ttname"><a href="grid__tools_8h.html">grid_tools.h</a></div></div>
<div class="ttc" id="amapping__q__eulerian_8h_html"><div class="ttname"><a href="mapping__q__eulerian_8h.html">mapping_q_eulerian.h</a></div></div>
<div class="ttc" id="aprecondition__selector_8h_html"><div class="ttname"><a href="precondition__selector_8h.html">precondition_selector.h</a></div></div>
<div class="ttc" id="aquadrature__point__data_8h_html"><div class="ttname"><a href="quadrature__point__data_8h.html">quadrature_point_data.h</a></div></div>
<div class="ttc" id="asolver__cg_8h_html"><div class="ttname"><a href="solver__cg_8h.html">solver_cg.h</a></div></div>
<div class="ttc" id="asolver__selector_8h_html"><div class="ttname"><a href="solver__selector_8h.html">solver_selector.h</a></div></div>
<div class="ttc" id="asparse__direct_8h_html"><div class="ttname"><a href="sparse__direct_8h.html">sparse_direct.h</a></div></div>
</div><!-- fragment --><p>Here are the headers necessary to use the <a class="el" href="classLinearOperator.html">LinearOperator</a> class. These are also all conveniently packaged into a single header file, namely &lt;deal.II/lac/linear_operator_tools.h&gt; but we list those specifically required here for the sake of transparency.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="linear__operator_8h.html">deal.II/lac/linear_operator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="packaged__operation_8h.html">deal.II/lac/packaged_operation.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="ttc" id="alinear__operator_8h_html"><div class="ttname"><a href="linear__operator_8h.html">linear_operator.h</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="apackaged__operation_8h_html"><div class="ttname"><a href="packaged__operation_8h.html">packaged_operation.h</a></div></div>
<div class="ttc" id="avector__tools_8h_html"><div class="ttname"><a href="vector__tools_8h.html">vector_tools.h</a></div></div>
</div><!-- fragment --><p>Defined in these two headers are some operations that are pertinent to finite strain elasticity. The first will help us compute some kinematic quantities, and the second provides some stanard tensor definitions.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kinematics_8h.html">deal.II/physics/elasticity/kinematics.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="standard__tensors_8h.html">deal.II/physics/elasticity/standard_tensors.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="ttc" id="akinematics_8h_html"><div class="ttname"><a href="kinematics_8h.html">kinematics.h</a></div></div>
<div class="ttc" id="astandard__tensors_8h_html"><div class="ttname"><a href="standard__tensors_8h.html">standard_tensors.h</a></div></div>
</div><!-- fragment --><p>We then stick everything that relates to this tutorial program into a namespace of its own, and import all the deal.II function and class names into it:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Step44</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="namespace__dealii_8h_source.html#l00025">namespace_dealii.h:26</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Runtimeparameters"></a> </p><h3>Run-time parameters</h3>
<p>There are several parameters that can be set in the code so we set up a <a class="el" href="classParameterHandler.html">ParameterHandler</a> object to read in the choices at run-time.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Parameters</div>
<div class="line">{</div>
</div><!-- fragment --><p><a class="anchor" id="FiniteElementsystem"></a> </p><h4>Finite Element system</h4>
<p>As mentioned in the introduction, a different order interpolation should be used for the displacement \(\mathbf{u}\) than for the pressure \(\widetilde{p}\) and the dilatation \(\widetilde{J}\). Choosing \(\widetilde{p}\) and \(\widetilde{J}\) as discontinuous (constant) functions at the element level leads to the mean-dilatation method. The discontinuous approximation allows \(\widetilde{p}\) and \(\widetilde{J}\) to be condensed out and a classical displacement based method is recovered. Here we specify the polynomial order used to approximate the solution. The quadrature order should be adjusted accordingly.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="classFESystem.html">FESystem</a></div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly_degree;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> quad_order;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> FESystem::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Displacement system polynomial order&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;3&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Gauss quadrature order&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> FESystem::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    poly_degree = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>);</div>
<div class="line">    quad_order  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassFESystem_html"><div class="ttname"><a href="classFESystem.html">FESystem</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__system_8h_source.html#l00215">fe_system.h:216</a></div></div>
<div class="ttc" id="aclassParameterHandler_html"><div class="ttname"><a href="classParameterHandler.html">ParameterHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8h_source.html#l00840">parameter_handler.h:841</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a599462cacd492e2f712bf7369507dcff"><div class="ttname"><a href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">ParameterHandler::leave_subsection</a></div><div class="ttdeci">void leave_subsection()</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00953">parameter_handler.cc:953</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a61fa98fdc0c52980a5b1de0ee1fc5bb2"><div class="ttname"><a href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">ParameterHandler::get_integer</a></div><div class="ttdeci">long int get_integer(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01025">parameter_handler.cc:1025</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6d65f458be69e23a348221cb67fc411d"><div class="ttname"><a href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a></div><div class="ttdeci">void declare_entry(const std::string &amp;entry, const std::string &amp;default_value, const Patterns::PatternBase &amp;pattern=Patterns::Anything(), const std::string &amp;documentation=&quot;&quot;, const bool has_to_be_set=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00796">parameter_handler.cc:796</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_af29c20cde6d44186806d559beb468696"><div class="ttname"><a href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">ParameterHandler::enter_subsection</a></div><div class="ttdeci">void enter_subsection(const std::string &amp;subsection)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00939">parameter_handler.cc:939</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Integer_html"><div class="ttname"><a href="classPatterns_1_1Integer.html">Patterns::Integer</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00189">patterns.h:190</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Geometry"></a> </p><h4>Geometry</h4>
<p>Make adjustments to the problem geometry and the applied load. Since the problem modelled here is quite specific, the load scale can be altered to specific values to compare with the results given in the literature.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Geometry</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> global_refinement;</div>
<div class="line">  <span class="keywordtype">double</span>       <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>;</div>
<div class="line">  <span class="keywordtype">double</span>       p_p0;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Geometry::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Global refinement level&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-3&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Global grid scaling factor&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Pressure ratio p/p0&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;100&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;20|40|60|80|100&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Ratio of applied pressure to reference pressure&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Geometry::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    global_refinement = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>);</div>
<div class="line">    <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>);</div>
<div class="line">    p_p0              = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Pressure ratio p/p0&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassParameterHandler_html_aeaf3c7846747695b1f327677e3716ec5"><div class="ttname"><a href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">ParameterHandler::get_double</a></div><div class="ttdeci">double get_double(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01068">parameter_handler.cc:1068</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Double_html"><div class="ttname"><a href="classPatterns_1_1Double.html">Patterns::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00292">patterns.h:293</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Selection_html"><div class="ttname"><a href="classPatterns_1_1Selection.html">Patterns::Selection</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00382">patterns.h:383</a></div></div>
<div class="ttc" id="anamespaceGridTools_html_a0967563badadd81f77f62622dd8bc2cd"><div class="ttname"><a href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a></div><div class="ttdeci">void scale(const double scaling_factor, Triangulation&lt; dim, spacedim &gt; &amp;triangulation)</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l02043">grid_tools.cc:2043</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Materials"></a> </p><h4>Materials</h4>
<p>We also need the shear modulus \( \mu \) and Poisson ration \( \nu \) for the neo-Hookean material.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Materials</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">double</span> nu;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespacemu.html">mu</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Materials::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.4999&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(-1.0, 0.5),</div>
<div class="line">                      <span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Shear modulus&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;80.194e6&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Shear modulus&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Materials::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    nu = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div>
<div class="line">    <a class="code" href="namespacemu.html">mu</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Shear modulus&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="anamespacemu_html"><div class="ttname"><a href="namespacemu.html">mu</a></div><div class="ttdef"><b>Definition:</b> <a href="function__parser_8h_source.html#l00032">function_parser.h:33</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Linearsolver"></a> </p><h4>Linear solver</h4>
<p>Next, we choose both solver and preconditioner settings. The use of an effective preconditioner is critical to ensure convergence when a large nonlinear motion occurs within a Newton increment.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>LinearSolver</div>
<div class="line">{</div>
<div class="line">  std::string type_lin;</div>
<div class="line">  <span class="keywordtype">double</span>      tol_lin;</div>
<div class="line">  <span class="keywordtype">double</span>      max_iterations_lin;</div>
<div class="line">  <span class="keywordtype">bool</span>        use_static_condensation;</div>
<div class="line">  std::string preconditioner_type;</div>
<div class="line">  <span class="keywordtype">double</span>      preconditioner_relaxation;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> LinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Solver type&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;CG&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;CG|Direct&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Type of solver used to solve the linear system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Residual&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1e-6&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Linear solver residual (scaled by residual norm)&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;Max iteration multiplier&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">      <span class="stringliteral">&quot;Linear solver iterations (multiples of the system matrix size)&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Use static condensation&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Solve the full block system or a reduced problem&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Preconditioner type&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;ssor&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;jacobi|ssor&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Type of preconditioner&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Preconditioner relaxation&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.65&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Preconditioner relaxation value&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> LinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    type_lin                  = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Solver type&quot;</span>);</div>
<div class="line">    tol_lin                   = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line">    max_iterations_lin        = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Max iteration multiplier&quot;</span>);</div>
<div class="line">    use_static_condensation   = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Use static condensation&quot;</span>);</div>
<div class="line">    preconditioner_type       = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Preconditioner type&quot;</span>);</div>
<div class="line">    preconditioner_relaxation = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Preconditioner relaxation&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassParameterHandler_html_a6bb45dc67787e3fab7882461929b5fbe"><div class="ttname"><a href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">ParameterHandler::get_bool</a></div><div class="ttdeci">bool get_bool(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01113">parameter_handler.cc:1113</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a91cfbaca954f444047302446a4e87125"><div class="ttname"><a href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">ParameterHandler::get</a></div><div class="ttdeci">std::string get(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00987">parameter_handler.cc:987</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Bool_html"><div class="ttname"><a href="classPatterns_1_1Bool.html">Patterns::Bool</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00981">patterns.h:982</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Nonlinearsolver"></a> </p><h4>Nonlinear solver</h4>
<p>A Newton-Raphson scheme is used to solve the nonlinear system of governing equations. We now define the tolerances and the maximum number of iterations for the Newton-Raphson nonlinear solver.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>NonlinearSolver</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iterations_NR;</div>
<div class="line">  <span class="keywordtype">double</span>       tol_f;</div>
<div class="line">  <span class="keywordtype">double</span>       tol_u;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> NonlinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;10&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Number of Newton-Raphson iterations allowed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1.0e-9&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Force residual tolerance&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1.0e-6&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                      <span class="stringliteral">&quot;Displacement error tolerance&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> NonlinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    max_iterations_NR = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>);</div>
<div class="line">    tol_f             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>);</div>
<div class="line">    tol_u             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Time"></a> </p><h4>Time</h4>
<p>Set the timestep size \( \varDelta t \) and the simulation end-time.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Time</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">double</span> delta_t;</div>
<div class="line">  <span class="keywordtype">double</span> end_time;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Time::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;End time&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(), <span class="stringliteral">&quot;End time&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Time step size&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Time step size&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Time::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">{</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div>
<div class="line">  {</div>
<div class="line">    end_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;End time&quot;</span>);</div>
<div class="line">    delta_t  = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Time step size&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Allparameters"></a> </p><h4>All parameters</h4>
<p>Finally we consolidate all of the above structures into a single container that holds all of our run-time selections.</p>
<div class="fragment"><div class="line">  <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> <a class="code" href="classFESystem.html">FESystem</a>,</div>
<div class="line">                         <span class="keyword">public</span> Geometry,</div>
<div class="line">                         <span class="keyword">public</span> Materials,</div>
<div class="line">                         <span class="keyword">public</span> LinearSolver,</div>
<div class="line">                         <span class="keyword">public</span> NonlinearSolver,</div>
<div class="line">                         <span class="keyword">public</span> Time</div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    AllParameters(<span class="keyword">const</span> std::string &amp;input_file);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  AllParameters::AllParameters(<span class="keyword">const</span> std::string &amp;input_file)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">    declare_parameters(prm);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_file);</div>
<div class="line">    parse_parameters(prm);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> AllParameters::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    FESystem::declare_parameters(prm);</div>
<div class="line">    Geometry::declare_parameters(prm);</div>
<div class="line">    Materials::declare_parameters(prm);</div>
<div class="line">    LinearSolver::declare_parameters(prm);</div>
<div class="line">    NonlinearSolver::declare_parameters(prm);</div>
<div class="line">    Time::declare_parameters(prm);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> AllParameters::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">  {</div>
<div class="line">    FESystem::parse_parameters(prm);</div>
<div class="line">    Geometry::parse_parameters(prm);</div>
<div class="line">    Materials::parse_parameters(prm);</div>
<div class="line">    LinearSolver::parse_parameters(prm);</div>
<div class="line">    NonlinearSolver::parse_parameters(prm);</div>
<div class="line">    Time::parse_parameters(prm);</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Parameters</span></div>
<div class="ttc" id="aclassParameterHandler_html_a0ddaa05c5463c6c0b7701e18005717a9"><div class="ttname"><a href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">ParameterHandler::parse_input</a></div><div class="ttdeci">virtual void parse_input(std::istream &amp;input, const std::string &amp;filename=&quot;input file&quot;, const std::string &amp;last_line=&quot;&quot;, const bool skip_undefined=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00399">parameter_handler.cc:399</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Timeclass"></a> </p><h3>Time class</h3>
<p>A simple class to store time data. Its functioning is transparent so no discussion is necessary. For simplicity we assume a constant time step size.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Time</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Time(<span class="keyword">const</span> <span class="keywordtype">double</span> time_end, <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t)</div>
<div class="line">    : timestep(0)</div>
<div class="line">    , time_current(0.0)</div>
<div class="line">    , time_end(time_end)</div>
<div class="line">    , delta_t(delta_t)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> ~Time() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> current()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> time_current;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> time_end;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">double</span> get_delta_t()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> delta_t;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> get_timestep()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> timestep;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> increment()</div>
<div class="line">  {</div>
<div class="line">    time_current += delta_t;</div>
<div class="line">    ++timestep;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep;</div>
<div class="line">  <span class="keywordtype">double</span>       time_current;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> time_end;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t;</div>
<div class="line">};</div>
<div class="ttc" id="anamespaceTrilinosWrappers_1_1internal_html_aee42c8e3004e2e81eac3c3356d3ec46b"><div class="ttname"><a href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">TrilinosWrappers::internal::end</a></div><div class="ttdeci">VectorType::value_type * end(VectorType &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="trilinos__sparse__matrix_8cc_source.html#l00067">trilinos_sparse_matrix.cc:67</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="CompressibleneoHookeanmaterialwithinathreefieldformulation"></a> </p><h3>Compressible neo-Hookean material within a three-field formulation</h3>
<p>As discussed in the Introduction, Neo-Hookean materials are a type of hyperelastic materials. The entire domain is assumed to be composed of a compressible neo-Hookean material. This class defines the behavior of this material within a three-field formulation. Compressible neo-Hookean materials can be described by a strain-energy function (SEF) \( \Psi = \Psi_{\text{iso}}(\overline{\mathbf{b}}) + \Psi_{\text{vol}}(\widetilde{J}) \).</p>
<p>The isochoric response is given by \( \Psi_{\text{iso}}(\overline{\mathbf{b}}) = c_{1} [\overline{I}_{1} - 3] \) where \( c_{1} = \frac{\mu}{2} \) and \(\overline{I}_{1}\) is the first invariant of the left- or right-isochoric Cauchy-Green deformation tensors. That is \(\overline{I}_1 \dealcoloneq \textrm{tr}(\overline{\mathbf{b}})\). In this example the SEF that governs the volumetric response is defined as \( \Psi_{\text{vol}}(\widetilde{J}) = \kappa \frac{1}{4} [ \widetilde{J}^2 - 1 - 2\textrm{ln}\; \widetilde{J} ]\), where \(\kappa \dealcoloneq \lambda + 2/3 \mu\) is the <a href="http://en.wikipedia.org/wiki/Bulk_modulus">bulk modulus</a> and \(\lambda\) is <a href="http://en.wikipedia.org/wiki/Lam%C3%A9_parameters">Lam&eacute;'s first parameter</a>.</p>
<p>The following class will be used to characterize the material we work with, and provides a central point that one would need to modify if one were to implement a different material model. For it to work, we will store one object of this type per quadrature point, and in each of these objects store the current state (characterized by the values or measures of the three fields) so that we can compute the elastic coefficients linearized around the current state.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>Material_Compressible_Neo_Hook_Three_Field</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Material_Compressible_Neo_Hook_Three_Field(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacemu.html">mu</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> nu)</div>
<div class="line">    : kappa((2.0 * <a class="code" href="namespacemu.html">mu</a> * (1.0 + nu)) / (3.0 * (1.0 - 2.0 * nu)))</div>
<div class="line">    , c_1(<a class="code" href="namespacemu.html">mu</a> / 2.0)</div>
<div class="line">    , det_F(1.0)</div>
<div class="line">    , p_tilde(0.0)</div>
<div class="line">    , J_tilde(1.0)</div>
<div class="line">    , b_bar(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(kappa &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  }</div>
<div class="ttc" id="agroup__Exceptions_html_ga31978c026b8b6b5116df30b8e748f6b7"><div class="ttname"><a href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">StandardExceptions::ExcInternalError</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcInternalError()</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01473">exceptions.h:1473</a></div></div>
<div class="ttc" id="anamespacePhysics_html"><div class="ttname"><a href="namespacePhysics.html">Physics</a></div><div class="ttdef"><b>Definition:</b> <a href="physics_8h_source.html#l00028">physics.h:29</a></div></div>
</div><!-- fragment --><p>We update the material model with various deformation dependent data based on \(F\) and the pressure \(\widetilde{p}\) and dilatation \(\widetilde{J}\), and at the end of the function include a physical check for internal consistency:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> update_material_data(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">double</span>          p_tilde_in,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">double</span>          J_tilde_in)</div>
<div class="line">{</div>
<div class="line">  det_F                      = <a class="code" href="classSymmetricTensor.html#a7c03a03a5fe823733e7af9f7e4267f81">determinant</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_bar = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae8c571720db885e3636e396f6e153317">Physics::Elasticity::Kinematics::F_iso</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">  b_bar                      = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">Physics::Elasticity::Kinematics::b</a>(F_bar);</div>
<div class="line">  p_tilde                    = p_tilde_in;</div>
<div class="line">  J_tilde                    = J_tilde_in;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(det_F &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">}</div>
<div class="ttc" id="aclassSymmetricTensor_html_a7c03a03a5fe823733e7af9f7e4267f81"><div class="ttname"><a href="classSymmetricTensor.html#a7c03a03a5fe823733e7af9f7e4267f81">SymmetricTensor::determinant</a></div><div class="ttdeci">constexpr Number determinant(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02622">symmetric_tensor.h:2622</a></div></div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 2, dim &gt;</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_aa87528a28ad8a95fa89a3876e6f986c8"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a></div><div class="ttdeci">Tensor&lt; 2, dim, Number &gt; F(const Tensor&lt; 2, dim, Number &gt; &amp;Grad_u)</div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_ae880749870e5b45fbb6a441fd96c1a07"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">Physics::Elasticity::Kinematics::b</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; b(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_ae8c571720db885e3636e396f6e153317"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae8c571720db885e3636e396f6e153317">Physics::Elasticity::Kinematics::F_iso</a></div><div class="ttdeci">Tensor&lt; 2, dim, Number &gt; F_iso(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
</div><!-- fragment --><p>The second function determines the Kirchhoff stress \(\boldsymbol{\tau} = \boldsymbol{\tau}_{\textrm{iso}} + \boldsymbol{\tau}_{\textrm{vol}}\)</p>
<div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> get_tau_iso() + get_tau_vol();</div>
<div class="line">}</div>
<div class="ttc" id="aclassSymmetricTensor_html"><div class="ttname"><a href="classSymmetricTensor.html">SymmetricTensor&lt; 2, dim &gt;</a></div></div>
</div><!-- fragment --><p>The fourth-order elasticity tensor in the spatial setting \(\mathfrak{c}\) is calculated from the SEF \(\Psi\) as \( J \mathfrak{c}_{ijkl} = F_{iA} F_{jB} \mathfrak{C}_{ABCD} F_{kC} F_{lD}\) where \( \mathfrak{C} = 4 \frac{\partial^2 \Psi(\mathbf{C})}{\partial \mathbf{C} \partial \mathbf{C}}\)</p>
<div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> get_Jc_vol() + get_Jc_iso();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Derivative of the volumetric free energy with respect to \(\widetilde{J}\) return \(\frac{\partial \Psi_{\text{vol}}(\widetilde{J})}{\partial \widetilde{J}}\)</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> get_dPsi_vol_dJ()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> (kappa / 2.0) * (J_tilde - 1.0 / J_tilde);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Second derivative of the volumetric free energy wrt \(\widetilde{J}\). We need the following computation explicitly in the tangent so we make it public. We calculate \(\frac{\partial^2 \Psi_{\textrm{vol}}(\widetilde{J})}{\partial \widetilde{J} \partial \widetilde{J}}\)</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> get_d2Psi_vol_dJ2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> ((kappa / 2.0) * (1.0 + 1.0 / (J_tilde * J_tilde)));</div>
<div class="line">}</div>
</div><!-- fragment --><p>The next few functions return various data that we choose to store with the material:</p>
<div class="fragment"><div class="line">  <span class="keywordtype">double</span> get_det_F()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> det_F;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> get_p_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> p_tilde;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> get_J_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> J_tilde;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
</div><!-- fragment --><p>Define constitutive model parameters \(\kappa\) (bulk modulus) and the neo-Hookean model parameter \(c_1\):</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> kappa;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> c_1;</div>
</div><!-- fragment --><p>Model specific data that is convenient to store with the material:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span>                  det_F;</div>
<div class="line"><span class="keywordtype">double</span>                  p_tilde;</div>
<div class="line"><span class="keywordtype">double</span>                  J_tilde;</div>
<div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> b_bar;</div>
</div><!-- fragment --><p>The following functions are used internally in determining the result of some of the public functions above. The first one determines the volumetric Kirchhoff stress \(\boldsymbol{\tau}_{\textrm{vol}}\):</p>
<div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_vol()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> p_tilde * det_F * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassPhysics_1_1Elasticity_1_1StandardTensors_html"><div class="ttname"><a href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors</a></div><div class="ttdef"><b>Definition:</b> <a href="standard__tensors_8h_source.html#l00046">standard_tensors.h:47</a></div></div>
</div><!-- fragment --><p>Next, determine the isochoric Kirchhoff stress \(\boldsymbol{\tau}_{\textrm{iso}} = \mathcal{P}:\overline{\boldsymbol{\tau}}\):</p>
<div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_iso()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * get_tau_bar();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Then, determine the fictitious Kirchhoff stress \(\overline{\boldsymbol{\tau}}\):</p>
<div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_bar()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> 2.0 * c_1 * b_bar;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Calculate the volumetric part of the tangent \(J \mathfrak{c}_\textrm{vol}\):</p>
<div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_vol()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> p_tilde * det_F *</div>
<div class="line">         (<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::IxI</a> -</div>
<div class="line">          (2.0 * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::S</a>));</div>
<div class="line">}</div>
</div><!-- fragment --><p>Calculate the isochoric part of the tangent \(J \mathfrak{c}_\textrm{iso}\):</p>
<div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_iso()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_bar = get_tau_bar();</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_iso = get_tau_iso();</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> tau_iso_x_I =</div>
<div class="line">    <a class="code" href="classSymmetricTensor.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a>(tau_iso, <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> I_x_tau_iso =</div>
<div class="line">    <a class="code" href="classSymmetricTensor.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a>(<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>, tau_iso);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> c_bar = get_c_bar();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> (2.0 / dim) * <a class="code" href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">trace</a>(tau_bar) *</div>
<div class="line">           <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> -</div>
<div class="line">         (2.0 / dim) * (tau_iso_x_I + I_x_tau_iso) +</div>
<div class="line">         <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * c_bar *</div>
<div class="line">           <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassSymmetricTensor_html_a8c727eebb2d3d1870cbf4e77a3f45a6b"><div class="ttname"><a href="classSymmetricTensor.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">SymmetricTensor::outer_product</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 4, dim, Number &gt; outer_product(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t1, const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t2)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03466">symmetric_tensor.h:3466</a></div></div>
<div class="ttc" id="aclassSymmetricTensor_html_a9137b6052702150e8e5b1188d1971906"><div class="ttname"><a href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">SymmetricTensor::trace</a></div><div class="ttdeci">constexpr Number trace(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02680">symmetric_tensor.h:2680</a></div></div>
</div><!-- fragment --><p>Calculate the fictitious elasticity tensor \(\overline{\mathfrak{c}}\). For the material model chosen this is simply zero:</p>
<div class="fragment"><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_c_bar()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a>();</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="Quadraturepointhistory"></a> </p><h3><a class="el" href="classQuadrature.html">Quadrature</a> point history</h3>
<p>As seen in <a class="el" href="step_18.html">step-18</a>, the <code> PointHistory </code> class offers a method for storing data at the quadrature points. Here each quadrature point holds a pointer to a material description. Thus, different material models can be used in different regions of the domain. Among other data, we choose to store the Kirchhoff stress \(\boldsymbol{\tau}\) and the tangent \(J\mathfrak{c}\) for the quadrature points.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>PointHistory</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  PointHistory()</div>
<div class="line">    : F_inv(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div>
<div class="line">    , tau(<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt;())</div>
<div class="line">    , d2Psi_vol_dJ2(0.0)</div>
<div class="line">    , dPsi_vol_dJ(0.0)</div>
<div class="line">    , Jc(<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;4, dim&gt;())</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> ~PointHistory() = <span class="keywordflow">default</span>;</div>
</div><!-- fragment --><p>The first function is used to create a material object and to initialize all tensors correctly: The second one updates the stored values and stresses based on the current deformation measure \(\textrm{Grad}\mathbf{u}_{\textrm{n}}\), pressure \(\widetilde{p}\) and dilation \(\widetilde{J}\) field values.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setup_lqp(<span class="keyword">const</span> Parameters::AllParameters &amp;parameters)</div>
<div class="line">{</div>
<div class="line">  material =</div>
<div class="line">    std::make_shared&lt;Material_Compressible_Neo_Hook_Three_Field&lt;dim&gt;&gt;(</div>
<div class="line">      parameters.mu, parameters.nu);</div>
<div class="line">  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>(<a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a>(), 0.0, 1.0);</div>
<div class="line">}</div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00078">fe_update_flags.h:78</a></div></div>
</div><!-- fragment --><p>To this end, we calculate the deformation gradient \(\mathbf{F}\) from the displacement gradient \(\textrm{Grad}\ \mathbf{u}\), i.e. \(\mathbf{F}(\mathbf{u}) = \mathbf{I} + \textrm{Grad}\ \mathbf{u}\) and then let the material model associated with this quadrature point update itself. When computing the deformation gradient, we have to take care with which data types we compare the sum \(\mathbf{I} + \textrm{Grad}\ \mathbf{u}\): Since \(I\) has data type <a class="el" href="classSymmetricTensor.html">SymmetricTensor</a>, just writing <code>I + Grad_u_n</code> would convert the second argument to a symmetric tensor, perform the sum, and then cast the result to a <a class="el" href="classTensor.html">Tensor</a> (i.e., the type of a possibly nonsymmetric tensor). However, since <code>Grad_u_n</code> is nonsymmetric in general, the conversion to <a class="el" href="classSymmetricTensor.html">SymmetricTensor</a> will fail. We can avoid this back and forth by converting \(I\) to <a class="el" href="classTensor.html">Tensor</a> first, and then performing the addition as between nonsymmetric tensors:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;Grad_u_n,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">double</span>          p_tilde,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">double</span>          J_tilde)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a> = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a>(Grad_u_n);</div>
<div class="line">  material-&gt;update_material_data(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>, p_tilde, J_tilde);</div>
</div><!-- fragment --><p>The material has been updated so we now calculate the Kirchhoff stress \(\mathbf{\tau}\), the tangent \(J\mathfrak{c}\) and the first and second derivatives of the volumetric free energy.</p>
<p>We also store the inverse of the deformation gradient since we frequently use it:</p>
<div class="fragment"><div class="line">  F_inv         = <a class="code" href="classSymmetricTensor.html#a33cd1a6c91c24a5ca34dfbc43c338d1c">invert</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">  tau           = material-&gt;get_tau();</div>
<div class="line">  Jc            = material-&gt;get_Jc();</div>
<div class="line">  dPsi_vol_dJ   = material-&gt;get_dPsi_vol_dJ();</div>
<div class="line">  d2Psi_vol_dJ2 = material-&gt;get_d2Psi_vol_dJ2();</div>
<div class="line">}</div>
<div class="ttc" id="aclassSymmetricTensor_html_a33cd1a6c91c24a5ca34dfbc43c338d1c"><div class="ttname"><a href="classSymmetricTensor.html#a33cd1a6c91c24a5ca34dfbc43c338d1c">SymmetricTensor::invert</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 2, dim, Number &gt; invert(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03415">symmetric_tensor.h:3415</a></div></div>
</div><!-- fragment --><p>We offer an interface to retrieve certain data. Here are the kinematic variables:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> get_J_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> material-&gt;get_J_tilde();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_det_F()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> material-&gt;get_det_F();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;get_F_inv()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> F_inv;</div>
<div class="line">}</div>
</div><!-- fragment --><p>...and the kinetic variables. These are used in the material and global tangent matrix and residual assembly operations:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> get_p_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> material-&gt;get_p_tilde();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;get_tau()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> tau;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_dPsi_vol_dJ()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> dPsi_vol_dJ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> get_d2Psi_vol_dJ2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> d2Psi_vol_dJ2;</div>
<div class="line">}</div>
</div><!-- fragment --><p>And finally the tangent:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> &amp;get_Jc()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordflow">return</span> Jc;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In terms of member functions, this class stores for the quadrature point it represents a copy of a material type in case different materials are used in different regions of the domain, as well as the inverse of the deformation gradient...</p>
<div class="fragment"><div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::shared_ptr&lt;Material_Compressible_Neo_Hook_Three_Field&lt;dim&gt;&gt; material;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv;</div>
</div><!-- fragment --><p>... and stress-type variables along with the tangent \(J\mathfrak{c}\):</p>
<div class="fragment"><div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau;</div>
<div class="line">  <span class="keywordtype">double</span>                  d2Psi_vol_dJ2;</div>
<div class="line">  <span class="keywordtype">double</span>                  dPsi_vol_dJ;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc;</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="Quasistaticquasiincompressiblefinitestrainsolid"></a> </p><h3>Quasi-static quasi-incompressible finite-strain solid</h3>
<p>The Solid class is the central class in that it represents the problem at hand. It follows the usual scheme in that all it really has is a constructor, destructor and a <code><a class="el" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run()</a></code> function that dispatches all the work to private functions of this class:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>Solid</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Solid(<span class="keyword">const</span> std::string &amp;input_file);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="ttc" id="anamespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00691">work_stream.h:691</a></div></div>
</div><!-- fragment --><p>In the private section of this class, we first forward declare a number of objects that are used in parallelizing work using the <a class="el" href="namespaceWorkStream.html">WorkStream</a> object (see the <a class="el" href="group__threads.html">Parallel computing with multiple processors accessing shared memory</a> module for more information on this).</p>
<p>We declare such structures for the computation of tangent (stiffness) matrix and right hand side vector, static condensation, and for updating quadrature points:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>PerTaskData_ASM;</div>
<div class="line"><span class="keyword">struct </span>ScratchData_ASM;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>PerTaskData_SC;</div>
<div class="line"><span class="keyword">struct </span>ScratchData_SC;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>PerTaskData_UQPH;</div>
<div class="line"><span class="keyword">struct </span>ScratchData_UQPH;</div>
</div><!-- fragment --><p>We start the collection of member functions with one that builds the grid:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> make_grid();</div>
</div><!-- fragment --><p>Set up the finite element system to be solved:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> system_setup();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> determine_component_extractors();</div>
</div><!-- fragment --><p>Create Dirichlet constraints for the incremental displacement field:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> it_nr);</div>
</div><!-- fragment --><p>Several functions to assemble the system and right hand side matrices using multithreading. Each of them comes as a wrapper function, one that is executed to do the work in the <a class="el" href="namespaceWorkStream.html">WorkStream</a> model on one cell, and one that copies the work done on this one cell into the global object that represents it:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> assemble_system();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> assemble_system_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">  PerTaskData_ASM &amp;                                     data) <span class="keyword">const</span>;</div>
<div class="ttc" id="agroup__Iterators_html_ga6b8bbcafed8847f3030ea30c6990eb2d"><div class="ttname"><a href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler::active_cell_iterator</a></div><div class="ttdeci">typename ActiveSelector::active_cell_iterator active_cell_iterator</div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00438">dof_handler.h:438</a></div></div>
</div><!-- fragment --><p>And similar to perform global static condensation:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> assemble_sc();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> assemble_sc_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_SC &amp;                                      scratch,</div>
<div class="line">  PerTaskData_SC &amp;                                      data);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> copy_local_to_global_sc(<span class="keyword">const</span> PerTaskData_SC &amp;data);</div>
</div><!-- fragment --><p>Create and update the quadrature points. Here, no data needs to be copied into a global object, so the copy_local_to_global function is empty:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setup_qph();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> update_qph_incremental(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> update_qph_incremental_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_UQPH &amp;                                    scratch,</div>
<div class="line">  PerTaskData_UQPH &amp;                                    data);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> copy_local_to_global_UQPH(<span class="keyword">const</span> PerTaskData_UQPH &amp; <span class="comment">/*data*/</span>)</div>
<div class="line">{}</div>
<div class="ttc" id="aclassBlockVector_html"><div class="ttname"><a href="classBlockVector.html">BlockVector</a></div><div class="ttdef"><b>Definition:</b> <a href="block__vector_8h_source.html#l00070">block_vector.h:71</a></div></div>
</div><!-- fragment --><p>Solve for the displacement using a Newton-Raphson method. We break this function into the nonlinear loop and the function that solves the linearized Newton-Raphson step:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> solve_nonlinear_timestep(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta);</div>
<div class="line"> </div>
<div class="line">std::pair&lt;unsigned int, double&gt;</div>
<div class="line">solve_linear_system(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update);</div>
</div><!-- fragment --><p>Solution retrieval as well as post-processing and writing data to file :</p>
<div class="fragment"><div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a></div>
<div class="line">get_total_solution(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>Finally, some member variables that describe the current state: A collection of the parameters used to describe the problem setup...</p>
<div class="fragment"><div class="line">Parameters::AllParameters parameters;</div>
</div><!-- fragment --><p>...the volume of the reference configuration...</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> vol_reference;</div>
</div><!-- fragment --><p>...and description of the geometry on which the problem is solved:</p>
<div class="fragment"><div class="line"><a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01127">tria.h:1128</a></div></div>
<div class="ttc" id="ap4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
</div><!-- fragment --><p>Also, keep track of the current time and the time spent evaluating certain functions</p>
<div class="fragment"><div class="line">Time                time;</div>
<div class="line"><span class="keyword">mutable</span> <a class="code" href="classTimerOutput.html">TimerOutput</a> timer;</div>
<div class="ttc" id="aclassTimerOutput_html"><div class="ttname"><a href="classTimerOutput.html">TimerOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00544">timer.h:545</a></div></div>
</div><!-- fragment --><p>A storage object for quadrature point information. As opposed to <a class="el" href="step_18.html">step-18</a>, deal.II's native quadrature point data manager is employed here.</p>
<div class="fragment"><div class="line"><a class="code" href="classCellDataStorage.html">CellDataStorage&lt;typename Triangulation&lt;dim&gt;::cell_iterator</a>,</div>
<div class="line">                PointHistory&lt;dim&gt;&gt;</div>
<div class="line">  quadrature_point_history;</div>
<div class="ttc" id="aclassCellDataStorage_html"><div class="ttname"><a href="classCellDataStorage.html">CellDataStorage</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__point__data_8h_source.html#l00062">quadrature_point_data.h:63</a></div></div>
</div><!-- fragment --><p>A description of the finite-element system including the displacement polynomial degree, the degree-of-freedom handler, number of DoFs per cell and the extractor objects used to retrieve information from the solution vectors:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               degree;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>              fe;</div>
<div class="line"><a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>                  dof_handler;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               dofs_per_cell;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> u_fe;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> p_fe;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> J_fe;</div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00314">dof_handler.h:315</a></div></div>
<div class="ttc" id="astructFEValuesExtractors_1_1Scalar_html"><div class="ttname"><a href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__values__extractors_8h_source.html#l00095">fe_values_extractors.h:96</a></div></div>
<div class="ttc" id="astructFEValuesExtractors_1_1Vector_html"><div class="ttname"><a href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__values__extractors_8h_source.html#l00150">fe_values_extractors.h:151</a></div></div>
</div><!-- fragment --><p>Description of how the block-system is arranged. There are 3 blocks, the first contains a vector DOF \(\mathbf{u}\) while the other two describe scalar DOFs, \(\widetilde{p}\) and \(\widetilde{J}\).</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>          = 3;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_components      = dim + 2;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_u_component = 0;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p_component       = dim;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> J_component       = dim + 1;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">  u_dof = 0,</div>
<div class="line">  p_dof = 1,</div>
<div class="line">  J_dof = 2</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">std::vector&lt;types::global_dof_index&gt; dofs_per_block;</div>
<div class="line">std::vector&lt;types::global_dof_index&gt; element_indices_u;</div>
<div class="line">std::vector&lt;types::global_dof_index&gt; element_indices_p;</div>
<div class="line">std::vector&lt;types::global_dof_index&gt; element_indices_J;</div>
<div class="ttc" id="anamespaceMatrixFreeOperators_1_1BlockHelper_html_a42c347ac5bcdd69aceb58ab14bacd2b7"><div class="ttname"><a href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">MatrixFreeOperators::BlockHelper::n_blocks</a></div><div class="ttdeci">std::enable_if&lt; IsBlockVector&lt; VectorType &gt;::value, unsigned int &gt;::type n_blocks(const VectorType &amp;vector)</div><div class="ttdef"><b>Definition:</b> <a href="operators_8h_source.html#l00049">operators.h:49</a></div></div>
</div><!-- fragment --><p>Rules for Gauss-quadrature on both the cell and faces. The number of quadrature points on both cells and faces is recorded.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     qf_cell;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt; qf_face;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points_f;</div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00038">quadrature_lib.h:39</a></div></div>
</div><!-- fragment --><p>Objects that store the converged solution and right-hand side vectors, as well as the tangent matrix. There is an <a class="el" href="classAffineConstraints.html">AffineConstraints</a> object used to keep track of constraints. We make use of a sparsity pattern designed for a block system.</p>
<div class="fragment"><div class="line"><a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"><a class="code" href="classBlockSparsityPattern.html">BlockSparsityPattern</a>      sparsity_pattern;</div>
<div class="line"><a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> tangent_matrix;</div>
<div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a>       system_rhs;</div>
<div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a>       solution_n;</div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassBlockSparseMatrix_html"><div class="ttname"><a href="classBlockSparseMatrix.html">BlockSparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparse__matrix_8h_source.html#l00049">block_sparse_matrix.h:50</a></div></div>
<div class="ttc" id="aclassBlockSparsityPattern_html"><div class="ttname"><a href="classBlockSparsityPattern.html">BlockSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparsity__pattern_8h_source.html#l00406">block_sparsity_pattern.h:407</a></div></div>
</div><!-- fragment --><p>Then define a number of variables to store norms and update norms and normalization factors.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Errors</div>
<div class="line">{</div>
<div class="line">  Errors()</div>
<div class="line">    : <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a>(1.0)</div>
<div class="line">    , u(1.0)</div>
<div class="line">    , p(1.0)</div>
<div class="line">    , J(1.0)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> = 1.0;</div>
<div class="line">    u    = 1.0;</div>
<div class="line">    p    = 1.0;</div>
<div class="line">    J    = 1.0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> normalize(<span class="keyword">const</span> Errors &amp;rhs)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (rhs.norm != 0.0)</div>
<div class="line">      <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> /= rhs.norm;</div>
<div class="line">    <span class="keywordflow">if</span> (rhs.u != 0.0)</div>
<div class="line">      u /= rhs.u;</div>
<div class="line">    <span class="keywordflow">if</span> (rhs.p != 0.0)</div>
<div class="line">      p /= rhs.p;</div>
<div class="line">    <span class="keywordflow">if</span> (rhs.J != 0.0)</div>
<div class="line">      J /= rhs.J;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a>, u, p, J;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">Errors error_residual, error_residual_0, error_residual_norm, error_update,</div>
<div class="line">  error_update_0, error_update_norm;</div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Divergence_html_a8bcfc37d2a2be8faa18628a601ecf112"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">LocalIntegrators::Divergence::norm</a></div><div class="ttdeci">double norm(const FEValuesBase&lt; dim &gt; &amp;fe, const ArrayView&lt; const std::vector&lt; Tensor&lt; 1, dim &gt;&gt;&gt; &amp;Du)</div><div class="ttdef"><b>Definition:</b> <a href="divergence_8h_source.html#l00472">divergence.h:472</a></div></div>
</div><!-- fragment --><p>Methods to calculate error measures</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> get_error_residual(Errors &amp;error_residual);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> get_error_update(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update,</div>
<div class="line">                      Errors &amp;                   error_update);</div>
<div class="line"> </div>
<div class="line">std::pair&lt;double, double&gt; get_error_dilation() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>Compute the volume in the spatial configuration</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> compute_vol_current() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p>Print information to screen in a pleasing way...</p>
<div class="fragment"><div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> print_conv_header();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> print_conv_footer();</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="ImplementationofthecodeSolidcodeclass"></a> </p><h3>Implementation of the <code>Solid</code> class</h3>
<p><a class="anchor" id="Publicinterface"></a> </p><h4>Public interface</h4>
<p>We initialize the Solid class using data extracted from the parameter file.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">Solid&lt;dim&gt;::Solid(<span class="keyword">const</span> std::string &amp;input_file)</div>
<div class="line">  : parameters(input_file)</div>
<div class="line">  , vol_reference(0.)</div>
<div class="line">  , <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::maximum_smoothing)</div>
<div class="line">  , time(parameters.end_time, parameters.delta_t)</div>
<div class="line">  , timer(std::cout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::summary, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">  , degree(parameters.poly_degree)</div>
<div class="line">  ,</div>
</div><!-- fragment --><p>The Finite Element System is composed of dim continuous displacement DOFs, and discontinuous pressure and dilatation DOFs. In an attempt to satisfy the Babuska-Brezzi or LBB stability conditions (see Hughes (2000)), we setup a \(Q_n \times DGPM_{n-1} \times DGPM_{n-1}\) system. \(Q_2 \times DGPM_1 \times DGPM_1\) elements satisfy this condition, while \(Q_1 \times DGPM_0 \times DGPM_0\) elements do not. However, it has been shown that the latter demonstrate good convergence characteristics nonetheless.</p>
<div class="fragment"><div class="line">  fe(<a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>(parameters.poly_degree),</div>
<div class="line">     dim, <span class="comment">// displacement</span></div>
<div class="line">     <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial&lt;dim&gt;</a>(parameters.poly_degree - 1),</div>
<div class="line">     1, <span class="comment">// pressure</span></div>
<div class="line">     <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial&lt;dim&gt;</a>(parameters.poly_degree - 1),</div>
<div class="line">     1)</div>
<div class="line">  , <span class="comment">// dilatation</span></div>
<div class="line">  dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , dofs_per_cell(fe.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>())</div>
<div class="line">  , u_fe(first_u_component)</div>
<div class="line">  , p_fe(p_component)</div>
<div class="line">  , J_fe(J_component)</div>
<div class="line">  , dofs_per_block(<a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>)</div>
<div class="line">  , qf_cell(parameters.quad_order)</div>
<div class="line">  , qf_face(parameters.quad_order)</div>
<div class="line">  , n_q_points(qf_cell.<a class="code" href="classQuadrature.html#af9f7d82770fa8126e19113f3e3db755b">size</a>())</div>
<div class="line">  , n_q_points_f(qf_face.size())</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim == 2 || dim == 3,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;This problem only works in 2 or 3 space dimensions.&quot;</span>));</div>
<div class="line">  determine_component_extractors();</div>
<div class="line">}</div>
<div class="ttc" id="aclassFE__DGPMonomial_html"><div class="ttname"><a href="classFE__DGPMonomial.html">FE_DGPMonomial</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__dgp__monomial_8h_source.html#l00284">fe_dgp_monomial.h:285</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8h_source.html#l00548">fe_q.h:549</a></div></div>
<div class="ttc" id="aclassFiniteElementData_html_a33b522422da89e5c080e7405ad49d7c7"><div class="ttname"><a href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">FiniteElementData::n_dofs_per_cell</a></div><div class="ttdeci">unsigned int n_dofs_per_cell() const</div></div>
<div class="ttc" id="aclassQuadrature_html_af9f7d82770fa8126e19113f3e3db755b"><div class="ttname"><a href="classQuadrature.html#af9f7d82770fa8126e19113f3e3db755b">Quadrature::size</a></div><div class="ttdeci">unsigned int size() const</div></div>
<div class="ttc" id="agroup__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
</div><!-- fragment --><p>In solving the quasi-static problem, the time becomes a loading parameter, i.e. we increasing the loading linearly with time, making the two concepts interchangeable. We choose to increment time linearly using a constant time step size.</p>
<p>We start the function with preprocessing, setting the initial dilatation values, and then output the initial grid before starting the simulation proper with the first time (and loading) increment.</p>
<p>Care must be taken (or at least some thought given) when imposing the constraint \(\widetilde{J}=1\) on the initial solution field. The constraint corresponds to the determinant of the deformation gradient in the undeformed configuration, which is the identity tensor. We use <a class="el" href="classFE__DGPMonomial.html">FE_DGPMonomial</a> bases to interpolate the dilatation field, thus we can't simply set the corresponding dof to unity as they correspond to the monomial coefficients. Thus we use the <a class="el" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a> function to do the work for us. The <a class="el" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a> function requires an argument indicating the hanging node constraints. We have none in this program So we have to create a constraint object. In its original state, constraint objects are unsorted, and have to be sorted (using the <a class="el" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a> function) before they can be used. Have a look at <a class="el" href="step_21.html">step-21</a> for more information. We only need to enforce the initial condition on the dilatation. In order to do this, we make use of a <a class="el" href="classComponentSelectFunction.html">ComponentSelectFunction</a> which acts as a mask and sets the J_component of n_components to 1. This is exactly what we want. Have a look at its usage in <a class="el" href="step_20.html">step-20</a> for more information.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">Solid&lt;dim&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  make_grid();</div>
<div class="line">  system_setup();</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a> J_mask(J_component, n_components);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a>(</div>
<div class="line">      dof_handler, constraints, <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(degree + 2), J_mask, solution_n);</div>
<div class="line">  }</div>
<div class="line">  output_results();</div>
<div class="line">  time.increment();</div>
<div class="ttc" id="aclassAffineConstraints_html_a1611aa37f754086388ca76bcd421cce5"><div class="ttname"><a href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">AffineConstraints::close</a></div><div class="ttdeci">void close()</div></div>
<div class="ttc" id="aclassComponentSelectFunction_html"><div class="ttname"><a href="classComponentSelectFunction.html">ComponentSelectFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00583">function.h:585</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ac6b404bf03cb2a742b290421cc2789fe"><div class="ttname"><a href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a></div><div class="ttdeci">void project(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const AffineConstraints&lt; typename VectorType::value_type &gt; &amp;constraints, const Quadrature&lt; dim &gt; &amp;quadrature, const Function&lt; spacedim, typename VectorType::value_type &gt; &amp;function, VectorType &amp;vec, const bool enforce_zero_boundary=false, const Quadrature&lt; dim - 1 &gt; &amp;q_boundary=(dim &gt; 1 ? QGauss&lt; dim - 1 &gt;(2) :Quadrature&lt; dim - 1 &gt;(0)), const bool project_to_boundary_first=false)</div></div>
</div><!-- fragment --><p>We then declare the incremental solution update \(\varDelta \mathbf{\Xi} \dealcoloneq \{\varDelta \mathbf{u},\varDelta \widetilde{p}, \varDelta \widetilde{J} \}\) and start the loop over the time domain.</p>
<p>At the beginning, we reset the solution update for this time step...</p>
<div class="fragment"><div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_delta(dofs_per_block);</div>
<div class="line"><span class="keywordflow">while</span> (time.current() &lt; time.end())</div>
<div class="line">  {</div>
<div class="line">    solution_delta = 0.0;</div>
</div><!-- fragment --><p>...solve the current time step and update total solution vector \(\mathbf{\Xi}_{\textrm{n}} = \mathbf{\Xi}_{\textrm{n-1}} + \varDelta \mathbf{\Xi}\)...</p>
<div class="fragment"><div class="line">solve_nonlinear_timestep(solution_delta);</div>
<div class="line">solution_n += solution_delta;</div>
</div><!-- fragment --><p>...and plot the results before moving on happily to the next time step:</p>
<div class="fragment"><div class="line">      output_results();</div>
<div class="line">      time.increment();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Privateinterface"></a> </p><h3>Private interface</h3>
<p><a class="anchor" id="Threadingbuildingblocksstructures"></a> </p><h4>Threading-building-blocks structures</h4>
<p>The first group of private member functions is related to parallelization. We use the Threading Building Blocks library (TBB) to perform as many computationally intensive distributed tasks as possible. In particular, we assemble the tangent matrix and right hand side vector, the static condensation contributions, and update data stored at the quadrature points using TBB. Our main tool for this is the <a class="el" href="namespaceWorkStream.html">WorkStream</a> class (see the <a class="el" href="group__threads.html">Parallel computing with multiple processors accessing shared memory</a> module for more information).</p>
<p>Firstly we deal with the tangent matrix and right-hand side assembly structures. The PerTaskData object stores local contributions to the global system.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_ASM</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line"> </div>
<div class="line">  PerTaskData_ASM(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell)</div>
<div class="line">    : <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell)</div>
<div class="line">    , cell_rhs(dofs_per_cell)</div>
<div class="line">    , local_dof_indices(dofs_per_cell)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0.0;</div>
<div class="line">    cell_rhs    = 0.0;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Advection_html_a8bc7b8136646134f73a4193adefe15f8"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">LocalIntegrators::Advection::cell_matrix</a></div><div class="ttdeci">void cell_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const FEValuesBase&lt; dim &gt; &amp;fetest, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="advection_8h_source.html#l00075">advection.h:75</a></div></div>
</div><!-- fragment --><p>On the other hand, the ScratchData object stores the larger objects such as the shape-function values array (<code>Nx</code>) and a shape function gradient and symmetric gradient vector which we will use during the assembly.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_ASM</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>     fe_values;</div>
<div class="line">  <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a> fe_face_values;</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;std::vector&lt;double&gt;&gt;                  Nx;</div>
<div class="line">  std::vector&lt;std::vector&lt;Tensor&lt;2, dim&gt;&gt;&gt;          grad_Nx;</div>
<div class="line">  std::vector&lt;std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt;&gt; symm_grad_Nx;</div>
<div class="line"> </div>
<div class="line">  ScratchData_ASM(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe_cell,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;       qf_cell,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         uf_cell,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim - 1&gt;</a> &amp;   qf_face,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         uf_face)</div>
<div class="line">    : fe_values(fe_cell, qf_cell, uf_cell)</div>
<div class="line">    , fe_face_values(fe_cell, qf_face, uf_face)</div>
<div class="line">    , Nx(qf_cell.size(), std::vector&lt;<a class="code" href="classdouble.html">double</a>&gt;(fe_cell.n_dofs_per_cell()))</div>
<div class="line">    , grad_Nx(qf_cell.size(),</div>
<div class="line">              std::vector&lt;<a class="code" href="classTensor.html">Tensor</a>&lt;2, dim&gt;&gt;(fe_cell.n_dofs_per_cell()))</div>
<div class="line">    , symm_grad_Nx(qf_cell.size(),</div>
<div class="line">                   std::vector&lt;<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt;&gt;(</div>
<div class="line">                     fe_cell.n_dofs_per_cell()))</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  ScratchData_ASM(<span class="keyword">const</span> ScratchData_ASM &amp;rhs)</div>
<div class="line">    : fe_values(rhs.fe_values.get_fe(),</div>
<div class="line">                rhs.fe_values.get_quadrature(),</div>
<div class="line">                rhs.fe_values.get_update_flags())</div>
<div class="line">    , fe_face_values(rhs.fe_face_values.get_fe(),</div>
<div class="line">                     rhs.fe_face_values.get_quadrature(),</div>
<div class="line">                     rhs.fe_face_values.get_update_flags())</div>
<div class="line">    , Nx(rhs.Nx)</div>
<div class="line">    , grad_Nx(rhs.grad_Nx)</div>
<div class="line">    , symm_grad_Nx(rhs.symm_grad_Nx)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points      = Nx.size();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs_per_cell = Nx[0].size();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(Nx[q_point].size() == n_dofs_per_cell, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(grad_Nx[q_point].size() == n_dofs_per_cell,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(symm_grad_Nx[q_point].size() == n_dofs_per_cell,</div>
<div class="line">               <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; n_dofs_per_cell; ++k)</div>
<div class="line">          {</div>
<div class="line">            Nx[q_point][k]           = 0.0;</div>
<div class="line">            grad_Nx[q_point][k]      = 0.0;</div>
<div class="line">            symm_grad_Nx[q_point][k] = 0.0;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassFEFaceValues_html"><div class="ttname"><a href="classFEFaceValues.html">FEFaceValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l04157">fe_values.h:4158</a></div></div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l03905">fe_values.h:3906</a></div></div>
<div class="ttc" id="aclassFiniteElement_html"><div class="ttname"><a href="classFiniteElement.html">FiniteElement</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l00645">fe.h:646</a></div></div>
<div class="ttc" id="aclassdouble_html"><div class="ttname"><a href="classdouble.html">double</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52f"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a></div><div class="ttdeci">UpdateFlags</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00066">fe_update_flags.h:67</a></div></div>
</div><!-- fragment --><p>Then we define structures to assemble the statically condensed tangent matrix. Recall that we wish to solve for a displacement-based formulation. We do the condensation at the element level as the \(\widetilde{p}\) and \(\widetilde{J}\) fields are element-wise discontinuous. As these operations are matrix-based, we need to setup a number of matrices to store the local contributions from a number of the tangent matrix sub-blocks. We place these in the PerTaskData struct.</p>
<p>We choose not to reset any data in the <code>reset()</code> function as the matrix extraction and replacement tools will take care of this</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_SC</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_orig;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pu;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pJ;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_JJ;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pJ_inv;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_bbar;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> B;</div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>;</div>
<div class="line"> </div>
<div class="line">  PerTaskData_SC(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_u,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_p,</div>
<div class="line">                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_J)</div>
<div class="line">    : <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell)</div>
<div class="line">    , local_dof_indices(dofs_per_cell)</div>
<div class="line">    , k_orig(dofs_per_cell, dofs_per_cell)</div>
<div class="line">    , k_pu(n_p, n_u)</div>
<div class="line">    , k_pJ(n_p, n_J)</div>
<div class="line">    , k_JJ(n_J, n_J)</div>
<div class="line">    , k_pJ_inv(n_p, n_J)</div>
<div class="line">    , k_bbar(n_u, n_u)</div>
<div class="line">    , <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>(n_J, n_u)</div>
<div class="line">    , B(n_J, n_u)</div>
<div class="line">    , <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>(n_p, n_u)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {}</div>
<div class="line">};</div>
<div class="ttc" id="anamespaceLAPACKSupport_html_a40707d49114d54318c823f3b750e89a4"><div class="ttname"><a href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">LAPACKSupport::A</a></div><div class="ttdeci">static const char A</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00153">lapack_support.h:153</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a09916360abaee5f1fb31994dbc96787b"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">Physics::Elasticity::Kinematics::C</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; C(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
</div><!-- fragment --><p>The ScratchData object for the operations we wish to perform here is empty since we need no temporary data, but it still needs to be defined for the current implementation of TBB in deal.II. So we create a dummy struct for this purpose.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_SC</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {}</div>
<div class="line">};</div>
</div><!-- fragment --><p>And finally we define the structures to assist with updating the quadrature point information. Similar to the SC assembly process, we do not need the PerTaskData object (since there is nothing to store here) but must define one nonetheless. Note that this is because for the operation that we have here &ndash; updating the data on quadrature points &ndash; the operation is purely local: the things we do on every cell get consumed on every cell, without any global aggregation operation as is usually the case when using the <a class="el" href="namespaceWorkStream.html">WorkStream</a> class. The fact that we still have to define a per-task data structure points to the fact that the <a class="el" href="namespaceWorkStream.html">WorkStream</a> class may be ill-suited to this operation (we could, in principle simply create a new task using <a class="el" href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a> for each cell) but there is not much harm done to doing it this way anyway. Furthermore, should there be different material models associated with a quadrature point, requiring varying levels of computational expense, then the method used here could be advantageous.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_UQPH</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {}</div>
<div class="line">};</div>
</div><!-- fragment --><p>The ScratchData object will be used to store an alias for the solution vector so that we don't have to copy this large data structure. We then define a number of vectors to extract the solution values and gradients at the quadrature points.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_UQPH</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_total;</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Tensor&lt;2, dim&gt;&gt; solution_grads_u_total;</div>
<div class="line">  std::vector&lt;double&gt;         solution_values_p_total;</div>
<div class="line">  std::vector&lt;double&gt;         solution_values_J_total;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line"> </div>
<div class="line">  ScratchData_UQPH(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe_cell,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;        qf_cell,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>          uf_cell,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_total)</div>
<div class="line">    : solution_total(solution_total)</div>
<div class="line">    , solution_grads_u_total(qf_cell.size())</div>
<div class="line">    , solution_values_p_total(qf_cell.size())</div>
<div class="line">    , solution_values_J_total(qf_cell.size())</div>
<div class="line">    , fe_values(fe_cell, qf_cell, uf_cell)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  ScratchData_UQPH(<span class="keyword">const</span> ScratchData_UQPH &amp;rhs)</div>
<div class="line">    : solution_total(rhs.solution_total)</div>
<div class="line">    , solution_grads_u_total(rhs.solution_grads_u_total)</div>
<div class="line">    , solution_values_p_total(rhs.solution_values_p_total)</div>
<div class="line">    , solution_values_J_total(rhs.solution_values_J_total)</div>
<div class="line">    , fe_values(rhs.fe_values.get_fe(),</div>
<div class="line">                rhs.fe_values.get_quadrature(),</div>
<div class="line">                rhs.fe_values.get_update_flags())</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = solution_grads_u_total.size();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">      {</div>
<div class="line">        solution_grads_u_total[q]  = 0.0;</div>
<div class="line">        solution_values_p_total[q] = 0.0;</div>
<div class="line">        solution_values_J_total[q] = 0.0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="Solidmake_grid"></a> </p><h4>Solid::make_grid</h4>
<p>On to the first of the private member functions. Here we create the triangulation of the domain, for which we choose the scaled cube with each face given a boundary ID number. The grid must be refined at least once for the indentation problem.</p>
<p>We then determine the volume of the reference configuration and print it for comparison:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::make_grid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#a56019d263ae45708302d5d7599f0d458">GridGenerator::hyper_rectangle</a>(</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">    (dim == 3 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0.0, 0.0, 0.0) : <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0.0, 0.0)),</div>
<div class="line">    (dim == 3 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(1.0, 1.0, 1.0) : <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(1.0, 1.0)),</div>
<div class="line">    <span class="keyword">true</span>);</div>
<div class="line">  <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a>(parameters.scale, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(1U, parameters.global_refinement));</div>
<div class="line"> </div>
<div class="line">  vol_reference = <a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">GridTools::volume</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Grid:\n\t Reference volume: &quot;</span> &lt;&lt; vol_reference &lt;&lt; std::endl;</div>
<div class="ttc" id="aclassPoint_html"><div class="ttname"><a href="classPoint.html">Point</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2point_8h_source.html#l00110">point.h:111</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_a56019d263ae45708302d5d7599f0d458"><div class="ttname"><a href="namespaceGridGenerator.html#a56019d263ae45708302d5d7599f0d458">GridGenerator::hyper_rectangle</a></div><div class="ttdeci">void hyper_rectangle(Triangulation&lt; dim, spacedim &gt; &amp;tria, const Point&lt; dim &gt; &amp;p1, const Point&lt; dim &gt; &amp;p2, const bool colorize=false)</div></div>
<div class="ttc" id="anamespaceGridTools_html_a9e8169dc4981e90ba5d2386a87efa042"><div class="ttname"><a href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">GridTools::volume</a></div><div class="ttdeci">double volume(const Triangulation&lt; dim, spacedim &gt; &amp;tria, const Mapping&lt; dim, spacedim &gt; &amp;mapping=(ReferenceCells::get_hypercube&lt; dim &gt;() .template get_default_linear_mapping&lt; dim, spacedim &gt;()))</div><div class="ttdef"><b>Definition:</b> <a href="grid__tools_8cc_source.html#l00137">grid_tools.cc:137</a></div></div>
<div class="ttc" id="anamespaceVectorTools_1_1EvaluationFlags_html_ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420"><div class="ttname"><a href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">VectorTools::EvaluationFlags::max</a></div><div class="ttdeci">@ max</div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__evaluate_8h_source.html#l00053">vector_tools_evaluate.h:53</a></div></div>
</div><!-- fragment --><p>Since we wish to apply a Neumann BC to a patch on the top surface, we must find the cell faces in this part of the domain and mark them with a distinct boundary ID number. The faces we are looking for are on the +y surface and will get boundary ID 6 (zero through five are already used when creating the six faces of the cube domain):</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (face-&gt;at_boundary() == <span class="keyword">true</span> &amp;&amp;</div>
<div class="line">            face-&gt;center()[1] == 1.0 * parameters.scale)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">if</span> (dim == 3)</div>
<div class="line">              {</div>
<div class="line">                <span class="keywordflow">if</span> (face-&gt;center()[0] &lt; 0.5 * parameters.scale &amp;&amp;</div>
<div class="line">                    face-&gt;center()[2] &lt; 0.5 * parameters.scale)</div>
<div class="line">                  face-&gt;set_boundary_id(6);</div>
<div class="line">              }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              {</div>
<div class="line">                <span class="keywordflow">if</span> (face-&gt;center()[0] &lt; 0.5 * parameters.scale)</div>
<div class="line">                  face-&gt;set_boundary_id(6);</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Solidsystem_setup"></a> </p><h4>Solid::system_setup</h4>
<p>Next we describe how the FE system is setup. We first determine the number of components per block. Since the displacement is a vector component, the first dim components belong to it, while the next two describe scalar pressure and dilatation DOFs.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::system_setup()</div>
<div class="line">{</div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned int&gt; block_component(n_components,</div>
<div class="line">                                            u_dof); <span class="comment">// Displacement</span></div>
<div class="line">  block_component[p_component] = p_dof;             <span class="comment">// Pressure</span></div>
<div class="line">  block_component[J_component] = J_dof;             <span class="comment">// Dilatation</span></div>
<div class="ttc" id="aclassTimerOutput_html_ae730ff220ae414208dc85e76920c3e45"><div class="ttname"><a href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">TimerOutput::enter_subsection</a></div><div class="ttdeci">void enter_subsection(const std::string &amp;section_name)</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00403">timer.cc:403</a></div></div>
</div><!-- fragment --><p>The DOF handler is then initialized and we renumber the grid in an efficient manner. We also record the number of DOFs per block.</p>
<div class="fragment"><div class="line">dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line"><a class="code" href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a>(dof_handler);</div>
<div class="line"><a class="code" href="namespaceDoFRenumbering.html#a52c1941406d1ce2937e29a46edf111f4">DoFRenumbering::component_wise</a>(dof_handler, block_component);</div>
<div class="line"> </div>
<div class="line">dofs_per_block =</div>
<div class="line">  <a class="code" href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a>(dof_handler, block_component);</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Triangulation:&quot;</span></div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;\n\t Number of active cells: &quot;</span></div>
<div class="line">          &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells()</div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot;\n\t Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">          &lt;&lt; std::endl;</div>
<div class="ttc" id="aclassDoFHandler_html_a553ca864aaf70330d9be86bc78f36d1e"><div class="ttname"><a href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">DoFHandler::distribute_dofs</a></div><div class="ttdeci">void distribute_dofs(const FiniteElement&lt; dim, spacedim &gt; &amp;fe)</div></div>
<div class="ttc" id="aclassDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="anamespaceDoFRenumbering_html_a52c1941406d1ce2937e29a46edf111f4"><div class="ttname"><a href="namespaceDoFRenumbering.html#a52c1941406d1ce2937e29a46edf111f4">DoFRenumbering::component_wise</a></div><div class="ttdeci">void component_wise(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const std::vector&lt; unsigned int &gt; &amp;target_component=std::vector&lt; unsigned int &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l00681">dof_renumbering.cc:681</a></div></div>
<div class="ttc" id="anamespaceDoFRenumbering_html_a68651164485490b86d901d9ae1fbfc3b"><div class="ttname"><a href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a></div><div class="ttdeci">void Cuthill_McKee(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const bool reversed_numbering=false, const bool use_constraints=false, const std::vector&lt; types::global_dof_index &gt; &amp;starting_indices=std::vector&lt; types::global_dof_index &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l00366">dof_renumbering.cc:366</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a796721b56b3a90e4e3973c7caae4c3d8"><div class="ttname"><a href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a></div><div class="ttdeci">std::vector&lt; types::global_dof_index &gt; count_dofs_per_fe_block(const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::vector&lt; unsigned int &gt; &amp;target_block=std::vector&lt; unsigned int &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l02047">dof_tools.cc:2047</a></div></div>
</div><!-- fragment --><p>Setup the sparsity pattern and tangent matrix</p>
<div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#gacf098688a1a7db16a6582be07dcbeb6a">clear</a>();</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_u = dofs_per_block[u_dof];</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_p = dofs_per_block[p_dof];</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_J = dofs_per_block[J_dof];</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a> dsp(<a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>, <a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>);</div>
<div class="line"> </div>
<div class="line">  dsp.block(u_dof, u_dof).reinit(n_dofs_u, n_dofs_u);</div>
<div class="line">  dsp.block(u_dof, p_dof).reinit(n_dofs_u, n_dofs_p);</div>
<div class="line">  dsp.block(u_dof, J_dof).reinit(n_dofs_u, n_dofs_J);</div>
<div class="line"> </div>
<div class="line">  dsp.block(p_dof, u_dof).reinit(n_dofs_p, n_dofs_u);</div>
<div class="line">  dsp.block(p_dof, p_dof).reinit(n_dofs_p, n_dofs_p);</div>
<div class="line">  dsp.block(p_dof, J_dof).reinit(n_dofs_p, n_dofs_J);</div>
<div class="line"> </div>
<div class="line">  dsp.block(J_dof, u_dof).reinit(n_dofs_J, n_dofs_u);</div>
<div class="line">  dsp.block(J_dof, p_dof).reinit(n_dofs_J, n_dofs_p);</div>
<div class="line">  dsp.block(J_dof, J_dof).reinit(n_dofs_J, n_dofs_J);</div>
<div class="line">  dsp.collect_sizes();</div>
<div class="ttc" id="aclassBlockDynamicSparsityPattern_html"><div class="ttname"><a href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparsity__pattern_8h_source.html#l00524">block_sparsity_pattern.h:526</a></div></div>
<div class="ttc" id="agroup__Matrix1_html_gacf098688a1a7db16a6582be07dcbeb6a"><div class="ttname"><a href="group__Matrix1.html#gacf098688a1a7db16a6582be07dcbeb6a">BlockSparseMatrix::clear</a></div><div class="ttdeci">void clear()</div></div>
<div class="ttc" id="anamespacetypes_html_a3543786f7dc7c57385fc923a6afd5917"><div class="ttname"><a href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a></div><div class="ttdeci">unsigned int global_dof_index</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00076">types.h:76</a></div></div>
</div><!-- fragment --><p>The global system matrix initially has the following structure </p><p class="formulaDsp">
\begin{align*} \underbrace{\begin{bmatrix} \mathsf{\mathbf{K}}_{uu} &amp; \mathsf{\mathbf{K}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathsf{\mathbf{K}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}} \\ \mathbf{0} &amp; \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}} &amp; \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} \end{bmatrix}}_{\mathsf{\mathbf{K}}(\mathbf{\Xi}_{\textrm{i}})} \underbrace{\begin{bmatrix} d \mathsf{u} \\ d \widetilde{\mathsf{\mathbf{p}}} \\ d \widetilde{\mathsf{\mathbf{J}}} \end{bmatrix}}_{d \mathbf{\Xi}} = \underbrace{\begin{bmatrix} \mathsf{\mathbf{F}}_{u}(\mathbf{u}_{\textrm{i}}) \\ \mathsf{\mathbf{F}}_{\widetilde{p}}(\widetilde{p}_{\textrm{i}}) \\ \mathsf{\mathbf{F}}_{\widetilde{J}}(\widetilde{J}_{\textrm{i}}) \end{bmatrix}}_{ \mathsf{\mathbf{F}}(\mathbf{\Xi}_{\textrm{i}}) } \, . \end{align*}
</p>
<p> We optimize the sparsity pattern to reflect this structure and prevent unnecessary data creation for the right-diagonal block components.</p>
<div class="fragment"><div class="line">  <a class="code" href="classTable.html">Table&lt;2, DoFTools::Coupling&gt;</a> coupling(n_components, n_components);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0; ii &lt; n_components; ++ii)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jj = 0; jj &lt; n_components; ++jj)</div>
<div class="line">      <span class="keywordflow">if</span> (((ii &lt; p_component) &amp;&amp; (jj == J_component)) ||</div>
<div class="line">          ((ii == J_component) &amp;&amp; (jj &lt; p_component)) ||</div>
<div class="line">          ((ii == p_component) &amp;&amp; (jj == p_component)))</div>
<div class="line">        coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba">DoFTools::none</a>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">DoFTools::always</a>;</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(</div>
<div class="line">    dof_handler, coupling, dsp, constraints, <span class="keyword">false</span>);</div>
<div class="line">  sparsity_pattern.<a class="code" href="group__Exceptions.html#ga923288e4b4093f86b680e7045e9b4984">copy_from</a>(dsp);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e0a45e360458e7350bd93487d6bf1e5">reinit</a>(sparsity_pattern);</div>
<div class="ttc" id="aclassTable_html"><div class="ttname"><a href="classTable.html">Table</a></div><div class="ttdef"><b>Definition:</b> <a href="table_8h_source.html#l00666">table.h:667</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga923288e4b4093f86b680e7045e9b4984"><div class="ttname"><a href="group__Exceptions.html#ga923288e4b4093f86b680e7045e9b4984">BlockSparsityPattern::copy_from</a></div><div class="ttdeci">void copy_from(const BlockDynamicSparsityPattern &amp;dsp)</div><div class="ttdef"><b>Definition:</b> <a href="block__sparsity__pattern_8cc_source.html#l00449">block_sparsity_pattern.cc:449</a></div></div>
<div class="ttc" id="agroup__Matrix1_html_ga1e0a45e360458e7350bd93487d6bf1e5"><div class="ttname"><a href="group__Matrix1.html#ga1e0a45e360458e7350bd93487d6bf1e5">BlockSparseMatrix::reinit</a></div><div class="ttdeci">virtual void reinit(const BlockSparsityPattern &amp;sparsity)</div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba"><div class="ttname"><a href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba">DoFTools::none</a></div><div class="ttdeci">@ none</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8h_source.html#l00231">dof_tools.h:231</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec"><div class="ttname"><a href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">DoFTools::always</a></div><div class="ttdeci">@ always</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8h_source.html#l00235">dof_tools.h:235</a></div></div>
</div><!-- fragment --><p>We then set up storage vectors</p>
<div class="fragment"><div class="line">system_rhs.<a class="code" href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">reinit</a>(dofs_per_block);</div>
<div class="line">system_rhs.<a class="code" href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">collect_sizes</a>();</div>
<div class="line"> </div>
<div class="line">solution_n.<a class="code" href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">reinit</a>(dofs_per_block);</div>
<div class="line">solution_n.<a class="code" href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">collect_sizes</a>();</div>
<div class="ttc" id="agroup__Exceptions_html_ga6a27b2a48e5b5780cd0a6640b928d794"><div class="ttname"><a href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">BlockVectorBase::collect_sizes</a></div><div class="ttdeci">void collect_sizes()</div></div>
<div class="ttc" id="agroup__Vectors_html_gadf4d1d6c3538af95309a95da2ded758c"><div class="ttname"><a href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">BlockVector::reinit</a></div><div class="ttdeci">void reinit(const unsigned int n_blocks, const size_type block_size=0, const bool omit_zeroing_entries=false)</div></div>
</div><!-- fragment --><p>...and finally set up the quadrature point history:</p>
<div class="fragment"><div class="line">  setup_qph();</div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassTimerOutput_html_a4d27dbc569819f3bbcb5e066e47212ea"><div class="ttname"><a href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">TimerOutput::leave_subsection</a></div><div class="ttdeci">void leave_subsection(const std::string &amp;section_name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00445">timer.cc:445</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Soliddetermine_component_extractors"></a> </p><h4>Solid::determine_component_extractors</h4>
<p>Next we compute some information from the FE system that describes which local element DOFs are attached to which block component. This is used later to extract sub-blocks from the global matrix.</p>
<p>In essence, all we need is for the <a class="el" href="classFESystem.html">FESystem</a> object to indicate to which block component a DOF on the reference cell is attached to. Currently, the interpolation fields are setup such that 0 indicates a displacement DOF, 1 a pressure DOF and 2 a dilatation DOF.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::determine_component_extractors()</div>
<div class="line">{</div>
<div class="line">  element_indices_u.clear();</div>
<div class="line">  element_indices_p.clear();</div>
<div class="line">  element_indices_J.clear();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; fe.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++k)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(k).first.first;</div>
<div class="line">      <span class="keywordflow">if</span> (k_group == u_dof)</div>
<div class="line">        element_indices_u.push_back(k);</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_dof)</div>
<div class="line">        element_indices_p.push_back(k);</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_dof)</div>
<div class="line">        element_indices_J.push_back(k);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassFiniteElement_html_ad88459d21a0e6c8b8882eb5dc981cf31"><div class="ttname"><a href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">FiniteElement::system_to_base_index</a></div><div class="ttdeci">std::pair&lt; std::pair&lt; unsigned int, unsigned int &gt;, unsigned int &gt; system_to_base_index(const unsigned int index) const</div></div>
</div><!-- fragment --><p><a class="anchor" id="Solidsetup_qph"></a> </p><h4>Solid::setup_qph</h4>
<p>The method used to store quadrature information is already described in <a class="el" href="step_18.html">step-18</a>. Here we implement a similar setup for a SMP machine.</p>
<p>Firstly the actual QPH data objects are created. This must be done only once the grid is refined to its finest level.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::setup_qph()</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;    Setting up quadrature point data...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  quadrature_point_history.<a class="code" href="classCellDataStorage.html#a9ce38927ac1a1f96618c2624da89d65b">initialize</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.begin_active(),</div>
<div class="line">                                      <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.end(),</div>
<div class="line">                                      n_q_points);</div>
<div class="ttc" id="aclassCellDataStorage_html_a9ce38927ac1a1f96618c2624da89d65b"><div class="ttname"><a href="classCellDataStorage.html#a9ce38927ac1a1f96618c2624da89d65b">CellDataStorage::initialize</a></div><div class="ttdeci">void initialize(const CellIteratorType &amp;cell, const unsigned int number_of_data_points_per_cell)</div></div>
</div><!-- fragment --><p>Next we setup the initial quadrature point data. Note that when the quadrature point data is retrieved, it is returned as a vector of smart pointers.</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">        lqph[q_point]-&gt;setup_lqp(parameters);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassCellDataStorage_html_ac9702fd0e031af11ccdc28e7908ec487"><div class="ttname"><a href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">CellDataStorage::get_data</a></div><div class="ttdeci">std::vector&lt; std::shared_ptr&lt; T &gt; &gt; get_data(const CellIteratorType &amp;cell)</div></div>
</div><!-- fragment --><p><a class="anchor" id="Solidupdate_qph_incremental"></a> </p><h4>Solid::update_qph_incremental</h4>
<p>As the update of QP information occurs frequently and involves a number of expensive operations, we define a multithreaded approach to distributing the task across a number of CPU cores.</p>
<p>To start this, we first we need to obtain the total solution as it stands at this Newton increment and then create the initial copy of the scratch and copy data objects:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">Solid&lt;dim&gt;::update_qph_incremental(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)</div>
<div class="line">{</div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Update QPH data&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; UQPH &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_total(</div>
<div class="line">    get_total_solution(solution_delta));</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_UQPH(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>);</div>
<div class="line">  PerTaskData_UQPH  per_task_data_UQPH;</div>
<div class="line">  ScratchData_UQPH  scratch_data_UQPH(fe, qf_cell, uf_UQPH, solution_total);</div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00084">fe_update_flags.h:84</a></div></div>
</div><!-- fragment --><p>We then pass them and the one-cell update function to the <a class="el" href="namespaceWorkStream.html">WorkStream</a> to be processed:</p>
<div class="fragment"><div class="line">  <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">                  *<span class="keyword">this</span>,</div>
<div class="line">                  &amp;Solid::update_qph_incremental_one_cell,</div>
<div class="line">                  &amp;Solid::copy_local_to_global_UQPH,</div>
<div class="line">                  scratch_data_UQPH,</div>
<div class="line">                  per_task_data_UQPH);</div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__CPP11_html_gaace8c98aca00e7e48a619bb5e08084aa"><div class="ttname"><a href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div></div>
<div class="ttc" id="anamespaceWorkStream_html_ab8ceb010811941c351803b671a19fb73"><div class="ttname"><a href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a></div><div class="ttdeci">void run(const std::vector&lt; std::vector&lt; Iterator &gt;&gt; &amp;colored_iterators, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length=2 *MultithreadInfo::n_threads(), const unsigned int chunk_size=8)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l01337">work_stream.h:1337</a></div></div>
</div><!-- fragment --><p>Now we describe how we extract data from the solution vector and pass it along to each QP storage object for processing.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::update_qph_incremental_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_UQPH &amp;                                    scratch,</div>
<div class="line">  PerTaskData_UQPH &amp; <span class="comment">/*data*/</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">    quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_grads_u_total.size() == n_q_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_values_p_total.size() == n_q_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_values_J_total.size() == n_q_points,</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">  scratch.reset();</div>
</div><!-- fragment --><p>We first need to find the values and gradients at quadrature points inside the current cell and then we update each local QP using the displacement gradient and total pressure and dilatation solution values:</p>
<div class="fragment"><div class="line">  scratch.fe_values.reinit(cell);</div>
<div class="line">  scratch.fe_values[u_fe].get_function_gradients(</div>
<div class="line">    scratch.solution_total, scratch.solution_grads_u_total);</div>
<div class="line">  scratch.fe_values[p_fe].get_function_values(</div>
<div class="line">    scratch.solution_total, scratch.solution_values_p_total);</div>
<div class="line">  scratch.fe_values[J_fe].get_function_values(</div>
<div class="line">    scratch.solution_total, scratch.solution_values_J_total);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">       scratch.fe_values.quadrature_point_indices())</div>
<div class="line">    lqph[q_point]-&gt;update_values(scratch.solution_grads_u_total[q_point],</div>
<div class="line">                                 scratch.solution_values_p_total[q_point],</div>
<div class="line">                                 scratch.solution_values_J_total[q_point]);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Solidsolve_nonlinear_timestep"></a> </p><h4>Solid::solve_nonlinear_timestep</h4>
<p>The next function is the driver method for the Newton-Raphson scheme. At its top we create a new vector to store the current Newton update step, reset the error storage objects and print solver header.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::solve_nonlinear_timestep(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Timestep &quot;</span> &lt;&lt; time.get_timestep() &lt;&lt; <span class="stringliteral">&quot; @ &quot;</span> &lt;&lt; time.current()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> newton_update(dofs_per_block);</div>
<div class="line"> </div>
<div class="line">  error_residual.reset();</div>
<div class="line">  error_residual_0.reset();</div>
<div class="line">  error_residual_norm.reset();</div>
<div class="line">  error_update.reset();</div>
<div class="line">  error_update_0.reset();</div>
<div class="line">  error_update_norm.reset();</div>
<div class="line"> </div>
<div class="line">  print_conv_header();</div>
</div><!-- fragment --><p>We now perform a number of Newton iterations to iteratively solve the nonlinear problem. Since the problem is fully nonlinear and we are using a full Newton method, the data stored in the tangent matrix and right-hand side vector is not reusable and must be cleared at each Newton step. We then initially build the linear system and check for convergence (and store this value in the first iteration). The unconstrained DOFs of the rhs vector hold the out-of-balance forces, and collectively determine whether or not the equilibrium solution has been attained.</p>
<p>Although for this particular problem we could potentially construct the RHS vector before assembling the system matrix, for the sake of extensibility we choose not to do so. The benefit to assembling the RHS vector and system matrix separately is that the latter is an expensive operation and we can potentially avoid an extra assembly process by not assembling the tangent matrix when convergence is attained. However, this makes parallelizing the code using MPI more difficult. Furthermore, when extending the problem to the transient case additional contributions to the RHS may result from the time discretization and application of constraints for the velocity and acceleration fields.</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_iteration = 0;</div>
<div class="line"><span class="keywordflow">for</span> (; newton_iteration &lt; parameters.max_iterations_NR; ++newton_iteration)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; newton_iteration &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">              &lt;&lt; std::flush;</div>
</div><!-- fragment --><p>We construct the linear system, but hold off on solving it (a step that should be significantly more expensive than assembly):</p>
<div class="fragment"><div class="line">make_constraints(newton_iteration);</div>
<div class="line">assemble_system();</div>
</div><!-- fragment --><p>We can now determine the normalized residual error and check for solution convergence:</p>
<div class="fragment"><div class="line">get_error_residual(error_residual);</div>
<div class="line"><span class="keywordflow">if</span> (newton_iteration == 0)</div>
<div class="line">  error_residual_0 = error_residual;</div>
<div class="line"> </div>
<div class="line">error_residual_norm = error_residual;</div>
<div class="line">error_residual_norm.normalize(error_residual_0);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (newton_iteration &gt; 0 &amp;&amp; error_update_norm.u &lt;= parameters.tol_u &amp;&amp;</div>
<div class="line">    error_residual_norm.u &lt;= parameters.tol_f)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; CONVERGED! &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    print_conv_footer();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
</div><!-- fragment --><p>If we have decided that we want to continue with the iteration, we solve the linearized system:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> std::pair&lt;unsigned int, double&gt; lin_solver_output =</div>
<div class="line">  solve_linear_system(newton_update);</div>
</div><!-- fragment --><p>We can now determine the normalized Newton update error:</p>
<div class="fragment"><div class="line">get_error_update(newton_update, error_update);</div>
<div class="line"><span class="keywordflow">if</span> (newton_iteration == 0)</div>
<div class="line">  error_update_0 = error_update;</div>
<div class="line"> </div>
<div class="line">error_update_norm = error_update;</div>
<div class="line">error_update_norm.normalize(error_update_0);</div>
</div><!-- fragment --><p>Lastly, since we implicitly accept the solution step we can perform the actual update of the solution increment for the current time step, update all quadrature point information pertaining to this new displacement and stress state and continue iterating:</p>
<div class="fragment"><div class="line">  solution_delta += newton_update;</div>
<div class="line">  update_qph_incremental(solution_delta);</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; std::fixed &lt;&lt; std::setprecision(3) &lt;&lt; std::setw(7)</div>
<div class="line">            &lt;&lt; std::scientific &lt;&lt; lin_solver_output.first &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">            &lt;&lt; lin_solver_output.second &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">            &lt;&lt; error_residual_norm.norm &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.u</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.p &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">            &lt;&lt; error_residual_norm.J &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.norm</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.u &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.p</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.J &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>At the end, if it turns out that we have in fact done more iterations than the parameter file allowed, we raise an exception that can be caught in the main() function. The call <code>AssertThrow(condition, exc_object)</code> is in essence equivalent to <code>if (!cond) throw exc_object;</code> but the former form fills certain fields in the exception object that identify the location (filename and line number) where the exception was raised to make it simpler to identify where the problem happened.</p>
<div class="fragment"><div class="line">  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(newton_iteration &lt; parameters.max_iterations_NR,</div>
<div class="line">              <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver!&quot;</span>));</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Exceptions_html_gafc0ca7ad85b3ebd64e8e51689ac85caf"><div class="ttname"><a href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a></div><div class="ttdeci">#define AssertThrow(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01583">exceptions.h:1583</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Solidprint_conv_headerandSolidprint_conv_footer"></a> </p><h4>Solid::print_conv_header and Solid::print_conv_footer</h4>
<p>This program prints out data in a nice table that is updated on a per-iteration basis. The next two functions set up the table header and footer:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_header()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_width = 150;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;               SOLVER STEP               &quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; |  LIN_IT   LIN_RES    RES_NORM    &quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; RES_U     RES_P      RES_J     NU_NORM     &quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; NU_U       NU_P       NU_J &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_footer()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_width = 150;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::pair&lt;double, double&gt; error_dil = get_error_dilation();</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Relative errors:&quot;</span> &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Displacement:\t&quot;</span> &lt;&lt; error_update.u / error_update_0.u</div>
<div class="line">            &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Force: \t\t&quot;</span> &lt;&lt; error_residual.u / error_residual_0.u</div>
<div class="line">            &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Dilatation:\t&quot;</span> &lt;&lt; error_dil.first &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;v / V_0:\t&quot;</span> &lt;&lt; error_dil.second * vol_reference &lt;&lt; <span class="stringliteral">&quot; / &quot;</span></div>
<div class="line">            &lt;&lt; vol_reference &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; error_dil.second &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Solidget_error_dilation"></a> </p><h4>Solid::get_error_dilation</h4>
<p>Calculate the volume of the domain in the spatial configuration</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> Solid&lt;dim&gt;::compute_vol_current()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordtype">double</span> vol_current = 0.0;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe, qf_cell, <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="ttc" id="aclassFEValues_html_a21f914e63d588e2652a9514620653d77"><div class="ttname"><a href="classFEValues.html#a21f914e63d588e2652a9514620653d77">FEValues::reinit</a></div><div class="ttdeci">void reinit(const TriaIterator&lt; DoFCellAccessor&lt; dim, spacedim, level_dof_access &gt;&gt; &amp;cell)</div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00129">fe_update_flags.h:129</a></div></div>
</div><!-- fragment --><p>In contrast to that which was previously called for, in this instance the quadrature point data is specifically non-modifiable since we will only be accessing data. We ensure that the right get_data function is called by marking this update function as constant.</p>
<div class="fragment"><div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point : fe_values.<a class="code" href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">quadrature_point_indices</a>())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> JxW      = fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div>
<div class="line"> </div>
<div class="line">          vol_current += det_F_qp * JxW;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(vol_current &gt; 0.0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">  <span class="keywordflow">return</span> vol_current;</div>
<div class="line">}</div>
<div class="ttc" id="aclassFEValuesBase_html_aada8380792b5e6a1f91dcba94b558cb8"><div class="ttname"><a href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">FEValuesBase::quadrature_point_indices</a></div><div class="ttdeci">std_cxx20::ranges::iota_view&lt; unsigned int, unsigned int &gt; quadrature_point_indices() const</div></div>
<div class="ttc" id="aclassFEValuesBase_html_abade89efb068b71b7ced7082012a2441"><div class="ttname"><a href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">FEValuesBase::JxW</a></div><div class="ttdeci">double JxW(const unsigned int quadrature_point) const</div></div>
</div><!-- fragment --><p>Calculate how well the dilatation \(\widetilde{J}\) agrees with \(J \dealcoloneq \textrm{det}\ \mathbf{F}\) from the \(L^2\) error \( \bigl[ \int_{\Omega_0} {[ J - \widetilde{J}]}^{2}\textrm{d}V \bigr]^{1/2}\). We also return the ratio of the current volume of the domain to the reference volume. This is of interest for incompressible media where we want to check how well the isochoric constraint has been enforced.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::pair&lt;double, double&gt; Solid&lt;dim&gt;::get_error_dilation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keywordtype">double</span> dil_L2_error = 0.0;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe, qf_cell, <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">        quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point : fe_values.<a class="code" href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">quadrature_point_indices</a>())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp   = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> J_tilde_qp = lqph[q_point]-&gt;get_J_tilde();</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> the_error_qp_squared =</div>
<div class="line">            <a class="code" href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a>((det_F_qp - J_tilde_qp), 2);</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div>
<div class="line"> </div>
<div class="line">          dil_L2_error += the_error_qp_squared * JxW;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> std::make_pair(std::sqrt(dil_L2_error),</div>
<div class="line">                        compute_vol_current() / vol_reference);</div>
<div class="line">}</div>
<div class="ttc" id="anumbers_8h_html_af44aee1db5cdcd0bab54e3c011d2be66"><div class="ttname"><a href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; pow(const ::VectorizedArray&lt; Number, width &gt; &amp;, const Number p)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05422">vectorization.h:5422</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Solidget_error_residual"></a> </p><h4>Solid::get_error_residual</h4>
<p>Determine the true residual error for the problem. That is, determine the error in the residual for the unconstrained degrees of freedom. Note that to do so, we need to ignore constrained DOFs by setting the residual in these vector components to zero.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_residual(Errors &amp;error_residual)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> error_res(dofs_per_block);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++i)</div>
<div class="line">    <span class="keywordflow">if</span> (!constraints.<a class="code" href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">is_constrained</a>(i))</div>
<div class="line">      error_res(i) = system_rhs(i);</div>
<div class="line"> </div>
<div class="line">  error_residual.norm = error_res.l2_norm();</div>
<div class="line">  error_residual.u    = error_res.block(u_dof).l2_norm();</div>
<div class="line">  error_residual.p    = error_res.block(p_dof).l2_norm();</div>
<div class="line">  error_residual.J    = error_res.block(J_dof).l2_norm();</div>
<div class="line">}</div>
<div class="ttc" id="aclassAffineConstraints_html_a885d18f0044979873f5e5a6f33772f73"><div class="ttname"><a href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">AffineConstraints::is_constrained</a></div><div class="ttdeci">bool is_constrained(const size_type line_n) const</div><div class="ttdef"><b>Definition:</b> <a href="affine__constraints_8h_source.html#l02122">affine_constraints.h:2122</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Solidget_error_update"></a> </p><h4>Solid::get_error_update</h4>
<p>Determine the true Newton update error for the problem</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_update(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update,</div>
<div class="line">                                  Errors &amp;                   error_update)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> error_ud(dofs_per_block);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++i)</div>
<div class="line">    <span class="keywordflow">if</span> (!constraints.<a class="code" href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">is_constrained</a>(i))</div>
<div class="line">      error_ud(i) = newton_update(i);</div>
<div class="line"> </div>
<div class="line">  error_update.norm = error_ud.l2_norm();</div>
<div class="line">  error_update.u    = error_ud.block(u_dof).l2_norm();</div>
<div class="line">  error_update.p    = error_ud.block(p_dof).l2_norm();</div>
<div class="line">  error_update.J    = error_ud.block(J_dof).l2_norm();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Solidget_total_solution"></a> </p><h4>Solid::get_total_solution</h4>
<p>This function provides the total solution, which is valid at any Newton step. This is required as, to reduce computational error, the total solution is only updated at the end of the timestep.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> Solid&lt;dim&gt;::get_total_solution(</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_total(solution_n);</div>
<div class="line">  solution_total += solution_delta;</div>
<div class="line">  <span class="keywordflow">return</span> solution_total;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Solidassemble_system"></a> </p><h4>Solid::assemble_system</h4>
<p>Since we use TBB for assembly, we simply setup a copy of the data structures required for the process and pass them, along with the assembly functions to the <a class="el" href="namespaceWorkStream.html">WorkStream</a> object for processing. Note that we must ensure that the matrix and RHS vector are reset before any assembly operations can occur. Furthermore, since we are describing a problem with Neumann BCs, we will need the face normals and so must specify this in the face update flags.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Assemble system&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; ASM_SYS &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">  tangent_matrix = 0.0;</div>
<div class="line">  system_rhs     = 0.0;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_cell(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_face(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">  PerTaskData_ASM per_task_data(dofs_per_cell);</div>
<div class="line">  ScratchData_ASM scratch_data(fe, qf_cell, uf_cell, qf_face, uf_face);</div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a></div><div class="ttdeci">@ update_normal_vectors</div><div class="ttdoc">Normal vectors.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00136">fe_update_flags.h:136</a></div></div>
</div><!-- fragment --><p>The syntax used here to pass data to the <a class="el" href="namespaceWorkStream.html">WorkStream</a> class is discussed in <a class="el" href="step_13.html">step-13</a>.</p>
<div class="fragment"><div class="line">  <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(</div>
<div class="line">    dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">    [<span class="keyword">this</span>](<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">           ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">           PerTaskData_ASM &amp;                                     data) {</div>
<div class="line">      this-&gt;assemble_system_one_cell(cell, scratch, data);</div>
<div class="line">    },</div>
<div class="line">    [<span class="keyword">this</span>](<span class="keyword">const</span> PerTaskData_ASM &amp;data) {</div>
<div class="line">      this-&gt;constraints.distribute_local_to_global(data.cell_matrix,</div>
<div class="line">                                                   data.cell_rhs,</div>
<div class="line">                                                   data.local_dof_indices,</div>
<div class="line">                                                   tangent_matrix,</div>
<div class="line">                                                   system_rhs);</div>
<div class="line">    },</div>
<div class="line">    scratch_data,</div>
<div class="line">    per_task_data);</div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Of course, we still have to define how we assemble the tangent matrix contribution for a single cell. We first need to reset and initialize some of the scratch data structures and retrieve some basic information regarding the DOF numbering on this cell. We can precalculate the cell shape function values and gradients. Note that the shape function gradients are defined with regard to the current configuration. That is \(\textrm{grad}\ \boldsymbol{\varphi} = \textrm{Grad}\ \boldsymbol{\varphi} \ \mathbf{F}^{-1}\).</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">  PerTaskData_ASM &amp;                                     data)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  data.reset();</div>
<div class="line">  scratch.reset();</div>
<div class="line">  scratch.fe_values.reinit(cell);</div>
<div class="line">  cell-&gt;get_dof_indices(data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">    quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">       scratch.fe_values.quadrature_point_indices())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv = lqph[q_point]-&gt;get_F_inv();</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k : scratch.fe_values.dof_indices())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(k).first.first;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (k_group == u_dof)</div>
<div class="line">            {</div>
<div class="line">              scratch.grad_Nx[q_point][k] =</div>
<div class="line">                scratch.fe_values[u_fe].gradient(k, q_point) * F_inv;</div>
<div class="line">              scratch.symm_grad_Nx[q_point][k] =</div>
<div class="line">                <a class="code" href="classSymmetricTensor.html#a1b2101a1d45267f1fd4664ed178cb636">symmetrize</a>(scratch.grad_Nx[q_point][k]);</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_dof)</div>
<div class="line">            scratch.Nx[q_point][k] =</div>
<div class="line">              scratch.fe_values[p_fe].value(k, q_point);</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_dof)</div>
<div class="line">            scratch.Nx[q_point][k] =</div>
<div class="line">              scratch.fe_values[J_fe].value(k, q_point);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="ttc" id="aclassSymmetricTensor_html_a1b2101a1d45267f1fd4664ed178cb636"><div class="ttname"><a href="classSymmetricTensor.html#a1b2101a1d45267f1fd4664ed178cb636">SymmetricTensor::symmetrize</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 2, dim, Number &gt; symmetrize(const Tensor&lt; 2, dim, Number &gt; &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03492">symmetric_tensor.h:3492</a></div></div>
</div><!-- fragment --><p>Now we build the local cell stiffness matrix and RHS vector. Since the global and local system matrices are symmetric, we can exploit this property by building only the lower half of the local matrix and copying the values to the upper half. So we only assemble half of the \(\mathsf{\mathbf{k}}_{uu}\), \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{p}} = \mathbf{0}\), \(\mathsf{\mathbf{k}}_{\widetilde{J} \widetilde{J}}\) blocks, while the whole \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\), \(\mathsf{\mathbf{k}}_{u \widetilde{J}} = \mathbf{0}\), \(\mathsf{\mathbf{k}}_{u \widetilde{p}}\) blocks are built.</p>
<p>In doing so, we first extract some configuration dependent variables from our quadrature history objects for the current quadrature point.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">     scratch.fe_values.quadrature_point_indices())</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau     = lqph[q_point]-&gt;get_tau();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a>          tau_ns  = lqph[q_point]-&gt;get_tau();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc      = lqph[q_point]-&gt;get_Jc();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                  det_F   = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                  p_tilde = lqph[q_point]-&gt;get_p_tilde();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>                  J_tilde = lqph[q_point]-&gt;get_J_tilde();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> dPsi_vol_dJ   = lqph[q_point]-&gt;get_dPsi_vol_dJ();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> d2Psi_vol_dJ2 = lqph[q_point]-&gt;get_d2Psi_vol_dJ2();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;I =</div>
<div class="line">      <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div>
</div><!-- fragment --><p>These two tensors store some precomputed data. Their use will explained shortly.</p>
<div class="fragment"><div class="line"><a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> symm_grad_Nx_i_x_Jc;</div>
<div class="line"><a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>          grad_Nx_i_comp_i_x_tau;</div>
</div><!-- fragment --><p>Next we define some aliases to make the assembly process easier to follow.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> std::vector&lt;double&gt; &amp;                 <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> = scratch.Nx[q_point];</div>
<div class="line"><span class="keyword">const</span> std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt; &amp;symm_grad_Nx =</div>
<div class="line">  scratch.symm_grad_Nx[q_point];</div>
<div class="line"><span class="keyword">const</span> std::vector&lt;Tensor&lt;2, dim&gt;&gt; &amp;grad_Nx = scratch.grad_Nx[q_point];</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span>                       JxW = scratch.fe_values.JxW(q_point);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">      fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(i).first.first;</div>
<div class="ttc" id="aclassFiniteElement_html_a23200d54e40cd719a183d47b6cfb719f"><div class="ttname"><a href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">FiniteElement::system_to_component_index</a></div><div class="ttdeci">std::pair&lt; unsigned int, unsigned int &gt; system_to_component_index(const unsigned int index) const</div></div>
<div class="ttc" id="anamespaceLAPACKSupport_html_a8edacd69ab93285f82b7f63c733a86b7"><div class="ttname"><a href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">LAPACKSupport::N</a></div><div class="ttdeci">static const char N</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00157">lapack_support.h:157</a></div></div>
</div><!-- fragment --><p>We first compute the contributions from the internal forces. Note, by definition of the rhs as the negative of the residual, these contributions are subtracted.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">  data.cell_rhs(i) -= (symm_grad_Nx[i] * tau) * JxW;</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == p_dof)</div>
<div class="line">  data.cell_rhs(i) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * (det_F - J_tilde) * JxW;</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == J_dof)</div>
<div class="line">  data.cell_rhs(i) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * (dPsi_vol_dJ - p_tilde) * JxW;</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(i_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
</div><!-- fragment --><p>Before we go into the inner loop, we have one final chance to introduce some optimizations. We've already taken into account the symmetry of the system, and we can now precompute some common terms that are repeatedly applied in the inner loop. We won't be excessive here, but will rather focus on expensive operations, namely those involving the rank-4 material stiffness tensor and the rank-2 stress tensor.</p>
<p>What we may observe is that both of these tensors are contracted with shape function gradients indexed on the "i" DoF. This implies that this particular operation remains constant as we loop over the "j" DoF. For that reason, we can extract this from the inner loop and save the many operations that, for each quadrature point and DoF index "i" and repeated over index "j" are required to double contract a rank-2 symmetric tensor with a rank-4 symmetric tensor, and a rank-1 tensor with a rank-2 tensor.</p>
<p>At the loss of some readability, this small change will reduce the assembly time of the symmetrized system by about half when using the simulation default parameters, and becomes more significant as the h-refinement level increases.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">  {</div>
<div class="line">    symm_grad_Nx_i_x_Jc    = symm_grad_Nx[i] * Jc;</div>
<div class="line">    grad_Nx_i_comp_i_x_tau = grad_Nx[i][component_i] * tau_ns;</div>
<div class="line">  }</div>
</div><!-- fragment --><p>Now we're prepared to compute the tangent matrix contributions:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j :</div>
<div class="line">     scratch.fe_values.dof_indices_ending_at(i))</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_j =</div>
<div class="line">      fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(j).first;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j_group =</div>
<div class="line">      fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(j).first.first;</div>
</div><!-- fragment --><p>This is the \(\mathsf{\mathbf{k}}_{uu}\) contribution. It comprises a material contribution, and a geometrical stress contribution which is only added along the local matrix diagonals:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> ((i_group == j_group) &amp;&amp; (i_group == u_dof))</div>
<div class="line">  {</div>
</div><!-- fragment --><p>The material contribution:</p>
<div class="fragment"><div class="line">data.cell_matrix(i, j) += symm_grad_Nx_i_x_Jc *  </div>
<div class="line">                          symm_grad_Nx[j] * JxW; </div>
</div><!-- fragment --><p>The geometrical stress contribution:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span> (component_i == component_j)</div>
<div class="line">    data.cell_matrix(i, j) +=</div>
<div class="line">      grad_Nx_i_comp_i_x_tau * grad_Nx[j][component_j] * JxW;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Next is the \(\mathsf{\mathbf{k}}_{ \widetilde{p} u}\) contribution</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == p_dof) &amp;&amp; (j_group == u_dof))</div>
<div class="line">  {</div>
<div class="line">    data.cell_matrix(i, j) += <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * det_F *               </div>
<div class="line">                              (symm_grad_Nx[j] * I) * JxW; </div>
<div class="line">  }</div>
</div><!-- fragment --><p>and lastly the \(\mathsf{\mathbf{k}}_{ \widetilde{J} \widetilde{p}}\) and \(\mathsf{\mathbf{k}}_{ \widetilde{J} \widetilde{J}}\) contributions:</p>
<div class="fragment"><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == J_dof) &amp;&amp; (j_group == p_dof))</div>
<div class="line">            data.cell_matrix(i, j) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[j] * JxW;</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == j_group) &amp;&amp; (i_group == J_dof))</div>
<div class="line">            data.cell_matrix(i, j) += <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * d2Psi_vol_dJ2 * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[j] * JxW;</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>((i_group &lt;= J_dof) &amp;&amp; (j_group &lt;= J_dof),</div>
<div class="line">                   <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Next we assemble the Neumann contribution. We first check to see it the cell face exists on a boundary on which a traction is applied and add the contribution if this is the case.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div>
<div class="line">  <span class="keywordflow">if</span> (face-&gt;at_boundary() &amp;&amp; face-&gt;boundary_id() == 6)</div>
<div class="line">    {</div>
<div class="line">      scratch.fe_face_values.reinit(cell, face);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> f_q_point :</div>
<div class="line">           scratch.fe_face_values.quadrature_point_indices())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> =</div>
<div class="line">            scratch.fe_face_values.normal_vector(f_q_point);</div>
</div><!-- fragment --><p>Using the face normal at this quadrature point we specify the traction in reference configuration. For this problem, a defined pressure is applied in the reference configuration. The direction of the applied traction is assumed not to evolve with the deformation of the domain. The traction is defined using the first Piola-Kirchhoff stress is simply \(\mathbf{t} = \mathbf{P}\mathbf{N} = [p_0 \mathbf{I}] \mathbf{N} = p_0 \mathbf{N}\) We use the time variable to linearly ramp up the pressure load.</p>
<p>Note that the contributions to the right hand side vector we compute here only exist in the displacement components of the vector.</p>
<div class="fragment"><div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> p0 =</div>
<div class="line">        -4.0 / (parameters.scale * parameters.scale);</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>         time_ramp = (time.current() / time.end());</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span>         pressure  = p0 * parameters.p_p0 * time_ramp;</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> traction  = pressure * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group =</div>
<div class="line">            fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(i).first.first;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> Ni =</div>
<div class="line">                scratch.fe_face_values.shape_value(i, f_q_point);</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = scratch.fe_face_values.JxW(f_q_point);</div>
<div class="line"> </div>
<div class="line">              data.cell_rhs(i) += (Ni * traction[component_i]) * JxW;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, we need to copy the lower half of the local matrix into the upper half:</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j :</div>
<div class="line">         scratch.fe_values.dof_indices_starting_at(i + 1))</div>
<div class="line">      data.cell_matrix(i, j) = data.cell_matrix(j, i);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Solidmake_constraints"></a> </p><h4>Solid::make_constraints</h4>
<p>The constraints for this problem are simple to describe. In this particular example, the boundary values will be calculated for the two first iterations of Newton's algorithm. In general, one would build non-homogeneous constraints in the zeroth iteration (that is, when <code>apply_dirichlet_bc == true</code> in the code block that follows) and build only the corresponding homogeneous constraints in the following step. While the current example has only homogeneous constraints, previous experiences have shown that a common error is forgetting to add the extra condition when refactoring the code to specific uses. This could lead to errors that are hard to debug. In this spirit, we choose to make the code more verbose in terms of what operations are performed at each Newton step.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> it_nr)</div>
<div class="line">{</div>
</div><!-- fragment --><p>Since we (a) are dealing with an iterative Newton method, (b) are using an incremental formulation for the displacement, and (c) apply the constraints to the incremental displacement field, any non-homogeneous constraints on the displacement update should only be specified at the zeroth iteration. No subsequent contributions are to be made since the constraints will be exactly satisfied after that iteration.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span> apply_dirichlet_bc = (it_nr == 0);</div>
</div><!-- fragment --><p>Furthermore, after the first Newton iteration within a timestep, the constraints remain the same and we do not need to modify or rebuild them so long as we do not clear the <code>constraints</code> object.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (it_nr &gt; 1)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; --- &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot; CST &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (apply_dirichlet_bc)</div>
<div class="line">  {</div>
</div><!-- fragment --><p>At the zeroth Newton iteration we wish to apply the full set of non-homogeneous and homogeneous constraints that represent the boundary conditions on the displacement increment. Since in general the constraints may be different at each time step, we need to clear the constraints matrix and completely rebuild it. An example case would be if a surface is accelerating; in such a scenario the change in displacement is non-constant between each time step.</p>
<div class="fragment"><div class="line">constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="ttc" id="aclassAffineConstraints_html_addd15bc409c61d6f795f0132c574335b"><div class="ttname"><a href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">AffineConstraints::clear</a></div><div class="ttdeci">void clear()</div></div>
</div><!-- fragment --><p>The boundary conditions for the indentation problem in 3D are as follows: On the -x, -y and -z faces (IDs 0,2,4) we set up a symmetry condition to allow only planar movement while the +x and +z faces (IDs 1,5) are traction free. In this contrived problem, part of the +y face (ID 3) is set to have no motion in the x- and z-component. Finally, as described earlier, the other part of the +y face has an the applied pressure but is also constrained in the x- and z-directions.</p>
<p>In the following, we will have to tell the function interpolation boundary values which components of the solution vector should be constrained (i.e., whether it's the x-, y-, z-displacements or combinations thereof). This is done using <a class="el" href="classComponentMask.html">ComponentMask</a> objects (see <a class="el" href="DEALGlossary.html#GlossComponentMask">GlossComponentMask</a>) which we can get from the finite element if we provide it with an extractor object for the component we wish to select. To this end we first set up such extractor objects and later use it when generating the relevant component masks:</p>
<div class="fragment"><div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> x_displacement(0);</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> y_displacement(1);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 0;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">        dof_handler,</div>
<div class="line">        <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">        <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">        constraints,</div>
<div class="line">        fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement));</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 2;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">        dof_handler,</div>
<div class="line">        <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">        <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">        constraints,</div>
<div class="line">        fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dim == 3)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> z_displacement(2);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 3;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement) |</div>
<div class="line">             fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement)));</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 4;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 6;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement) |</div>
<div class="line">             fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement)));</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 3;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement)));</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 6;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement)));</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="ttc" id="aclassFiniteElement_html_a4409f54175f279ac24cc982cfcfcbd2f"><div class="ttname"><a href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">FiniteElement::component_mask</a></div><div class="ttdeci">ComponentMask component_mask(const FEValuesExtractors::Scalar &amp;scalar) const</div></div>
<div class="ttc" id="aclassFunctions_1_1ZeroFunction_html"><div class="ttname"><a href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00510">function.h:511</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
<div class="ttc" id="anamespacetypes_html_aed8813fee8c8a2edcc6005e6a48c321a"><div class="ttname"><a href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">types::boundary_id</a></div><div class="ttdeci">unsigned int boundary_id</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00129">types.h:129</a></div></div>
</div><!-- fragment --><p>As all Dirichlet constraints are fulfilled exactly after the zeroth Newton iteration, we want to ensure that no further modification are made to those entries. This implies that we want to convert all non-homogeneous Dirichlet constraints into homogeneous ones.</p>
<p>In this example the procedure to do this is quite straightforward, and in fact we can (and will) circumvent any unnecessary operations when only homogeneous boundary conditions are applied. In a more general problem one should be mindful of hanging node and periodic constraints, which may also introduce some inhomogeneities. It might then be advantageous to keep disparate objects for the different types of constraints, and merge them together once the homogeneous Dirichlet constraints have been constructed.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (constraints.<a class="code" href="classAffineConstraints.html#a0df947a828e8496cd04087c58b382da5">has_inhomogeneities</a>())</div>
<div class="line">  {</div>
<div class="ttc" id="aclassAffineConstraints_html_a0df947a828e8496cd04087c58b382da5"><div class="ttname"><a href="classAffineConstraints.html#a0df947a828e8496cd04087c58b382da5">AffineConstraints::has_inhomogeneities</a></div><div class="ttdeci">bool has_inhomogeneities() const</div></div>
</div><!-- fragment --><p>Since the affine constraints were finalized at the previous Newton iteration, they may not be modified directly. So we need to copy them to another temporary object and make modification there. Once we're done, we'll transfer them back to the main <code>constraints</code> object.</p>
<div class="fragment"><div class="line">          <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> homogeneous_constraints(constraints);</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof = 0; dof != dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++dof)</div>
<div class="line">            <span class="keywordflow">if</span> (homogeneous_constraints.is_inhomogeneously_constrained(dof))</div>
<div class="line">              homogeneous_constraints.set_inhomogeneity(dof, 0.0);</div>
<div class="line"> </div>
<div class="line">          constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">          constraints.<a class="code" href="classAffineConstraints.html#ac15d04ef931b4ff581b9a4b3d7b5123e">copy_from</a>(homogeneous_constraints);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassAffineConstraints_html_ac15d04ef931b4ff581b9a4b3d7b5123e"><div class="ttname"><a href="classAffineConstraints.html#ac15d04ef931b4ff581b9a4b3d7b5123e">AffineConstraints::copy_from</a></div><div class="ttdeci">void copy_from(const AffineConstraints&lt; other_number &gt; &amp;other)</div><div class="ttdef"><b>Definition:</b> <a href="affine__constraints_8h_source.html#l02425">affine_constraints.h:2425</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Solidassemble_sc"></a> </p><h4>Solid::assemble_sc</h4>
<p>Solving the entire block system is a bit problematic as there are no contributions to the \(\mathsf{\mathbf{K}}_{ \widetilde{J} \widetilde{J}}\) block, rendering it noninvertible (when using an iterative solver). Since the pressure and dilatation variables DOFs are discontinuous, we can condense them out to form a smaller displacement-only system which we will then solve and subsequently post-process to retrieve the pressure and dilatation solutions.</p>
<p>The static condensation process could be performed at a global level but we need the inverse of one of the blocks. However, since the pressure and dilatation variables are discontinuous, the static condensation (SC) operation can also be done on a per-cell basis and we can produce the inverse of the block-diagonal \(\mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}\) block by inverting the local blocks. We can again use TBB to do this since each operation will be independent of one another.</p>
<p>Using the TBB via the <a class="el" href="namespaceWorkStream.html">WorkStream</a> class, we assemble the contributions to form \( \mathsf{\mathbf{K}}_{\textrm{con}} = \bigl[ \mathsf{\mathbf{K}}_{uu} + \overline{\overline{\mathsf{\mathbf{K}}}}~ \bigr] \) from each element's contributions. These contributions are then added to the global stiffness matrix. Given this description, the following two functions should be clear:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_sc()</div>
<div class="line">{</div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Perform static condensation&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; ASM_SC &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">  PerTaskData_SC per_task_data(dofs_per_cell,</div>
<div class="line">                               element_indices_u.size(),</div>
<div class="line">                               element_indices_p.size(),</div>
<div class="line">                               element_indices_J.size());</div>
<div class="line">  ScratchData_SC scratch_data;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">                  *<span class="keyword">this</span>,</div>
<div class="line">                  &amp;Solid::assemble_sc_one_cell,</div>
<div class="line">                  &amp;Solid::copy_local_to_global_sc,</div>
<div class="line">                  scratch_data,</div>
<div class="line">                  per_task_data);</div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::copy_local_to_global_sc(<span class="keyword">const</span> PerTaskData_SC &amp;data)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">      tangent_matrix.<a class="code" href="group__Matrix1.html#gad8fe7a35a3336d251a4b3aa2c3ed9748">add</a>(data.local_dof_indices[i],</div>
<div class="line">                         data.local_dof_indices[j],</div>
<div class="line">                         data.cell_matrix(i, j));</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Matrix1_html_gad8fe7a35a3336d251a4b3aa2c3ed9748"><div class="ttname"><a href="group__Matrix1.html#gad8fe7a35a3336d251a4b3aa2c3ed9748">BlockMatrixBase::add</a></div><div class="ttdeci">void add(const size_type i, const size_type j, const value_type value)</div></div>
</div><!-- fragment --><p>Now we describe the static condensation process. As per usual, we must first find out which global numbers the degrees of freedom on this cell have and reset some data structures:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_sc_one_cell(</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">  ScratchData_SC &amp;                                      scratch,</div>
<div class="line">  PerTaskData_SC &amp;                                      data)</div>
<div class="line">{</div>
<div class="line">  data.reset();</div>
<div class="line">  scratch.reset();</div>
<div class="line">  cell-&gt;get_dof_indices(data.local_dof_indices);</div>
</div><!-- fragment --><p>We now extract the contribution of the dofs associated with the current cell to the global stiffness matrix. The discontinuous nature of the \(\widetilde{p}\) and \(\widetilde{J}\) interpolations mean that their is no coupling of the local contributions at the global level. This is not the case with the \(\mathbf{u}\) dof. In other words, \(\mathsf{\mathbf{k}}_{\widetilde{J} \widetilde{p}}\), \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{p}}\) and \(\mathsf{\mathbf{k}}_{\widetilde{J} \widetilde{p}}\), when extracted from the global stiffness matrix are the element contributions. This is not the case for \(\mathsf{\mathbf{k}}_{uu}\).</p>
<p>Note: A lower-case symbol is used to denote element stiffness matrices.</p>
<p>Currently the matrix corresponding to the dof associated with the current element (denoted somewhat loosely as \(\mathsf{\mathbf{k}}\)) is of the form: </p><p class="formulaDsp">
\begin{align*} \begin{bmatrix} \mathsf{\mathbf{k}}_{uu} &amp; \mathsf{\mathbf{k}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathsf{\mathbf{k}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathsf{\mathbf{k}}_{\widetilde{p}\widetilde{J}} \\ \mathbf{0} &amp; \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{p}} &amp; \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{J}} \end{bmatrix} \end{align*}
</p>
<p>We now need to modify it such that it appear as </p><p class="formulaDsp">
\begin{align*} \begin{bmatrix} \mathsf{\mathbf{k}}_{\textrm{con}} &amp; \mathsf{\mathbf{k}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathsf{\mathbf{k}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathsf{\mathbf{k}}_{\widetilde{p}\widetilde{J}}^{-1} \\ \mathbf{0} &amp; \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{p}} &amp; \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{J}} \end{bmatrix} \end{align*}
</p>
<p> with \(\mathsf{\mathbf{k}}_{\textrm{con}} = \bigl[ \mathsf{\mathbf{k}}_{uu} +\overline{\overline{\mathsf{\mathbf{k}}}}~ \bigr]\) where \( \overline{\overline{\mathsf{\mathbf{k}}}} \dealcoloneq \mathsf{\mathbf{k}}_{u\widetilde{p}} \overline{\mathsf{\mathbf{k}}} \mathsf{\mathbf{k}}_{\widetilde{p}u} \) and \( \overline{\mathsf{\mathbf{k}}} = \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{p}}^{-1} \mathsf{\mathbf{k}}_{\widetilde{J}\widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p}\widetilde{J}}^{-1} \).</p>
<p>At this point, we need to take note of the fact that global data already exists in the \(\mathsf{\mathbf{K}}_{uu}\), \(\mathsf{\mathbf{K}}_{\widetilde{p} \widetilde{J}}\) and \(\mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{p}}\) sub-blocks. So if we are to modify them, we must account for the data that is already there (i.e. simply add to it or remove it if necessary). Since the copy_local_to_global operation is a "+=" operation, we need to take this into account</p>
<p>For the \(\mathsf{\mathbf{K}}_{uu}\) block in particular, this means that contributions have been added from the surrounding cells, so we need to be careful when we manipulate this block. We can't just erase the sub-blocks.</p>
<p>This is the strategy we will employ to get the sub-blocks we want:</p>
<ul>
<li>\( {\mathsf{\mathbf{k}}}_{\textrm{store}}\): Since we don't have access to \(\mathsf{\mathbf{k}}_{uu}\), but we know its contribution is added to the global \(\mathsf{\mathbf{K}}_{uu}\) matrix, we just want to add the element wise static-condensation \(\overline{\overline{\mathsf{\mathbf{k}}}}\).</li>
<li>\(\mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}}\): Similarly, \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\) exists in the subblock. Since the copy operation is a += operation, we need to subtract the existing \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\) submatrix in addition to "adding" that which we wish to replace it with.</li>
<li>\(\mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{p}}\): Since the global matrix is symmetric, this block is the same as the one above and we can simply use \(\mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}}\) as a substitute for this one.</li>
</ul>
<p>We first extract element data from the system matrix. So first we get the entire subblock for the cell, then extract \(\mathsf{\mathbf{k}}\) for the dofs associated with the current element</p>
<div class="fragment"><div class="line">data.k_orig.extract_submatrix_from(tangent_matrix,</div>
<div class="line">                                   data.local_dof_indices,</div>
<div class="line">                                   data.local_dof_indices);</div>
</div><!-- fragment --><p>and next the local matrices for \(\mathsf{\mathbf{k}}_{ \widetilde{p} u}\) \(\mathsf{\mathbf{k}}_{ \widetilde{p} \widetilde{J}}\) and \(\mathsf{\mathbf{k}}_{ \widetilde{J} \widetilde{J}}\):</p>
<div class="fragment"><div class="line">data.k_pu.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                 element_indices_p,</div>
<div class="line">                                 element_indices_u);</div>
<div class="line">data.k_pJ.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                 element_indices_p,</div>
<div class="line">                                 element_indices_J);</div>
<div class="line">data.k_JJ.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                 element_indices_J,</div>
<div class="line">                                 element_indices_J);</div>
</div><!-- fragment --><p>To get the inverse of \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\), we invert it directly. This operation is relatively inexpensive since \(\mathsf{\mathbf{k}}_{\widetilde{p} \widetilde{J}}\) since block-diagonal.</p>
<div class="fragment"><div class="line">data.k_pJ_inv.invert(data.k_pJ);</div>
</div><!-- fragment --><p>Now we can make condensation terms to add to the \(\mathsf{\mathbf{k}}_{uu}\) block and put them in the cell local matrix \( \mathsf{\mathbf{A}} = \mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p} u} \):</p>
<div class="fragment"><div class="line">data.k_pJ_inv.mmult(data.A, data.k_pu);</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{B}} = \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p} u} \)</p>
<div class="fragment"><div class="line">data.k_JJ.mmult(data.B, data.A);</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{C}} = \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{p}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p} u} \)</p>
<div class="fragment"><div class="line">data.k_pJ_inv.Tmmult(data.C, data.B);</div>
</div><!-- fragment --><p>\( \overline{\overline{\mathsf{\mathbf{k}}}} = \mathsf{\mathbf{k}}_{u \widetilde{p}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{p}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{k}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{k}}_{\widetilde{p} u} \)</p>
<div class="fragment"><div class="line">data.k_pu.Tmmult(data.k_bbar, data.C);</div>
<div class="line">data.k_bbar.scatter_matrix_to(element_indices_u,</div>
<div class="line">                              element_indices_u,</div>
<div class="line">                              data.cell_matrix);</div>
</div><!-- fragment --><p>Next we place \(\mathsf{\mathbf{k}}^{-1}_{ \widetilde{p} \widetilde{J}}\) in the \(\mathsf{\mathbf{k}}_{ \widetilde{p} \widetilde{J}}\) block for post-processing. Note again that we need to remove the contribution that already exists there.</p>
<div class="fragment"><div class="line">  data.k_pJ_inv.add(-1.0, data.k_pJ);</div>
<div class="line">  data.k_pJ_inv.scatter_matrix_to(element_indices_p,</div>
<div class="line">                                  element_indices_J,</div>
<div class="line">                                  data.cell_matrix);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Solidsolve_linear_system"></a> </p><h4>Solid::solve_linear_system</h4>
<p>We now have all of the necessary components to use one of two possible methods to solve the linearised system. The first is to perform static condensation on an element level, which requires some alterations to the tangent matrix and RHS vector. Alternatively, the full block system can be solved by performing condensation on a global level. Below we implement both approaches.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::pair&lt;unsigned int, double&gt;</div>
<div class="line">Solid&lt;dim&gt;::solve_linear_system(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lin_it  = 0;</div>
<div class="line">  <span class="keywordtype">double</span>       lin_res = 0.0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (parameters.use_static_condensation == <span class="keyword">true</span>)</div>
<div class="line">    {</div>
</div><!-- fragment --><p>Firstly, here is the approach using the (permanent) augmentation of the tangent matrix. For the following, recall that </p><p class="formulaDsp">
\begin{align*} \mathsf{\mathbf{K}}_{\textrm{store}} \dealcoloneq \begin{bmatrix} \mathsf{\mathbf{K}}_{\textrm{con}} &amp; \mathsf{\mathbf{K}}_{u\widetilde{p}} &amp; \mathbf{0} \\ \mathsf{\mathbf{K}}_{\widetilde{p}u} &amp; \mathbf{0} &amp; \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \\ \mathbf{0} &amp; \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}} &amp; \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} \end{bmatrix} \, . \end{align*}
</p>
<p> and </p><p class="formulaDsp">
\begin{align*} d \widetilde{\mathsf{\mathbf{p}}} &amp; = \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \bigr] \\ d \widetilde{\mathsf{\mathbf{J}}} &amp; = \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{p}} - \mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \bigr] \\ \Rightarrow d \widetilde{\mathsf{\mathbf{p}}} &amp;= \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathsf{\mathbf{F}}_{\widetilde{J}} - \underbrace{\bigl[\mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1}\bigr]}_{\overline{\mathsf{\mathbf{K}}}}\bigl[ \mathsf{\mathbf{F}}_{\widetilde{p}} - \mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \bigr] \end{align*}
</p>
<p> and thus </p><p class="formulaDsp">
\[ \underbrace{\bigl[ \mathsf{\mathbf{K}}_{uu} + \overline{\overline{\mathsf{\mathbf{K}}}}~ \bigr] }_{\mathsf{\mathbf{K}}_{\textrm{con}}} d \mathsf{\mathbf{u}} = \underbrace{ \Bigl[ \mathsf{\mathbf{F}}_{u} - \mathsf{\mathbf{K}}_{u\widetilde{p}} \bigl[ \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \mathsf{\mathbf{F}}_{\widetilde{J}} - \overline{\mathsf{\mathbf{K}}}\mathsf{\mathbf{F}}_{\widetilde{p}} \bigr] \Bigr]}_{\mathsf{\mathbf{F}}_{\textrm{con}}} \]
</p>
<p> where </p><p class="formulaDsp">
\[ \overline{\overline{\mathsf{\mathbf{K}}}} \dealcoloneq \mathsf{\mathbf{K}}_{u\widetilde{p}} \overline{\mathsf{\mathbf{K}}} \mathsf{\mathbf{K}}_{\widetilde{p}u} \, . \]
</p>
<p>At the top, we allocate two temporary vectors to help with the static condensation, and variables to store the number of linear solver iterations and the (hopefully converged) residual.</p>
<div class="fragment"><div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>(dofs_per_block);</div>
<div class="line"><a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> B(dofs_per_block);</div>
</div><!-- fragment --><p>In the first step of this function, we solve for the incremental displacement \(d\mathbf{u}\). To this end, we perform static condensation to make \(\mathsf{\mathbf{K}}_{\textrm{con}} = \bigl[ \mathsf{\mathbf{K}}_{uu} + \overline{\overline{\mathsf{\mathbf{K}}}}~ \bigr]\) and put \(\mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}}\) in the original \(\mathsf{\mathbf{K}}_{\widetilde{p} \widetilde{J}}\) block. That is, we make \(\mathsf{\mathbf{K}}_{\textrm{store}}\).</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  assemble_sc();</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} \)</p>
<div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof), system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof));</div>
<div class="ttc" id="aclassSparseMatrix_html_a7706b5f721efc5ea1966f5a5cdaad0e6"><div class="ttname"><a href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">SparseMatrix::vmult</a></div><div class="ttdeci">void vmult(OutVector &amp;dst, const InVector &amp;src) const</div></div>
<div class="ttc" id="agroup__Exceptions_html_gae05a0e26814f032473ed2ef66da018bd"><div class="ttname"><a href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">BlockVectorBase::block</a></div><div class="ttdeci">BlockType &amp; block(const unsigned int i)</div></div>
<div class="ttc" id="agroup__Matrix1_html_ga1e54eb8c095bf2191a29c36a7784a5b6"><div class="ttname"><a href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">BlockMatrixBase::block</a></div><div class="ttdeci">BlockType &amp; block(const unsigned int row, const unsigned int column)</div></div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{B}}_{\widetilde{J}} = \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} \)</p>
<div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(B.block(J_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} \)</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) -= B.block(J_dof);</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{K}}^{-1}_{\widetilde{J} \widetilde{p}} [ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} ] \)</p>
<div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">Tvmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="ttc" id="aclassSparseMatrix_html_a224a78133e7b655e3a2c26647097c2c7"><div class="ttname"><a href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">SparseMatrix::Tvmult</a></div><div class="ttdeci">void Tvmult(OutVector &amp;dst, const InVector &amp;src) const</div></div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{u} = \mathsf{\mathbf{K}}_{u \widetilde{p}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{J} \widetilde{p}} [ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} ] \)</p>
<div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, p_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(u_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof));</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{F}}_{\text{con}} = \mathsf{\mathbf{F}}_{u} - \mathsf{\mathbf{K}}_{u \widetilde{p}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{J} \widetilde{p}} [ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J} \widetilde{J}} \mathsf{\mathbf{K}}^{-1}_{\widetilde{p} \widetilde{J}} \mathsf{\mathbf{F}}_{\widetilde{p}} ] \)</p>
<div class="fragment"><div class="line">system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof) -= <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(u_dof);</div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"><span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;CG&quot;</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> solver_its = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line">      tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">      parameters.max_iterations_lin);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> tol_sol =</div>
<div class="line">      parameters.tol_lin * system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof).l2_norm();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(solver_its, tol_sol);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classGrowingVectorMemory.html">GrowingVectorMemory&lt;Vector&lt;double&gt;</a>&gt; GVM;</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; solver_CG(solver_control, GVM);</div>
<div class="ttc" id="aclassGrowingVectorMemory_html"><div class="ttname"><a href="classGrowingVectorMemory.html">GrowingVectorMemory</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2lac_2vector__memory_8h_source.html#l00313">vector_memory.h:314</a></div></div>
<div class="ttc" id="aclassSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__cg_8h_source.html#l00095">solver_cg.h:96</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00065">solver_control.h:66</a></div></div>
<div class="ttc" id="aclassSparseMatrix_html_acff5838afad6b9d4cc0c0eb5f6c515b5"><div class="ttname"><a href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">SparseMatrix::m</a></div><div class="ttdeci">size_type m() const</div></div>
</div><!-- fragment --><p>We've chosen by default a SSOR preconditioner as it appears to provide the fastest solver convergence characteristics for this problem on a single-thread machine. However, this might not be true for different problem sizes.</p>
<div class="fragment"><div class="line">    <a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">      preconditioner(parameters.preconditioner_type,</div>
<div class="line">                     parameters.preconditioner_relaxation);</div>
<div class="line">    preconditioner.use_matrix(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line"> </div>
<div class="line">    solver_CG.solve(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof),</div>
<div class="line">                    newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                    system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                    preconditioner);</div>
<div class="line"> </div>
<div class="line">    lin_it  = solver_control.last_step();</div>
<div class="line">    lin_res = solver_control.last_value();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;Direct&quot;</span>)</div>
<div class="line">  {</div>
<div class="ttc" id="aclassPreconditionSelector_html"><div class="ttname"><a href="classPreconditionSelector.html">PreconditionSelector</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition__selector_8h_source.html#l00100">precondition_selector.h:101</a></div></div>
</div><!-- fragment --><p>Otherwise if the problem is small enough, a direct solver can be utilised.</p>
<div class="fragment"><div class="line">      <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">      A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line">      A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                     system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof));</div>
<div class="line"> </div>
<div class="line">      lin_it  = 1;</div>
<div class="line">      lin_res = 0.0;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Linear solver type not implemented&quot;</span>));</div>
<div class="line"> </div>
<div class="line">  timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html"><div class="ttname"><a href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8h_source.html#l00087">sparse_direct.h:88</a></div></div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html_a25b1d3c7dbb88158a76165a4a56a16d6"><div class="ttname"><a href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">SparseDirectUMFPACK::initialize</a></div><div class="ttdeci">void initialize(const SparsityPattern &amp;sparsity_pattern)</div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8cc_source.html#l00049">sparse_direct.cc:49</a></div></div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html_adc154e4830b0e16be265f10a5c8b7103"><div class="ttname"><a href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">SparseDirectUMFPACK::vmult</a></div><div class="ttdeci">void vmult(Vector&lt; double &gt; &amp;dst, const Vector&lt; double &gt; &amp;src) const</div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8cc_source.html#l00762">sparse_direct.cc:762</a></div></div>
</div><!-- fragment --><p>Now that we have the displacement update, distribute the constraints back to the Newton update:</p>
<div class="fragment"><div class="line">constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot; PP &quot;</span> &lt;&lt; std::flush;</div>
<div class="ttc" id="aclassAffineConstraints_html_a7b3d3f295bb56d6cd6856bdc6cbe8a01"><div class="ttname"><a href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">AffineConstraints::distribute</a></div><div class="ttdeci">void distribute(VectorType &amp;vec) const</div></div>
</div><!-- fragment --><p>The next step after solving the displacement problem is to post-process to get the dilatation solution from the substitution: \( d \widetilde{\mathsf{\mathbf{J}}} = \mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{p}} - \mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \bigr] \)</p>
<div class="fragment"><div class="line">{</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{p}} = \mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \)</p>
<div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, u_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof), newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof));</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{p}} = -\mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \)</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof) *= -1.0;</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{p}} = \mathsf{\mathbf{F}}_{\widetilde{p}} -\mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} \)</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof) += system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
</div><!-- fragment --><p>\( d\mathsf{\mathbf{\widetilde{J}}} = \mathsf{\mathbf{K}}^{-1}_{\widetilde{p}\widetilde{J}} [ \mathsf{\mathbf{F}}_{\widetilde{p}} -\mathsf{\mathbf{K}}_{\widetilde{p}u} d \mathsf{\mathbf{u}} ] \)</p>
<div class="fragment"><div class="line">  tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">    .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof));</div>
<div class="line">}</div>
</div><!-- fragment --><p>we ensure here that any Dirichlet constraints are distributed on the updated solution:</p>
<div class="fragment"><div class="line">constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
</div><!-- fragment --><p>Finally we solve for the pressure update with the substitution: \( d \widetilde{\mathsf{\mathbf{p}}} = \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \bigr] \)</p>
<div class="fragment"><div class="line">{</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \)</p>
<div class="fragment"><div class="line">tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof)</div>
<div class="line">  .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof), newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof));</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{J}} = -\mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \)</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) *= -1.0;</div>
</div><!-- fragment --><p>\( \mathsf{\mathbf{A}}_{\widetilde{J}} = \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \)</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) += system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
</div><!-- fragment --><p>and finally.... \( d \widetilde{\mathsf{\mathbf{p}}} = \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1} \bigl[ \mathsf{\mathbf{F}}_{\widetilde{J}} - \mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{J}} d \widetilde{\mathsf{\mathbf{J}}} \bigr] \)</p>
<div class="fragment"><div class="line">  tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">    .<a class="code" href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">Tvmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="line">}</div>
</div><!-- fragment --><p>We are now at the end, so we distribute all constrained dofs back to the Newton update:</p>
<div class="fragment"><div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; ------ &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;CG&quot;</span>)</div>
<div class="line">      {</div>
</div><!-- fragment --><p>Manual condensation of the dilatation and pressure fields on a local level, and subsequent post-processing, took quite a bit of effort to achieve. To recap, we had to produce the inverse matrix \(\mathsf{\mathbf{K}}_{\widetilde{p}\widetilde{J}}^{-1}\), which was permanently written into the global tangent matrix. We then permanently modified \(\mathsf{\mathbf{K}}_{uu}\) to produce \(\mathsf{\mathbf{K}}_{\textrm{con}}\). This involved the extraction and manipulation of local sub-blocks of the tangent matrix. After solving for the displacement, the individual matrix-vector operations required to solve for dilatation and pressure were carefully implemented. Contrast these many sequence of steps to the much simpler and transparent implementation using functionality provided by the <a class="el" href="classLinearOperator.html">LinearOperator</a> class.</p>
<p>For ease of later use, we define some aliases for blocks in the RHS vector</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_u = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_p = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_J = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
</div><!-- fragment --><p>... and for blocks in the Newton update vector.</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_u = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof);</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_p = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_J = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
</div><!-- fragment --><p>We next define some linear operators for the tangent matrix sub-blocks We will exploit the symmetry of the system, so not all blocks are required.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_uu =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_up =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, p_dof));</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_pu =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, u_dof));</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_Jp =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof));</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_JJ =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof));</div>
<div class="ttc" id="agroup__LAOperators_html_ga6b74b7ed76e4aeea2c67c0bbb03e3e24"><div class="ttname"><a href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">LinearOperator::linear_operator</a></div><div class="ttdeci">LinearOperator&lt; Range, Domain, Payload &gt; linear_operator(const Matrix &amp;matrix)</div><div class="ttdef"><b>Definition:</b> <a href="linear__operator_8h_source.html#l01379">linear_operator.h:1379</a></div></div>
</div><!-- fragment --><p>We then construct a <a class="el" href="classLinearOperator.html">LinearOperator</a> that represents the inverse of (square block) \(\mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}\). Since it is diagonal (or, when a higher order ansatz it used, nearly diagonal), a Jacobi preconditioner is suitable.</p>
<div class="fragment"><div class="line"><a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">  preconditioner_K_Jp_inv(<span class="stringliteral">&quot;jacobi&quot;</span>);</div>
<div class="line">preconditioner_K_Jp_inv.use_matrix(</div>
<div class="line">  tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof));</div>
<div class="line"><a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_Jp_inv(</div>
<div class="line">  <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                            parameters.max_iterations_lin),</div>
<div class="line">  1.0e-30,</div>
<div class="line">  parameters.tol_lin);</div>
<div class="line"><a class="code" href="classSolverSelector.html">SolverSelector&lt;Vector&lt;double&gt;</a>&gt; solver_K_Jp_inv;</div>
<div class="line">solver_K_Jp_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(<span class="stringliteral">&quot;cg&quot;</span>);</div>
<div class="line">solver_K_Jp_inv.<a class="code" href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">set_control</a>(solver_control_K_Jp_inv);</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_Jp_inv =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_Jp, solver_K_Jp_inv, preconditioner_K_Jp_inv);</div>
<div class="ttc" id="aclassReductionControl_html"><div class="ttname"><a href="classReductionControl.html">ReductionControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00423">solver_control.h:424</a></div></div>
<div class="ttc" id="aclassSolverSelector_html"><div class="ttname"><a href="classSolverSelector.html">SolverSelector</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__selector_8h_source.html#l00089">solver_selector.h:90</a></div></div>
<div class="ttc" id="aclassSolverSelector_html_a3da215c843356cdab3b603ce98991b53"><div class="ttname"><a href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">SolverSelector::select</a></div><div class="ttdeci">void select(const std::string &amp;name)</div><div class="ttdef"><b>Definition:</b> <a href="solver__selector_8h_source.html#l00258">solver_selector.h:258</a></div></div>
<div class="ttc" id="aclassSolverSelector_html_a5732b402440fb4d9494e431254b3b15e"><div class="ttname"><a href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">SolverSelector::set_control</a></div><div class="ttdeci">void set_control(SolverControl &amp;ctrl)</div><div class="ttdef"><b>Definition:</b> <a href="solver__selector_8h_source.html#l00311">solver_selector.h:311</a></div></div>
<div class="ttc" id="agroup__LAOperators_html_ga87e38fbde431397c069a88692bd24ae7"><div class="ttname"><a href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">LinearOperator::inverse_operator</a></div><div class="ttdeci">LinearOperator&lt; Domain, Range, Payload &gt; inverse_operator(const LinearOperator&lt; Range, Domain, Payload &gt; &amp;op, Solver &amp;solver, const Preconditioner &amp;preconditioner)</div><div class="ttdef"><b>Definition:</b> <a href="linear__operator_8h_source.html#l00701">linear_operator.h:701</a></div></div>
</div><!-- fragment --><p>Now we can construct that transpose of \(\mathsf{\mathbf{K}}_{\widetilde{J}\widetilde{p}}^{-1}\) and a linear operator that represents the condensed operations \(\overline{\mathsf{\mathbf{K}}}\) and \(\overline{\overline{\mathsf{\mathbf{K}}}}\) and the final augmented matrix \(\mathsf{\mathbf{K}}_{\textrm{con}}\). Note that the <a class="el" href="group__LAOperators.html#ga76acca911f21089cd3bb385d20ccc995">schur_complement()</a> operator could also be of use here, but for clarity and the purpose of demonstrating the similarities between the formulation and implementation of the linear solution scheme, we will perform these operations manually.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_pJ_inv     = <a class="code" href="group__LAOperators.html#ga6bdc65fb2db56230e6bc7d545e81295d">transpose_operator</a>(K_Jp_inv);</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_pp_bar     = K_Jp_inv * K_JJ * K_pJ_inv;</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_uu_bar_bar = K_up * K_pp_bar * K_pu;</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con     = K_uu + K_uu_bar_bar;</div>
<div class="ttc" id="agroup__LAOperators_html_ga6bdc65fb2db56230e6bc7d545e81295d"><div class="ttname"><a href="group__LAOperators.html#ga6bdc65fb2db56230e6bc7d545e81295d">LinearOperator::transpose_operator</a></div><div class="ttdeci">LinearOperator&lt; Domain, Range, Payload &gt; transpose_operator(const LinearOperator&lt; Range, Domain, Payload &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="linear__operator_8h_source.html#l00660">linear_operator.h:660</a></div></div>
</div><!-- fragment --><p>Lastly, we define an operator for inverse of augmented stiffness matrix, namely \(\mathsf{\mathbf{K}}_{\textrm{con}}^{-1}\). Note that the preconditioner for the augmented stiffness matrix is different to the case when we use static condensation. In this instance, the preconditioner is based on a non-modified \(\mathsf{\mathbf{K}}_{uu}\), while with the first approach we actually modified the entries of this sub-block. However, since \(\mathsf{\mathbf{K}}_{\textrm{con}}\) and \(\mathsf{\mathbf{K}}_{uu}\) operate on the same space, it remains adequate for this problem.</p>
<div class="fragment"><div class="line"><a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">  preconditioner_K_con_inv(parameters.preconditioner_type,</div>
<div class="line">                           parameters.preconditioner_relaxation);</div>
<div class="line">preconditioner_K_con_inv.use_matrix(</div>
<div class="line">  tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line"><a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_con_inv(</div>
<div class="line">  <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                            parameters.max_iterations_lin),</div>
<div class="line">  1.0e-30,</div>
<div class="line">  parameters.tol_lin);</div>
<div class="line"><a class="code" href="classSolverSelector.html">SolverSelector&lt;Vector&lt;double&gt;</a>&gt; solver_K_con_inv;</div>
<div class="line">solver_K_con_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(<span class="stringliteral">&quot;cg&quot;</span>);</div>
<div class="line">solver_K_con_inv.<a class="code" href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">set_control</a>(solver_control_K_con_inv);</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con_inv =</div>
<div class="line">  <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_uu_con,</div>
<div class="line">                   solver_K_con_inv,</div>
<div class="line">                   preconditioner_K_con_inv);</div>
</div><!-- fragment --><p>Now we are in a position to solve for the displacement field. We can nest the linear operations, and the result is immediately written to the Newton update vector. It is clear that the implementation closely mimics the derivation stated in the introduction.</p>
<div class="fragment"><div class="line">d_u =</div>
<div class="line">  K_uu_con_inv * (f_u - K_up * (K_Jp_inv * f_J - K_pp_bar * f_p));</div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
</div><!-- fragment --><p>The operations need to post-process for the dilatation and pressure fields are just as easy to express.</p>
<div class="fragment"><div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; PP &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    d_J = K_pJ_inv * (f_p - K_pu * d_u);</div>
<div class="line">    d_p = K_Jp_inv * (f_J - K_JJ * d_J);</div>
<div class="line"> </div>
<div class="line">    lin_it  = solver_control_K_con_inv.last_step();</div>
<div class="line">    lin_res = solver_control_K_con_inv.last_value();</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;Direct&quot;</span>)</div>
<div class="line">  {</div>
</div><!-- fragment --><p>Solve the full block system with a direct solver. As it is relatively robust, it may be immune to problem arising from the presence of the zero \(\mathsf{\mathbf{K}}_{ \widetilde{J} \widetilde{J}}\) block.</p>
<div class="fragment"><div class="line">    <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">    A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(tangent_matrix);</div>
<div class="line">    A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(newton_update, system_rhs);</div>
<div class="line"> </div>
<div class="line">    lin_it  = 1;</div>
<div class="line">    lin_res = 0.0;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; -- &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Linear solver type not implemented&quot;</span>));</div>
<div class="line"> </div>
<div class="line">timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
</div><!-- fragment --><p>Finally, we again ensure here that any Dirichlet constraints are distributed on the updated solution:</p>
<div class="fragment"><div class="line">      constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> std::make_pair(lin_it, lin_res);</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Solidoutput_results"></a> </p><h4>Solid::output_results</h4>
<p>Here we present how the results are written to file to be viewed using ParaView or VisIt. The method is similar to that shown in previous tutorials so will not be discussed in detail.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> Solid&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    data_component_interpretation(</div>
<div class="line">      dim, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;std::string&gt; solution_name(dim, <span class="stringliteral">&quot;displacement&quot;</span>);</div>
<div class="line">  solution_name.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line">  solution_name.emplace_back(<span class="stringliteral">&quot;dilatation&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> output_flags;</div>
<div class="line">  output_flags.<a class="code" href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">write_higher_order_cells</a> = <span class="keyword">true</span>;</div>
<div class="line">  data_out.<a class="code" href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">set_flags</a>(output_flags);</div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_n,</div>
<div class="line">                           solution_name,</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                           data_component_interpretation);</div>
<div class="ttc" id="aclassDataOut__DoFData_html_ac1eb26168177faa30ffbcf9cbb9c3cd5"><div class="ttname"><a href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandlerType &amp;)</div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_ace4b76e565ba0701c4d32c26075ed3b9"><div class="ttname"><a href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="data__out__dof__data_8h_source.html#l01087">data_out_dof_data.h:1087</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8h_source.html#l00147">data_out.h:150</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gaa9dd1830c0ff35a2431704c4d45453eb"><div class="ttname"><a href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">DataOutBase::VtkFlags::write_higher_order_cells</a></div><div class="ttdeci">bool write_higher_order_cells</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01170">data_out_base.h:1170</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gac7280a24690b117454acfb0fa058299c"><div class="ttname"><a href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">DataOutInterface::set_flags</a></div><div class="ttdeci">void set_flags(const FlagType &amp;flags)</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l08166">data_out_base.cc:8166</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a></div><div class="ttdeci">@ component_is_scalar</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00053">data_component_interpretation.h:53</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a></div><div class="ttdeci">@ component_is_part_of_vector</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00059">data_component_interpretation.h:59</a></div></div>
<div class="ttc" id="astructDataOutBase_1_1VtkFlags_html"><div class="ttname"><a href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a></div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01087">data_out_base.h:1088</a></div></div>
</div><!-- fragment --><p>Since we are dealing with a large deformation problem, it would be nice to display the result on a displaced grid! The <a class="el" href="classMappingQEulerian.html">MappingQEulerian</a> class linked with the <a class="el" href="classDataOut.html">DataOut</a> class provides an interface through which this can be achieved without physically moving the grid points in the <a class="el" href="classTriangulation.html">Triangulation</a> object ourselves. We first need to copy the solution to a temporary vector and then create the Eulerian mapping. We also specify the polynomial degree to the <a class="el" href="classDataOut.html">DataOut</a> object in order to produce a more refined output data set when higher order polynomials are used.</p>
<div class="fragment"><div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> soln(solution_n.<a class="code" href="group__Exceptions.html#ga69b8dc1f71903659eb44f12e02359ac6">size</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; soln.size(); ++i)</div>
<div class="line">      soln(i) = solution_n(i);</div>
<div class="line">    <a class="code" href="classMappingQEulerian.html">MappingQEulerian&lt;dim&gt;</a> q_mapping(degree, dof_handler, soln);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>(q_mapping, degree);</div>
<div class="line"> </div>
<div class="line">    std::ofstream output(<span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(dim) + <span class="stringliteral">&quot;d-&quot;</span> +</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(time.get_timestep()) + <span class="stringliteral">&quot;.vtu&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace Step44</span></div>
<div class="ttc" id="aclassDataOut_html_a5eb51872b8736849bb7e8d2007fae086"><div class="ttname"><a href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01085">data_out.cc:1085</a></div></div>
<div class="ttc" id="aclassMappingQEulerian_html"><div class="ttname"><a href="classMappingQEulerian.html">MappingQEulerian</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q__eulerian_8h_source.html#l00093">mapping_q_eulerian.h:94</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga69b8dc1f71903659eb44f12e02359ac6"><div class="ttname"><a href="group__Exceptions.html#ga69b8dc1f71903659eb44f12e02359ac6">BlockVectorBase::size</a></div><div class="ttdeci">std::size_t size() const</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga72743302dcb1a0fb1f2f8dc5122d299e"><div class="ttname"><a href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">Patterns::Tools::to_string</a></div><div class="ttdeci">std::string to_string(const T &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l02329">patterns.h:2329</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga93c780f93105e0daaa76c6c43694b4ae"><div class="ttname"><a href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">DataOutInterface::write_vtu</a></div><div class="ttdeci">void write_vtu(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07188">data_out_base.cc:7188</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Mainfunction"></a> </p><h3>Main function</h3>
<p>Lastly we provide the main driver function which appears no different to the other tutorials.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span>Step44;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 3;</div>
<div class="line">      Solid&lt;dim&gt;         solid(<span class="stringliteral">&quot;parameters.prm&quot;</span>);</div>
<div class="line">      solid.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>Firstly, we present a comparison of a series of 3-d results with those in the literature (see Reese et al (2000)) to demonstrate that the program works as expected.</p>
<p>We begin with a comparison of the convergence with mesh refinement for the \(Q_1-DGPM_0-DGPM_0\) and \(Q_2-DGPM_1-DGPM_1\) formulations, as summarised in the figure below. The vertical displacement of the midpoint of the upper surface of the block is used to assess convergence. Both schemes demonstrate good convergence properties for varying values of the load parameter \(p/p_0\). The results agree with those in the literature. The lower-order formulation typically overestimates the displacement for low levels of refinement, while the higher-order interpolation scheme underestimates it, but be a lesser degree. This benchmark, and a series of others not shown here, give us confidence that the code is working as it should.</p>
<table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q1-P0_convergence.png" alt="" class="inline"/> </p>
<p class="intertd">Convergence of the \(Q_1-DGPM_0-DGPM_0\) formulation in 3-d. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q2-P1_convergence.png" alt="" class="inline"/> </p>
<p class="intertd">Convergence of the \(Q_2-DGPM_1-DGPM_1\) formulation in 3-d. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p>A typical screen output generated by running the problem is shown below. The particular case demonstrated is that of the \(Q_2-DGPM_1-DGPM_1\) formulation. It is clear that, using the Newton-Raphson method, quadratic convergence of the solution is obtained. Solution convergence is achieved within 5 Newton increments for all time-steps. The converged displacement's \(L_2\)-norm is several orders of magnitude less than the geometry scale.</p>
<div class="fragment"><div class="line">Grid:</div>
<div class="line">         Reference <a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">volume</a>: 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-09</div>
<div class="line"><a class="code" href="namespaceparallel.html#a36161bdee34defd46d214e5098ac1a5e">Triangulation</a>:</div>
<div class="line">         Number of active cells: 64</div>
<div class="line">         Number of degrees of freedom: 2699</div>
<div class="line">    Setting up quadrature <a class="code" href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">point</a> data...</div>
<div class="line"> </div>
<div class="line">Timestep 1 @ 0.1s</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">                 SOLVER STEP                   |  LIN_IT   LIN_RES    RES_NORM     RES_U     RES_P      RES_J     NU_NORM      NU_U       NU_P       NU_J</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">  0  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     786  2.118e-06  1.000e+00  1.000e+00  0.000e+00  0.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00</div>
<div class="line">  1  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     552  1.031e-03  8.563e-02  8.563e-02  9.200e-13  3.929e-08  1.060e-01  3.816e-02  1.060e-01  1.060e-01</div>
<div class="line">  2  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     667  5.602e-06  2.482e-03  2.482e-03  3.373e-15  2.982e-10  2.936e-03  2.053e-04  2.936e-03  2.936e-03</div>
<div class="line">  3  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     856  6.469e-10  2.129e-06  2.129e-06  2.245e-19  1.244e-13  1.887e-06  7.289e-07  1.887e-06  1.887e-06</div>
<div class="line">  4  ASM_R  CONVERGED!</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">Relative errors:</div>
<div class="line">Displacement:   7.289e-07</div>
<div class="line">Force:          2.451e-10</div>
<div class="line">Dilatation:     1.353e-07</div>
<div class="line">v / V_0:        1.000e-09 / 1.000e-09 = 1.000e+00</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[...]</div>
<div class="line"> </div>
<div class="line">Timestep 10 @ 1.000e+00s</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">                 SOLVER STEP                   |  LIN_IT   LIN_RES    RES_NORM     RES_U     RES_P      RES_J     NU_NORM      NU_U       NU_P       NU_J</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">  0  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     874  2.358e-06  1.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00  1.000e+00</div>
<div class="line">  1  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     658  2.942e-04  1.544e-01  1.544e-01  1.208e+13  1.855e+06  6.014e-02  7.398e-02  6.014e-02  6.014e-02</div>
<div class="line">  2  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     790  2.206e-06  2.908e-03  2.908e-03  7.302e+10  2.067e+03  2.716e-03  1.433e-03  2.716e-03  2.717e-03</div>
<div class="line">  3  ASM_R  ASM_K  CST  ASM_SC  SLV  PP  UQPH  |     893  2.374e-09  1.919e-06  1.919e-06  4.527e+07  4.100e+00  1.672e-06  6.842e-07  1.672e-06  1.672e-06</div>
<div class="line">  4  ASM_R  CONVERGED!</div>
<div class="line">___________________________________________________________________________________________________________________________________________________________</div>
<div class="line">Relative errors:</div>
<div class="line">Displacement:   6.842e-07</div>
<div class="line">Force:          8.995e-10</div>
<div class="line">Dilatation:     1.528e-06</div>
<div class="line">v / V_0:        1.000e-09 / 1.000e-09 = 1.000e+00</div>
<div class="ttc" id="anamespaceOpenCASCADE_html_a7b0b2393711bae58d859be1bb9761781"><div class="ttname"><a href="namespaceOpenCASCADE.html#a7b0b2393711bae58d859be1bb9761781">OpenCASCADE::point</a></div><div class="ttdeci">Point&lt; spacedim &gt; point(const gp_Pnt &amp;p, const double tolerance=1e-10)</div><div class="ttdef"><b>Definition:</b> <a href="opencascade_2utilities_8cc_source.html#l00188">utilities.cc:188</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="anamespaceparallel_html_a36161bdee34defd46d214e5098ac1a5e"><div class="ttname"><a href="namespaceparallel.html#a36161bdee34defd46d214e5098ac1a5e">parallel::Triangulation</a></div><div class="ttdeci">TriangulationBase&lt; dim, spacedim &gt; Triangulation</div><div class="ttdef"><b>Definition:</b> <a href="tria__base_8h_source.html#l00396">tria_base.h:396</a></div></div>
</div><!-- fragment --><p>Using the <a class="el" href="classTimer.html">Timer</a> class, we can discern which parts of the code require the highest computational expense. For a case with a large number of degrees-of-freedom (i.e. a high level of refinement), a typical output of the <a class="el" href="classTimer.html">Timer</a> is given below. Much of the code in the tutorial has been developed based on the optimizations described, discussed and demonstrated in <a class="el" href="step_18.html">step-18</a> and others. With over 93% of the time being spent in the linear solver, it is obvious that it may be necessary to invest in a better solver for large three-dimensional problems. The SSOR preconditioner is not multithreaded but is effective for this class of solid problems. It may be beneficial to investigate the use of another solver such as those available through the Trilinos library.</p>
<div class="fragment"><div class="line">+---------------------------------------------+------------+------------+</div>
<div class="line">| Total wallclock time elapsed since start    | 9.874e+02s |            |</div>
<div class="line">|                                             |            |            |</div>
<div class="line">| Section                         | no. calls |  wall time | % of total |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="line">| Assemble system right-hand side |        53 | 1.727e+00s |  1.75e-01% |</div>
<div class="line">| Assemble tangent <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a>         |        43 | 2.707e+01s |  2.74e+00% |</div>
<div class="line">| Linear solver                   |        43 | 9.248e+02s |  9.37e+01% |</div>
<div class="line">| Linear solver postprocessing    |        43 | 2.743e-02s |  2.78e-03% |</div>
<div class="line">| Perform <span class="keyword">static</span> condensation     |        43 | 1.437e+01s |  1.46e+00% |</div>
<div class="line">| Setup system                    |         1 | 3.897e-01s |  3.95e-02% |</div>
<div class="line">| Update QPH data                 |        43 | 5.770e-01s |  5.84e-02% |</div>
<div class="line">+---------------------------------+-----------+------------+------------+</div>
<div class="ttc" id="anamespaceLAPACKSupport_html_a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003"><div class="ttname"><a href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">LAPACKSupport::matrix</a></div><div class="ttdeci">@ matrix</div><div class="ttdoc">Contents is actually a matrix.</div><div class="ttdef"><b>Definition:</b> <a href="lapack__support_8h_source.html#l00058">lapack_support.h:58</a></div></div>
</div><!-- fragment --><p>We then used ParaView to visualize the results for two cases. The first was for the coarsest grid and the lowest-order interpolation method: \(Q_1-DGPM_0-DGPM_0\). The second was on a refined grid using a \(Q_2-DGPM_1-DGPM_1\) formulation. The vertical component of the displacement, the pressure \(\widetilde{p}\) and the dilatation \(\widetilde{J}\) fields are shown below.</p>
<p>For the first case it is clear that the coarse spatial discretization coupled with large displacements leads to a low quality solution (the loading ratio is \(p/p_0=80\)). Additionally, the pressure difference between elements is very large. The constant pressure field on the element means that the large pressure gradient is not captured. However, it should be noted that locking, which would be present in a standard \(Q_1\) displacement formulation does not arise even in this poorly discretised case. The final vertical displacement of the tracked node on the top surface of the block is still within 12.5% of the converged solution. The pressure solution is very coarse and has large jumps between adjacent cells. It is clear that the volume nearest to the applied traction undergoes compression while the outer extents of the domain are in a state of expansion. The dilatation solution field and pressure field are clearly linked, with positive dilatation indicating regions of positive pressure and negative showing regions placed in compression. As discussed in the Introduction, a compressive pressure has a negative sign while an expansive pressure takes a positive sign. This stems from the definition of the volumetric strain energy function and is opposite to the physically realistic interpretation of pressure.</p>
<table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q1-P0_gr_1_p_ratio_80-displacement.png" alt="" class="inline"/> </p>
<p class="intertd">Z-displacement solution for the 3-d problem. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q1-P0_gr_1_p_ratio_80-pressure.png" alt="" class="inline"/> </p>
<p class="intertd">Discontinuous piece-wise constant pressure field. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q1-P0_gr_1_p_ratio_80-dilatation.png" alt="" class="inline"/> </p>
<p class="intertd">Discontinuous piece-wise constant dilatation field. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p>Combining spatial refinement and a higher-order interpolation scheme results in a high-quality solution. Three grid refinements coupled with a \(Q_2-DGPM_1-DGPM_1\) formulation produces a result that clearly captures the mechanics of the problem. The deformation of the traction surface is well resolved. We can now observe the actual extent of the applied traction, with the maximum force being applied at the central point of the surface causing the largest compression. Even though very high strains are experienced in the domain, especially at the boundary of the region of applied traction, the solution remains accurate. The pressure field is captured in far greater detail than before. There is a clear distinction and transition between regions of compression and expansion, and the linear approximation of the pressure field allows a refined visualization of the pressure at the sub-element scale. It should however be noted that the pressure field remains discontinuous and could be smoothed on a continuous grid for the post-processing purposes.</p>
<table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q2-P1_gr_3_p_ratio_80-displacement.png" alt="" class="inline"/> </p>
<p class="intertd">Z-displacement solution for the 3-d problem. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q2-P1_gr_3_p_ratio_80-pressure.png" alt="" class="inline"/> </p>
<p class="intertd">Discontinuous linear pressure field. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Q2-P1_gr_3_p_ratio_80-dilatation.png" alt="" class="inline"/> </p>
<p class="intertd">Discontinuous linear dilatation field. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p>This brief analysis of the results demonstrates that the three-field formulation is effective in circumventing volumetric locking for highly-incompressible media. The mixed formulation is able to accurately simulate the displacement of a near-incompressible block under compression. The command-line output indicates that the volumetric change under extreme compression resulted in less than 0.01% volume change for a Poisson's ratio of 0.4999.</p>
<p>In terms of run-time, the \(Q_2-DGPM_1-DGPM_1\) formulation tends to be more computationally expensive than the \(Q_1-DGPM_0-DGPM_0\) for a similar number of degrees-of-freedom (produced by adding an extra grid refinement level for the lower-order interpolation). This is shown in the graph below for a batch of tests run consecutively on a single 4-core (8-thread) machine. The increase in computational time for the higher-order method is likely due to the increased band-width required for the higher-order elements. As previously mentioned, the use of a better solver and preconditioner may mitigate the expense of using a higher-order formulation. It was observed that for the given problem using the multithreaded Jacobi preconditioner can reduce the computational runtime by up to 72% (for the worst case being a higher-order formulation with a large number of degrees-of-freedom) in comparison to the single-thread SSOR preconditioner. However, it is the author's experience that the Jacobi method of preconditioning may not be suitable for some finite-strain problems involving alternative constitutive models.</p>
<table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.Normalised_runtime.png" alt="" class="inline"/> </p>
<p class="intertd">Runtime on a 4-core machine, normalised against the lowest grid resolution \(Q_1-DGPM_0-DGPM_0\) solution that utilised a SSOR preconditioner. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p>Lastly, results for the displacement solution for the 2-d problem are showcased below for two different levels of grid refinement. It is clear that due to the extra constraints imposed by simulating in 2-d that the resulting displacement field, although qualitatively similar, is different to that of the 3-d case.</p>
<table align="center" class="tutorial" cellspacing="3" cellpadding="3">
<tr>
<td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.2d-gr_2.png" alt="" class="inline"/> </p>
<p class="intertd">Y-displacement solution in 2-d for 2 global grid refinement levels. </p>
<p class="endtd"></p>
</td><td align="center"><p class="starttd" align="center"><img src="https://www.dealii.org/images/steps/developer/step-44.2d-gr_5.png" alt="" class="inline"/> </p>
<p class="intertd">Y-displacement solution in 2-d for 5 global grid refinement levels. </p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a class="anchor" id="extensions"></a> <a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p>There are a number of obvious extensions for this work:</p>
<ul>
<li>Firstly, an additional constraint could be added to the free-energy function in order to enforce a high degree of incompressibility in materials. An additional Lagrange multiplier would be introduced, but this could most easily be dealt with using the principle of augmented Lagrange multipliers. This is demonstrated in <em>Simo and Taylor (1991) </em>.</li>
<li>The constitutive relationship used in this model is relatively basic. It may be beneficial to split the material class into two separate classes, one dealing with the volumetric response and the other the isochoric response, and produce a generic materials class (i.e. having abstract virtual functions that derived classes have to implement) that would allow for the addition of more complex material models. Such models could include other hyperelastic materials, plasticity and viscoelastic materials and others.</li>
<li>The program has been developed for solving problems on single-node multicore machines. With a little effort, the program could be extended to a large-scale computing environment through the use of Petsc or Trilinos, using a similar technique to that demonstrated in <a class="el" href="step_40.html">step-40</a>. This would mostly involve changes to the setup, assembly, <code>PointHistory</code> and linear solver routines.</li>
<li>As this program assumes quasi-static equilibrium, extensions to include dynamic effects would be necessary to study problems where inertial effects are important, e.g. problems involving impact.</li>
<li>Load and solution limiting procedures may be necessary for highly nonlinear problems. It is possible to add a linesearch algorithm to limit the step size within a Newton increment to ensure optimum convergence. It may also be necessary to use a load limiting method, such as the Riks method, to solve unstable problems involving geometric instability such as buckling and snap-through.</li>
<li>Many physical problems involve contact. It is possible to include the effect of frictional or frictionless contact between objects into this program. This would involve the addition of an extra term in the free-energy functional and therefore an addition to the assembly routine. One would also need to manage the contact problem (detection and stress calculations) itself. An alternative to additional penalty terms in the free-energy functional would be to use active set methods such as the one used in <a class="el" href="step_41.html">step-41</a>.</li>
<li>The complete condensation procedure using LinearOperators has been coded into the linear solver routine. This could also have been achieved through the application of the <a class="el" href="group__LAOperators.html#ga76acca911f21089cd3bb385d20ccc995">schur_complement()</a> operator to condense out one or more of the fields in a more automated manner.</li>
<li>Finally, adaptive mesh refinement, as demonstrated in <a class="el" href="step_6.html">step-6</a> and <a class="el" href="step_18.html">step-18</a>, could provide additional solution accuracy.</li>
</ul>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2010 - 2020 by the deal.II authors and</span></div>
<div class="line"><span class="comment"> *                              &amp; Jean-Paul Pelteret and Andrew McBride</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Authors: Jean-Paul Pelteret, University of Cape Town,</span></div>
<div class="line"><span class="comment"> *          Andrew McBride, University of Erlangen-Nuremberg, 2010</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2point_8h.html">deal.II/base/point.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="symmetric__tensor_8h.html">deal.II/base/symmetric_tensor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tensor_8h.html">deal.II/base/tensor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="work__stream_8h.html">deal.II/base/work_stream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__point__data_8h.html">deal.II/base/quadrature_point_data.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__dgp__monomial_8h.html">deal.II/fe/fe_dgp_monomial.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__tools_8h.html">deal.II/fe/fe_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mapping__q__eulerian_8h.html">deal.II/fe/mapping_q_eulerian.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__sparse__matrix_8h.html">deal.II/lac/block_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition__selector_8h.html">deal.II/lac/precondition_selector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__selector_8h.html">deal.II/lac/solver_selector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__direct_8h.html">deal.II/lac/sparse_direct.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="linear__operator_8h.html">deal.II/lac/linear_operator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="packaged__operation_8h.html">deal.II/lac/packaged_operation.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kinematics_8h.html">deal.II/physics/elasticity/kinematics.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="standard__tensors_8h.html">deal.II/physics/elasticity/standard_tensors.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step44</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">namespace </span>Parameters</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="classFESystem.html">FESystem</a></div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly_degree;</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> quad_order;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> FESystem::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;Displacement system polynomial order&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;3&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;Gauss quadrature order&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> FESystem::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Finite element system&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        poly_degree = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Polynomial degree&quot;</span>);</div>
<div class="line">        quad_order  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Quadrature order&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Geometry</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> global_refinement;</div>
<div class="line">      <span class="keywordtype">double</span>       <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>;</div>
<div class="line">      <span class="keywordtype">double</span>       p_p0;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Geometry::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;Global refinement level&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-3&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Global grid scaling factor&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Pressure ratio p/p0&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;100&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;20|40|60|80|100&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;Ratio of applied pressure to reference pressure&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Geometry::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Geometry&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        global_refinement = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Global refinement&quot;</span>);</div>
<div class="line">        <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">scale</a>             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Grid scale&quot;</span>);</div>
<div class="line">        p_p0              = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Pressure ratio p/p0&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Materials</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">double</span> nu;</div>
<div class="line">      <span class="keywordtype">double</span> <a class="code" href="namespacemu.html">mu</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Materials::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.4999&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(-1.0, 0.5),</div>
<div class="line">                          <span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Shear modulus&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;80.194e6&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Shear modulus&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Materials::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Material properties&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        nu = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Poisson&#39;s ratio&quot;</span>);</div>
<div class="line">        <a class="code" href="namespacemu.html">mu</a> = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Shear modulus&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>LinearSolver</div>
<div class="line">    {</div>
<div class="line">      std::string type_lin;</div>
<div class="line">      <span class="keywordtype">double</span>      tol_lin;</div>
<div class="line">      <span class="keywordtype">double</span>      max_iterations_lin;</div>
<div class="line">      <span class="keywordtype">bool</span>        use_static_condensation;</div>
<div class="line">      std::string preconditioner_type;</div>
<div class="line">      <span class="keywordtype">double</span>      preconditioner_relaxation;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> LinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Solver type&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;CG&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;CG|Direct&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;Type of solver used to solve the linear system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Residual&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1e-6&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Linear solver residual (scaled by residual norm)&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">          <span class="stringliteral">&quot;Max iteration multiplier&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">          <span class="stringliteral">&quot;Linear solver iterations (multiples of the system matrix size)&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Use static condensation&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Solve the full block system or a reduced problem&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Preconditioner type&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;ssor&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;jacobi|ssor&quot;</span>),</div>
<div class="line">                          <span class="stringliteral">&quot;Type of preconditioner&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Preconditioner relaxation&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.65&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Preconditioner relaxation value&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> LinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        type_lin                  = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Solver type&quot;</span>);</div>
<div class="line">        tol_lin                   = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line">        max_iterations_lin        = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Max iteration multiplier&quot;</span>);</div>
<div class="line">        use_static_condensation   = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Use static condensation&quot;</span>);</div>
<div class="line">        preconditioner_type       = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Preconditioner type&quot;</span>);</div>
<div class="line">        preconditioner_relaxation = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Preconditioner relaxation&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>NonlinearSolver</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iterations_NR;</div>
<div class="line">      <span class="keywordtype">double</span>       tol_f;</div>
<div class="line">      <span class="keywordtype">double</span>       tol_u;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> NonlinearSolver::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;10&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0),</div>
<div class="line">                          <span class="stringliteral">&quot;Number of Newton-Raphson iterations allowed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1.0e-9&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Force residual tolerance&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;1.0e-6&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.0),</div>
<div class="line">                          <span class="stringliteral">&quot;Displacement error tolerance&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> NonlinearSolver::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Nonlinear solver&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        max_iterations_NR = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Max iterations Newton-Raphson&quot;</span>);</div>
<div class="line">        tol_f             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance force&quot;</span>);</div>
<div class="line">        tol_u             = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Tolerance displacement&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Time</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">double</span> delta_t;</div>
<div class="line">      <span class="keywordtype">double</span> end_time;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Time::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;End time&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(), <span class="stringliteral">&quot;End time&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Time step size&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;0.1&quot;</span>,</div>
<div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(),</div>
<div class="line">                          <span class="stringliteral">&quot;Time step size&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> Time::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time&quot;</span>);</div>
<div class="line">      {</div>
<div class="line">        end_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;End time&quot;</span>);</div>
<div class="line">        delta_t  = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Time step size&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>AllParameters : <span class="keyword">public</span> <a class="code" href="classFESystem.html">FESystem</a>,</div>
<div class="line">                           <span class="keyword">public</span> Geometry,</div>
<div class="line">                           <span class="keyword">public</span> Materials,</div>
<div class="line">                           <span class="keyword">public</span> LinearSolver,</div>
<div class="line">                           <span class="keyword">public</span> NonlinearSolver,</div>
<div class="line">                           <span class="keyword">public</span> Time</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      AllParameters(<span class="keyword">const</span> std::string &amp;input_file);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    AllParameters::AllParameters(<span class="keyword">const</span> std::string &amp;input_file)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line">      declare_parameters(prm);</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(input_file);</div>
<div class="line">      parse_parameters(prm);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> AllParameters::declare_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      FESystem::declare_parameters(prm);</div>
<div class="line">      Geometry::declare_parameters(prm);</div>
<div class="line">      Materials::declare_parameters(prm);</div>
<div class="line">      LinearSolver::declare_parameters(prm);</div>
<div class="line">      NonlinearSolver::declare_parameters(prm);</div>
<div class="line">      Time::declare_parameters(prm);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> AllParameters::parse_parameters(<a class="code" href="classParameterHandler.html">ParameterHandler</a> &amp;prm)</div>
<div class="line">    {</div>
<div class="line">      FESystem::parse_parameters(prm);</div>
<div class="line">      Geometry::parse_parameters(prm);</div>
<div class="line">      Materials::parse_parameters(prm);</div>
<div class="line">      LinearSolver::parse_parameters(prm);</div>
<div class="line">      NonlinearSolver::parse_parameters(prm);</div>
<div class="line">      Time::parse_parameters(prm);</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// namespace Parameters</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">class </span>Time</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Time(<span class="keyword">const</span> <span class="keywordtype">double</span> time_end, <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t)</div>
<div class="line">      : timestep(0)</div>
<div class="line">      , time_current(0.0)</div>
<div class="line">      , time_end(time_end)</div>
<div class="line">      , delta_t(delta_t)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> ~Time() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> current()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> time_current;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> <a class="code" href="namespaceTrilinosWrappers_1_1internal.html#aee42c8e3004e2e81eac3c3356d3ec46b">end</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> time_end;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> get_delta_t()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> delta_t;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> get_timestep()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> timestep;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">void</span> increment()</div>
<div class="line">    {</div>
<div class="line">      time_current += delta_t;</div>
<div class="line">      ++timestep;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep;</div>
<div class="line">    <span class="keywordtype">double</span>       time_current;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> time_end;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> delta_t;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>Material_Compressible_Neo_Hook_Three_Field</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Material_Compressible_Neo_Hook_Three_Field(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacemu.html">mu</a>, <span class="keyword">const</span> <span class="keywordtype">double</span> nu)</div>
<div class="line">      : kappa((2.0 * <a class="code" href="namespacemu.html">mu</a> * (1.0 + nu)) / (3.0 * (1.0 - 2.0 * nu)))</div>
<div class="line">      , c_1(<a class="code" href="namespacemu.html">mu</a> / 2.0)</div>
<div class="line">      , det_F(1.0)</div>
<div class="line">      , p_tilde(0.0)</div>
<div class="line">      , J_tilde(1.0)</div>
<div class="line">      , b_bar(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(kappa &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> update_material_data(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>          p_tilde_in,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>          J_tilde_in)</div>
<div class="line">    {</div>
<div class="line">      det_F                      = <a class="code" href="symmetric__tensor_8h.html#a31fa20712aae4f3b8ab9f62729b464d3">determinant</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_bar = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae8c571720db885e3636e396f6e153317">Physics::Elasticity::Kinematics::F_iso</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">      b_bar                      = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#ae880749870e5b45fbb6a441fd96c1a07">Physics::Elasticity::Kinematics::b</a>(F_bar);</div>
<div class="line">      p_tilde                    = p_tilde_in;</div>
<div class="line">      J_tilde                    = J_tilde_in;</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(det_F &gt; 0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau()</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> get_tau_iso() + get_tau_vol();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> get_Jc_vol() + get_Jc_iso();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_dPsi_vol_dJ()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> (kappa / 2.0) * (J_tilde - 1.0 / J_tilde);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_d2Psi_vol_dJ2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> ((kappa / 2.0) * (1.0 + 1.0 / (J_tilde * J_tilde)));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_det_F()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> det_F;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_p_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> p_tilde;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_J_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> J_tilde;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> kappa;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> c_1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span>                  det_F;</div>
<div class="line">    <span class="keywordtype">double</span>                  p_tilde;</div>
<div class="line">    <span class="keywordtype">double</span>                  J_tilde;</div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> b_bar;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_vol()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> p_tilde * det_F * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_iso()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * get_tau_bar();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> get_tau_bar()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> 2.0 * c_1 * b_bar;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_vol()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> p_tilde * det_F *</div>
<div class="line">             (<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::IxI</a> -</div>
<div class="line">              (2.0 * <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::S</a>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_Jc_iso()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_bar = get_tau_bar();</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau_iso = get_tau_iso();</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> tau_iso_x_I =</div>
<div class="line">        <a class="code" href="symmetric__tensor_8h.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a>(tau_iso, <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>);</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> I_x_tau_iso =</div>
<div class="line">        <a class="code" href="symmetric__tensor_8h.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a>(<a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>, tau_iso);</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> c_bar = get_c_bar();</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> (2.0 / dim) * <a class="code" href="symmetric__tensor_8h.html#a4248760c880275bab1f288fc80f27039">trace</a>(tau_bar) *</div>
<div class="line">               <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> -</div>
<div class="line">             (2.0 / dim) * (tau_iso_x_I + I_x_tau_iso) +</div>
<div class="line">             <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a> * c_bar *</div>
<div class="line">               <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::dev_P</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> get_c_bar()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a>();</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>PointHistory</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    PointHistory()</div>
<div class="line">      : F_inv(<a class="code" href="namespacePhysics.html">Physics</a>::Elasticity::StandardTensors&lt;dim&gt;::I)</div>
<div class="line">      , tau(<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt;())</div>
<div class="line">      , d2Psi_vol_dJ2(0.0)</div>
<div class="line">      , dPsi_vol_dJ(0.0)</div>
<div class="line">      , Jc(<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;4, dim&gt;())</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> ~PointHistory() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_lqp(<span class="keyword">const</span> Parameters::AllParameters &amp;parameters)</div>
<div class="line">    {</div>
<div class="line">      material =</div>
<div class="line">        std::make_shared&lt;Material_Compressible_Neo_Hook_Three_Field&lt;dim&gt;&gt;(</div>
<div class="line">          parameters.mu, parameters.nu);</div>
<div class="line">      <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>(<a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a>(), 0.0, 1.0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;Grad_u_n,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">double</span>          p_tilde,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">double</span>          J_tilde)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a> = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">Physics::Elasticity::Kinematics::F</a>(Grad_u_n);</div>
<div class="line">      material-&gt;update_material_data(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>, p_tilde, J_tilde);</div>
<div class="line"> </div>
<div class="line">      F_inv         = <a class="code" href="symmetric__tensor_8h.html#a3656e2f6095f612536b06139a6a2ca39">invert</a>(<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#aa87528a28ad8a95fa89a3876e6f986c8">F</a>);</div>
<div class="line">      tau           = material-&gt;get_tau();</div>
<div class="line">      Jc            = material-&gt;get_Jc();</div>
<div class="line">      dPsi_vol_dJ   = material-&gt;get_dPsi_vol_dJ();</div>
<div class="line">      d2Psi_vol_dJ2 = material-&gt;get_d2Psi_vol_dJ2();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_J_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> material-&gt;get_J_tilde();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_det_F()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> material-&gt;get_det_F();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> &amp;get_F_inv()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> F_inv;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_p_tilde()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> material-&gt;get_p_tilde();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;get_tau()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> tau;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_dPsi_vol_dJ()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> dPsi_vol_dJ;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> get_d2Psi_vol_dJ2()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> d2Psi_vol_dJ2;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> &amp;get_Jc()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      <span class="keywordflow">return</span> Jc;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    std::shared_ptr&lt;Material_Compressible_Neo_Hook_Three_Field&lt;dim&gt;&gt; material;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau;</div>
<div class="line">    <span class="keywordtype">double</span>                  d2Psi_vol_dJ2;</div>
<div class="line">    <span class="keywordtype">double</span>                  dPsi_vol_dJ;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>Solid</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Solid(<span class="keyword">const</span> std::string &amp;input_file);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">struct </span>PerTaskData_ASM;</div>
<div class="line">    <span class="keyword">struct </span>ScratchData_ASM;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>PerTaskData_SC;</div>
<div class="line">    <span class="keyword">struct </span>ScratchData_SC;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>PerTaskData_UQPH;</div>
<div class="line">    <span class="keyword">struct </span>ScratchData_UQPH;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> make_grid();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> system_setup();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> determine_component_extractors();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> it_nr);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_system_one_cell(</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">      ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">      PerTaskData_ASM &amp;                                     data) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_sc();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> assemble_sc_one_cell(</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">      ScratchData_SC &amp;                                      scratch,</div>
<div class="line">      PerTaskData_SC &amp;                                      data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> copy_local_to_global_sc(<span class="keyword">const</span> PerTaskData_SC &amp;data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_qph();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> update_qph_incremental(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> update_qph_incremental_one_cell(</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">      ScratchData_UQPH &amp;                                    scratch,</div>
<div class="line">      PerTaskData_UQPH &amp;                                    data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> copy_local_to_global_UQPH(<span class="keyword">const</span> PerTaskData_UQPH &amp; <span class="comment">/*data*/</span>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> solve_nonlinear_timestep(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta);</div>
<div class="line"> </div>
<div class="line">    std::pair&lt;unsigned int, double&gt;</div>
<div class="line">    solve_linear_system(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a></div>
<div class="line">    get_total_solution(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    Parameters::AllParameters parameters;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> vol_reference;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line"> </div>
<div class="line">    Time                time;</div>
<div class="line">    <span class="keyword">mutable</span> <a class="code" href="classTimerOutput.html">TimerOutput</a> timer;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classCellDataStorage.html">CellDataStorage&lt;typename Triangulation&lt;dim&gt;::cell_iterator</a>,</div>
<div class="line">                    PointHistory&lt;dim&gt;&gt;</div>
<div class="line">      quadrature_point_history;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               degree;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>              fe;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>                  dof_handler;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>               dofs_per_cell;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> u_fe;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> p_fe;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> J_fe;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>          = 3;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_components      = dim + 2;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_u_component = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p_component       = dim;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> J_component       = dim + 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span></div>
<div class="line">    {</div>
<div class="line">      u_dof = 0,</div>
<div class="line">      p_dof = 1,</div>
<div class="line">      J_dof = 2</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; dofs_per_block;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; element_indices_u;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; element_indices_p;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; element_indices_J;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>     qf_cell;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss</a>&lt;dim - 1&gt; qf_face;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    n_q_points_f;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line">    <a class="code" href="classBlockSparsityPattern.html">BlockSparsityPattern</a>      sparsity_pattern;</div>
<div class="line">    <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> tangent_matrix;</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a>       system_rhs;</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a>       solution_n;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Errors</div>
<div class="line">    {</div>
<div class="line">      Errors()</div>
<div class="line">        : <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a>(1.0)</div>
<div class="line">        , u(1.0)</div>
<div class="line">        , p(1.0)</div>
<div class="line">        , J(1.0)</div>
<div class="line">      {}</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> reset()</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> = 1.0;</div>
<div class="line">        u    = 1.0;</div>
<div class="line">        p    = 1.0;</div>
<div class="line">        J    = 1.0;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordtype">void</span> normalize(<span class="keyword">const</span> Errors &amp;rhs)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (rhs.norm != 0.0)</div>
<div class="line">          <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a> /= rhs.norm;</div>
<div class="line">        <span class="keywordflow">if</span> (rhs.u != 0.0)</div>
<div class="line">          u /= rhs.u;</div>
<div class="line">        <span class="keywordflow">if</span> (rhs.p != 0.0)</div>
<div class="line">          p /= rhs.p;</div>
<div class="line">        <span class="keywordflow">if</span> (rhs.J != 0.0)</div>
<div class="line">          J /= rhs.J;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">double</span> <a class="code" href="namespaceLocalIntegrators_1_1Divergence.html#a8bcfc37d2a2be8faa18628a601ecf112">norm</a>, u, p, J;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    Errors error_residual, error_residual_0, error_residual_norm, error_update,</div>
<div class="line">      error_update_0, error_update_norm;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> get_error_residual(Errors &amp;error_residual);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> get_error_update(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update,</div>
<div class="line">                          Errors &amp;                   error_update);</div>
<div class="line"> </div>
<div class="line">    std::pair&lt;double, double&gt; get_error_dilation() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> compute_vol_current() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> print_conv_header();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> print_conv_footer();</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  Solid&lt;dim&gt;::Solid(<span class="keyword">const</span> std::string &amp;input_file)</div>
<div class="line">    : parameters(input_file)</div>
<div class="line">    , vol_reference(0.)</div>
<div class="line">    , <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::maximum_smoothing)</div>
<div class="line">    , time(parameters.end_time, parameters.delta_t)</div>
<div class="line">    , timer(std::cout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::summary, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">    , degree(parameters.poly_degree)</div>
<div class="line">    ,</div>
<div class="line">    fe(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;dim&gt;(parameters.poly_degree),</div>
<div class="line">       dim, <span class="comment">// displacement</span></div>
<div class="line">       <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial</a>&lt;dim&gt;(parameters.poly_degree - 1),</div>
<div class="line">       1, <span class="comment">// pressure</span></div>
<div class="line">       <a class="code" href="classFE__DGPMonomial.html">FE_DGPMonomial</a>&lt;dim&gt;(parameters.poly_degree - 1),</div>
<div class="line">       1)</div>
<div class="line">    , <span class="comment">// dilatation</span></div>
<div class="line">    dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">    , dofs_per_cell(fe.n_dofs_per_cell())</div>
<div class="line">    , u_fe(first_u_component)</div>
<div class="line">    , p_fe(p_component)</div>
<div class="line">    , J_fe(J_component)</div>
<div class="line">    , dofs_per_block(<a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>)</div>
<div class="line">    , qf_cell(parameters.quad_order)</div>
<div class="line">    , qf_face(parameters.quad_order)</div>
<div class="line">    , n_q_points(qf_cell.size())</div>
<div class="line">    , n_q_points_f(qf_face.size())</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim == 2 || dim == 3,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;This problem only works in 2 or 3 space dimensions.&quot;</span>));</div>
<div class="line">    determine_component_extractors();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">Solid&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    make_grid();</div>
<div class="line">    system_setup();</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line">      constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a> J_mask(J_component, n_components);</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a>(</div>
<div class="line">        dof_handler, constraints, <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(degree + 2), J_mask, solution_n);</div>
<div class="line">    }</div>
<div class="line">    output_results();</div>
<div class="line">    time.increment();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_delta(dofs_per_block);</div>
<div class="line">    <span class="keywordflow">while</span> (time.current() &lt; time.end())</div>
<div class="line">      {</div>
<div class="line">        solution_delta = 0.0;</div>
<div class="line"> </div>
<div class="line">        solve_nonlinear_timestep(solution_delta);</div>
<div class="line">        solution_n += solution_delta;</div>
<div class="line"> </div>
<div class="line">        output_results();</div>
<div class="line">        time.increment();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_ASM</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line"> </div>
<div class="line">    PerTaskData_ASM(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell)</div>
<div class="line">      : <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell)</div>
<div class="line">      , cell_rhs(dofs_per_cell)</div>
<div class="line">      , local_dof_indices(dofs_per_cell)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0.0;</div>
<div class="line">      cell_rhs    = 0.0;</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_ASM</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>     fe_values;</div>
<div class="line">    <a class="code" href="classFEFaceValues.html">FEFaceValues&lt;dim&gt;</a> fe_face_values;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::vector&lt;double&gt;&gt;                  Nx;</div>
<div class="line">    std::vector&lt;std::vector&lt;Tensor&lt;2, dim&gt;&gt;&gt;          grad_Nx;</div>
<div class="line">    std::vector&lt;std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt;&gt; symm_grad_Nx;</div>
<div class="line"> </div>
<div class="line">    ScratchData_ASM(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe_cell,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;       qf_cell,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         uf_cell,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim - 1&gt;</a> &amp;   qf_face,</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>         uf_face)</div>
<div class="line">      : fe_values(fe_cell, qf_cell, uf_cell)</div>
<div class="line">      , fe_face_values(fe_cell, qf_face, uf_face)</div>
<div class="line">      , Nx(qf_cell.size(), std::vector&lt;<a class="code" href="classdouble.html">double</a>&gt;(fe_cell.n_dofs_per_cell()))</div>
<div class="line">      , grad_Nx(qf_cell.size(),</div>
<div class="line">                std::vector&lt;<a class="code" href="classTensor.html">Tensor</a>&lt;2, dim&gt;&gt;(fe_cell.n_dofs_per_cell()))</div>
<div class="line">      , symm_grad_Nx(qf_cell.size(),</div>
<div class="line">                     std::vector&lt;<a class="code" href="classSymmetricTensor.html">SymmetricTensor</a>&lt;2, dim&gt;&gt;(</div>
<div class="line">                       fe_cell.n_dofs_per_cell()))</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    ScratchData_ASM(<span class="keyword">const</span> ScratchData_ASM &amp;rhs)</div>
<div class="line">      : fe_values(rhs.fe_values.get_fe(),</div>
<div class="line">                  rhs.fe_values.get_quadrature(),</div>
<div class="line">                  rhs.fe_values.get_update_flags())</div>
<div class="line">      , fe_face_values(rhs.fe_face_values.get_fe(),</div>
<div class="line">                       rhs.fe_face_values.get_quadrature(),</div>
<div class="line">                       rhs.fe_face_values.get_update_flags())</div>
<div class="line">      , Nx(rhs.Nx)</div>
<div class="line">      , grad_Nx(rhs.grad_Nx)</div>
<div class="line">      , symm_grad_Nx(rhs.symm_grad_Nx)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points      = Nx.size();</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs_per_cell = Nx[0].size();</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(Nx[q_point].size() == n_dofs_per_cell, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(grad_Nx[q_point].size() == n_dofs_per_cell,</div>
<div class="line">                 <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(symm_grad_Nx[q_point].size() == n_dofs_per_cell,</div>
<div class="line">                 <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; n_dofs_per_cell; ++k)</div>
<div class="line">            {</div>
<div class="line">              Nx[q_point][k]           = 0.0;</div>
<div class="line">              grad_Nx[q_point][k]      = 0.0;</div>
<div class="line">              symm_grad_Nx[q_point][k] = 0.0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_SC</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_orig;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pu;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pJ;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_JJ;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_pJ_inv;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> k_bbar;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> B;</div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>;</div>
<div class="line"> </div>
<div class="line">    PerTaskData_SC(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_u,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_p,</div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_J)</div>
<div class="line">      : <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell)</div>
<div class="line">      , local_dof_indices(dofs_per_cell)</div>
<div class="line">      , k_orig(dofs_per_cell, dofs_per_cell)</div>
<div class="line">      , k_pu(n_p, n_u)</div>
<div class="line">      , k_pJ(n_p, n_J)</div>
<div class="line">      , k_JJ(n_J, n_J)</div>
<div class="line">      , k_pJ_inv(n_p, n_J)</div>
<div class="line">      , k_bbar(n_u, n_u)</div>
<div class="line">      , <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>(n_J, n_u)</div>
<div class="line">      , B(n_J, n_u)</div>
<div class="line">      , <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a09916360abaee5f1fb31994dbc96787b">C</a>(n_p, n_u)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_SC</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::PerTaskData_UQPH</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>Solid&lt;dim&gt;::ScratchData_UQPH</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_total;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;Tensor&lt;2, dim&gt;&gt; solution_grads_u_total;</div>
<div class="line">    std::vector&lt;double&gt;         solution_values_p_total;</div>
<div class="line">    std::vector&lt;double&gt;         solution_values_J_total;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line"> </div>
<div class="line">    ScratchData_UQPH(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp; fe_cell,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;        qf_cell,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>          uf_cell,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_total)</div>
<div class="line">      : solution_total(solution_total)</div>
<div class="line">      , solution_grads_u_total(qf_cell.size())</div>
<div class="line">      , solution_values_p_total(qf_cell.size())</div>
<div class="line">      , solution_values_J_total(qf_cell.size())</div>
<div class="line">      , fe_values(fe_cell, qf_cell, uf_cell)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    ScratchData_UQPH(<span class="keyword">const</span> ScratchData_UQPH &amp;rhs)</div>
<div class="line">      : solution_total(rhs.solution_total)</div>
<div class="line">      , solution_grads_u_total(rhs.solution_grads_u_total)</div>
<div class="line">      , solution_values_p_total(rhs.solution_values_p_total)</div>
<div class="line">      , solution_values_J_total(rhs.solution_values_J_total)</div>
<div class="line">      , fe_values(rhs.fe_values.get_fe(),</div>
<div class="line">                  rhs.fe_values.get_quadrature(),</div>
<div class="line">                  rhs.fe_values.get_update_flags())</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> reset()</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = solution_grads_u_total.size();</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          solution_grads_u_total[q]  = 0.0;</div>
<div class="line">          solution_values_p_total[q] = 0.0;</div>
<div class="line">          solution_values_J_total[q] = 0.0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::make_grid()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#a56019d263ae45708302d5d7599f0d458">GridGenerator::hyper_rectangle</a>(</div>
<div class="line">      <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">      (dim == 3 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0.0, 0.0, 0.0) : <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0.0, 0.0)),</div>
<div class="line">      (dim == 3 ? <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(1.0, 1.0, 1.0) : <a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(1.0, 1.0)),</div>
<div class="line">      <span class="keyword">true</span>);</div>
<div class="line">    <a class="code" href="namespaceGridTools.html#a0967563badadd81f77f62622dd8bc2cd">GridTools::scale</a>(parameters.scale, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(1U, parameters.global_refinement));</div>
<div class="line"> </div>
<div class="line">    vol_reference = <a class="code" href="namespaceGridTools.html#a9e8169dc4981e90ba5d2386a87efa042">GridTools::volume</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Grid:\n\t Reference volume: &quot;</span> &lt;&lt; vol_reference &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> (face-&gt;at_boundary() == <span class="keyword">true</span> &amp;&amp;</div>
<div class="line">              face-&gt;center()[1] == 1.0 * parameters.scale)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">if</span> (dim == 3)</div>
<div class="line">                {</div>
<div class="line">                  <span class="keywordflow">if</span> (face-&gt;center()[0] &lt; 0.5 * parameters.scale &amp;&amp;</div>
<div class="line">                      face-&gt;center()[2] &lt; 0.5 * parameters.scale)</div>
<div class="line">                    face-&gt;set_boundary_id(6);</div>
<div class="line">                }</div>
<div class="line">              <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                  <span class="keywordflow">if</span> (face-&gt;center()[0] &lt; 0.5 * parameters.scale)</div>
<div class="line">                    face-&gt;set_boundary_id(6);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::system_setup()</div>
<div class="line">  {</div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Setup system&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned int&gt; block_component(n_components,</div>
<div class="line">                                              u_dof); <span class="comment">// Displacement</span></div>
<div class="line">    block_component[p_component] = p_dof;             <span class="comment">// Pressure</span></div>
<div class="line">    block_component[J_component] = J_dof;             <span class="comment">// Dilatation</span></div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a>(dof_handler);</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a52c1941406d1ce2937e29a46edf111f4">DoFRenumbering::component_wise</a>(dof_handler, block_component);</div>
<div class="line"> </div>
<div class="line">    dofs_per_block =</div>
<div class="line">      <a class="code" href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a>(dof_handler, block_component);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Triangulation:&quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\n\t Number of active cells: &quot;</span></div>
<div class="line">              &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\n\t Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>()</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    tangent_matrix.<a class="code" href="group__Matrix1.html#gacf098688a1a7db16a6582be07dcbeb6a">clear</a>();</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_u = dofs_per_block[u_dof];</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_p = dofs_per_block[p_dof];</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="namespacetypes.html#a3543786f7dc7c57385fc923a6afd5917">types::global_dof_index</a> n_dofs_J = dofs_per_block[J_dof];</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a> dsp(<a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>, <a class="code" href="namespaceMatrixFreeOperators_1_1BlockHelper.html#a42c347ac5bcdd69aceb58ab14bacd2b7">n_blocks</a>);</div>
<div class="line"> </div>
<div class="line">      dsp.block(u_dof, u_dof).reinit(n_dofs_u, n_dofs_u);</div>
<div class="line">      dsp.block(u_dof, p_dof).reinit(n_dofs_u, n_dofs_p);</div>
<div class="line">      dsp.block(u_dof, J_dof).reinit(n_dofs_u, n_dofs_J);</div>
<div class="line"> </div>
<div class="line">      dsp.block(p_dof, u_dof).reinit(n_dofs_p, n_dofs_u);</div>
<div class="line">      dsp.block(p_dof, p_dof).reinit(n_dofs_p, n_dofs_p);</div>
<div class="line">      dsp.block(p_dof, J_dof).reinit(n_dofs_p, n_dofs_J);</div>
<div class="line"> </div>
<div class="line">      dsp.block(J_dof, u_dof).reinit(n_dofs_J, n_dofs_u);</div>
<div class="line">      dsp.block(J_dof, p_dof).reinit(n_dofs_J, n_dofs_p);</div>
<div class="line">      dsp.block(J_dof, J_dof).reinit(n_dofs_J, n_dofs_J);</div>
<div class="line">      dsp.collect_sizes();</div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classTable.html">Table&lt;2, DoFTools::Coupling&gt;</a> coupling(n_components, n_components);</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0; ii &lt; n_components; ++ii)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jj = 0; jj &lt; n_components; ++jj)</div>
<div class="line">          <span class="keywordflow">if</span> (((ii &lt; p_component) &amp;&amp; (jj == J_component)) ||</div>
<div class="line">              ((ii == J_component) &amp;&amp; (jj &lt; p_component)) ||</div>
<div class="line">              ((ii == p_component) &amp;&amp; (jj == p_component)))</div>
<div class="line">            coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a193fa079dee88a75524f669136d6faba">DoFTools::none</a>;</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            coupling[ii][jj] = <a class="code" href="namespaceDoFTools.html#ad31df71a29dd76de9b4ab241b2527160a6a742e14fbc92a1c202d77d4f319d5ec">DoFTools::always</a>;</div>
<div class="line">      <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(</div>
<div class="line">        dof_handler, coupling, dsp, constraints, <span class="keyword">false</span>);</div>
<div class="line">      sparsity_pattern.<a class="code" href="group__Exceptions.html#ga923288e4b4093f86b680e7045e9b4984">copy_from</a>(dsp);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e0a45e360458e7350bd93487d6bf1e5">reinit</a>(sparsity_pattern);</div>
<div class="line"> </div>
<div class="line">    system_rhs.<a class="code" href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">reinit</a>(dofs_per_block);</div>
<div class="line">    system_rhs.<a class="code" href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">collect_sizes</a>();</div>
<div class="line"> </div>
<div class="line">    solution_n.<a class="code" href="group__Vectors.html#gadf4d1d6c3538af95309a95da2ded758c">reinit</a>(dofs_per_block);</div>
<div class="line">    solution_n.<a class="code" href="group__Exceptions.html#ga6a27b2a48e5b5780cd0a6640b928d794">collect_sizes</a>();</div>
<div class="line"> </div>
<div class="line">    setup_qph();</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::determine_component_extractors()</div>
<div class="line">  {</div>
<div class="line">    element_indices_u.clear();</div>
<div class="line">    element_indices_p.clear();</div>
<div class="line">    element_indices_J.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; fe.<a class="code" href="classFiniteElementData.html#a33b522422da89e5c080e7405ad49d7c7">n_dofs_per_cell</a>(); ++k)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(k).first.first;</div>
<div class="line">        <span class="keywordflow">if</span> (k_group == u_dof)</div>
<div class="line">          element_indices_u.push_back(k);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_dof)</div>
<div class="line">          element_indices_p.push_back(k);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_dof)</div>
<div class="line">          element_indices_J.push_back(k);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::setup_qph()</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;    Setting up quadrature point data...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    quadrature_point_history.<a class="code" href="classCellDataStorage.html#a9ce38927ac1a1f96618c2624da89d65b">initialize</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.begin_active(),</div>
<div class="line">                                        <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.end(),</div>
<div class="line">                                        n_q_points);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">          quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">          lqph[q_point]-&gt;setup_lqp(parameters);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  Solid&lt;dim&gt;::update_qph_incremental(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)</div>
<div class="line">  {</div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Update QPH data&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; UQPH &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_total(</div>
<div class="line">      get_total_solution(solution_delta));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_UQPH(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>);</div>
<div class="line">    PerTaskData_UQPH  per_task_data_UQPH;</div>
<div class="line">    ScratchData_UQPH  scratch_data_UQPH(fe, qf_cell, uf_UQPH, solution_total);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">                    *<span class="keyword">this</span>,</div>
<div class="line">                    &amp;Solid::update_qph_incremental_one_cell,</div>
<div class="line">                    &amp;Solid::copy_local_to_global_UQPH,</div>
<div class="line">                    scratch_data_UQPH,</div>
<div class="line">                    per_task_data_UQPH);</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::update_qph_incremental_one_cell(</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">    ScratchData_UQPH &amp;                                    scratch,</div>
<div class="line">    PerTaskData_UQPH &amp; <span class="comment">/*data*/</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">      quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_grads_u_total.size() == n_q_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_values_p_total.size() == n_q_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(scratch.solution_values_J_total.size() == n_q_points,</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    scratch.reset();</div>
<div class="line"> </div>
<div class="line">    scratch.fe_values.reinit(cell);</div>
<div class="line">    scratch.fe_values[u_fe].get_function_gradients(</div>
<div class="line">      scratch.solution_total, scratch.solution_grads_u_total);</div>
<div class="line">    scratch.fe_values[p_fe].get_function_values(</div>
<div class="line">      scratch.solution_total, scratch.solution_values_p_total);</div>
<div class="line">    scratch.fe_values[J_fe].get_function_values(</div>
<div class="line">      scratch.solution_total, scratch.solution_values_J_total);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">         scratch.fe_values.quadrature_point_indices())</div>
<div class="line">      lqph[q_point]-&gt;update_values(scratch.solution_grads_u_total[q_point],</div>
<div class="line">                                   scratch.solution_values_p_total[q_point],</div>
<div class="line">                                   scratch.solution_values_J_total[q_point]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::solve_nonlinear_timestep(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;Timestep &quot;</span> &lt;&lt; time.get_timestep() &lt;&lt; <span class="stringliteral">&quot; @ &quot;</span> &lt;&lt; time.current()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;s&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> newton_update(dofs_per_block);</div>
<div class="line"> </div>
<div class="line">    error_residual.reset();</div>
<div class="line">    error_residual_0.reset();</div>
<div class="line">    error_residual_norm.reset();</div>
<div class="line">    error_update.reset();</div>
<div class="line">    error_update_0.reset();</div>
<div class="line">    error_update_norm.reset();</div>
<div class="line"> </div>
<div class="line">    print_conv_header();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newton_iteration = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (; newton_iteration &lt; parameters.max_iterations_NR; ++newton_iteration)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::setw(2) &lt;&lt; newton_iteration &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                  &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        make_constraints(newton_iteration);</div>
<div class="line">        assemble_system();</div>
<div class="line"> </div>
<div class="line">        get_error_residual(error_residual);</div>
<div class="line">        <span class="keywordflow">if</span> (newton_iteration == 0)</div>
<div class="line">          error_residual_0 = error_residual;</div>
<div class="line"> </div>
<div class="line">        error_residual_norm = error_residual;</div>
<div class="line">        error_residual_norm.normalize(error_residual_0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (newton_iteration &gt; 0 &amp;&amp; error_update_norm.u &lt;= parameters.tol_u &amp;&amp;</div>
<div class="line">            error_residual_norm.u &lt;= parameters.tol_f)</div>
<div class="line">          {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; CONVERGED! &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            print_conv_footer();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::pair&lt;unsigned int, double&gt; lin_solver_output =</div>
<div class="line">          solve_linear_system(newton_update);</div>
<div class="line"> </div>
<div class="line">        get_error_update(newton_update, error_update);</div>
<div class="line">        <span class="keywordflow">if</span> (newton_iteration == 0)</div>
<div class="line">          error_update_0 = error_update;</div>
<div class="line"> </div>
<div class="line">        error_update_norm = error_update;</div>
<div class="line">        error_update_norm.normalize(error_update_0);</div>
<div class="line"> </div>
<div class="line">        solution_delta += newton_update;</div>
<div class="line">        update_qph_incremental(solution_delta);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; std::fixed &lt;&lt; std::setprecision(3) &lt;&lt; std::setw(7)</div>
<div class="line">                  &lt;&lt; std::scientific &lt;&lt; lin_solver_output.first &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">                  &lt;&lt; lin_solver_output.second &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">                  &lt;&lt; error_residual_norm.norm &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.u</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_residual_norm.p &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div>
<div class="line">                  &lt;&lt; error_residual_norm.J &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.norm</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.u &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.p</div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error_update_norm.J &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(newton_iteration &lt; parameters.max_iterations_NR,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;No convergence in nonlinear solver!&quot;</span>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_header()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_width = 150;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;               SOLVER STEP               &quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; |  LIN_IT   LIN_RES    RES_NORM    &quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; RES_U     RES_P      RES_J     NU_NORM     &quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; NU_U       NU_P       NU_J &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::print_conv_footer()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_width = 150;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; l_width; ++i)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::pair&lt;double, double&gt; error_dil = get_error_dilation();</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Relative errors:&quot;</span> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;Displacement:\t&quot;</span> &lt;&lt; error_update.u / error_update_0.u</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;Force: \t\t&quot;</span> &lt;&lt; error_residual.u / error_residual_0.u</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;Dilatation:\t&quot;</span> &lt;&lt; error_dil.first &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;v / V_0:\t&quot;</span> &lt;&lt; error_dil.second * vol_reference &lt;&lt; <span class="stringliteral">&quot; / &quot;</span></div>
<div class="line">              &lt;&lt; vol_reference &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; error_dil.second &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> Solid&lt;dim&gt;::compute_vol_current()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordtype">double</span> vol_current = 0.0;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe, qf_cell, <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">          quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point : fe_values.<a class="code" href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">quadrature_point_indices</a>())</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> JxW      = fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div>
<div class="line"> </div>
<div class="line">            vol_current += det_F_qp * JxW;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(vol_current &gt; 0.0, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">    <span class="keywordflow">return</span> vol_current;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::pair&lt;double, double&gt; Solid&lt;dim&gt;::get_error_dilation()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordtype">double</span> dil_L2_error = 0.0;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe, qf_cell, <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        fe_values.<a class="code" href="classFEValues.html#a21f914e63d588e2652a9514620653d77">reinit</a>(cell);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">          quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point : fe_values.<a class="code" href="classFEValuesBase.html#aada8380792b5e6a1f91dcba94b558cb8">quadrature_point_indices</a>())</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> det_F_qp   = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> J_tilde_qp = lqph[q_point]-&gt;get_J_tilde();</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> the_error_qp_squared =</div>
<div class="line">              <a class="code" href="numbers_8h.html#af44aee1db5cdcd0bab54e3c011d2be66">std::pow</a>((det_F_qp - J_tilde_qp), 2);</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = fe_values.<a class="code" href="classFEValuesBase.html#abade89efb068b71b7ced7082012a2441">JxW</a>(q_point);</div>
<div class="line"> </div>
<div class="line">            dil_L2_error += the_error_qp_squared * JxW;</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> std::make_pair(std::sqrt(dil_L2_error),</div>
<div class="line">                          compute_vol_current() / vol_reference);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_residual(Errors &amp;error_residual)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> error_res(dofs_per_block);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++i)</div>
<div class="line">      <span class="keywordflow">if</span> (!constraints.<a class="code" href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">is_constrained</a>(i))</div>
<div class="line">        error_res(i) = system_rhs(i);</div>
<div class="line"> </div>
<div class="line">    error_residual.norm = error_res.l2_norm();</div>
<div class="line">    error_residual.u    = error_res.block(u_dof).l2_norm();</div>
<div class="line">    error_residual.p    = error_res.block(p_dof).l2_norm();</div>
<div class="line">    error_residual.J    = error_res.block(J_dof).l2_norm();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::get_error_update(<span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update,</div>
<div class="line">                                    Errors &amp;                   error_update)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> error_ud(dofs_per_block);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++i)</div>
<div class="line">      <span class="keywordflow">if</span> (!constraints.<a class="code" href="classAffineConstraints.html#a885d18f0044979873f5e5a6f33772f73">is_constrained</a>(i))</div>
<div class="line">        error_ud(i) = newton_update(i);</div>
<div class="line"> </div>
<div class="line">    error_update.norm = error_ud.l2_norm();</div>
<div class="line">    error_update.u    = error_ud.block(u_dof).l2_norm();</div>
<div class="line">    error_update.p    = error_ud.block(p_dof).l2_norm();</div>
<div class="line">    error_update.J    = error_ud.block(J_dof).l2_norm();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> Solid&lt;dim&gt;::get_total_solution(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;solution_delta)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution_total(solution_n);</div>
<div class="line">    solution_total += solution_delta;</div>
<div class="line">    <span class="keywordflow">return</span> solution_total;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system()</div>
<div class="line">  {</div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Assemble system&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; ASM_SYS &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    tangent_matrix = 0.0;</div>
<div class="line">    system_rhs     = 0.0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_cell(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> |</div>
<div class="line">                              <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> uf_face(<a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> |</div>
<div class="line">                              <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>);</div>
<div class="line"> </div>
<div class="line">    PerTaskData_ASM per_task_data(dofs_per_cell);</div>
<div class="line">    ScratchData_ASM scratch_data(fe, qf_cell, uf_cell, qf_face, uf_face);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(</div>
<div class="line">      dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">      [<span class="keyword">this</span>](<span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">             ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">             PerTaskData_ASM &amp;                                     data) {</div>
<div class="line">        this-&gt;assemble_system_one_cell(cell, scratch, data);</div>
<div class="line">      },</div>
<div class="line">      [<span class="keyword">this</span>](<span class="keyword">const</span> PerTaskData_ASM &amp;data) {</div>
<div class="line">        this-&gt;constraints.distribute_local_to_global(data.cell_matrix,</div>
<div class="line">                                                     data.cell_rhs,</div>
<div class="line">                                                     data.local_dof_indices,</div>
<div class="line">                                                     tangent_matrix,</div>
<div class="line">                                                     system_rhs);</div>
<div class="line">      },</div>
<div class="line">      scratch_data,</div>
<div class="line">      per_task_data);</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_system_one_cell(</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">    ScratchData_ASM &amp;                                     scratch,</div>
<div class="line">    PerTaskData_ASM &amp;                                     data)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    data.reset();</div>
<div class="line">    scratch.reset();</div>
<div class="line">    scratch.fe_values.reinit(cell);</div>
<div class="line">    cell-&gt;get_dof_indices(data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;std::shared_ptr&lt;const PointHistory&lt;dim&gt;&gt;&gt; lqph =</div>
<div class="line">      quadrature_point_history.<a class="code" href="classCellDataStorage.html#ac9702fd0e031af11ccdc28e7908ec487">get_data</a>(cell);</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(lqph.size() == n_q_points, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">         scratch.fe_values.quadrature_point_indices())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a> F_inv = lqph[q_point]-&gt;get_F_inv();</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k : scratch.fe_values.dof_indices())</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(k).first.first;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (k_group == u_dof)</div>
<div class="line">              {</div>
<div class="line">                scratch.grad_Nx[q_point][k] =</div>
<div class="line">                  scratch.fe_values[u_fe].gradient(k, q_point) * F_inv;</div>
<div class="line">                scratch.symm_grad_Nx[q_point][k] =</div>
<div class="line">                  <a class="code" href="classSymmetricTensor.html#a1b2101a1d45267f1fd4664ed178cb636">symmetrize</a>(scratch.grad_Nx[q_point][k]);</div>
<div class="line">              }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == p_dof)</div>
<div class="line">              scratch.Nx[q_point][k] =</div>
<div class="line">                scratch.fe_values[p_fe].value(k, q_point);</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_group == J_dof)</div>
<div class="line">              scratch.Nx[q_point][k] =</div>
<div class="line">                scratch.fe_values[J_fe].value(k, q_point);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(k_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point :</div>
<div class="line">         scratch.fe_values.quadrature_point_indices())</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> tau     = lqph[q_point]-&gt;get_tau();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;2, dim&gt;</a>          tau_ns  = lqph[q_point]-&gt;get_tau();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;4, dim&gt;</a> Jc      = lqph[q_point]-&gt;get_Jc();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                  det_F   = lqph[q_point]-&gt;get_det_F();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                  p_tilde = lqph[q_point]-&gt;get_p_tilde();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                  J_tilde = lqph[q_point]-&gt;get_J_tilde();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> dPsi_vol_dJ   = lqph[q_point]-&gt;get_dPsi_vol_dJ();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> d2Psi_vol_dJ2 = lqph[q_point]-&gt;get_d2Psi_vol_dJ2();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> &amp;I =</div>
<div class="line">          <a class="code" href="classPhysics_1_1Elasticity_1_1StandardTensors.html">Physics::Elasticity::StandardTensors&lt;dim&gt;::I</a>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classSymmetricTensor.html">SymmetricTensor&lt;2, dim&gt;</a> symm_grad_Nx_i_x_Jc;</div>
<div class="line">        <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>          grad_Nx_i_comp_i_x_tau;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;double&gt; &amp;                 <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> = scratch.Nx[q_point];</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt; &amp;symm_grad_Nx =</div>
<div class="line">          scratch.symm_grad_Nx[q_point];</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;Tensor&lt;2, dim&gt;&gt; &amp;grad_Nx = scratch.grad_Nx[q_point];</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                       JxW = scratch.fe_values.JxW(q_point);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">              fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group = fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(i).first.first;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">              data.cell_rhs(i) -= (symm_grad_Nx[i] * tau) * JxW;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == p_dof)</div>
<div class="line">              data.cell_rhs(i) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * (det_F - J_tilde) * JxW;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_group == J_dof)</div>
<div class="line">              data.cell_rhs(i) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * (dPsi_vol_dJ - p_tilde) * JxW;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(i_group &lt;= J_dof, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">              {</div>
<div class="line">                symm_grad_Nx_i_x_Jc    = symm_grad_Nx[i] * Jc;</div>
<div class="line">                grad_Nx_i_comp_i_x_tau = grad_Nx[i][component_i] * tau_ns;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j :</div>
<div class="line">                 scratch.fe_values.dof_indices_ending_at(i))</div>
<div class="line">              {</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_j =</div>
<div class="line">                  fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(j).first;</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j_group =</div>
<div class="line">                  fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(j).first.first;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> ((i_group == j_group) &amp;&amp; (i_group == u_dof))</div>
<div class="line">                  {</div>
<div class="line">                    data.cell_matrix(i, j) += symm_grad_Nx_i_x_Jc *  </div>
<div class="line">                                              symm_grad_Nx[j] * JxW; </div>
<div class="line"> </div>
<div class="line">                    <span class="keywordflow">if</span> (component_i == component_j)</div>
<div class="line">                      data.cell_matrix(i, j) +=</div>
<div class="line">                        grad_Nx_i_comp_i_x_tau * grad_Nx[j][component_j] * JxW;</div>
<div class="line">                  }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == p_dof) &amp;&amp; (j_group == u_dof))</div>
<div class="line">                  {</div>
<div class="line">                    data.cell_matrix(i, j) += <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * det_F *               </div>
<div class="line">                                              (symm_grad_Nx[j] * I) * JxW; </div>
<div class="line">                  }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == J_dof) &amp;&amp; (j_group == p_dof))</div>
<div class="line">                  data.cell_matrix(i, j) -= <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[j] * JxW;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_group == j_group) &amp;&amp; (i_group == J_dof))</div>
<div class="line">                  data.cell_matrix(i, j) += <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[i] * d2Psi_vol_dJ2 * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>[j] * JxW;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>((i_group &lt;= J_dof) &amp;&amp; (j_group &lt;= J_dof),</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>());</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;face : cell-&gt;face_iterators())</div>
<div class="line">      <span class="keywordflow">if</span> (face-&gt;at_boundary() &amp;&amp; face-&gt;boundary_id() == 6)</div>
<div class="line">        {</div>
<div class="line">          scratch.fe_face_values.reinit(cell, face);</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> f_q_point :</div>
<div class="line">               scratch.fe_face_values.quadrature_point_indices())</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> &amp;<a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a> =</div>
<div class="line">                scratch.fe_face_values.normal_vector(f_q_point);</div>
<div class="line"> </div>
<div class="line">              <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> p0 =</div>
<div class="line">                -4.0 / (parameters.scale * parameters.scale);</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         time_ramp = (time.current() / time.end());</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span>         pressure  = p0 * parameters.p_p0 * time_ramp;</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> traction  = pressure * <a class="code" href="namespaceLAPACKSupport.html#a8edacd69ab93285f82b7f63c733a86b7">N</a>;</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">                {</div>
<div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_group =</div>
<div class="line">                    fe.<a class="code" href="classFiniteElement.html#ad88459d21a0e6c8b8882eb5dc981cf31">system_to_base_index</a>(i).first.first;</div>
<div class="line"> </div>
<div class="line">                  <span class="keywordflow">if</span> (i_group == u_dof)</div>
<div class="line">                    {</div>
<div class="line">                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                        fe.<a class="code" href="classFiniteElement.html#a23200d54e40cd719a183d47b6cfb719f">system_to_component_index</a>(i).first;</div>
<div class="line">                      <span class="keyword">const</span> <span class="keywordtype">double</span> Ni =</div>
<div class="line">                        scratch.fe_face_values.shape_value(i, f_q_point);</div>
<div class="line">                      <span class="keyword">const</span> <span class="keywordtype">double</span> JxW = scratch.fe_face_values.JxW(f_q_point);</div>
<div class="line"> </div>
<div class="line">                      data.cell_rhs(i) += (Ni * traction[component_i]) * JxW;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i : scratch.fe_values.dof_indices())</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j :</div>
<div class="line">           scratch.fe_values.dof_indices_starting_at(i + 1))</div>
<div class="line">        data.cell_matrix(i, j) = data.cell_matrix(j, i);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::make_constraints(<span class="keyword">const</span> <span class="keywordtype">int</span> it_nr)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> apply_dirichlet_bc = (it_nr == 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (it_nr &gt; 1)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; --- &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; CST &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (apply_dirichlet_bc)</div>
<div class="line">      {</div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> x_displacement(0);</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> y_displacement(1);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 0;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement));</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 2;</div>
<div class="line"> </div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">            dof_handler,</div>
<div class="line">            <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">            <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">            constraints,</div>
<div class="line">            fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(y_displacement));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (dim == 3)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> z_displacement(2);</div>
<div class="line"> </div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 3;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement) |</div>
<div class="line">                 fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement)));</div>
<div class="line">            }</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 4;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement));</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 6;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement) |</div>
<div class="line">                 fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(z_displacement)));</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          {</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 3;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement)));</div>
<div class="line">            }</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a> = 6;</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">                dof_handler,</div>
<div class="line">                <a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>,</div>
<div class="line">                <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(n_components),</div>
<div class="line">                constraints,</div>
<div class="line">                (fe.<a class="code" href="classFiniteElement.html#a4409f54175f279ac24cc982cfcfcbd2f">component_mask</a>(x_displacement)));</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (constraints.<a class="code" href="classAffineConstraints.html#a0df947a828e8496cd04087c58b382da5">has_inhomogeneities</a>())</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> homogeneous_constraints(constraints);</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof = 0; dof != dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(); ++dof)</div>
<div class="line">              <span class="keywordflow">if</span> (homogeneous_constraints.is_inhomogeneously_constrained(dof))</div>
<div class="line">                homogeneous_constraints.set_inhomogeneity(dof, 0.0);</div>
<div class="line"> </div>
<div class="line">            constraints.<a class="code" href="classAffineConstraints.html#addd15bc409c61d6f795f0132c574335b">clear</a>();</div>
<div class="line">            constraints.<a class="code" href="classAffineConstraints.html#ac15d04ef931b4ff581b9a4b3d7b5123e">copy_from</a>(homogeneous_constraints);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    constraints.<a class="code" href="classAffineConstraints.html#a1611aa37f754086388ca76bcd421cce5">close</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_sc()</div>
<div class="line">  {</div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Perform static condensation&quot;</span>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; ASM_SC &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    PerTaskData_SC per_task_data(dofs_per_cell,</div>
<div class="line">                                 element_indices_u.size(),</div>
<div class="line">                                 element_indices_p.size(),</div>
<div class="line">                                 element_indices_J.size());</div>
<div class="line">    ScratchData_SC scratch_data;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>(dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>(),</div>
<div class="line">                    *<span class="keyword">this</span>,</div>
<div class="line">                    &amp;Solid::assemble_sc_one_cell,</div>
<div class="line">                    &amp;Solid::copy_local_to_global_sc,</div>
<div class="line">                    scratch_data,</div>
<div class="line">                    per_task_data);</div>
<div class="line"> </div>
<div class="line">    timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::copy_local_to_global_sc(<span class="keyword">const</span> PerTaskData_SC &amp;data)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">        tangent_matrix.<a class="code" href="group__Matrix1.html#gad8fe7a35a3336d251a4b3aa2c3ed9748">add</a>(data.local_dof_indices[i],</div>
<div class="line">                           data.local_dof_indices[j],</div>
<div class="line">                           data.cell_matrix(i, j));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::assemble_sc_one_cell(</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="group__Iterators.html#ga6b8bbcafed8847f3030ea30c6990eb2d">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell,</div>
<div class="line">    ScratchData_SC &amp;                                      scratch,</div>
<div class="line">    PerTaskData_SC &amp;                                      data)</div>
<div class="line">  {</div>
<div class="line">    data.reset();</div>
<div class="line">    scratch.reset();</div>
<div class="line">    cell-&gt;get_dof_indices(data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    data.k_orig.extract_submatrix_from(tangent_matrix,</div>
<div class="line">                                       data.local_dof_indices,</div>
<div class="line">                                       data.local_dof_indices);</div>
<div class="line">    data.k_pu.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                     element_indices_p,</div>
<div class="line">                                     element_indices_u);</div>
<div class="line">    data.k_pJ.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                     element_indices_p,</div>
<div class="line">                                     element_indices_J);</div>
<div class="line">    data.k_JJ.extract_submatrix_from(data.k_orig,</div>
<div class="line">                                     element_indices_J,</div>
<div class="line">                                     element_indices_J);</div>
<div class="line"> </div>
<div class="line">    data.k_pJ_inv.invert(data.k_pJ);</div>
<div class="line"> </div>
<div class="line">    data.k_pJ_inv.mmult(data.A, data.k_pu);</div>
<div class="line">    data.k_JJ.mmult(data.B, data.A);</div>
<div class="line">    data.k_pJ_inv.Tmmult(data.C, data.B);</div>
<div class="line">    data.k_pu.Tmmult(data.k_bbar, data.C);</div>
<div class="line">    data.k_bbar.scatter_matrix_to(element_indices_u,</div>
<div class="line">                                  element_indices_u,</div>
<div class="line">                                  data.cell_matrix);</div>
<div class="line"> </div>
<div class="line">    data.k_pJ_inv.add(-1.0, data.k_pJ);</div>
<div class="line">    data.k_pJ_inv.scatter_matrix_to(element_indices_p,</div>
<div class="line">                                    element_indices_J,</div>
<div class="line">                                    data.cell_matrix);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::pair&lt;unsigned int, double&gt;</div>
<div class="line">  Solid&lt;dim&gt;::solve_linear_system(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;newton_update)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lin_it  = 0;</div>
<div class="line">    <span class="keywordtype">double</span>       lin_res = 0.0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (parameters.use_static_condensation == <span class="keyword">true</span>)</div>
<div class="line">      {</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>(dofs_per_block);</div>
<div class="line">        <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> B(dofs_per_block);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          assemble_sc();</div>
<div class="line"> </div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof), system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof));</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(B.block(J_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) -= B.block(J_dof);</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">Tvmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, p_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(u_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof));</div>
<div class="line">          system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof) -= <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(u_dof);</div>
<div class="line"> </div>
<div class="line">          timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">          <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;CG&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">              <span class="keyword">const</span> <span class="keyword">auto</span> solver_its = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line">                tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                parameters.max_iterations_lin);</div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> tol_sol =</div>
<div class="line">                parameters.tol_lin * system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof).l2_norm();</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(solver_its, tol_sol);</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="classGrowingVectorMemory.html">GrowingVectorMemory&lt;Vector&lt;double&gt;</a>&gt; GVM;</div>
<div class="line">              <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; solver_CG(solver_control, GVM);</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">                preconditioner(parameters.preconditioner_type,</div>
<div class="line">                               parameters.preconditioner_relaxation);</div>
<div class="line">              preconditioner.use_matrix(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line"> </div>
<div class="line">              solver_CG.solve(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof),</div>
<div class="line">                              newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                              system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                              preconditioner);</div>
<div class="line"> </div>
<div class="line">              lin_it  = solver_control.last_step();</div>
<div class="line">              lin_res = solver_control.last_value();</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;Direct&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">              <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">              A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line">              A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof),</div>
<div class="line">                             system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof));</div>
<div class="line"> </div>
<div class="line">              lin_it  = 1;</div>
<div class="line">              lin_res = 0.0;</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Linear solver type not implemented&quot;</span>));</div>
<div class="line"> </div>
<div class="line">          timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; PP &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, u_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof), newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof));</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof) *= -1.0;</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof) += system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(p_dof));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a7706b5f721efc5ea1966f5a5cdaad0e6">vmult</a>(<a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof), newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof));</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) *= -1.0;</div>
<div class="line">          <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof) += system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line">          tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, J_dof)</div>
<div class="line">            .<a class="code" href="classSparseMatrix.html#a224a78133e7b655e3a2c26647097c2c7">Tvmult</a>(newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof), <a class="code" href="namespaceLAPACKSupport.html#a40707d49114d54318c823f3b750e89a4">A</a>.block(J_dof));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; ------ &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver&quot;</span>);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; SLV &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;CG&quot;</span>)</div>
<div class="line">          {</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_u = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof);</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_p = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;f_J = system_rhs.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_u = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(u_dof);</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_p = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(p_dof);</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a> &amp;d_J = newton_update.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(J_dof);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_uu =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_up =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, p_dof));</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_pu =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(p_dof, u_dof));</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_Jp =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof));</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_JJ =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga6b74b7ed76e4aeea2c67c0bbb03e3e24">linear_operator</a>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, J_dof));</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">              preconditioner_K_Jp_inv(<span class="stringliteral">&quot;jacobi&quot;</span>);</div>
<div class="line">            preconditioner_K_Jp_inv.use_matrix(</div>
<div class="line">              tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof));</div>
<div class="line">            <a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_Jp_inv(</div>
<div class="line">              <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(J_dof, p_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                                        parameters.max_iterations_lin),</div>
<div class="line">              1.0e-30,</div>
<div class="line">              parameters.tol_lin);</div>
<div class="line">            <a class="code" href="classSolverSelector.html">SolverSelector&lt;Vector&lt;double&gt;</a>&gt; solver_K_Jp_inv;</div>
<div class="line">            solver_K_Jp_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(<span class="stringliteral">&quot;cg&quot;</span>);</div>
<div class="line">            solver_K_Jp_inv.<a class="code" href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">set_control</a>(solver_control_K_Jp_inv);</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_Jp_inv =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_Jp, solver_K_Jp_inv, preconditioner_K_Jp_inv);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_pJ_inv     = <a class="code" href="group__LAOperators.html#ga6bdc65fb2db56230e6bc7d545e81295d">transpose_operator</a>(K_Jp_inv);</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_pp_bar     = K_Jp_inv * K_JJ * K_pJ_inv;</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_bar_bar = K_up * K_pp_bar * K_pu;</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con     = K_uu + K_uu_bar_bar;</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classPreconditionSelector.html">PreconditionSelector&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;</div>
<div class="line">              preconditioner_K_con_inv(parameters.preconditioner_type,</div>
<div class="line">                                       parameters.preconditioner_relaxation);</div>
<div class="line">            preconditioner_K_con_inv.use_matrix(</div>
<div class="line">              tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof));</div>
<div class="line">            <a class="code" href="classReductionControl.html">ReductionControl</a> solver_control_K_con_inv(</div>
<div class="line">              <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(tangent_matrix.<a class="code" href="group__Matrix1.html#ga1e54eb8c095bf2191a29c36a7784a5b6">block</a>(u_dof, u_dof).<a class="code" href="classSparseMatrix.html#acff5838afad6b9d4cc0c0eb5f6c515b5">m</a>() *</div>
<div class="line">                                        parameters.max_iterations_lin),</div>
<div class="line">              1.0e-30,</div>
<div class="line">              parameters.tol_lin);</div>
<div class="line">            <a class="code" href="classSolverSelector.html">SolverSelector&lt;Vector&lt;double&gt;</a>&gt; solver_K_con_inv;</div>
<div class="line">            solver_K_con_inv.<a class="code" href="classSolverSelector.html#a3da215c843356cdab3b603ce98991b53">select</a>(<span class="stringliteral">&quot;cg&quot;</span>);</div>
<div class="line">            solver_K_con_inv.<a class="code" href="classSolverSelector.html#a5732b402440fb4d9494e431254b3b15e">set_control</a>(solver_control_K_con_inv);</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> K_uu_con_inv =</div>
<div class="line">              <a class="code" href="group__LAOperators.html#ga87e38fbde431397c069a88692bd24ae7">inverse_operator</a>(K_uu_con,</div>
<div class="line">                               solver_K_con_inv,</div>
<div class="line">                               preconditioner_K_con_inv);</div>
<div class="line"> </div>
<div class="line">            d_u =</div>
<div class="line">              K_uu_con_inv * (f_u - K_up * (K_Jp_inv * f_J - K_pp_bar * f_p));</div>
<div class="line"> </div>
<div class="line">            timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">            timer.<a class="code" href="classTimerOutput.html#ae730ff220ae414208dc85e76920c3e45">enter_subsection</a>(<span class="stringliteral">&quot;Linear solver postprocessing&quot;</span>);</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; PP &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">            d_J = K_pJ_inv * (f_p - K_pu * d_u);</div>
<div class="line">            d_p = K_Jp_inv * (f_J - K_JJ * d_J);</div>
<div class="line"> </div>
<div class="line">            lin_it  = solver_control_K_con_inv.last_step();</div>
<div class="line">            lin_res = solver_control_K_con_inv.last_value();</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters.type_lin == <span class="stringliteral">&quot;Direct&quot;</span>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">            A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(tangent_matrix);</div>
<div class="line">            A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(newton_update, system_rhs);</div>
<div class="line"> </div>
<div class="line">            lin_it  = 1;</div>
<div class="line">            lin_res = 0.0;</div>
<div class="line"> </div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -- &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Linear solver type not implemented&quot;</span>));</div>
<div class="line"> </div>
<div class="line">        timer.<a class="code" href="classTimerOutput.html#a4d27dbc569819f3bbcb5e066e47212ea">leave_subsection</a>();</div>
<div class="line"> </div>
<div class="line">        constraints.<a class="code" href="classAffineConstraints.html#a7b3d3f295bb56d6cd6856bdc6cbe8a01">distribute</a>(newton_update);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> std::make_pair(lin_it, lin_res);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> Solid&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">      data_component_interpretation(</div>
<div class="line">        dim, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">    data_component_interpretation.push_back(</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line">    data_component_interpretation.push_back(</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::string&gt; solution_name(dim, <span class="stringliteral">&quot;displacement&quot;</span>);</div>
<div class="line">    solution_name.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line">    solution_name.emplace_back(<span class="stringliteral">&quot;dilatation&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> output_flags;</div>
<div class="line">    output_flags.<a class="code" href="group__Exceptions.html#gaa9dd1830c0ff35a2431704c4d45453eb">write_higher_order_cells</a> = <span class="keyword">true</span>;</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">set_flags</a>(output_flags);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_n,</div>
<div class="line">                             solution_name,</div>
<div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                             data_component_interpretation);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> soln(solution_n.<a class="code" href="group__Exceptions.html#ga69b8dc1f71903659eb44f12e02359ac6">size</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; soln.size(); ++i)</div>
<div class="line">      soln(i) = solution_n(i);</div>
<div class="line">    <a class="code" href="classMappingQEulerian.html">MappingQEulerian&lt;dim&gt;</a> q_mapping(degree, dof_handler, soln);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>(q_mapping, degree);</div>
<div class="line"> </div>
<div class="line">    std::ofstream output(<span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(dim) + <span class="stringliteral">&quot;d-&quot;</span> +</div>
<div class="line">                         <a class="code" href="group__Exceptions.html#ga72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(time.get_timestep()) + <span class="stringliteral">&quot;.vtu&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace Step44</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span>Step44;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 3;</div>
<div class="line">      Solid&lt;dim&gt;         solid(<span class="stringliteral">&quot;parameters.prm&quot;</span>);</div>
<div class="line">      solid.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="asymmetric__tensor_8h_html_a31fa20712aae4f3b8ab9f62729b464d3"><div class="ttname"><a href="symmetric__tensor_8h.html#a31fa20712aae4f3b8ab9f62729b464d3">determinant</a></div><div class="ttdeci">constexpr Number determinant(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02622">symmetric_tensor.h:2622</a></div></div>
<div class="ttc" id="asymmetric__tensor_8h_html_a3656e2f6095f612536b06139a6a2ca39"><div class="ttname"><a href="symmetric__tensor_8h.html#a3656e2f6095f612536b06139a6a2ca39">invert</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 2, dim, Number &gt; invert(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03415">symmetric_tensor.h:3415</a></div></div>
<div class="ttc" id="asymmetric__tensor_8h_html_a4248760c880275bab1f288fc80f27039"><div class="ttname"><a href="symmetric__tensor_8h.html#a4248760c880275bab1f288fc80f27039">trace</a></div><div class="ttdeci">constexpr Number trace(const SymmetricTensor&lt; 2, dim2, Number &gt; &amp;)</div></div>
<div class="ttc" id="asymmetric__tensor_8h_html_a8c727eebb2d3d1870cbf4e77a3f45a6b"><div class="ttname"><a href="symmetric__tensor_8h.html#a8c727eebb2d3d1870cbf4e77a3f45a6b">outer_product</a></div><div class="ttdeci">constexpr SymmetricTensor&lt; 4, dim, Number &gt; outer_product(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t1, const SymmetricTensor&lt; 2, dim, Number &gt; &amp;t2)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l03466">symmetric_tensor.h:3466</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
