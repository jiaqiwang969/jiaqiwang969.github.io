<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_23.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-23 tutorial program 。</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.3.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.3.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-23 tutorial program 。 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>本教程取决于 <a class="el" href="step_4.html">step-4</a> 。</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Timediscretization">Time discretization</a><a href="#Timediscretization">Time discretization</a>
      <ul>
        <li><a href="#MethodoflinesorRothesmethod">Method of lines or Rothe's method?</a><a href="#MethodoflinesorRothesmethod">Method of lines or Rothe's method?</a>
        <li><a href="#Rothesmethod">Rothe's method!</a><a href="#Rothesmethod">Rothe's method!</a>
      </ul>
        <li><a href="#Spacediscretization">Space discretization</a><a href="#Spacediscretization">Space discretization</a>
        <li><a href="#Energyconservation">Energy conservation</a><a href="#Energyconservation">Energy conservation</a>
        <li><a href="#WhoareCourantFriedrichsandLewy">Who are Courant, Friedrichs, and Lewy?</a><a href="#WhoareCourantFriedrichsandLewy">Who are Courant, Friedrichs, and Lewy?</a>
        <li><a href="#Thetestcase">The test case</a><a href="#Thetestcase">The test case</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a><a href="#Includefiles">Include files</a>
        <li><a href="#ThecodeWaveEquationcodeclass">The <code>WaveEquation</code> class</a><a href="#ThecodeWaveEquationcodeclass">The <code>WaveEquation</code> class</a>
        <li><a href="#Equationdata">Equation data</a><a href="#Equationdata">Equation data</a>
        <li><a href="#ImplementationofthecodeWaveEquationcodeclass">Implementation of the <code>WaveEquation</code> class</a><a href="#ImplementationofthecodeWaveEquationcodeclass">Implementation of the <code>WaveEquation</code> class</a>
      <ul>
        <li><a href="#WaveEquationsetup_system">WaveEquation::setup_system</a><a href="#WaveEquationsetup_system">WaveEquation::setup_system</a>
        <li><a href="#WaveEquationsolve_uandWaveEquationsolve_v">WaveEquation::solve_u and WaveEquation::solve_v</a><a href="#WaveEquationsolve_uandWaveEquationsolve_v">WaveEquation::solve_u and WaveEquation::solve_v</a>
        <li><a href="#WaveEquationoutput_results">WaveEquation::output_results</a><a href="#WaveEquationoutput_results">WaveEquation::output_results</a>
        <li><a href="#WaveEquationrun">WaveEquation::run</a><a href="#WaveEquationrun">WaveEquation::run</a>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main</code> function</a><a href="#Thecodemaincodefunction">The <code>main</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
</p>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<dl class="section note"><dt>Note</dt><dd>The material presented here is also discussed in <a href="http://www.math.colostate.edu/~bangerth/videos.676.28.html">video lecture 28</a>. (All video lectures are also available <a href="http://www.math.colostate.edu/~bangerth/videos.html">here</a>.) <br  />
</dd></dl>
<p>这是一系列教程程序中的第一个，将最终涵盖 "真正的 "时间依赖问题，而不是在 <a class="el" href="step_18.html">step-18</a> 或 <a class="el" href="step_21.html">step-21</a> 的 DAE 模型中发现的稍微奇怪的时间依赖形式。特别是，这个程序介绍了有界域中的波浪方程。以后， <a class="el" href="step_24.html">step-24</a> 将考虑一个吸收边界条件的例子， <a class="el" href="step_25.html">@ref step_25 </a>step-25"  " 一种产生称为孤子的解决方案的非线性波方程。</p>
<p>波浪方程的原型形式如下：找到满足 </p><p class="formulaDsp">
\begin{eqnarray*} \frac{\partial^2 u}{\partial t^2} - \Delta u &amp;=&amp; f \qquad \textrm{in}\ \Omega\times [0,T], \\ u(x,t) &amp;=&amp; g \qquad \textrm{on}\ \partial\Omega\times [0,T], \\ u(x,0) &amp;=&amp; u_0(x) \qquad \textrm{in}\ \Omega, \\ \frac{\partial u(x,0)}{\partial t} &amp;=&amp; u_1(x) \qquad \textrm{in}\ \Omega. \end{eqnarray*}
</p>
<p>的 \(u(x,t), x\in\Omega, t\in[0,T]\) 。</p>
<p>注意，由于这是一个具有二阶时间导数的方程，我们需要提出两个初始条件，一个是解的值，一个是解的时间导数。</p>
<p>在物理上，该方程描述了弹性介质的运动。在二维空间中，我们可以考虑膜在受到力的作用下如何运动。上面的Dirichlet边界条件表明，膜被夹在高度 \(g(x,t)\) 的边界处（这个高度可能也在移动&amp;mdash；想想人们拿着一条毯子上下摇晃）。第一个初始条件等于膜的初始偏转，而第二个初始条件则是它的速度。例如，我们可以想一想，用手指把膜往下推，然后在 \(t=0\) 处让它离开（非零偏转但零初始速度），或者在 \(t=0\) 处用锤子砸它（零偏转但非零速度）。这两种情况都会引起膜的运动。</p>
<p><a class="anchor" id="Timediscretization"></a></p><h3>Time discretization</h3>
<p><a class="anchor" id="MethodoflinesorRothesmethod"></a></p><h4>Method of lines or Rothe's method?</h4>
<p>在数值分析界有一个长期的争论，即时间依赖方程的离散化是否应该首先离散时间变量，导致每个时间步长的静止PDE，然后用标准的有限元技术来解决（这被称为Rothe方法），或者是否应该首先离散空间变量，导致一个大型的常微分方程系统，然后用通常的ODE求解器处理（这被称为线的方法）。</p>
<p>这两种方法都有优点和缺点。传统上，人们更倾向于线段法，因为它允许使用非常发达的高阶ODE求解器，可用于这种方法产生的相当僵硬的ODE，包括步长控制和时间误差的估计。</p>
<p>另一方面，当使用高阶时间步长法时，罗特的方法变得很尴尬，因为人们不得不写下一个PDE，将当前时间步长的解与前一个时间步长的解结合起来，而且可能还有更早的解，导致大量的条款。</p>
<p>由于这些原因，线段法在很长一段时间内是首选的方法。然而，它有一个很大的缺点：如果我们首先对空间变量进行离散化，导致一个大的ODE系统，我们必须一劳永逸地选择一个网格。如果我们愿意这样做，那么这是一个合法的、可能是优越的方法。</p>
<p>另一方面，如果我们看的是波浪方程和其他许多与时间有关的问题，我们会发现，随着时间的推移，解决方案的特征会发生变化。例如，对于波浪方程，我们可能有一个单一的波浪在域中穿行，在波浪的前后，解是平滑的，甚至是恒定的&mdash;自适应性对于这种情况确实有用，但关键是我们需要细化网格的区域会随着时间步数的变化而变化!</p>
<p>如果我们打算走这条路，即为每个时间步长（或一组时间步长）选择不同的网格，那么线的方法就不再合适了：不是得到一个变量数等于有限元网格中未知数的ODE系统，而是我们的未知数数量现在一直在变化，标准ODE求解器当然根本不准备处理这一事实。另一方面，对于Rothe方法，我们只是在每个时间步长得到一个PDE，我们可以选择独立于前一个时间步长的网格进行离散化；这种方法不是没有危险和困难，但至少是一个合理的、定义明确的程序。</p>
<p>由于所有这些原因，在本程序中，我们选择使用Rothe方法进行离散化，即我们首先在时间上进行离散，然后在空间上进行离散。我们实际上根本不会使用自适应网格，因为这涉及到大量的额外代码，但我们将在<a href="#Results">results section below</a>中对此作一些评论。</p>
<p><a class="anchor" id="Rothesmethod"></a></p><h4>Rothe's method!</h4>
<p>鉴于这些考虑，我们将这样进行：让我们首先为这个二阶问题定义一个简单的时间步进方法，然后在第二步做空间离散化，也就是说，我们将遵循Rothe的方法。</p>
<p>对于第一步，让我们先走个小弯路：为了离散化一个二阶时间导数，我们可以直接离散化它，或者我们可以引入一个额外的变量并将系统转化为一阶系统。在许多情况下，这证明是等价的，但处理一阶系统往往更简单。为此，让我们引入 </p><p class="formulaDsp">
\[ v = \frac{\partial u}{\partial t}, \]
</p>
<p>，出于明显的原因，将这个变量称为<em>velocity</em>。然后，我们可以将原来的波浪方程重新表述如下。 </p><p class="formulaDsp">
\begin{eqnarray*} \frac{\partial u}{\partial t} - v &amp;=&amp; 0 \qquad \textrm{in}\ \Omega\times [0,T], \\ \frac{\partial v}{\partial t} - \Delta u &amp;=&amp; f \qquad \textrm{in}\ \Omega\times [0,T], \\ u(x,t) &amp;=&amp; g \qquad \textrm{on}\ \partial\Omega\times [0,T], \\ u(x,0) &amp;=&amp; u_0(x) \qquad \textrm{in}\ \Omega, \\ v(x,0) &amp;=&amp; u_1(x) \qquad \textrm{in}\ \Omega. \end{eqnarray*}
</p>
<p>这种表述的好处是，它现在只包含两个变量的第一时间导数，对于它来说，写下时间步进方案是很简单的。请注意，我们一开始没有 \(v\) 的边界条件。然而，我们可以在边界上强制执行 \(v=\frac{\partial g}{\partial t}\) 。在数值例子中发现，这实际上是必要的：如果不这样做，解决方案看起来并没有特别的错误，但如果不执行这些边界条件，Crank-Nicolson方案并不保存能量。</p>
<p>有了这个公式，让我们引入以下时间离散化，其中上标 \(n\) 表示一个时间步长， \(k=t_n-t_{n-1}\) 是当前时间步长。 </p><p class="formulaDsp">
\begin{eqnarray*} \frac{u^n - u^{n-1}}{k} - \left[\theta v^n + (1-\theta) v^{n-1}\right] &amp;=&amp; 0, \\ \frac{v^n - v^{n-1}}{k} - \Delta\left[\theta u^n + (1-\theta) u^{n-1}\right] &amp;=&amp; \theta f^n + (1-\theta) f^{n-1}. \end{eqnarray*}
</p>
<p> 注意我们在这里引入了一个参数 \(\theta\) 。如果我们选择 \(\theta=0\) ，例如，第一个方程将简化为 \(\frac{u^n - u^{n-1}}{k} - v^{n-1} = 0\) ，这就是众所周知的正向或显式欧拉方法。另一方面，如果我们设定 \(\theta=1\) ，那么我们将得到 \(\frac{u^n - u^{n-1}}{k} - v^n = 0\) ，这对应于后向或隐式欧拉方法。这两种方法都是一阶精确方法。它们实现起来很简单，但其实并不十分精确。</p>
<p>第三种情况是选择 \(\theta=\frac 12\) 。然后上面的第一个方程就会变成 \(\frac{u^n - u^{n-1}}{k} - \frac 12 \left[v^n + v^{n-1}\right] = 0\) 。这种方法被称为Crank-Nicolson方法，它的优点是二阶精确。此外，它还有一个很好的特性，即保留了溶液中的能量（从物理上讲，能量是膜中粒子的动能加上由于局部拉伸而存在的势能的总和；这个量在连续方程中是一个守恒量，但大多数时间步进方案在时间离散化后并不保留它）。由于 \(v^n\) 也出现在 \(u^n\) 的方程中，Crank-Nicolson方案也是隐式的。</p>
<p>在程序中，我们将把 \(\theta\) 作为一个参数，这样就很容易玩弄它。结果部分将显示一些比较不同方案的数值证据。</p>
<p>上面的方程（称为<em>semidiscretized</em>方程，因为我们只离散了时间，而没有离散空间），可以通过消除第一个方程中的 \(v^n\) 和重新排列项来简化一些。然后我们得到 </p><p class="formulaDsp">
\begin{eqnarray*} \left[ 1-k^2\theta^2\Delta \right] u^n &amp;=&amp; \left[ 1+k^2\theta(1-\theta)\Delta\right] u^{n-1} + k v^{n-1} + k^2\theta\left[\theta f^n + (1-\theta) f^{n-1}\right],\\ v^n &amp;=&amp; v^{n-1} + k\Delta\left[ \theta u^n + (1-\theta) u^{n-1}\right] + k\left[\theta f^n + (1-\theta) f^{n-1}\right]. \end{eqnarray*}
</p>
<p> 在这种形式下，我们看到，如果我们得到前一个时间步长的解决方案 \(u^{n-1},v^{n-1}\) ，那么我们可以分别解决变量 \(u^n,v^n\) ，即一次一个。这很方便。此外，我们认识到第一个方程中的算子是正定的，而第二个方程看起来特别简单。</p>
<p><a class="anchor" id="Spacediscretization"></a></p><h3>Space discretization</h3>
<p>现在我们已经导出了方程，将时间 \(u^n(x)\) 的近似（半离散）解 \(u^n(x)\) 及其时间导数 \(v^n(x)\) 与 \(t_{n-1}\) 的前一个时间步骤的解 \(u^{n-1}(x),v^{n-1}(x)\) 联系起来。下一步是使用通常的有限元方法将空间变量离散化。为此，我们将每个方程与一个测试函数相乘，在整个域上进行积分，并在必要时进行部分积分。这就导致了 </p><p class="formulaDsp">
\begin{eqnarray*} (u^n,\varphi) + k^2\theta^2(\nabla u^n,\nabla \varphi) &amp;=&amp; (u^{n-1},\varphi) - k^2\theta(1-\theta)(\nabla u^{n-1},\nabla \varphi) + k(v^{n-1},\varphi) + k^2\theta \left[ \theta (f^n,\varphi) + (1-\theta) (f^{n-1},\varphi) \right], \\ (v^n,\varphi) &amp;=&amp; (v^{n-1},\varphi) - k\left[ \theta (\nabla u^n,\nabla\varphi) + (1-\theta) (\nabla u^{n-1},\nabla \varphi)\right] + k \left[ \theta (f^n,\varphi) + (1-\theta) (f^{n-1},\varphi) \right]. \end{eqnarray*}
</p>
<p>。</p>
<p>然后习惯性地对 \(u^n(x) \approx u^n_h(x) = \sum_i U_i^n\phi_i^n(x)\) 进行近似，其中 \(\phi_i^n(x)\) 是用于 \(n\) 第1个时间步长离散化的形状函数， \(U_i^n\) 是解决方案的未知节点值。类似地， \(v^n(x) \approx v^n_h(x) = \sum_i V_i^n\phi_i^n(x)\) 。最后，我们有前一个时间步骤的解决方案， \(u^{n-1}(x) \approx u^{n-1}_h(x) = \sum_i U_i^{n-1}\phi_i^{n-1}(x)\) 和 \(v^{n-1}(x) \approx v^{n-1}_h(x) = \sum_i V_i^{n-1}\phi_i^{n-1}(x)\) 。请注意，由于在我们到达时间步骤时，前一个时间步骤的解已经被计算出来了 \(n\) , \(U^{n-1},V^{n-1}\) 是已知的。此外，注意上一步的解可能是在不同的网格上计算的，所以我们必须使用形状函数 \(\phi^{n-1}_i(x)\) 。</p>
<p>如果我们将这些展开式插入上述方程，并使用目前网格中的测试函数进行测试，我们得到以下线性系统。 </p><p class="formulaDsp">
\begin{eqnarray*} (M^n + k^2\theta^2 A^n)U^n &amp;=&amp; M^{n,n-1}U^{n-1} - k^2\theta(1-\theta) A^{n,n-1}U^{n-1} + kM^{n,n-1}V^{n-1} + k^2\theta \left[ \theta F^n + (1-\theta) F^{n-1} \right], \\ M^nV^n &amp;=&amp; M^{n,n-1}V^{n-1} - k\left[ \theta A^n U^n + (1-\theta) A^{n,n-1} U^{n-1}\right] + k \left[ \theta F^n + (1-\theta) F^{n-1} \right], \end{eqnarray*}
</p>
<p> 其中 </p><p class="formulaDsp">
\begin{eqnarray*} M^n_{ij} &amp;=&amp; (\phi_i^n, \phi_j^n), \\ A^n_{ij} &amp;=&amp; (\nabla\phi_i^n, \nabla\phi_j^n), \\ M^{n,n-1}_{ij} &amp;=&amp; (\phi_i^n, \phi_j^{n-1}), \\ A^{n,n-1}_{ij} &amp;=&amp; (\nabla\phi_i^n, \nabla\phi_j^{n-1}), \\ F^n_{i} &amp;=&amp; (f^n,\phi_i^n), \\ F^{n-1}_{i} &amp;=&amp; (f^{n-1},\phi_i^n). \end{eqnarray*}
</p>
<p> 为</p>
<p>如果我们解决这两个方程，我们可以将解决方案向前推进一步，并进入下一个时间步骤。</p>
<p>值得注意的是，如果我们在每个时间步长选择相同的网格（事实上我们将在下面的程序中这样做），那么我们在时间步长 \(n\) 和 \(n-1\) 上有相同的形状函数，即 \(\phi^n_i=\phi_i^{n-1}=\phi_i\) 。因此，我们得到 \(M^n=M^{n,n-1}=M\) 和 \(A^n=A^{n,n-1}=A\) 。另一方面，如果我们使用了不同的形状函数，那么我们将不得不计算包含定义在两个网格上的形状函数的积分。这是一个有些混乱的过程，我们在此省略，但在 <a class="el" href="step_28.html">step-28</a> 中有一些详细的处理。</p>
<p>在这些条件下（即网格不改变），我们可以通过基本消除第二个线性系统的解来优化求解过程。我们将在 <a class="el" href="step_25.html">@ref step_25 </a>step-25"  " 程序的介绍中讨论这个问题。</p>
<p><a class="anchor" id="Energyconservation"></a></p><h3>Energy conservation</h3>
<p>比较时间步进方案质量的一个方法是看数值逼近是否保留了连续方程的守恒特性。对于波浪方程来说，自然要看的是能量。通过将波浪方程乘以 \(u_t\) ，对 \(\Omega\) 进行积分，并在必要时进行部分积分，我们发现 </p><p class="formulaDsp">
\[ \frac{d}{d t} \left[\frac 12 \int_\Omega \left(\frac{\partial u}{\partial t}\right)^2 + (\nabla u)^2 \; dx\right] = \int_\Omega f \frac{\partial u}{\partial t} \; dx + \int_{\partial\Omega} n\cdot\nabla u \frac{\partial g}{\partial t} \; dx. \]
</p>
<p> 因此，在没有体力和恒定边界值的情况下，我们得到 </p><p class="formulaDsp">
\[ E(t) = \frac 12 \int_\Omega \left(\frac{\partial u}{\partial t}\right)^2 + (\nabla u)^2 \; dx \]
</p>
<p>是一个守恒量，即一个不随时间变化的量。我们将在每个时间步骤之后计算这个量。我们可以直接看到，如果我们用有限元近似值替换 \(u\) ，用速度的有限元近似值替换 \(\frac{\partial u}{\partial t}\) ，那么 </p><p class="formulaDsp">
\[ E(t_n) = \frac 12 \left&lt;V^n, M^n V^n\right&gt; + \frac 12 \left&lt;U^n, A^n U^n\right&gt;. \]
</p>
<p>正如我们将在结果部分看到的，Crank-Nicolson方案确实保存了能量，而前向和后向Euler方案都没有。</p>
<p><a class="anchor" id="WhoareCourantFriedrichsandLewy"></a></p><h3>Who are Courant, Friedrichs, and Lewy?</h3>
<p>波浪方程的数值求解令人讨厌的原因之一是，显式时间离散化只有在时间步长足够小的情况下才是稳定的。特别是，它与空间网格宽度相耦合 \(h\) 。对于我们这里使用的最低阶离散化，关系为 </p><p class="formulaDsp">
\[ k\le \frac hc \]
</p>
<p>，其中 \(c\) 是波速，在我们的波浪方程公式中，波速已被归一。因此，除非我们使用带有 \(\theta&gt;0\) 的隐式方案，否则如果我们违反这一限制，我们的解在数值上是不稳定的。隐式方案对稳定性没有这个限制，但如果时间步长过大，它们就会变得不准确。</p>
<p>这个条件最早是由Courant, Friedrichs, and Lewy &amp;mdash；在1928年，远在计算机可用于数值计算之前就已经认识到了！（这个结果在德语中出现过。这个结果出现在德语文章R.Courant, K. Friedrichs and H. Lewy: <em>&Uuml;ber die partiellen Differenzengleichungen der mathematischen Physik</em>, Mathematische Annalen, vol. 100, no. 1, pages 32-74, 1928)。这个关于时间步长的条件最常被称为<em>CFL</em>条件。直观地说，CFL条件是指时间步长不能大于一个波穿过一个单元的时间。</p>
<p>在程序中，我们将对正方形 \([-1,1]^2\) 均匀地细化七次，得到一个 \(h=\frac 1{64}\) 的网格大小，这就是我们设定的时间步长。我们在两个不同的地方分别设置时间步长和网格尺寸是很容易出错的：很容易再细化一次网格，却忘记同时调整时间步长。 <a class="el" href="step_24.html">@ref step_24 </a>step-24"  " 显示了一个更好的方法来保持这些东西的同步。</p>
<p><a class="anchor" id="Thetestcase"></a></p><h3>The test case</h3>
<p>尽管程序有所有的钩子来处理非零初始条件和边界条件以及体力，但我们采取一个简单的案例，域是一个正方形 \([-1,1]^2\) 和 </p><p class="formulaDsp">
\begin{eqnarray*} f &amp;=&amp; 0, \\ u_0 &amp;=&amp; 0, \\ u_1 &amp;=&amp; 0, \\ g &amp;=&amp; \left\{\begin{matrix}\sin (4\pi t) &amp;\qquad&amp; \text{for }\ t\le \frac 12, x=-1, -\frac 13&lt;y&lt;\frac 13 \\ 0 &amp;&amp;\text{otherwise} \end{matrix} \right. \end{eqnarray*}
</p>
<p>这相当于一个最初处于静止状态、四周被夹住的膜，有人将被夹住的边界的一部分上下挥动一次，从而向域内射出一个波。<a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>我们从通常的各种各样的包含文件开始，我们在以前的许多测试中都看到过。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="ttc" id="aaffine__constraints_8h_html"><div class="ttname"><a href="affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="adof__tools_8h_html"><div class="ttname"><a href="dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="adynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="afe__q_8h_html"><div class="ttname"><a href="fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="afunction_8h_html"><div class="ttname"><a href="function_8h.html">function.h</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="agrid__generator_8h_html"><div class="ttname"><a href="grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aprecondition_8h_html"><div class="ttname"><a href="precondition_8h.html">precondition.h</a></div></div>
<div class="ttc" id="aquadrature__lib_8h_html"><div class="ttname"><a href="quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="asolver__cg_8h_html"><div class="ttname"><a href="solver__cg_8h.html">solver_cg.h</a></div></div>
<div class="ttc" id="asparse__matrix_8h_html"><div class="ttname"><a href="sparse__matrix_8h.html">sparse_matrix.h</a></div></div>
<div class="ttc" id="avector_8h_html"><div class="ttname"><a href="vector_8h.html">vector.h</a></div></div>
</div><!-- fragment --><p>这里是仅有的三个有一些新兴趣的包含文件。第一个文件已经被使用了，例如，用于 <a class="el" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a> 和 <a class="el" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a> 函数。然而，我们在这里使用该类中的另一个函数， <a class="el" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a> 来计算我们的初始值，作为连续初始值的 \(L^2\) 投影。此外，我们使用 <a class="el" href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a> 来生成积分 \((f^n,\phi^n_i)\) 。这些以前总是由 <code>assemble_system</code> 或应用程序代码中的类似函数手工生成。然而，我们太懒了，不能在这里这么做，所以干脆使用库函数。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="ttc" id="avector__tools_8h_html"><div class="ttname"><a href="vector__tools_8h.html">vector_tools.h</a></div></div>
</div><!-- fragment --><p>与此非常相似，我们也懒得写代码来组装质量矩阵和拉普拉斯矩阵，尽管这只需要从以前任何数量的教程程序中复制相关代码。相反，我们想把重点放在这个程序中真正新的东西上，因此使用了 <a class="el" href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a> 和 <a class="el" href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a> 函数。它们被声明在这里。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="ttc" id="amatrix__tools_8h_html"><div class="ttname"><a href="matrix__tools_8h.html">matrix_tools.h</a></div></div>
</div><!-- fragment --><p>最后，这里有一个include文件，包含了人们有时需要的各种工具函数。特别是，我们需要 <a class="el" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a> 类，该类给定一个整数参数，返回它的字符串表示。它特别有用，因为它允许有第二个参数，表明我们希望结果用前导零填充的数字数。我们将用它来写输出文件，其形式为 <code>solution-XXX.vtu</code> where <code>XXX</code> 表示时间步数，并且总是由三位数组成，即使我们仍然处于个位或两位数的时间步数。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="ttc" id="ainclude_2deal_8II_2base_2utilities_8h_html"><div class="ttname"><a href="include_2deal_8II_2base_2utilities_8h.html">utilities.h</a></div></div>
</div><!-- fragment --><p>最后一步和以前所有的程序一样。</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Step23</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="namespace__dealii_8h_source.html#l00025">namespace_dealii.h:26</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ThecodeWaveEquationcodeclass"></a></p><h3>The <code>WaveEquation</code> class</h3>
<p>接下来是主类的声明。它的公共函数接口与其他大多数教程程序中的一样。值得一提的是，我们现在必须存储四个矩阵，而不是一个：质量矩阵 \(M\) ，拉普拉斯矩阵 \(A\) ，用于求解 \(U^n\) 的矩阵 \(M+k^2\theta^2A\) ，以及用于求解 \(V^n\) 的具有边界条件的质量矩阵副本。请注意，在周围有一个额外的质量矩阵副本是有点浪费的。我们将在可能的改进部分讨论如何避免这种情况的策略。 <br  />
</p>
<p>同样，我们需要 \(U^n,V^n\) 的解向量，以及前一个时间步长的相应向量， \(U^{n-1},V^{n-1}\) 。 <code>system_rhs</code> 将用于我们在每个时间步长中解决两个线性系统之一时的任何右手向量。这些将在两个函数 <code>solve_u</code> 和 <code>solve_v</code> 中得到解决。 <br  />
</p>
<p>最后，变量 <code>theta</code> 用于表示参数 \(\theta\) ，该参数用于定义使用哪种时间步进方案，这在介绍中已经解释过。其余的是不言自明的。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>WaveEquation</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  WaveEquation();</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line">  <span class="keywordtype">void</span> solve_u();</div>
<div class="line">  <span class="keywordtype">void</span> solve_v();</div>
<div class="line">  <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">  <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>          fe;</div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      sparsity_pattern;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> laplace_matrix;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> matrix_u;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> matrix_v;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> solution_u, solution_v;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> old_solution_u, old_solution_v;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span>       time_step;</div>
<div class="line">  <span class="keywordtype">double</span>       time;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep_number;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> theta;</div>
<div class="line">};</div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00314">dof_handler.h:315</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8h_source.html#l00548">fe_q.h:549</a></div></div>
<div class="ttc" id="aclassSparseMatrix_html"><div class="ttname"><a href="classSparseMatrix.html">SparseMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassSparsityPattern_html"><div class="ttname"><a href="classSparsityPattern.html">SparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="sparsity__pattern_8h_source.html#l00868">sparsity_pattern.h:869</a></div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01127">tria.h:1128</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1L2_html_a1c15243765304a803037988b5561627d"><div class="ttname"><a href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">LocalIntegrators::L2::mass_matrix</a></div><div class="ttdeci">void mass_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="l2_8h_source.html#l00058">l2.h:58</a></div></div>
<div class="ttc" id="anamespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00691">work_stream.h:691</a></div></div>
<div class="ttc" id="ap4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Equationdata"></a></p><h3>Equation data</h3>
<p>在我们继续填写主类的细节之前，让我们定义与问题相对应的方程数据，即解 \(u\) 及其时间导数 \(v\) 的初始值和边界值，以及一个右手类。我们使用从Function类模板派生出来的类来做这件事，这个模板以前已经用过很多次了，所以下面的内容不应该是一个惊喜。 <br  />
</p>
<p>让我们从初始值开始，对数值 \(u\) 以及它的时间导数，即速度 \(v\) 都选择零。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>InitialValuesU : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    (void)component;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>InitialValuesV : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    (void)component;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassFunction_html"><div class="ttname"><a href="classFunction.html">Function</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00150">function.h:153</a></div></div>
<div class="ttc" id="aclassFunction_html_acbfcab66b2fc63bfea59268f40772bb4"><div class="ttname"><a href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">Function::value</a></div><div class="ttdeci">virtual RangeNumberType value(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const</div></div>
<div class="ttc" id="aclassPoint_html"><div class="ttname"><a href="classPoint.html">Point</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2point_8h_source.html#l00110">point.h:111</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga0d685aad996180f9851183ae3e29019a"><div class="ttname"><a href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">StandardExceptions::ExcIndexRange</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcIndexRange(int arg1, int arg2, int arg3)</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01473">exceptions.h:1473</a></div></div>
</div><!-- fragment --><p>其次，我们有右手边的强制项。无聊的是，我们在这里也选择零。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    (void)component;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p>最后，我们有［ \(u\) ］和［ \(v\) ］的边界值。它们与介绍中描述的一样，一个是另一个的时间导数。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>BoundaryValuesU : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    (void)component;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((this-&gt;<a class="code" href="classFunctionTime.html#ae7d37ddb04314b38cf67c6cba22923f6">get_time</a>() &lt;= 0.5) &amp;&amp; (p[0] &lt; 0) &amp;&amp; (p[1] &lt; 1. / 3) &amp;&amp;</div>
<div class="line">        (p[1] &gt; -1. / 3))</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">std::sin</a>(this-&gt;<a class="code" href="classFunctionTime.html#ae7d37ddb04314b38cf67c6cba22923f6">get_time</a>() * 4 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>BoundaryValuesV : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    (void)component;</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((this-&gt;<a class="code" href="classFunctionTime.html#ae7d37ddb04314b38cf67c6cba22923f6">get_time</a>() &lt;= 0.5) &amp;&amp; (p[0] &lt; 0) &amp;&amp; (p[1] &lt; 1. / 3) &amp;&amp;</div>
<div class="line">        (p[1] &gt; -1. / 3))</div>
<div class="line">      <span class="keywordflow">return</span> (std::cos(this-&gt;<a class="code" href="classFunctionTime.html#ae7d37ddb04314b38cf67c6cba22923f6">get_time</a>() * 4 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>) * 4 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassFunctionTime_html_ae7d37ddb04314b38cf67c6cba22923f6"><div class="ttname"><a href="classFunctionTime.html#ae7d37ddb04314b38cf67c6cba22923f6">FunctionTime&lt; numbers::NumberTraits&lt; double &gt;::real_type &gt;::get_time</a></div><div class="ttdeci">numbers::NumberTraits&lt; double &gt;::real_type get_time() const</div></div>
<div class="ttc" id="anamespacenumbers_html_a3e24f194a9cb9b6ff4442b8a7a877d4a"><div class="ttname"><a href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a></div><div class="ttdeci">static constexpr double PI</div><div class="ttdef"><b>Definition:</b> <a href="numbers_8h_source.html#l00231">numbers.h:231</a></div></div>
<div class="ttc" id="anumbers_8h_html_a27989bdc7b4b828564982787d126bd91"><div class="ttname"><a href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">std::sin</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; sin(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05291">vectorization.h:5291</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="ImplementationofthecodeWaveEquationcodeclass"></a> </p><h3>Implementation of the <code>WaveEquation</code> class</h3>
<p>实际逻辑的实现实际上是相当短的，因为我们把组装矩阵和右手边的向量等事情交给了库。其余的实际代码不超过130行，其中相当一部分是可以从以前的例子程序中获取的模板代码（例如，解决线性系统的函数，或生成输出的函数）。 <br  />
</p>
<p>让我们从构造函数开始（关于时间步长的选择的解释，请参见介绍中关于Courant、Friedrichs和Lewy的部分）。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">WaveEquation&lt;dim&gt;::WaveEquation()</div>
<div class="line">  : fe(1)</div>
<div class="line">  , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , time_step(1. / 64)</div>
<div class="line">  , time(time_step)</div>
<div class="line">  , timestep_number(1)</div>
<div class="line">  , theta(0.5)</div>
<div class="line">{}</div>
</div><!-- fragment --><p><a class="anchor" id="WaveEquationsetup_system"></a> </p><h4>WaveEquation::setup_system</h4>
<p>下一个函数是在程序开始时，也就是在第一个时间步长之前，设置网格、DoFHandler、矩阵和向量。如果你已经阅读了至少到 <a class="el" href="step_6.html">step-6</a> 为止的教程程序，那么前几行是相当标准的。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> WaveEquation&lt;dim&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>, -1, 1);</div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(7);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Number of active cells: &quot;</span> &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells()</div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dof_handler.distribute_dofs(fe);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.n_dofs()</div>
<div class="line">            &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.n_dofs(), dof_handler.n_dofs());</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line">  sparsity_pattern.copy_from(dsp);</div>
<div class="ttc" id="aclassDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamic__sparsity__pattern_8h_source.html#l00318">dynamic_sparsity_pattern.h:319</a></div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_acea0cbcd68e52ce8113d1134b87de403"><div class="ttname"><a href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube</a></div><div class="ttdeci">void hyper_cube(Triangulation&lt; dim, spacedim &gt; &amp;tria, const double left=0., const double right=1., const bool colorize=false)</div></div>
</div><!-- fragment --><p>然后是我们必须初始化程序过程中需要的3个矩阵：质量矩阵、拉普拉斯矩阵和在每个时间步长中求解 \(U^n\) 时使用的矩阵 \(M+k^2\theta^2A\) 。 <br  />
</p>
<p>在设置这些矩阵时，注意它们都利用了相同的稀疏模式对象。最后，在deal.II中矩阵和稀疏模式是独立对象的原因（与许多其他有限元或线性代数类不同）变得很清楚：在相当一部分应用中，我们必须持有几个恰好具有相同稀疏模式的矩阵，它们没有理由不共享这一信息，而不是重新建立并多次浪费内存。 <br  />
</p>
<p>在初始化所有这些矩阵后，我们调用库函数来建立拉普拉斯和质量矩阵。它们所需要的只是一个DoFHandler对象和一个将用于数值积分的正交公式对象。请注意，在许多方面，这些函数比我们通常在应用程序中做的要好，例如，如果一台机器上有多个处理器，它们会自动并行构建矩阵：更多信息请参见WorkStream的文档或 <a class="el" href="group__threads.html">多处理器的并行计算 </a>模块。解决线性系统的矩阵将在run()方法中被填充，因为我们需要在每个时间步长重新应用边界条件。</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.reinit(sparsity_pattern);</div>
<div class="line">laplace_matrix.reinit(sparsity_pattern);</div>
<div class="line">matrix_u.reinit(sparsity_pattern);</div>
<div class="line">matrix_v.reinit(sparsity_pattern);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a>(dof_handler,</div>
<div class="line">                                  <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                                  <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>);</div>
<div class="line"><a class="code" href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a>(dof_handler,</div>
<div class="line">                                     <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                                     laplace_matrix);</div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00038">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="anamespaceMatrixCreator_html_a7b8157122064151d414dc34a22a3ca9c"><div class="ttname"><a href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a></div><div class="ttdeci">void create_laplace_matrix(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Quadrature&lt; dim &gt; &amp;q, SparseMatrix&lt; double &gt; &amp;matrix, const Function&lt; spacedim &gt; *const a=nullptr, const AffineConstraints&lt; double &gt; &amp;constraints=AffineConstraints&lt; double &gt;())</div></div>
<div class="ttc" id="anamespaceMatrixCreator_html_aab6397f114af66efd781f7f4daba22be"><div class="ttname"><a href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a></div><div class="ttdeci">void create_mass_matrix(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Quadrature&lt; dim &gt; &amp;q, SparseMatrix&lt; number &gt; &amp;matrix, const Function&lt; spacedim, number &gt; *const a=nullptr, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;())</div></div>
</div><!-- fragment --><p>该函数的其余部分用于将矢量大小设置为正确的值。最后一行关闭了悬挂的节点约束对象。由于我们在一个均匀细化的网格上工作，没有约束条件存在，也没有计算过（也就是说，没有必要像其他程序那样调用 <a class="el" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a> ），但无论如何，我们需要在下面的一个地方有一个约束对象。</p>
<div class="fragment"><div class="line">  solution_u.reinit(dof_handler.n_dofs());</div>
<div class="line">  solution_v.reinit(dof_handler.n_dofs());</div>
<div class="line">  old_solution_u.reinit(dof_handler.n_dofs());</div>
<div class="line">  old_solution_v.reinit(dof_handler.n_dofs());</div>
<div class="line">  system_rhs.reinit(dof_handler.n_dofs());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  constraints.close();</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="WaveEquationsolve_uandWaveEquationsolve_v"></a> </p><h4>WaveEquation::solve_u and WaveEquation::solve_v</h4>
<p>接下来的两个函数是解决与 \(U^n\) 和 \(V^n\) 的方程相关的线性系统。这两个函数并不特别有趣，因为它们基本遵循了之前所有教程程序中使用的方案。 <br  />
</p>
<p>我们可以对我们要反转的两个矩阵的预处理程序做一些小实验。然而，事实证明，对于这里的矩阵，使用雅可比或SSOR预处理器可以稍微减少解决线性系统所需的迭代次数，但由于应用预处理器的成本，在运行时间方面并不占优势。这也不是什么损失，但让我们保持简单，只做不做。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> WaveEquation&lt;dim&gt;::solve_u()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8 * system_rhs.l2_norm());</div>
<div class="line">  <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  cg.solve(matrix_u, solution_u, system_rhs, <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;   u-equation: &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; CG iterations.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> WaveEquation&lt;dim&gt;::solve_v()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8 * system_rhs.l2_norm());</div>
<div class="line">  <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  cg.solve(matrix_v, solution_v, system_rhs, <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;   v-equation: &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; CG iterations.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassPreconditionIdentity_html"><div class="ttname"><a href="classPreconditionIdentity.html">PreconditionIdentity</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00079">precondition.h:80</a></div></div>
<div class="ttc" id="aclassSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__cg_8h_source.html#l00095">solver_cg.h:96</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00065">solver_control.h:66</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
</div><!-- fragment --><p><a class="anchor" id="WaveEquationoutput_results"></a> </p><h4>WaveEquation::output_results</h4>
<p>同样，下面的函数也和我们以前做的差不多。唯一值得一提的是，这里我们使用 <a class="el" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a> 函数的第二个参数生成一个用前导零填充的时间步长的字符串表示。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> WaveEquation&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_u, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_v, <span class="stringliteral">&quot;V&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string filename =</div>
<div class="line">    <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(timestep_number, 3) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="ttc" id="aclassDataOut__DoFData_html_ac1eb26168177faa30ffbcf9cbb9c3cd5"><div class="ttname"><a href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandlerType &amp;)</div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_ace4b76e565ba0701c4d32c26075ed3b9"><div class="ttname"><a href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="data__out__dof__data_8h_source.html#l01087">data_out_dof_data.h:1087</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8h_source.html#l00147">data_out.h:150</a></div></div>
<div class="ttc" id="aclassDataOut_html_a5eb51872b8736849bb7e8d2007fae086"><div class="ttname"><a href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01085">data_out.cc:1085</a></div></div>
<div class="ttc" id="anamespaceUtilities_html_a6195c5f009ea8c7c536c6ffdf108c32f"><div class="ttname"><a href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></div><div class="ttdeci">std::string int_to_string(const unsigned int value, const unsigned int digits=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00473">utilities.cc:473</a></div></div>
</div><!-- fragment --><p>像 <a class="el" href="step_15.html">step-15</a> 一样，由于我们在每个时间步长写输出（而且我们要解决的系统相对简单），我们指示DataOut使用zlib压缩算法，该算法是为速度而不是磁盘使用而优化的，因为否则绘制输出就会成为瓶颈。</p>
<div class="fragment"><div class="line">  <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> vtk_flags;</div>
<div class="line">  vtk_flags.<a class="code" href="group__Exceptions.html#ga3be0d6de1c92b770e8664bce2fc7c107">compression_level</a> =</div>
<div class="line">    DataOutBase::VtkFlags::ZlibCompressionLevel::best_speed;</div>
<div class="line">  data_out.<a class="code" href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">set_flags</a>(vtk_flags);</div>
<div class="line">  std::ofstream output(filename);</div>
<div class="line">  data_out.<a class="code" href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Exceptions_html_ga3be0d6de1c92b770e8664bce2fc7c107"><div class="ttname"><a href="group__Exceptions.html#ga3be0d6de1c92b770e8664bce2fc7c107">DataOutBase::VtkFlags::compression_level</a></div><div class="ttdeci">ZlibCompressionLevel compression_level</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01151">data_out_base.h:1151</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga93c780f93105e0daaa76c6c43694b4ae"><div class="ttname"><a href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">DataOutInterface::write_vtu</a></div><div class="ttdeci">void write_vtu(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07188">data_out_base.cc:7188</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gac7280a24690b117454acfb0fa058299c"><div class="ttname"><a href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">DataOutInterface::set_flags</a></div><div class="ttdeci">void set_flags(const FlagType &amp;flags)</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l08166">data_out_base.cc:8166</a></div></div>
<div class="ttc" id="astructDataOutBase_1_1VtkFlags_html"><div class="ttname"><a href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a></div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01087">data_out_base.h:1088</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="WaveEquationrun"></a> </p><h4>WaveEquation::run</h4>
<p>以下是该程序唯一有趣的功能。它包含了所有时间步骤的循环，但在这之前我们必须设置网格、DoFHandler和矩阵。此外，我们必须以某种方式从初始值开始。为此，我们使用 <a class="el" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a> 函数，该函数接收一个描述连续函数的对象，并计算该函数在DoFHandler对象所描述的有限元空间的 \(L^2\) 投影。没有比这更简单的了。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WaveEquation&lt;dim&gt;::run</a>()</div>
<div class="line">{</div>
<div class="line">  setup_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a>(dof_handler,</div>
<div class="line">                       constraints,</div>
<div class="line">                       <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                       InitialValuesU&lt;dim&gt;(),</div>
<div class="line">                       old_solution_u);</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a>(dof_handler,</div>
<div class="line">                       constraints,</div>
<div class="line">                       <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                       InitialValuesV&lt;dim&gt;(),</div>
<div class="line">                       old_solution_v);</div>
<div class="ttc" id="anamespaceVectorTools_html_ac6b404bf03cb2a742b290421cc2789fe"><div class="ttname"><a href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a></div><div class="ttdeci">void project(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const AffineConstraints&lt; typename VectorType::value_type &gt; &amp;constraints, const Quadrature&lt; dim &gt; &amp;quadrature, const Function&lt; spacedim, typename VectorType::value_type &gt; &amp;function, VectorType &amp;vec, const bool enforce_zero_boundary=false, const Quadrature&lt; dim - 1 &gt; &amp;q_boundary=(dim &gt; 1 ? QGauss&lt; dim - 1 &gt;(2) :Quadrature&lt; dim - 1 &gt;(0)), const bool project_to_boundary_first=false)</div></div>
</div><!-- fragment --><p>接下来是循环所有的时间步骤，直到我们到达结束时间（本例中为 \(T=5\) ）。在每个时间步骤中，我们首先要解决 \(U^n\) ，使用方程式 \((M^n + k^2\theta^2 A^n)U^n =\) \((M^{n,n-1} - k^2\theta(1-\theta) A^{n,n-1})U^{n-1} + kM^{n,n-1}V^{n-1} +\) \(k\theta \left[k \theta F^n + k(1-\theta) F^{n-1} \right]\) 。请注意，我们在所有的时间步骤中使用相同的网格，因此 \(M^n=M^{n,n-1}=M\) 和 \(A^n=A^{n,n-1}=A\) 。因此，我们首先要做的是将 \(MU^{n-1} - k^2\theta(1-\theta) AU^{n-1} + kMV^{n-1}\) 和强制项相加，并将结果放入 <code>system_rhs</code> 矢量。对于这些加法，我们需要在循环之前声明一个临时向量，以避免在每个时间步骤中重复分配内存）。</p>
<p>这里要意识到的一点是我们如何将时间变量传达给描述右手边的对象：每个从函数类派生的对象都有一个时间字段，可以用 <a class="el" href="classFunctionTime.html#a3a583fd8f30db3549dbaa43b2592e2bc">Function::set_time</a> 来设置，用 <a class="el" href="classFunctionTime.html#ae7d37ddb04314b38cf67c6cba22923f6">Function::get_time</a>. 来读取。实质上，使用这种机制，所有空间和时间的函数因此被认为是在特定时间评估的空间的函数。这很符合我们在有限元程序中的典型需要，我们几乎总是在一个时间步长上工作，而且从来没有发生过，例如，人们想在任何给定的空间位置为所有时间评估一个时空函数。</p>
<div class="fragment"><div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> tmp(solution_u.size());</div>
<div class="line"><a class="code" href="classVector.html">Vector&lt;double&gt;</a> forcing_terms(solution_u.size());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (; time &lt;= 5; time += time_step, ++timestep_number)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Time step &quot;</span> &lt;&lt; timestep_number &lt;&lt; <span class="stringliteral">&quot; at t=&quot;</span> &lt;&lt; time</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.vmult(system_rhs, old_solution_u);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.vmult(tmp, old_solution_v);</div>
<div class="line">    system_rhs.add(time_step, tmp);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    laplace_matrix.vmult(tmp, old_solution_u);</div>
<div class="line">    system_rhs.add(-theta * (1 - theta) * time_step * time_step, tmp);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    RightHandSide&lt;dim&gt; rhs_function;</div>
<div class="line">    rhs_function.set_time(time);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a>(dof_handler,</div>
<div class="line">                                        <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                                        rhs_function,</div>
<div class="line">                                        tmp);</div>
<div class="line">    forcing_terms = tmp;</div>
<div class="line">    forcing_terms *= theta * time_step;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    rhs_function.set_time(time - time_step);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a>(dof_handler,</div>
<div class="line">                                        <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                                        rhs_function,</div>
<div class="line">                                        tmp);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    forcing_terms.add((1 - theta) * time_step, tmp);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    system_rhs.add(theta * time_step, forcing_terms);</div>
<div class="ttc" id="anamespaceVectorTools_html_a6e325333a138893e181da47f29ac680a"><div class="ttname"><a href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a></div><div class="ttdeci">void create_right_hand_side(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Quadrature&lt; dim &gt; &amp;q, const Function&lt; spacedim, typename VectorType::value_type &gt; &amp;rhs, VectorType &amp;rhs_vector, const AffineConstraints&lt; typename VectorType::value_type &gt; &amp;constraints=AffineConstraints&lt; typename VectorType::value_type &gt;())</div></div>
</div><!-- fragment --><p>在如此构建了第一个方程的右手边向量之后，我们要做的就是应用正确的边界值。至于右手边，这是一个在特定时间评估的时空函数，我们在边界节点插值，然后像我们通常做的那样用结果来应用边界值。然后将结果交给solve_u()函数。</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  BoundaryValuesU&lt;dim&gt; boundary_values_u_function;</div>
<div class="line">  boundary_values_u_function.set_time(time);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::map&lt;types::global_dof_index, double&gt; boundary_values;</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                           0,</div>
<div class="line">                                           boundary_values_u_function,</div>
<div class="line">                                           boundary_values);</div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
</div><!-- fragment --><p>solve_u()的矩阵在每个时间步骤中都是相同的，所以人们可以认为只在模拟开始时做一次就足够了。然而，由于我们需要对线性系统应用边界值（消除了一些矩阵的行和列，并对右手边做出了贡献），在实际应用边界数据之前，我们必须在每个时间步骤中重新填充矩阵。实际内容非常简单：它是质量矩阵和加权拉普拉斯矩阵的总和。</p>
<div class="fragment"><div class="line">  matrix_u.copy_from(<a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>);</div>
<div class="line">  matrix_u.add(theta * theta * time_step * time_step, laplace_matrix);</div>
<div class="line">  <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                     matrix_u,</div>
<div class="line">                                     solution_u,</div>
<div class="line">                                     system_rhs);</div>
<div class="line">}</div>
<div class="line">solve_u();</div>
<div class="ttc" id="anamespaceMatrixTools_html_a9ad0eb7a8662628534586716748d62fb"><div class="ttname"><a href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a></div><div class="ttdeci">void apply_boundary_values(const std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, SparseMatrix&lt; number &gt; &amp;matrix, Vector&lt; number &gt; &amp;solution, Vector&lt; number &gt; &amp;right_hand_side, const bool eliminate_columns=true)</div><div class="ttdef"><b>Definition:</b> <a href="matrix__tools_8cc_source.html#l00081">matrix_tools.cc:81</a></div></div>
</div><!-- fragment --><p>第二步，即求解 \(V^n\) ，工作原理类似，只是这次左边的矩阵是质量矩阵（我们再次复制，以便能够应用边界条件，右边的矩阵是 \(MV^{n-1} - k\left[ \theta A U^n + (1-\theta) AU^{n-1}\right]\) 加上强制项。边界值的应用方式与之前相同，只是现在我们必须使用BoundaryValuesV类。</p>
<div class="fragment"><div class="line">laplace_matrix.vmult(system_rhs, solution_u);</div>
<div class="line">system_rhs *= -theta * time_step;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.vmult(tmp, old_solution_v);</div>
<div class="line">system_rhs += tmp;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">laplace_matrix.vmult(tmp, old_solution_u);</div>
<div class="line">system_rhs.add(-time_step * (1 - theta), tmp);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">system_rhs += forcing_terms;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">  BoundaryValuesV&lt;dim&gt; boundary_values_v_function;</div>
<div class="line">  boundary_values_v_function.set_time(time);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::map&lt;types::global_dof_index, double&gt; boundary_values;</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                           0,</div>
<div class="line">                                           boundary_values_v_function,</div>
<div class="line">                                           boundary_values);</div>
<div class="line">  matrix_v.copy_from(<a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>);</div>
<div class="line">  <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                     matrix_v,</div>
<div class="line">                                     solution_v,</div>
<div class="line">                                     system_rhs);</div>
<div class="line">}</div>
<div class="line">solve_v();</div>
</div><!-- fragment --><p>最后，在计算完两个解的组成部分后，我们输出结果，计算解中的能量，并在将现在的解移入保持前一个时间步长的解的向量后，继续下一个时间步长。注意函数 <a class="el" href="classSparseMatrix.html#a56d106dfe8792db57f2d6e60bdfe63e1">SparseMatrix::matrix_norm_square</a> 可以在一个步骤中计算 \(\left&lt;V^n,MV^n\right&gt;\) 和 \(\left&lt;U^n,AU^n\right&gt;\) ，为我们节省了一个临时向量和几行代码的费用。</p>
<div class="fragment"><div class="line">        output_results();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Total energy: &quot;</span></div>
<div class="line">                  &lt;&lt; (<a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.matrix_norm_square(solution_v) +</div>
<div class="line">                      laplace_matrix.matrix_norm_square(solution_u)) /</div>
<div class="line">                       2</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        old_solution_u = solution_u;</div>
<div class="line">        old_solution_v = solution_v;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step23</span></div>
</div><!-- fragment --><p><a class="anchor" id="Thecodemaincodefunction"></a> </p><h3>The <code>main</code> function</h3>
<p>剩下的就是程序的主要功能了。这里没有什么是在以前的几个程序中没有展示过的。</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span>Step23;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      WaveEquation&lt;2&gt; wave_equation_solver;</div>
<div class="line">      wave_equation_solver.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>当程序运行时，它会产生以下输出。</p>
<div class="fragment"><div class="line">Number of active cells: 16384</div>
<div class="line">Number of degrees of freedom: 16641</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Time step 1 at t=0.015625</div>
<div class="line">   u-equation: 8 CG iterations.</div>
<div class="line">   v-equation: 22 CG iterations.</div>
<div class="line">   Total energy: 1.17887</div>
<div class="line">Time step 2 at t=0.03125</div>
<div class="line">   u-equation: 8 CG iterations.</div>
<div class="line">   v-equation: 20 CG iterations.</div>
<div class="line">   Total energy: 2.9655</div>
<div class="line">Time step 3 at t=0.046875</div>
<div class="line">   u-equation: 8 CG iterations.</div>
<div class="line">   v-equation: 21 CG iterations.</div>
<div class="line">   Total energy: 4.33761</div>
<div class="line">Time step 4 at t=0.0625</div>
<div class="line">   u-equation: 7 CG iterations.</div>
<div class="line">   v-equation: 21 CG iterations.</div>
<div class="line">   Total energy: 5.35499</div>
<div class="line">Time step 5 at t=0.078125</div>
<div class="line">   u-equation: 7 CG iterations.</div>
<div class="line">   v-equation: 21 CG iterations.</div>
<div class="line">   Total energy: 6.18652</div>
<div class="line">Time step 6 at t=0.09375</div>
<div class="line">   u-equation: 7 CG iterations.</div>
<div class="line">   v-equation: 20 CG iterations.</div>
<div class="line">   Total energy: 6.6799</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Time step 31 at t=0.484375</div>
<div class="line">   u-equation: 7 CG iterations.</div>
<div class="line">   v-equation: 20 CG iterations.</div>
<div class="line">   Total energy: 21.9068</div>
<div class="line">Time step 32 at t=0.5</div>
<div class="line">   u-equation: 7 CG iterations.</div>
<div class="line">   v-equation: 20 CG iterations.</div>
<div class="line">   Total energy: 23.3394</div>
<div class="line">Time step 33 at t=0.515625</div>
<div class="line">   u-equation: 7 CG iterations.</div>
<div class="line">   v-equation: 20 CG iterations.</div>
<div class="line">   Total energy: 23.1019</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Time step 319 at t=4.98438</div>
<div class="line">   u-equation: 7 CG iterations.</div>
<div class="line">   v-equation: 20 CG iterations.</div>
<div class="line">   Total energy: 23.1019</div>
<div class="line">Time step 320 at t=5</div>
<div class="line">   u-equation: 7 CG iterations.</div>
<div class="line">   v-equation: 20 CG iterations.</div>
<div class="line">   Total energy: 23.1019</div>
</div><!-- fragment --><p>我们立即看到的是，至少在 \(t=\frac 12\) 之后，能量是一个常数（在此之前，边界源项 \(g\) 是非零的，向系统注入能量）。</p>
<p>除了屏幕输出外，程序还将每个时间步骤的解写到输出文件中。如果我们对其进行充分处理，并将其粘贴到电影中，我们会得到以下结果。</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-23.movie.gif" alt="Animation of the solution of step 23." class="inline"/> <br  />
</p>
<p>影片显示了生成的波很好地穿过域并返回，在钳制的边界处被反射。一些数值噪声跟在波的后面，这是由于网格尺寸过大造成的，可以通过减小网格宽度和时间步长来减少。</p>
<p><a class="anchor" id="extensions"></a> <a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p>如果你想探索一下，可以试试下面的一些东西。 </p><ul>
<li>
<p class="startli">变化的 \(\theta\) 。这给出了不同的时间步进方案，其中一些是稳定的，而另一些则不是。看一看能量是如何演变的。 </p><pre class="fragment">&lt;li&gt;  不同的初始和边界条件，右手边。

&lt;li&gt;  更复杂的域或更精细的网格。请记住，时间步长需要以网格宽度为界，所以改变网格也应该包括改变时间步长。我们将在  @ref step_24 "step-24"  中再次讨论这个问题。

&lt;li&gt;  可变系数。在实际介质中，波速往往是可变的。特别是，现实介质中的 "真实 "波浪方程为@f[
 \rho(x) \frac{\partial^2 u}{\partial t^2}


 -
 \nabla \cdot
 a(x) \nabla u = f,
</pre><p> @f]，其中 \(\rho(x)\) 是材料的密度， \(a(x)\) 与刚度系数有关。那么波速就是 \(c=\sqrt{a/\rho}\) 。</p>
<p class="interli">为了做出这样的改变，我们必须计算质量矩阵和拉普拉斯矩阵的可变系数。幸运的是，这并不难：函数 <a class="el" href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a> 和 <a class="el" href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a> 有额外的默认参数，可以用来向它们传递非恒定系数函数。因此，所需的变化相对较小。另一方面，必须再次注意确保时间步长在允许范围内。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">在代码内的注释中，我们讨论了这样一个事实：由于边界条件的原因，用于求解 \(U^n\) 和 \(V^n\) 的矩阵需要在每个时间内被重置，尽管实际内容没有变化。可以通过不消除线性系统中的列来避免复制，这可以通过在调用中附加一个 <code>false</code> 参数来实现。</p><div class="fragment"><div class="line"><a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                   matrix_u,</div>
<div class="line">                                   solution_u,</div>
<div class="line">                                   system_rhs,</div>
<div class="line">                                   <span class="keyword">false</span>);</div>
</div><!-- fragment --><pre class="fragment">&lt;li&gt;  deal.II是一个支持自适应网格的库，如果这个程序支持每隔几步改变网格，那当然很好了。考虑到解决方案的结构&amp;mdash; 一个在域中旅行的波&amp;mdash; 如果我们只在波的当前位置完善网格，而不是简单地在所有地方完善网格，似乎是合适的。直观地看，我们应该能够通过这种方式节省大量的单元。虽然经过进一步的思考，我们意识到这只是在模拟的初始阶段。  一段时间后，对于波浪现象来说，域中充满了初始波的反射，向各个方向发展，充满了域中的每个角落。  在这一点上，一般来说，使用局部网格细化是没有什么好处的）。) 
</pre><p> 为了使自适应改变网格成为可能，基本上有两条路线。 正确的方法是回到我们用Rothe的方法得到的弱形式。例如，在每个时间步长中要解决的两个方程中的第一个是这样的。 </p><p class="formulaDsp">
\begin{eqnarray*} (u^n,\varphi) + k^2\theta^2(\nabla u^n,\nabla \varphi) &amp;=&amp; (u^{n-1},\varphi) - k^2\theta(1-\theta)(\nabla u^{n-1},\nabla \varphi) + k(v^{n-1},\varphi) + k^2\theta \left[ \theta (f^n,\varphi) + (1-\theta) (f^{n-1},\varphi) \right]. \end{eqnarray*}
</p>
<p> 现在，注意我们在网格 \({\mathbb T}^n\) 上求解 \(u^n\) ，因此，测试函数 \(\varphi\) 也必须来自空间 \(V_h^n\) 。正如在介绍中所讨论的，像 \((u^{n-1},\varphi)\) 这样的条款要求我们将上一步的解决方案（可能是在不同的网格 \({\mathbb T}^{n-1}\) 上计算的）与当前网格的测试函数进行整合，从而得到一个矩阵 \(M^{n,n-1}\) 。这个整合不同网格的形状函数的过程，充其量也是尴尬的。它是可以做到的，但是由于很难保证 \({\mathbb T}^{n-1}\) 和 \({\mathbb T}^{n}\) 最多相差一个细化级别，我们必须递归匹配两个网格的单元。这样做是可行的，但会导致冗长且不完全明显的代码。</p>
<p class="interli">第二种方法是：每当我们改变网格时，我们只需使用SolutionTransfer类将旧网格上最后一个时间步长的解插到新网格上。换句话说，我们将解决 </p><p class="formulaDsp">
\begin{eqnarray*} (u^n,\varphi) + k^2\theta^2(\nabla u^n,\nabla \varphi) &amp;=&amp; (I^n u^{n-1},\varphi) - k^2\theta(1-\theta)(\nabla I^n u^{n-1},\nabla \varphi) + k(I^n v^{n-1},\varphi) + k^2\theta \left[ \theta (f^n,\varphi) + (1-\theta) (f^{n-1},\varphi) \right], \end{eqnarray*}
</p>
<p>， \(I^n\) 将一个给定的函数插值到网格 \({\mathbb T}^n\) 上，而不是上面的方程式。 这是一个更简单的方法，因为在每个时间步长中，我们不再需要担心 \(u^{n-1},v^{n-1}\) 是在我们现在使用的同一个网格上计算的，还是在不同的网格上计算的。因此，代码的唯一变化是增加了一个计算误差的函数，为细化标记单元，设置SolutionTransfer对象，将解转移到新的网格上，并在新的网格上重建矩阵和右手向量。建立矩阵和右手边的函数以及求解器都不需要改变。</p>
<p class="endli">虽然严格来说，这第二种方法在Rothe框架中并不十分正确（它引入了一个额外的误差源，即插值），但这几乎是每个人在解决时间相关方程时都会做的事情。我们将在 step-31 中使用这种方法，例如。 </p>
</li>
</ul>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2006 - 2020 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Author: Wolfgang Bangerth, Texas A&amp;M University, 2006</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step23</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>WaveEquation</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    WaveEquation();</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line">    <span class="keywordtype">void</span> solve_u();</div>
<div class="line">    <span class="keywordtype">void</span> solve_v();</div>
<div class="line">    <span class="keywordtype">void</span> output_results() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">    <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>          fe;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      sparsity_pattern;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> laplace_matrix;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> matrix_u;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> matrix_v;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> solution_u, solution_v;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> old_solution_u, old_solution_v;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span>       time_step;</div>
<div class="line">    <span class="keywordtype">double</span>       time;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep_number;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> theta;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>InitialValuesU : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      (void)component;</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>InitialValuesV : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      (void)component;</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; <span class="comment">/*p*/</span>,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      (void)component;</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>BoundaryValuesU : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      (void)component;</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((this-&gt;<a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">get_time</a>() &lt;= 0.5) &amp;&amp; (p[0] &lt; 0) &amp;&amp; (p[1] &lt; 1. / 3) &amp;&amp;</div>
<div class="line">          (p[1] &gt; -1. / 3))</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">std::sin</a>(this-&gt;<a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">get_time</a>() * 4 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>BoundaryValuesV : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">      (void)component;</div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((this-&gt;<a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">get_time</a>() &lt;= 0.5) &amp;&amp; (p[0] &lt; 0) &amp;&amp; (p[1] &lt; 1. / 3) &amp;&amp;</div>
<div class="line">          (p[1] &gt; -1. / 3))</div>
<div class="line">        <span class="keywordflow">return</span> (std::cos(this-&gt;<a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">get_time</a>() * 4 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>) * 4 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  WaveEquation&lt;dim&gt;::WaveEquation()</div>
<div class="line">    : fe(1)</div>
<div class="line">    , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">    , time_step(1. / 64)</div>
<div class="line">    , time(time_step)</div>
<div class="line">    , timestep_number(1)</div>
<div class="line">    , theta(0.5)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> WaveEquation&lt;dim&gt;::setup_system()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>, -1, 1);</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(7);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Number of active cells: &quot;</span> &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells()</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    dof_handler.distribute_dofs(fe);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.n_dofs()</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.n_dofs(), dof_handler.n_dofs());</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, dsp);</div>
<div class="line">    sparsity_pattern.copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.reinit(sparsity_pattern);</div>
<div class="line">    laplace_matrix.reinit(sparsity_pattern);</div>
<div class="line">    matrix_u.reinit(sparsity_pattern);</div>
<div class="line">    matrix_v.reinit(sparsity_pattern);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a>(dof_handler,</div>
<div class="line">                                      <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                                      <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>);</div>
<div class="line">    <a class="code" href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a>(dof_handler,</div>
<div class="line">                                         <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                                         laplace_matrix);</div>
<div class="line"> </div>
<div class="line">    solution_u.reinit(dof_handler.n_dofs());</div>
<div class="line">    solution_v.reinit(dof_handler.n_dofs());</div>
<div class="line">    old_solution_u.reinit(dof_handler.n_dofs());</div>
<div class="line">    old_solution_v.reinit(dof_handler.n_dofs());</div>
<div class="line">    system_rhs.reinit(dof_handler.n_dofs());</div>
<div class="line"> </div>
<div class="line">    constraints.close();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> WaveEquation&lt;dim&gt;::solve_u()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8 * system_rhs.l2_norm());</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">    cg.solve(matrix_u, solution_u, system_rhs, <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>());</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;   u-equation: &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; CG iterations.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> WaveEquation&lt;dim&gt;::solve_v()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8 * system_rhs.l2_norm());</div>
<div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">    cg.solve(matrix_v, solution_v, system_rhs, <a class="code" href="classPreconditionIdentity.html">PreconditionIdentity</a>());</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;   v-equation: &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; CG iterations.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> WaveEquation&lt;dim&gt;::output_results()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_u, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution_v, <span class="stringliteral">&quot;V&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string filename =</div>
<div class="line">      <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(timestep_number, 3) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line">    <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> vtk_flags;</div>
<div class="line">    vtk_flags.<a class="code" href="group__Exceptions.html#ga3be0d6de1c92b770e8664bce2fc7c107">compression_level</a> =</div>
<div class="line">      DataOutBase::VtkFlags::ZlibCompressionLevel::best_speed;</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#gac7280a24690b117454acfb0fa058299c">set_flags</a>(vtk_flags);</div>
<div class="line">    std::ofstream output(filename);</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WaveEquation&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    setup_system();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a>(dof_handler,</div>
<div class="line">                         constraints,</div>
<div class="line">                         <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                         InitialValuesU&lt;dim&gt;(),</div>
<div class="line">                         old_solution_u);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">VectorTools::project</a>(dof_handler,</div>
<div class="line">                         constraints,</div>
<div class="line">                         <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                         InitialValuesV&lt;dim&gt;(),</div>
<div class="line">                         old_solution_v);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> tmp(solution_u.size());</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> forcing_terms(solution_u.size());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (; time &lt;= 5; time += time_step, ++timestep_number)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Time step &quot;</span> &lt;&lt; timestep_number &lt;&lt; <span class="stringliteral">&quot; at t=&quot;</span> &lt;&lt; time</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.vmult(system_rhs, old_solution_u);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.vmult(tmp, old_solution_v);</div>
<div class="line">        system_rhs.add(time_step, tmp);</div>
<div class="line"> </div>
<div class="line">        laplace_matrix.vmult(tmp, old_solution_u);</div>
<div class="line">        system_rhs.add(-theta * (1 - theta) * time_step * time_step, tmp);</div>
<div class="line"> </div>
<div class="line">        RightHandSide&lt;dim&gt; rhs_function;</div>
<div class="line">        rhs_function.set_time(time);</div>
<div class="line">        <a class="code" href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a>(dof_handler,</div>
<div class="line">                                            <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                                            rhs_function,</div>
<div class="line">                                            tmp);</div>
<div class="line">        forcing_terms = tmp;</div>
<div class="line">        forcing_terms *= theta * time_step;</div>
<div class="line"> </div>
<div class="line">        rhs_function.set_time(time - time_step);</div>
<div class="line">        <a class="code" href="namespaceVectorTools.html#a6e325333a138893e181da47f29ac680a">VectorTools::create_right_hand_side</a>(dof_handler,</div>
<div class="line">                                            <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(fe.degree + 1),</div>
<div class="line">                                            rhs_function,</div>
<div class="line">                                            tmp);</div>
<div class="line"> </div>
<div class="line">        forcing_terms.add((1 - theta) * time_step, tmp);</div>
<div class="line"> </div>
<div class="line">        system_rhs.add(theta * time_step, forcing_terms);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          BoundaryValuesU&lt;dim&gt; boundary_values_u_function;</div>
<div class="line">          boundary_values_u_function.set_time(time);</div>
<div class="line"> </div>
<div class="line">          std::map&lt;types::global_dof_index, double&gt; boundary_values;</div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                                   0,</div>
<div class="line">                                                   boundary_values_u_function,</div>
<div class="line">                                                   boundary_values);</div>
<div class="line"> </div>
<div class="line">          matrix_u.copy_from(<a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>);</div>
<div class="line">          matrix_u.add(theta * theta * time_step * time_step, laplace_matrix);</div>
<div class="line">          <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                             matrix_u,</div>
<div class="line">                                             solution_u,</div>
<div class="line">                                             system_rhs);</div>
<div class="line">        }</div>
<div class="line">        solve_u();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        laplace_matrix.vmult(system_rhs, solution_u);</div>
<div class="line">        system_rhs *= -theta * time_step;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.vmult(tmp, old_solution_v);</div>
<div class="line">        system_rhs += tmp;</div>
<div class="line"> </div>
<div class="line">        laplace_matrix.vmult(tmp, old_solution_u);</div>
<div class="line">        system_rhs.add(-time_step * (1 - theta), tmp);</div>
<div class="line"> </div>
<div class="line">        system_rhs += forcing_terms;</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          BoundaryValuesV&lt;dim&gt; boundary_values_v_function;</div>
<div class="line">          boundary_values_v_function.set_time(time);</div>
<div class="line"> </div>
<div class="line">          std::map&lt;types::global_dof_index, double&gt; boundary_values;</div>
<div class="line">          <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                                   0,</div>
<div class="line">                                                   boundary_values_v_function,</div>
<div class="line">                                                   boundary_values);</div>
<div class="line">          matrix_v.copy_from(<a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>);</div>
<div class="line">          <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values,</div>
<div class="line">                                             matrix_v,</div>
<div class="line">                                             solution_v,</div>
<div class="line">                                             system_rhs);</div>
<div class="line">        }</div>
<div class="line">        solve_v();</div>
<div class="line"> </div>
<div class="line">        output_results();</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Total energy: &quot;</span></div>
<div class="line">                  &lt;&lt; (<a class="code" href="namespaceLocalIntegrators_1_1L2.html#a1c15243765304a803037988b5561627d">mass_matrix</a>.matrix_norm_square(solution_v) +</div>
<div class="line">                      laplace_matrix.matrix_norm_square(solution_u)) /</div>
<div class="line">                       2</div>
<div class="line">                  &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        old_solution_u = solution_u;</div>
<div class="line">        old_solution_v = solution_v;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step23</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span>Step23;</div>
<div class="line"> </div>
<div class="line">      WaveEquation&lt;2&gt; wave_equation_solver;</div>
<div class="line">      wave_equation_solver.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceUtilities_1_1System_html_a76bc1cc7649cc416723f450d24fdd91d"><div class="ttname"><a href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">Utilities::System::get_time</a></div><div class="ttdeci">std::string get_time()</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l01019">utilities.cc:1019</a></div></div>
<div class="ttc" id="anamespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div><div class="ttdeci">@ value</div></div>
</div><!-- fragment --><p> 。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
