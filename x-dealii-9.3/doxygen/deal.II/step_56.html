<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_56.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-56 tutorial program  。</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.3.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.3.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-56 tutorial program 。 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>本教程取决于 <a class="el" href="step_16.html">step-16</a> , <a class="el" href="step_22.html">step-22</a> 。</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#StokesProblem"> Stokes Problem </a><a href="#StokesProblem"> Stokes Problem </a>
        <li><a href="#LinearSolverandPreconditioningIssues"> Linear Solver and Preconditioning Issues </a><a href="#LinearSolverandPreconditioningIssues"> Linear Solver and Preconditioning Issues </a>
        <li><a href="#ReferenceSolution"> Reference Solution </a><a href="#ReferenceSolution"> Reference Solution </a>
        <li><a href="#ComputingErrors"> Computing Errors </a><a href="#ComputingErrors"> Computing Errors </a>
        <li><a href="#DoFHandlers"> DoF Handlers </a><a href="#DoFHandlers"> DoF Handlers </a>
        <li><a href="#DifferencesfromtheStep22tutorial"> Differences from the Step 22 tutorial </a><a href="#DifferencesfromtheStep22tutorial"> Differences from the Step 22 tutorial </a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a><a href="#Includefiles">Include files</a>
        <li><a href="#FunctionsforSolutionandRighthandside">Functions for Solution and Righthand side</a><a href="#FunctionsforSolutionandRighthandside">Functions for Solution and Righthand side</a>
        <li><a href="#ASPECTBlockSchurPreconditioner">ASPECT BlockSchurPreconditioner</a><a href="#ASPECTBlockSchurPreconditioner">ASPECT BlockSchurPreconditioner</a>
        <li><a href="#TheStokesProblemclass">The StokesProblem class</a><a href="#TheStokesProblemclass">The StokesProblem class</a>
      <ul>
        <li><a href="#StokesProblemsetup_dofs">StokesProblem::setup_dofs</a><a href="#StokesProblemsetup_dofs">StokesProblem::setup_dofs</a>
        <li><a href="#StokesProblemassemble_system">StokesProblem::assemble_system</a> ]<a href="#StokesProblemassemble_system">StokesProblem::assemble_system</a>
        <li><a href="#StokesProblemassemble_multigrid">StokesProblem::assemble_multigrid</a><a href="#StokesProblemassemble_multigrid">StokesProblem::assemble_multigrid</a>
        <li><a href="#StokesProblemsolve">StokesProblem::solve</a><a href="#StokesProblemsolve">StokesProblem::solve</a>
        <li><a href="#StokesProblemprocess_solution">StokesProblem::process_solution</a><a href="#StokesProblemprocess_solution">StokesProblem::process_solution</a>
        <li><a href="#StokesProblemoutput_results">StokesProblem::output_results</a><a href="#StokesProblemoutput_results">StokesProblem::output_results</a>
        <li><a href="#StokesProblemrun">StokesProblem::run</a><a href="#StokesProblemrun">StokesProblem::run</a>
      </ul>
        <li><a href="#Themainfunction">The main function</a><a href="#Themainfunction">The main function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Errors"> Errors </a><a href="#Errors"> Errors </a>
        <li><a href="#TimingResults"> Timing Results </a><a href="#TimingResults"> Timing Results </a>
        <li><a href="#Possibilitiesforextensions"> Possibilities for extensions </a><a href="#Possibilitiesforextensions"> Possibilities for extensions </a>
      <ul>
        <li><a href="#Checkhigherorderdiscretizations"> Check higher order discretizations </a><a href="#Checkhigherorderdiscretizations"> Check higher order discretizations </a>
        <li><a href="#Comparewithcheappreconditioner"> Compare with cheap preconditioner </a><a href="#Comparewithcheappreconditioner"> Compare with cheap preconditioner </a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
</p>
<p><em>This program was contributed by Ryan Grove and Timo Heister.</em></p>
<p><em>This material is based upon work partially supported by National Science Foundation grant DMS1522191 and the Computational Infrastructure in Geodynamics initiative (CIG), through the National Science Foundation under Award No. EAR-0949446 and The University of California-Davis.</em></p>
<p><em>The authors would like to thank the Isaac Newton Institute for Mathematical Sciences, Cambridge, for support and hospitality during the programme Melt in the Mantle where work on this tutorial was undertaken. This work was supported by EPSRC grant no EP/K032208/1. </em></p>
<dl class="section note"><dt>Note</dt><dd>If you use this program as a basis for your own work, please consider citing it in your list of references. The initial version of this work was contributed to the deal.II project by the authors listed in the following citation: <a href="https://doi.org/10.5281/zenodo.400995"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.400995.svg" alt="10.5281/zenodo.400995"/></a>  <br  />
</dd></dl>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p><a class="anchor" id="StokesProblem"></a></p><h3>Stokes Problem </h3>
<p>本教程的目的是为斯托克斯方程创建一个高效的线性求解器，并将其与其他方法进行比较。 在这里，我们将使用带有几何多网格的FGMRES作为预处理速度块，我们将在结果部分表明，这比 <a class="el" href="step_22.html">step-22</a> 中使用的线性求解器（包括 "可能的扩展 "中描述的方案）从根本上来说是一种更好的方法。 从根本上说，这是因为只有使用多网格才有可能得到 \(O(n)\) 的求解时间，其中 \(n\) 是线性系统的未知数的数量。使用Timer类，我们收集一些统计数据来比较设置时间、求解时间和迭代次数。我们还计算误差以确保我们所实现的是正确的。</p>
<p>让 \(u \in H_0^1 = \{ u \in H^1(\Omega), u|_{\partial \Omega} = 0 \}\) 和 \(p \in L_*^2 = \{ p \in L^2(\Omega), \int_\Omega p = 0 \}\) . 斯托克斯方程在非维度化形式下读作如下。</p>
<p class="formulaDsp">
\begin{eqnarray*} - 2 \text{div} \frac {1}{2} \left[ (\nabla \textbf{u}) + (\nabla \textbf{u})^T\right] + \nabla p &amp; =&amp; f \\ - \nabla \cdot u &amp;=&amp; 0 \end{eqnarray*}
</p>
<p>请注意，我们使用的是变形张量，而不是 \(\Delta u\) （关于两者之间的区别的详细描述可以在 <a class="el" href="step_22.html">step-22</a> 中找到，但总的来说，变形张量的物理性更强，也更昂贵）。</p>
<p><a class="anchor" id="LinearSolverandPreconditioningIssues"></a></p><h3>Linear Solver and Preconditioning Issues </h3>
<p>离散方程的弱形式自然导致了以下速度和压力场的节点值的线性系统。 </p><p class="formulaDsp">
\begin{eqnarray*} \left(\begin{array}{cc} A &amp; B^T \\ B &amp; 0 \end{array}\right) \left(\begin{array}{c} U \\ P \end{array}\right) = \left(\begin{array}{c} F \\ 0 \end{array}\right). \end{eqnarray*}
</p>
<p>我们的目标是比较几种解决方法。 虽然 <a class="el" href="step_22.html">step-22</a> 使用 "Schur补数法 "分两步解决线性系统，但我们本着 <a class="el" href="step_22.html">step-22</a> "结果 "一节中概述的方法，使用带有高效预处理程序的FMGRES一次性解决该块系统。其思路如下：如果我们找到一个块状预处理器 \(P\) ，使矩阵</p>
<p class="formulaDsp">
\begin{eqnarray*} \left(\begin{array}{cc} A &amp; B^T \\ B &amp; 0 \end{array}\right) P^{-1} \end{eqnarray*}
</p>
<p>是简单的，那么使用该预处理程序的迭代求解器将在几次迭代中收敛。注意，我们在这里做的是正确的预处理。 使用舒尔补码 \(S=BA^{-1}B^T\) ，我们发现</p>
<p class="formulaDsp">
\begin{eqnarray*} P^{-1} = \left(\begin{array}{cc} A &amp; B^T \\ 0 &amp; S \end{array}\right)^{-1} \end{eqnarray*}
</p>
<p>是一个不错的选择。让 \(\widetilde{A^{-1}}\) 是 \(A^{-1}\) 的近似值， \(\widetilde{S^{-1}}\) 是 \(S^{-1}\) 的近似值，我们看到 </p><p class="formulaDsp">
\begin{eqnarray*} P^{-1} = \left(\begin{array}{cc} A^{-1} &amp; 0 \\ 0 &amp; I \end{array}\right) \left(\begin{array}{cc} I &amp; B^T \\ 0 &amp; -I \end{array}\right) \left(\begin{array}{cc} I &amp; 0 \\ 0 &amp; S^{-1} \end{array}\right) \approx \left(\begin{array}{cc} \widetilde{A^{-1}} &amp; 0 \\ 0 &amp; I \end{array}\right) \left(\begin{array}{cc} I &amp; B^T \\ 0 &amp; -I \end{array}\right) \left(\begin{array}{cc} I &amp; 0 \\ 0 &amp; \widetilde{S^{-1}} \end{array}\right). \end{eqnarray*}
</p>
<p>由于 \(P\) 的目的只是作为一个预处理程序，我们将在上式中使用右边的近似值。</p>
<p>正如在 <a class="el" href="step_22.html">step-22</a> 、 \(-M_p^{-1}=:\widetilde{S^{-1}} \approx S^{-1}\) 中所讨论的，其中 \(M_p\) 是压力质量矩阵，通过使用CG与ILU作为预处理程序进行近似求解，而 \(\widetilde{A^{-1}}\) ]是通过多种方法之一得到的：用CG和ILU作为预处理程序求解线性系统，仅仅使用ILU的一次应用，用CG和GMG（如 <a class="el" href="step_16.html">step-16</a> 中描述的几何多网格）作为预处理程序求解线性系统，或者仅仅执行GMG的一个V-循环。</p>
<p>作为比较，我们还在整个系统上使用了直接求解器UMFPACK来比较我们的结果，而不是FGMRES。 如果你想使用直接求解器（如UMFPACK），系统需要是可逆的。为了避免恒定压力给定的一维无效空间，我们将第一个压力未知数固定为零。这对迭代求解器来说是没有必要的。</p>
<p><a class="anchor" id="ReferenceSolution"></a></p><h3>Reference Solution </h3>
<p>测试问题是一个 "制造的解决方案"（详见 <a class="el" href="step_7.html">step-7</a> ），我们选择 \(u=(u_1,u_2,u_3)=(2\sin (\pi x), - \pi y \cos (\pi x),- \pi z \cos (\pi x))\) 和 \(p = \sin (\pi x)\cos (\pi y)\sin (\pi z)\) 。我们在域的整个边界上对速度应用迪里切特边界条件 \(\Omega=[0,1]\times[0,1]\times[0,1]\) 。为了执行边界条件，我们可以直接使用我们的参考解。</p>
<p>如果你在deal.II手册中查找创建一个从 <code><a class="el" href="classFunction.html">Function</a>&lt;dim&gt;</code> 派生的类所需的内容，你会发现这个类有许多 <code>virtual</code> 函数，包括 <a class="el" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">Function::value()</a>, <a class="el" href="classFunction.html#ae316ebc05d21989d573024f8a23c49cb">Function::vector_value()</a>, <a class="el" href="classFunction.html#a562fc1114e95e702e6696721f71528db">Function::value_list()</a>, 等等，所有这些都可以被重载。 deal.II的不同部分将需要这些特定函数中的不同部分。这在一开始会让人感到困惑，但幸运的是，你真正需要实现的只有 <code>value()</code>. ，函数类中的其他虚函数在里面有默认的实现，会默认调用你对 <code>value</code> 的实现。</p>
<p>请注意，我们的参考方案满足了 \(\nabla \cdot u = 0\) 。此外，压力被选择为平均值为零。 对于 <a class="el" href="step_7.html">step-7</a> 的 "制造解决方案的方法"，我们需要找到 \(\bf f\) ，以便。</p>
<p class="formulaDsp">
\begin{align*} {\bf f} = - 2 \text{div} \frac {1}{2} \left[ (\nabla \textbf{u}) + (\nabla \textbf{u})^T\right] + \nabla p. \end{align*}
</p>
<p>使用上面的参考解，我们得到。</p>
<p class="formulaDsp">
\begin{eqnarray*} {\bf f} &amp;=&amp; (2 \pi^2 \sin (\pi x),- \pi^3 y \cos(\pi x),- \pi^3 z \cos(\pi x))\\ &amp; &amp; + (\pi \cos(\pi x) \cos(\pi y) \sin(\pi z) ,- \pi \sin(\pi y) \sin(\pi x) \sin(\pi z), \pi \cos(\pi z) \sin(\pi x) \cos(\pi y)) \end{eqnarray*}
</p>
<p><a class="anchor" id="ComputingErrors"></a></p><h3>Computing Errors </h3>
<p>因为我们在线性系统中没有强制要求平均压力为零，所以我们需要在求解后对解决方案进行后处理。为了做到这一点，我们使用 <a class="el" href="namespaceVectorTools.html#ad086eb08b8424fd7c853e389a3978a9a">VectorTools::compute_mean_value()</a> 函数来计算压力的平均值，以便从压力中减去它。</p>
<p><a class="anchor" id="DoFHandlers"></a></p><h3>DoF Handlers </h3>
<p>我们在这里实现几何多网格的方式只在速度变量（即上面描述的 \(A\) 矩阵）上执行，而不是压力。我们可以用不同的方式来实现这一点，包括将所有的粗网格操作视为作用于 \(2\times 2\) 块系统，我们只考虑左上角的块。另外，我们也可以通过真正只考虑整个有限元离散化的速度部分的线性系统来实现。后者是我们在这里想要使用的方式。</p>
<p>为了实现这一点，我们需要能够提出诸如 "我可以只拥有DoFHandler的一部分吗？"之类的问题。在编写这个程序的时候，这是不可能的，所以为了满足我们的需求，我们只是为速度创建一个单独的、第二个DoFHandler。然后，我们只基于这个第二DoFHandler为多网格预处理程序建立线性系统，并简单地将第一块（整体）向量转移到整个第二DoFHandler的对应向量中。为了实现这一目标，我们必须保证两个DoFHandler对象中的（速度）自由度排序的<em>order</em>是相同的。事实上，首先在两个对象上分配自由度，然后在两个对象上使用相同的DoFRenumbering操作序列，就可以做到这一点。</p>
<p><a class="anchor" id="DifferencesfromtheStep22tutorial"></a></p><h3>Differences from the Step 22 tutorial </h3>
<p>step-56 和 step-22 之间的主要区别是，我们使用块状求解器而不是 step-22 中使用的Schur Complement方法。这种方法的细节可以在 step-22 的 "可能的扩展 "部分的 "块状Schur补码预处理 "小节中找到。对于速度块的预处理，我们从<a href="https://aspect.geodynamics.org">ASPECT</a>中借用了一个名为 <code>BlockSchurPreconditioner</code> 的类，该类可以选择求解 \(A\) 的逆，或者只对其应用一个预处理扫频，这分别为我们提供了一种昂贵和廉价的方法。<a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a></p><h3>Include files</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="logstream_8h.html">deal.II/base/logstream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__sparse__matrix_8h.html">deal.II/lac/block_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__sparsity__pattern_8h.html">deal.II/lac/block_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="error__estimator_8h.html">deal.II/numerics/error_estimator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__direct_8h.html">deal.II/lac/sparse_direct.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__ilu_8h.html">deal.II/lac/sparse_ilu.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="ttc" id="aaffine__constraints_8h_html"><div class="ttname"><a href="affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="ablock__sparse__matrix_8h_html"><div class="ttname"><a href="block__sparse__matrix_8h.html">block_sparse_matrix.h</a></div></div>
<div class="ttc" id="ablock__sparsity__pattern_8h_html"><div class="ttname"><a href="block__sparsity__pattern_8h.html">block_sparsity_pattern.h</a></div></div>
<div class="ttc" id="ablock__vector_8h_html"><div class="ttname"><a href="block__vector_8h.html">block_vector.h</a></div></div>
<div class="ttc" id="adof__renumbering_8h_html"><div class="ttname"><a href="dof__renumbering_8h.html">dof_renumbering.h</a></div></div>
<div class="ttc" id="adof__tools_8h_html"><div class="ttname"><a href="dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="adynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="aerror__estimator_8h_html"><div class="ttname"><a href="error__estimator_8h.html">error_estimator.h</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="afe__q_8h_html"><div class="ttname"><a href="fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="afe__system_8h_html"><div class="ttname"><a href="fe__system_8h.html">fe_system.h</a></div></div>
<div class="ttc" id="afull__matrix_8h_html"><div class="ttname"><a href="full__matrix_8h.html">full_matrix.h</a></div></div>
<div class="ttc" id="afunction_8h_html"><div class="ttname"><a href="function_8h.html">function.h</a></div></div>
<div class="ttc" id="agrid_2grid__refinement_8h_html"><div class="ttname"><a href="grid_2grid__refinement_8h.html">grid_refinement.h</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="agrid__generator_8h_html"><div class="ttname"><a href="grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="agrid__out_8h_html"><div class="ttname"><a href="grid__out_8h.html">grid_out.h</a></div></div>
<div class="ttc" id="agrid__tools_8h_html"><div class="ttname"><a href="grid__tools_8h.html">grid_tools.h</a></div></div>
<div class="ttc" id="ainclude_2deal_8II_2base_2utilities_8h_html"><div class="ttname"><a href="include_2deal_8II_2base_2utilities_8h.html">utilities.h</a></div></div>
<div class="ttc" id="alogstream_8h_html"><div class="ttname"><a href="logstream_8h.html">logstream.h</a></div></div>
<div class="ttc" id="amatrix__tools_8h_html"><div class="ttname"><a href="matrix__tools_8h.html">matrix_tools.h</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aprecondition_8h_html"><div class="ttname"><a href="precondition_8h.html">precondition.h</a></div></div>
<div class="ttc" id="aquadrature__lib_8h_html"><div class="ttname"><a href="quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="asolver__cg_8h_html"><div class="ttname"><a href="solver__cg_8h.html">solver_cg.h</a></div></div>
<div class="ttc" id="asolver__gmres_8h_html"><div class="ttname"><a href="solver__gmres_8h.html">solver_gmres.h</a></div></div>
<div class="ttc" id="asparse__direct_8h_html"><div class="ttname"><a href="sparse__direct_8h.html">sparse_direct.h</a></div></div>
<div class="ttc" id="asparse__ilu_8h_html"><div class="ttname"><a href="sparse__ilu_8h.html">sparse_ilu.h</a></div></div>
<div class="ttc" id="avector__tools_8h_html"><div class="ttname"><a href="vector__tools_8h.html">vector_tools.h</a></div></div>
</div><!-- fragment --><p>我们需要包括以下文件来做计时。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="ttc" id="atimer_8h_html"><div class="ttname"><a href="timer_8h.html">timer.h</a></div></div>
</div><!-- fragment --><p>这包括我们使用几何多网格所需的文件</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step56</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="ttc" id="amg__coarse_8h_html"><div class="ttname"><a href="mg__coarse_8h.html">mg_coarse.h</a></div></div>
<div class="ttc" id="amg__matrix_8h_html"><div class="ttname"><a href="mg__matrix_8h.html">mg_matrix.h</a></div></div>
<div class="ttc" id="amg__smoother_8h_html"><div class="ttname"><a href="mg__smoother_8h.html">mg_smoother.h</a></div></div>
<div class="ttc" id="amg__tools_8h_html"><div class="ttname"><a href="mg__tools_8h.html">mg_tools.h</a></div></div>
<div class="ttc" id="amg__transfer_8h_html"><div class="ttname"><a href="mg__transfer_8h.html">mg_transfer.h</a></div></div>
<div class="ttc" id="amultigrid_8h_html"><div class="ttname"><a href="multigrid_8h.html">multigrid.h</a></div></div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="namespace__dealii_8h_source.html#l00025">namespace_dealii.h:26</a></div></div>
</div><!-- fragment --><p>为了方便在使用的不同求解器之间进行切换，我们声明一个枚举，可以作为参数传递给主类的构造函数。</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> <a class="code" href="classSolverType.html">SolverType</a></div>
<div class="line">{</div>
<div class="line">  FGMRES_ILU,</div>
<div class="line">  FGMRES_GMG,</div>
<div class="line">  UMFPACK</div>
<div class="line">};</div>
<div class="ttc" id="aclassSolverType_html"><div class="ttname"><a href="classSolverType.html">SolverType</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="FunctionsforSolutionandRighthandside"></a> </p><h3><a class="el" href="namespaceFunctions.html">Functions</a> for Solution and Righthand side</h3>
<p><br  />
</p>
<p>类Solution是用来定义边界条件和计算数值解的误差的。请注意，我们需要定义值和梯度，以便计算L2和H1误差。在这里，我们决定使用模板的特殊化来分离2D和3D的实现。 <br  />
</p>
<p>请注意，前几个昏暗分量是速度分量，最后一个是压力。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>Solution : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Solution()</div>
<div class="line">    : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(dim + 1)</div>
<div class="line">  {}</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">  <span class="keyword">virtual</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a></div>
<div class="line">  <a class="code" href="classFunction.html#a4b0aadc89a827b39c20f12889aa88625">gradient</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keywordtype">double</span> Solution&lt;2&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;2&gt;</a> &amp;   p,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 2 + 1, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 2 + 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> y = p(1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">    <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keywordtype">double</span> Solution&lt;3&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;3&gt;</a> &amp;   p,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 3 + 1, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 3 + 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> y = p(1);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> z = p(2);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">    <span class="keywordflow">return</span> 2.0 * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">    <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">    <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 3)</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassFunction_html"><div class="ttname"><a href="classFunction.html">Function</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00150">function.h:153</a></div></div>
<div class="ttc" id="aclassFunction_html_a4b0aadc89a827b39c20f12889aa88625"><div class="ttname"><a href="classFunction.html#a4b0aadc89a827b39c20f12889aa88625">Function::gradient</a></div><div class="ttdeci">virtual Tensor&lt; 1, dim, RangeNumberType &gt; gradient(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const</div></div>
<div class="ttc" id="aclassFunction_html_acbfcab66b2fc63bfea59268f40772bb4"><div class="ttname"><a href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">Function::value</a></div><div class="ttdeci">virtual RangeNumberType value(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const</div></div>
<div class="ttc" id="aclassPoint_html"><div class="ttname"><a href="classPoint.html">Point</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2point_8h_source.html#l00110">point.h:111</a></div></div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 1, dim &gt;</a></div></div>
<div class="ttc" id="aclassVectorizedArray_html_adea3423146bcdda2dce143cfb4d10ae8"><div class="ttname"><a href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">VectorizedArray::cos</a></div><div class="ttdeci">VectorizedArray&lt; Number, width &gt; cos(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05318">vectorization.h:5318</a></div></div>
<div class="ttc" id="aclassVectorizedArray_html_ae4e256a1298425a946574012d5b81e53"><div class="ttname"><a href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">VectorizedArray::sin</a></div><div class="ttdeci">VectorizedArray&lt; Number, width &gt; sin(const ::VectorizedArray&lt; Number, width &gt; &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05291">vectorization.h:5291</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga0d685aad996180f9851183ae3e29019a"><div class="ttname"><a href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">StandardExceptions::ExcIndexRange</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcIndexRange(int arg1, int arg2, int arg3)</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01473">exceptions.h:1473</a></div></div>
<div class="ttc" id="anamespacenumbers_html_a3e24f194a9cb9b6ff4442b8a7a877d4a"><div class="ttname"><a href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a></div><div class="ttdeci">static constexpr double PI</div><div class="ttdef"><b>Definition:</b> <a href="numbers_8h_source.html#l00231">numbers.h:231</a></div></div>
</div><!-- fragment --><p>请注意，对于梯度，我们需要返回一个Tensor&lt;1,dim&gt;。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a class="code" href="classTensor.html">Tensor&lt;1, 2&gt;</a> Solution&lt;2&gt;::gradient(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;2&gt;</a> &amp;   p,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 2, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 2 + 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> y = p(1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, 2&gt;</a> return_value;</div>
<div class="line">  <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">    {</div>
<div class="line">      return_value[0] = <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">      return_value[1] = 0.0;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">    {</div>
<div class="line">      return_value[0] = y * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">      return_value[1] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">    {</div>
<div class="line">      return_value[0] = <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line">      return_value[1] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> return_value;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a class="code" href="classTensor.html">Tensor&lt;1, 3&gt;</a> Solution&lt;3&gt;::gradient(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;3&gt;</a> &amp;   p,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 3, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 3 + 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> y = p(1);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> z = p(2);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, 3&gt;</a> return_value;</div>
<div class="line">  <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">    {</div>
<div class="line">      return_value[0] = 2 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">      return_value[1] = 0.0;</div>
<div class="line">      return_value[2] = 0.0;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">    {</div>
<div class="line">      return_value[0] = y * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">      return_value[1] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">      return_value[2] = 0.0;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">    {</div>
<div class="line">      return_value[0] = z * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">      return_value[1] = 0.0;</div>
<div class="line">      return_value[2] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 3)</div>
<div class="line">    {</div>
<div class="line">      return_value[0] = <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">      return_value[1] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">      return_value[2] = <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> return_value;</div>
<div class="line">}</div>
</div><!-- fragment --><p>\(f\) 的实现。更多信息请参见介绍。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  RightHandSide()</div>
<div class="line">    : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(dim + 1)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keywordtype">double</span> RightHandSide&lt;2&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;2&gt;</a> &amp;   p,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 2, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 2 + 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">  <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">  <span class="keywordtype">double</span> y = p(1);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) + <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">    <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) - <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keywordtype">double</span> RightHandSide&lt;3&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;3&gt;</a> &amp;   p,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 3, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 3 + 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">  <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">  <span class="keywordtype">double</span> y = p(1);</div>
<div class="line">  <span class="keywordtype">double</span> z = p(2);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">    <span class="keywordflow">return</span> 2 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) +</div>
<div class="line">           <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">    <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) +</div>
<div class="line">           <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * (-1) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">    <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) +</div>
<div class="line">           <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z) * <a class="code" href="classVectorizedArray.html#ae4e256a1298425a946574012d5b81e53">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="classVectorizedArray.html#adea3423146bcdda2dce143cfb4d10ae8">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line">  <span class="keywordflow">if</span> (component == 3)</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="ASPECTBlockSchurPreconditioner"></a> </p><h3>ASPECT BlockSchurPreconditioner</h3>
<p>．</p>
<p>在下文中，我们将实现一个预处理程序，它扩展了 <a class="el" href="step_22.html">step-22</a> 的结果部分所讨论的想法。具体来说，我们1.使用一个上块三角的预处理器，因为我们想使用右预处理。2.可选择允许使用速度块的内部求解器，而不是单一的预处理程序应用。3.不使用InverseMatrix，而是明确地调用SolverCG。这种方法也用于ASPECT代码（见https://aspect.geodynamics.org），该代码在模拟地幔对流的背景下求解斯托克斯方程，该代码已被用于解决成千上万个处理器上的问题。 <br  />
</p>
<p>构造函数中的bool标志 <code>do_solve_A</code> 允许我们对速度块应用一次预处理，或者使用内部迭代求解器来代替更精确的近似。 <br  />
</p>
<p>注意我们是如何跟踪内部迭代的总和（预处理程序的应用）的。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> PreconditionerAType, <span class="keyword">class</span> PreconditionerSType&gt;</div>
<div class="line"><span class="keyword">class </span>BlockSchurPreconditioner : <span class="keyword">public</span> <a class="code" href="classSubscriptor.html">Subscriptor</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  BlockSchurPreconditioner(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> &amp;system_matrix,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> &amp;     schur_complement_matrix,</div>
<div class="line">    <span class="keyword">const</span> PreconditionerAType &amp;      preconditioner_A,</div>
<div class="line">    <span class="keyword">const</span> PreconditionerSType &amp;      preconditioner_S,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span>                       do_solve_A);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> vmult(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;dst, <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;src) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">mutable</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_iterations_A;</div>
<div class="line">  <span class="keyword">mutable</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_iterations_S;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> &amp;system_matrix;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> &amp;     schur_complement_matrix;</div>
<div class="line">  <span class="keyword">const</span> PreconditionerAType &amp;      preconditioner_A;</div>
<div class="line">  <span class="keyword">const</span> PreconditionerSType &amp;      preconditioner_S;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span> do_solve_A;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> PreconditionerAType, <span class="keyword">class</span> PreconditionerSType&gt;</div>
<div class="line">BlockSchurPreconditioner&lt;PreconditionerAType, PreconditionerSType&gt;::</div>
<div class="line">  BlockSchurPreconditioner(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> &amp;system_matrix,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> &amp;     schur_complement_matrix,</div>
<div class="line">    <span class="keyword">const</span> PreconditionerAType &amp;      preconditioner_A,</div>
<div class="line">    <span class="keyword">const</span> PreconditionerSType &amp;      preconditioner_S,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span>                       do_solve_A)</div>
<div class="line">  : n_iterations_A(0)</div>
<div class="line">  , n_iterations_S(0)</div>
<div class="line">  , system_matrix(system_matrix)</div>
<div class="line">  , schur_complement_matrix(schur_complement_matrix)</div>
<div class="line">  , preconditioner_A(preconditioner_A)</div>
<div class="line">  , preconditioner_S(preconditioner_S)</div>
<div class="line">  , do_solve_A(do_solve_A)</div>
<div class="line">{}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> PreconditionerAType, <span class="keyword">class</span> PreconditionerSType&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">BlockSchurPreconditioner&lt;PreconditionerAType, PreconditionerSType&gt;::vmult(</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> utmp(src.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0));</div>
<div class="ttc" id="aclassBlockSparseMatrix_html"><div class="ttname"><a href="classBlockSparseMatrix.html">BlockSparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparse__matrix_8h_source.html#l00049">block_sparse_matrix.h:50</a></div></div>
<div class="ttc" id="aclassBlockVector_html"><div class="ttname"><a href="classBlockVector.html">BlockVector</a></div><div class="ttdef"><b>Definition:</b> <a href="block__vector_8h_source.html#l00070">block_vector.h:71</a></div></div>
<div class="ttc" id="aclassSparseMatrix_html"><div class="ttname"><a href="classSparseMatrix.html">SparseMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassSubscriptor_html"><div class="ttname"><a href="classSubscriptor.html">Subscriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="subscriptor_8h_source.html#l00061">subscriptor.h:62</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gae05a0e26814f032473ed2ef66da018bd"><div class="ttname"><a href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">BlockVectorBase::block</a></div><div class="ttdeci">BlockType &amp; block(const unsigned int i)</div></div>
</div><!-- fragment --><p>首先用S的近似值求解</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-6 * src.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1).l2_norm());</div>
<div class="line">  <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1) = 0.0;</div>
<div class="line">  cg.solve(schur_complement_matrix,</div>
<div class="line">           dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1),</div>
<div class="line">           src.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1),</div>
<div class="line">           preconditioner_S);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  n_iterations_S += solver_control.last_step();</div>
<div class="line">  dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1) *= -1.0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassSolverCG_html"><div class="ttname"><a href="classSolverCG.html">SolverCG</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__cg_8h_source.html#l00095">solver_cg.h:96</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00065">solver_control.h:66</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
</div><!-- fragment --><p>其次，应用右上角的块（B^T）。</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  system_matrix.block(0, 1).vmult(utmp, dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1));</div>
<div class="line">  utmp *= -1.0;</div>
<div class="line">  utmp += src.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><p>最后，要么用左上角的块求解，要么只应用一个预处理程序扫频。</p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span> (do_solve_A == <span class="keyword">true</span>)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(10000, utmp.l2_norm() * 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-4);</div>
<div class="line">      <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0) = 0.0;</div>
<div class="line">      cg.solve(system_matrix.block(0, 0),</div>
<div class="line">               dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0),</div>
<div class="line">               utmp,</div>
<div class="line">               preconditioner_A);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      n_iterations_A += solver_control.last_step();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      preconditioner_A.vmult(dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0), utmp);</div>
<div class="line">      n_iterations_A += 1;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="TheStokesProblemclass"></a></p><h3>The StokesProblem class</h3>
<p><br  />
</p>
<p>这是该问题的主要类别。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>StokesProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  StokesProblem(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pressure_degree,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classSolverType.html">SolverType</a>   solver_type);</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> setup_dofs();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">  <span class="keywordtype">void</span> assemble_multigrid();</div>
<div class="line">  <span class="keywordtype">void</span> solve();</div>
<div class="line">  <span class="keywordtype">void</span> compute_errors();</div>
<div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> refinement_cycle) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pressure_degree;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classSolverType.html">SolverType</a>   solver_type;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">  <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>      velocity_fe;</div>
<div class="line">  <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>      fe;</div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    velocity_dof_handler;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classBlockSparsityPattern.html">BlockSparsityPattern</a>      sparsity_pattern;</div>
<div class="line">  <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>      pressure_mass_matrix;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution;</div>
<div class="line">  <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a>      mg_sparsity_patterns;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_matrices;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_matrices;</div>
<div class="line">  <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a>                   mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">StokesProblem&lt;dim&gt;::StokesProblem(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pressure_degree,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classSolverType.html">SolverType</a>   solver_type)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  : pressure_degree(pressure_degree)</div>
<div class="line">  , solver_type(solver_type)</div>
<div class="line">  , <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::maximum_smoothing)</div>
<div class="line">  ,</div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassBlockSparsityPattern_html"><div class="ttname"><a href="classBlockSparsityPattern.html">BlockSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparsity__pattern_8h_source.html#l00406">block_sparsity_pattern.h:407</a></div></div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00314">dof_handler.h:315</a></div></div>
<div class="ttc" id="aclassFESystem_html"><div class="ttname"><a href="classFESystem.html">FESystem</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__system_8h_source.html#l00215">fe_system.h:216</a></div></div>
<div class="ttc" id="aclassMGConstrainedDoFs_html"><div class="ttname"><a href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__constrained__dofs_8h_source.html#l00046">mg_constrained_dofs.h:47</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html"><div class="ttname"><a href="classMGLevelObject.html">MGLevelObject&lt; SparsityPattern &gt;</a></div></div>
<div class="ttc" id="aclassTimerOutput_html"><div class="ttname"><a href="classTimerOutput.html">TimerOutput</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00544">timer.h:545</a></div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01127">tria.h:1128</a></div></div>
<div class="ttc" id="anamespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00691">work_stream.h:691</a></div></div>
<div class="ttc" id="ap4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
</div><!-- fragment --><p>只针对速度的有限元。</p>
<div class="fragment"><div class="line">velocity_fe(<a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>(pressure_degree + 1), dim)</div>
<div class="line">,</div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8h_source.html#l00548">fe_q.h:549</a></div></div>
</div><!-- fragment --><p>整个系统的有限元。</p>
<div class="fragment"><div class="line">  fe(velocity_fe, 1, <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>(pressure_degree), 1)</div>
<div class="line">  , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , velocity_dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , computing_timer(std::cout, <a class="code" href="classTimerOutput.html#a643d0e642b80048e91b37109fe9357cbaed9deac359496981f6275d6d6962e652">TimerOutput::never</a>, <a class="code" href="classTimerOutput.html#a2405ae1b041a57d11a61a8cbfad3b487aa1bf9100145d06321277979f4ca77ba2">TimerOutput::wall_times</a>)</div>
<div class="line">{}</div>
<div class="ttc" id="aclassTimerOutput_html_a2405ae1b041a57d11a61a8cbfad3b487aa1bf9100145d06321277979f4ca77ba2"><div class="ttname"><a href="classTimerOutput.html#a2405ae1b041a57d11a61a8cbfad3b487aa1bf9100145d06321277979f4ca77ba2">TimerOutput::wall_times</a></div><div class="ttdeci">@ wall_times</div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00647">timer.h:647</a></div></div>
<div class="ttc" id="aclassTimerOutput_html_a643d0e642b80048e91b37109fe9357cbaed9deac359496981f6275d6d6962e652"><div class="ttname"><a href="classTimerOutput.html#a643d0e642b80048e91b37109fe9357cbaed9deac359496981f6275d6d6962e652">TimerOutput::never</a></div><div class="ttdeci">@ never</div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00612">timer.h:611</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="StokesProblemsetup_dofs"></a> </p><h4>StokesProblem::setup_dofs</h4>
<p>该函数设置了DoFHandler、矩阵、向量和Multigrid结构（如果需要）。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::setup_dofs()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> scope(computing_timer, <span class="stringliteral">&quot;Setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  system_matrix.clear();</div>
<div class="line">  pressure_mass_matrix.clear();</div>
<div class="ttc" id="aclassTimerOutput_1_1Scope_html"><div class="ttname"><a href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00552">timer.h:553</a></div></div>
</div><!-- fragment --><p>主DoFHandler只需要活动的DoF，所以我们不在这里调用distribution_mg_dofs()</p>
<div class="fragment"><div class="line">dof_handler.distribute_dofs(fe);</div>
</div><!-- fragment --><p>这个块结构将dim速度分量与压力分量（用于重新排序）分开。注意，我们有2个而不是像 <a class="el" href="step_22.html">step-22</a> 中的dim+1块，因为我们的FESystem是嵌套的，dim速度分量作为一个块出现。</p>
<div class="fragment"><div class="line">std::vector&lt;unsigned int&gt; block_component(2);</div>
<div class="line">block_component[0] = 0;</div>
<div class="line">block_component[1] = 1;</div>
</div><!-- fragment --><p>速度从分量0开始。</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> velocities(0);</div>
<div class="ttc" id="astructFEValuesExtractors_1_1Vector_html"><div class="ttname"><a href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__values__extractors_8h_source.html#l00150">fe_values_extractors.h:151</a></div></div>
</div><!-- fragment --><p>如果我们应用重新排序来减少填充，ILU的表现会更好。对于其他求解器来说，这样做并没有什么好处。</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_ILU)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> ilu_specific(computing_timer, <span class="stringliteral">&quot;(ILU specific)&quot;</span>);</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a>(dof_handler);</div>
<div class="line">  }</div>
<div class="ttc" id="anamespaceDoFRenumbering_html_a68651164485490b86d901d9ae1fbfc3b"><div class="ttname"><a href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a></div><div class="ttdeci">void Cuthill_McKee(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const bool reversed_numbering=false, const bool use_constraints=false, const std::vector&lt; types::global_dof_index &gt; &amp;starting_indices=std::vector&lt; types::global_dof_index &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l00366">dof_renumbering.cc:366</a></div></div>
</div><!-- fragment --><p>这确保了所有的速度DoF在压力未知数之前被列举出来。这允许我们使用块来处理向量和矩阵，并允许我们为dof_handler和velocity_dof_handler获得相同的DoF编号。</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceDoFRenumbering.html#a658593cab0e93a92a7d8ce0ffe086518">DoFRenumbering::block_wise</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_GMG)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> multigrid_specific(computing_timer,</div>
<div class="line">                                          <span class="stringliteral">&quot;(Multigrid specific)&quot;</span>);</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> setup_multigrid(computing_timer,</div>
<div class="line">                                       <span class="stringliteral">&quot;Setup - Multigrid&quot;</span>);</div>
<div class="ttc" id="anamespaceDoFRenumbering_html_a658593cab0e93a92a7d8ce0ffe086518"><div class="ttname"><a href="namespaceDoFRenumbering.html#a658593cab0e93a92a7d8ce0ffe086518">DoFRenumbering::block_wise</a></div><div class="ttdeci">void block_wise(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler)</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l00997">dof_renumbering.cc:997</a></div></div>
</div><!-- fragment --><p>这将速度空间的主动道次和多网格道次分布在一个单独的DoFHandler中，如介绍中所述。</p>
<div class="fragment"><div class="line">velocity_dof_handler.distribute_dofs(velocity_fe);</div>
<div class="line">velocity_dof_handler.distribute_mg_dofs();</div>
</div><!-- fragment --><p>下面的代码块初始化了MGConstrainedDofs（使用速度的边界条件），以及每个层次的稀疏模式和矩阵。MGLevelObject&lt;T&gt;的resize()函数将销毁所有现有的包含对象。</p>
<div class="fragment"><div class="line">    std::set&lt;types::boundary_id&gt; zero_boundary_ids;</div>
<div class="line">    zero_boundary_ids.insert(0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    mg_constrained_dofs.clear();</div>
<div class="line">    mg_constrained_dofs.initialize(velocity_dof_handler);</div>
<div class="line">    mg_constrained_dofs.make_zero_boundary_constraints(velocity_dof_handler,</div>
<div class="line">                                                       zero_boundary_ids);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_levels = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    mg_interface_matrices.resize(0, n_levels - 1);</div>
<div class="line">    mg_matrices.resize(0, n_levels - 1);</div>
<div class="line">    mg_sparsity_patterns.resize(0, n_levels - 1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> csp(velocity_dof_handler.n_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                                   velocity_dof_handler.n_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">        <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(velocity_dof_handler, csp, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">        mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].copy_from(csp);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">        mg_interface_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; dofs_per_block =</div>
<div class="line">  <a class="code" href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a>(dof_handler, block_component);</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_u = dofs_per_block[0];</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_p = dofs_per_block[1];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">  constraints.clear();</div>
<div class="ttc" id="aclassDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamic__sparsity__pattern_8h_source.html#l00318">dynamic_sparsity_pattern.h:319</a></div></div>
<div class="ttc" id="agrid__out_8cc_html_a9082f945c1d289684d0bcd51ee08e11e"><div class="ttname"><a href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a></div><div class="ttdeci">unsigned int level</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04590">grid_out.cc:4590</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a796721b56b3a90e4e3973c7caae4c3d8"><div class="ttname"><a href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a></div><div class="ttdeci">std::vector&lt; types::global_dof_index &gt; count_dofs_per_fe_block(const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::vector&lt; unsigned int &gt; &amp;target_block=std::vector&lt; unsigned int &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l02047">dof_tools.cc:2047</a></div></div>
<div class="ttc" id="anamespaceMGTools_html_a19ba9ee4a2b65235c8bb3fb65ea8f4e0"><div class="ttname"><a href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity, const unsigned int level, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true)</div><div class="ttdef"><b>Definition:</b> <a href="mg__tools_8cc_source.html#l00593">mg_tools.cc:593</a></div></div>
</div><!-- fragment --><p>下面利用分量掩码，只对速度的边界值进行插值，这在矢量值dealii <a class="el" href="step_20.html">step-20</a> 教程中进一步解释。</p>
<div class="fragment"><div class="line"><a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div>
<div class="line"><a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                         0,</div>
<div class="line">                                         Solution&lt;dim&gt;(),</div>
<div class="line">                                         constraints,</div>
<div class="line">                                         fe.component_mask(velocities));</div>
<div class="ttc" id="agroup__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
</div><!-- fragment --><p>正如介绍中所讨论的，我们需要固定压力变量的一个自由度以确保问题的可解性。我们在这里通过标记第一个压力自由度来做到这一点，该自由度的索引为n_u，是一个受约束的自由度。</p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> (solver_type == SolverType::UMFPACK)</div>
<div class="line">      constraints.add_line(n_u);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    constraints.close();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\tNumber of active cells: &quot;</span> &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells()</div>
<div class="line">            &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;\tNumber of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.n_dofs()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; n_u &lt;&lt; <span class="charliteral">&#39;+&#39;</span> &lt;&lt; n_p &lt;&lt; <span class="charliteral">&#39;)&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a> csp(dofs_per_block, dofs_per_block);</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, csp, constraints, <span class="keyword">false</span>);</div>
<div class="line">    sparsity_pattern.copy_from(csp);</div>
<div class="line">  }</div>
<div class="line">  system_matrix.reinit(sparsity_pattern);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  solution.reinit(dofs_per_block);</div>
<div class="line">  system_rhs.reinit(dofs_per_block);</div>
<div class="line">}</div>
<div class="ttc" id="aclassBlockDynamicSparsityPattern_html"><div class="ttname"><a href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="block__sparsity__pattern_8h_source.html#l00524">block_sparsity_pattern.h:526</a></div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="StokesProblemassemble_system"></a></p><h4>StokesProblem::assemble_system</h4>
<p>在这个函数中，系统矩阵被组装起来。我们在(1,1)块中装配压力质量矩阵（如果需要），并在此函数结束时将其移出该位置。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::assemble_system()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> <a class="code" href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">assemble</a>(computing_timer, <span class="stringliteral">&quot;Assemble&quot;</span>);</div>
<div class="line">  system_matrix = 0;</div>
<div class="line">  system_rhs    = 0;</div>
<div class="ttc" id="anamespaceinternal_html_a2b3d48efdf7c94da455dc6a3553bab79"><div class="ttname"><a href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">internal::assemble</a></div><div class="ttdeci">void assemble(const MeshWorker::DoFInfoBox&lt; dim, DOFINFO &gt; &amp;dinfo, A *assembler)</div><div class="ttdef"><b>Definition:</b> <a href="loop_8h_source.html#l00071">loop.h:71</a></div></div>
</div><!-- fragment --><p>如果为真，我们将在(1,1)块中装配压力质量矩阵。</p>
<div class="fragment"><div class="line">  <span class="keyword">const</span> <span class="keywordtype">bool</span> assemble_pressure_mass_matrix =</div>
<div class="line">    (solver_type == SolverType::UMFPACK) ? <span class="keyword">false</span> : <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(pressure_degree + 2);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe.n_dofs_per_cell();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_matrix(dofs_per_cell, dofs_per_cell);</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     local_rhs(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> RightHandSide&lt;dim&gt;    right_hand_side;</div>
<div class="line">  std::vector&lt;Vector&lt;double&gt;&gt; rhs_values(n_q_points, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>(dim + 1));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> velocities(0);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> pressure(dim);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt; symgrad_phi_u(dofs_per_cell);</div>
<div class="line">  std::vector&lt;double&gt;                  div_phi_u(dofs_per_cell);</div>
<div class="line">  std::vector&lt;double&gt;                  phi_p(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.active_cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      fe_values.reinit(cell);</div>
<div class="line">      local_matrix = 0;</div>
<div class="line">      local_rhs    = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      right_hand_side.vector_value_list(fe_values.get_quadrature_points(),</div>
<div class="line">                                        rhs_values);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">            {</div>
<div class="line">              symgrad_phi_u[k] =</div>
<div class="line">                fe_values[velocities].symmetric_gradient(k, q);</div>
<div class="line">              div_phi_u[k] = fe_values[velocities].divergence(k, q);</div>
<div class="line">              phi_p[k]     = fe_values[pressure].value(k, q);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt;= i; ++j)</div>
<div class="line">                {</div>
<div class="line">                  local_matrix(i, j) +=</div>
<div class="line">                    (2 * (symgrad_phi_u[i] * symgrad_phi_u[j]) -</div>
<div class="line">                     div_phi_u[i] * phi_p[j] - phi_p[i] * div_phi_u[j] +</div>
<div class="line">                     (assemble_pressure_mass_matrix ? phi_p[i] * phi_p[j] :</div>
<div class="line">                                                      0)) *</div>
<div class="line">                    fe_values.JxW(q);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                fe.system_to_component_index(i).first;</div>
<div class="line">              local_rhs(i) += fe_values.shape_value(i, q) *</div>
<div class="line">                              rhs_values[q](component_i) * fe_values.JxW(q);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + 1; j &lt; dofs_per_cell; ++j)</div>
<div class="line">          local_matrix(i, j) = local_matrix(j, i);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      cell-&gt;get_dof_indices(local_dof_indices);</div>
<div class="line">      constraints.distribute_local_to_global(local_matrix,</div>
<div class="line">                                             local_rhs,</div>
<div class="line">                                             local_dof_indices,</div>
<div class="line">                                             system_matrix,</div>
<div class="line">                                             system_rhs);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (solver_type != SolverType::UMFPACK)</div>
<div class="line">    {</div>
<div class="line">      pressure_mass_matrix.reinit(sparsity_pattern.block(1, 1));</div>
<div class="line">      pressure_mass_matrix.copy_from(system_matrix.block(1, 1));</div>
<div class="line">      system_matrix.block(1, 1) = 0;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l03905">fe_values.h:3906</a></div></div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00038">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00078">fe_update_flags.h:78</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00129">fe_update_flags.h:129</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00084">fe_update_flags.h:84</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00122">fe_update_flags.h:122</a></div></div>
<div class="ttc" id="astructFEValuesExtractors_1_1Scalar_html"><div class="ttname"><a href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__values__extractors_8h_source.html#l00095">fe_values_extractors.h:96</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="StokesProblemassemble_multigrid"></a> </p><h4>StokesProblem::assemble_multigrid</h4>
<p>在这里，就像在 <a class="el" href="step_16.html">step-16</a> 中一样，我们有一个函数来组装多网格预处理程序所需的水平和界面矩阵。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::assemble_multigrid()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> multigrid_specific(computing_timer,</div>
<div class="line">                                        <span class="stringliteral">&quot;(Multigrid specific)&quot;</span>);</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> assemble_multigrid(computing_timer,</div>
<div class="line">                                        <span class="stringliteral">&quot;Assemble Multigrid&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  mg_matrices = 0.;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(pressure_degree + 2);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(velocity_fe,</div>
<div class="line">                          quadrature_formula,</div>
<div class="line">                          <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = velocity_fe.n_dofs_per_cell();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> velocities(0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt; symgrad_phi_u(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels());</div>
<div class="line">  std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_interface_constraints(</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels(); ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">    {</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">        mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">        mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">      boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].close();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classIndexSet.html">IndexSet</a> idx = mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>) &amp;</div>
<div class="line">                     mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      boundary_interface_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(idx);</div>
<div class="line">      boundary_interface_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].close();</div>
<div class="line">    }</div>
<div class="ttc" id="aclassIndexSet_html"><div class="ttname"><a href="classIndexSet.html">IndexSet</a></div><div class="ttdef"><b>Definition:</b> <a href="index__set_8h_source.html#l00072">index_set.h:73</a></div></div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Advection_html_a8bc7b8136646134f73a4193adefe15f8"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">LocalIntegrators::Advection::cell_matrix</a></div><div class="ttdeci">void cell_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const FEValuesBase&lt; dim &gt; &amp;fetest, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="advection_8h_source.html#l00075">advection.h:75</a></div></div>
</div><!-- fragment --><p>这个迭代器覆盖了所有的单元（不仅仅是活动的）。</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : velocity_dof_handler.cell_iterators())</div>
<div class="line">    {</div>
<div class="line">      fe_values.reinit(cell);</div>
<div class="line">      <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">            symgrad_phi_u[k] = fe_values[velocities].symmetric_gradient(k, q);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt;= i; ++j)</div>
<div class="line">              {</div>
<div class="line">                <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) +=</div>
<div class="line">                  (symgrad_phi_u[i] * symgrad_phi_u[j]) * fe_values.JxW(q);</div>
<div class="line">              }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + 1; j &lt; dofs_per_cell; ++j)</div>
<div class="line">          <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) = <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(j, i);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      cell-&gt;get_mg_dof_indices(local_dof_indices);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      boundary_constraints[cell-&gt;level()].distribute_local_to_global(</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>, local_dof_indices, mg_matrices[cell-&gt;level()]);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">          <span class="keywordflow">if</span> (!mg_constrained_dofs.at_refinement_edge(cell-&gt;level(),</div>
<div class="line">                                                      local_dof_indices[i]) ||</div>
<div class="line">              mg_constrained_dofs.at_refinement_edge(cell-&gt;level(),</div>
<div class="line">                                                     local_dof_indices[j]))</div>
<div class="line">            <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      boundary_interface_constraints[cell-&gt;level()]</div>
<div class="line">        .distribute_local_to_global(<a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>,</div>
<div class="line">                                    local_dof_indices,</div>
<div class="line">                                    mg_interface_matrices[cell-&gt;level()]);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="StokesProblemsolve"></a> </p><h4>StokesProblem::solve</h4>
<p>这个函数根据你是想使用ILU还是GMG作为预处理程序来设置不同的东西。 这两种方法共享相同的求解器（FGMRES），但需要初始化不同的预处理器。在这里，我们不仅对整个求解函数进行计时，而且对预调节器的设置以及求解本身分别进行计时。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::solve()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> solve(computing_timer, <span class="stringliteral">&quot;Solve&quot;</span>);</div>
<div class="line">  constraints.set_zero(solution);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (solver_type == SolverType::UMFPACK)</div>
<div class="line">    {</div>
<div class="line">      computing_timer.enter_subsection(<span class="stringliteral">&quot;(UMFPACK specific)&quot;</span>);</div>
<div class="line">      computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve - Initialize&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">      A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(system_matrix);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      computing_timer.leave_subsection();</div>
<div class="line">      computing_timer.leave_subsection();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> solve_backslash(computing_timer,</div>
<div class="line">                                           <span class="stringliteral">&quot;Solve - Backslash&quot;</span>);</div>
<div class="line">        A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(solution, system_rhs);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      constraints.distribute(solution);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html"><div class="ttname"><a href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8h_source.html#l00087">sparse_direct.h:88</a></div></div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html_a25b1d3c7dbb88158a76165a4a56a16d6"><div class="ttname"><a href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">SparseDirectUMFPACK::initialize</a></div><div class="ttdeci">void initialize(const SparsityPattern &amp;sparsity_pattern)</div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8cc_source.html#l00049">sparse_direct.cc:49</a></div></div>
<div class="ttc" id="aclassSparseDirectUMFPACK_html_adc154e4830b0e16be265f10a5c8b7103"><div class="ttname"><a href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">SparseDirectUMFPACK::vmult</a></div><div class="ttdeci">void vmult(Vector&lt; double &gt; &amp;dst, const Vector&lt; double &gt; &amp;src) const</div><div class="ttdef"><b>Definition:</b> <a href="sparse__direct_8cc_source.html#l00762">sparse_direct.cc:762</a></div></div>
</div><!-- fragment --><p>这里我们必须确保以 "足够好 "的精度求解残差。</p>
<div class="fragment"><div class="line"><a class="code" href="classSolverControl.html">SolverControl</a> solver_control(system_matrix.m(),</div>
<div class="line">                             1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-10 * system_rhs.l2_norm());</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  n_iterations_A;</div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  n_iterations_S;</div>
</div><!-- fragment --><p>这是用来传递我们是否要在预处理程序中求解A。 我们可以把它改为false，看看是否仍有收敛性，如果有，程序会不会运行得更快或更慢。</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span> use_expensive = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classSolverFGMRES.html">SolverFGMRES&lt;BlockVector&lt;double&gt;</a>&gt; solver(solver_control);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_ILU)</div>
<div class="line">  {</div>
<div class="line">    computing_timer.enter_subsection(<span class="stringliteral">&quot;(ILU specific)&quot;</span>);</div>
<div class="line">    computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve - Set-up Preconditioner&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;   Computing preconditioner...&quot;</span> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a> A_preconditioner;</div>
<div class="line">    A_preconditioner.<a class="code" href="group__Preconditioners.html#gae4b56dfaab3fd8820faa1b21160b1acb">initialize</a>(system_matrix.block(0, 0));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a> S_preconditioner;</div>
<div class="line">    S_preconditioner.<a class="code" href="group__Preconditioners.html#gae4b56dfaab3fd8820faa1b21160b1acb">initialize</a>(pressure_mass_matrix);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> BlockSchurPreconditioner&lt;SparseILU&lt;double&gt;, <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a>&gt;</div>
<div class="line">      preconditioner(system_matrix,</div>
<div class="line">                     pressure_mass_matrix,</div>
<div class="line">                     A_preconditioner,</div>
<div class="line">                     S_preconditioner,</div>
<div class="line">                     use_expensive);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    computing_timer.leave_subsection();</div>
<div class="line">    computing_timer.leave_subsection();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> solve_fmgres(computing_timer, <span class="stringliteral">&quot;Solve - FGMRES&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      solver.solve(system_matrix, solution, system_rhs, preconditioner);</div>
<div class="line">      n_iterations_A = preconditioner.n_iterations_A;</div>
<div class="line">      n_iterations_S = preconditioner.n_iterations_S;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    computing_timer.enter_subsection(<span class="stringliteral">&quot;(Multigrid specific)&quot;</span>);</div>
<div class="line">    computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve - Set-up Preconditioner&quot;</span>);</div>
<div class="ttc" id="aclassSolverFGMRES_html"><div class="ttname"><a href="classSolverFGMRES.html">SolverFGMRES</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__gmres_8h_source.html#l00459">solver_gmres.h:460</a></div></div>
<div class="ttc" id="aclassSparseILU_html"><div class="ttname"><a href="classSparseILU.html">SparseILU</a></div><div class="ttdef"><b>Definition:</b> <a href="sparse__ilu_8h_source.html#l00059">sparse_ilu.h:60</a></div></div>
<div class="ttc" id="agroup__Preconditioners_html_gae4b56dfaab3fd8820faa1b21160b1acb"><div class="ttname"><a href="group__Preconditioners.html#gae4b56dfaab3fd8820faa1b21160b1acb">SparseILU::initialize</a></div><div class="ttdeci">void initialize(const SparseMatrix&lt; somenumber &gt; &amp;matrix, const AdditionalData &amp;parameters=AdditionalData())</div></div>
</div><!-- fragment --><p>在各级之间转移运算符</p>
<div class="fragment"><div class="line"><a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt; mg_transfer(mg_constrained_dofs);</div>
<div class="line">mg_transfer.build(velocity_dof_handler);</div>
<div class="ttc" id="aclassMGTransferPrebuilt_html"><div class="ttname"><a href="classMGTransferPrebuilt.html">MGTransferPrebuilt</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer_8h_source.html#l00636">mg_transfer.h:637</a></div></div>
</div><!-- fragment --><p>设置粗略的网格解算器</p>
<div class="fragment"><div class="line"><a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> coarse_matrix;</div>
<div class="line">coarse_matrix.<a class="code" href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">copy_from</a>(mg_matrices[0]);</div>
<div class="line"><a class="code" href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder&lt;double, Vector&lt;double&gt;</a>&gt; coarse_grid_solver;</div>
<div class="line">coarse_grid_solver.<a class="code" href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">initialize</a>(coarse_matrix);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionSOR.html">PreconditionSOR&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line"><a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation&lt;Smoother, Vector&lt;double&gt;</a>&gt; mg_smoother;</div>
<div class="line">mg_smoother.<a class="code" href="classmg_1_1SmootherRelaxation.html#ae9e03c626c50a1b13dffe338f5f977b0">initialize</a>(mg_matrices);</div>
<div class="line">mg_smoother.<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(2);</div>
<div class="ttc" id="aclassFullMatrix_html_ae9e8fbf00e15c7b66d527a5de4b31404"><div class="ttname"><a href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">FullMatrix::copy_from</a></div><div class="ttdeci">void copy_from(const MatrixType &amp;)</div></div>
<div class="ttc" id="aclassMGCoarseGridHouseholder_html"><div class="ttname"><a href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__coarse_8h_source.html#l00175">mg_coarse.h:176</a></div></div>
<div class="ttc" id="aclassMGCoarseGridHouseholder_html_a07bd76dc7f6f66cb22d3e7951a558f50"><div class="ttname"><a href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">MGCoarseGridHouseholder::initialize</a></div><div class="ttdeci">void initialize(const FullMatrix&lt; number &gt; &amp;A)</div></div>
<div class="ttc" id="aclassMGSmoother_html_a9976182b6b272aac7800a8fbf18c8ab9"><div class="ttname"><a href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">MGSmoother::set_steps</a></div><div class="ttdeci">void set_steps(const unsigned int)</div></div>
<div class="ttc" id="aclassPreconditionSOR_html"><div class="ttname"><a href="classPreconditionSOR.html">PreconditionSOR</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00583">precondition.h:584</a></div></div>
<div class="ttc" id="aclassmg_1_1SmootherRelaxation_html"><div class="ttname"><a href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__smoother_8h_source.html#l00183">mg_smoother.h:185</a></div></div>
<div class="ttc" id="aclassmg_1_1SmootherRelaxation_html_ae9e03c626c50a1b13dffe338f5f977b0"><div class="ttname"><a href="classmg_1_1SmootherRelaxation.html#ae9e03c626c50a1b13dffe338f5f977b0">mg::SmootherRelaxation::initialize</a></div><div class="ttdeci">void initialize(const MGLevelObject&lt; MatrixType2 &gt; &amp;matrices, const typename RelaxationType::AdditionalData &amp;additional_data=typename RelaxationType::AdditionalData())</div></div>
</div><!-- fragment --><p>多网格作为CG的预处理程序时，需要是一个对称算子，所以平滑器必须是对称的。</p>
<div class="fragment"><div class="line">mg_smoother.<a class="code" href="classMGSmoother.html#abed2837ee4e224f94c6a98405906df8f">set_symmetric</a>(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_matrix(mg_matrices);</div>
<div class="line"><a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_up(mg_interface_matrices);</div>
<div class="line"><a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_down(mg_interface_matrices);</div>
<div class="ttc" id="aclassMGSmoother_html_abed2837ee4e224f94c6a98405906df8f"><div class="ttname"><a href="classMGSmoother.html#abed2837ee4e224f94c6a98405906df8f">MGSmoother::set_symmetric</a></div><div class="ttdeci">void set_symmetric(const bool)</div></div>
<div class="ttc" id="aclassmg_1_1Matrix_html"><div class="ttname"><a href="classmg_1_1Matrix.html">mg::Matrix</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__matrix_8h_source.html#l00044">mg_matrix.h:45</a></div></div>
</div><!-- fragment --><p>现在，我们准备设置V型循环算子和多级预处理器。</p>
<div class="fragment"><div class="line">      <a class="code" href="classMultigrid.html">Multigrid&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">        mg_matrix, coarse_grid_solver, mg_transfer, mg_smoother, mg_smoother);</div>
<div class="line">      <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface_down, mg_interface_up);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, Vector&lt;double&gt;</a>, <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;&gt;</div>
<div class="line">        A_Multigrid(velocity_dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a> S_preconditioner;</div>
<div class="line">      S_preconditioner.<a class="code" href="group__Preconditioners.html#gae4b56dfaab3fd8820faa1b21160b1acb">initialize</a>(pressure_mass_matrix,</div>
<div class="line">                                  <a class="code" href="group__Preconditioners.html#gae21347f3202a1186060eac36dcb45817">SparseILU&lt;double&gt;::AdditionalData</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> BlockSchurPreconditioner&lt;</div>
<div class="line">        <a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;dim,</div>
<div class="line">                       <a class="code" href="classVector.html">Vector&lt;double&gt;</a>,</div>
<div class="line">                       <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;&gt;,</div>
<div class="line">        <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a>&gt;</div>
<div class="line">        preconditioner(system_matrix,</div>
<div class="line">                       pressure_mass_matrix,</div>
<div class="line">                       A_Multigrid,</div>
<div class="line">                       S_preconditioner,</div>
<div class="line">                       use_expensive);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      computing_timer.leave_subsection();</div>
<div class="line">      computing_timer.leave_subsection();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> solve_fmgres(computing_timer, <span class="stringliteral">&quot;Solve - FGMRES&quot;</span>);</div>
<div class="line">        solver.solve(system_matrix, solution, system_rhs, preconditioner);</div>
<div class="line">        n_iterations_A = preconditioner.n_iterations_A;</div>
<div class="line">        n_iterations_S = preconditioner.n_iterations_S;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout</div>
<div class="line">    &lt;&lt; std::endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;\tNumber of FGMRES iterations: &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">    &lt;&lt; std::endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;\tTotal number of iterations used for approximation of A inverse: &quot;</span></div>
<div class="line">    &lt;&lt; n_iterations_A &lt;&lt; std::endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;\tTotal number of iterations used for approximation of S inverse: &quot;</span></div>
<div class="line">    &lt;&lt; n_iterations_S &lt;&lt; std::endl</div>
<div class="line">    &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassMultigrid_html"><div class="ttname"><a href="classMultigrid.html">Multigrid</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_8h_source.html#l00152">multigrid.h:153</a></div></div>
<div class="ttc" id="aclassPreconditionMG_html"><div class="ttname"><a href="classPreconditionMG.html">PreconditionMG</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_8h_source.html#l00467">multigrid.h:468</a></div></div>
<div class="ttc" id="agroup__Preconditioners_html_gae21347f3202a1186060eac36dcb45817"><div class="ttname"><a href="group__Preconditioners.html#gae21347f3202a1186060eac36dcb45817">SparseILU::AdditionalData</a></div><div class="ttdeci">typename SparseLUDecomposition&lt; number &gt;::AdditionalData AdditionalData</div><div class="ttdef"><b>Definition:</b> <a href="sparse__ilu_8h_source.html#l00079">sparse_ilu.h:79</a></div></div>
<div class="ttc" id="anamespacemg_html"><div class="ttname"><a href="namespacemg.html">mg</a></div><div class="ttdef"><b>Definition:</b> <a href="mg_8h_source.html#l00081">mg.h:82</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="StokesProblemprocess_solution"></a> </p><h4>StokesProblem::process_solution</h4>
<p>这个函数计算解的L2和H1误差。为此，我们需要确保压力的平均值为零。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::compute_errors()</div>
<div class="line">{</div>
</div><!-- fragment --><p>计算平均压力 \(\frac{1}{\Omega} \int_{\Omega} p(x) dx \) ，然后从每个压力系数中减去它。这将导致压力的平均值为零。这里我们利用了压力是分量 \(dim\) 和有限元空间是节点的事实。</p>
<div class="fragment"><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> mean_pressure = <a class="code" href="namespaceVectorTools.html#ad086eb08b8424fd7c853e389a3978a9a">VectorTools::compute_mean_value</a>(</div>
<div class="line">    dof_handler, <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(pressure_degree + 2), solution, dim);</div>
<div class="line">  solution.block(1).add(-mean_pressure);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;   Note: The mean value was adjusted by &quot;</span> &lt;&lt; -mean_pressure</div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a> pressure_mask(dim, dim + 1);</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a> velocity_mask(std::make_pair(0, dim),</div>
<div class="line">                                                   dim + 1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;float&gt;</a> difference_per_cell(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(dof_handler,</div>
<div class="line">                                    solution,</div>
<div class="line">                                    Solution&lt;dim&gt;(),</div>
<div class="line">                                    difference_per_cell,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(pressure_degree + 2),</div>
<div class="line">                                    <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a>,</div>
<div class="line">                                    &amp;velocity_mask);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> Velocity_L2_error =</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">                                      difference_per_cell,</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(dof_handler,</div>
<div class="line">                                    solution,</div>
<div class="line">                                    Solution&lt;dim&gt;(),</div>
<div class="line">                                    difference_per_cell,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(pressure_degree + 2),</div>
<div class="line">                                    <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a>,</div>
<div class="line">                                    &amp;pressure_mask);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> Pressure_L2_error =</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">                                      difference_per_cell,</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(dof_handler,</div>
<div class="line">                                    solution,</div>
<div class="line">                                    Solution&lt;dim&gt;(),</div>
<div class="line">                                    difference_per_cell,</div>
<div class="line">                                    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(pressure_degree + 2),</div>
<div class="line">                                    <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a6a4df2311989608627aa7bff3898fd3c">VectorTools::H1_norm</a>,</div>
<div class="line">                                    &amp;velocity_mask);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> Velocity_H1_error =</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">                                      difference_per_cell,</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a6a4df2311989608627aa7bff3898fd3c">VectorTools::H1_norm</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;   Velocity L2 Error: &quot;</span> &lt;&lt; Velocity_L2_error &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;   Pressure L2 Error: &quot;</span> &lt;&lt; Pressure_L2_error &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;   Velocity H1 Error: &quot;</span> &lt;&lt; Velocity_H1_error &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassComponentSelectFunction_html"><div class="ttname"><a href="classComponentSelectFunction.html">ComponentSelectFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00583">function.h:585</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a21eb62d70953182dcc2b15c4e14dd533"><div class="ttname"><a href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a></div><div class="ttdeci">double compute_global_error(const Triangulation&lt; dim, spacedim &gt; &amp;tria, const InVector &amp;cellwise_error, const NormType &amp;norm, const double exponent=2.)</div></div>
<div class="ttc" id="anamespaceVectorTools_html_a676190d2c897ac5da68a9c460fa95832"><div class="ttname"><a href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a></div><div class="ttdeci">void integrate_difference(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const InVector &amp;fe_function, const Function&lt; spacedim, typename InVector::value_type &gt; &amp;exact_solution, OutVector &amp;difference, const Quadrature&lt; dim &gt; &amp;q, const NormType &amp;norm, const Function&lt; spacedim, double &gt; *weight=nullptr, const double exponent=2.)</div></div>
<div class="ttc" id="anamespaceVectorTools_html_a69967cb7a148a7169963126249213db1a6a4df2311989608627aa7bff3898fd3c"><div class="ttname"><a href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a6a4df2311989608627aa7bff3898fd3c">VectorTools::H1_norm</a></div><div class="ttdeci">@ H1_norm</div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__common_8h_source.html#l00204">vector_tools_common.h:204</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e"><div class="ttname"><a href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a></div><div class="ttdeci">@ L2_norm</div><div class="ttdef"><b>Definition:</b> <a href="vector__tools__common_8h_source.html#l00113">vector_tools_common.h:113</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ad086eb08b8424fd7c853e389a3978a9a"><div class="ttname"><a href="namespaceVectorTools.html#ad086eb08b8424fd7c853e389a3978a9a">VectorTools::compute_mean_value</a></div><div class="ttdeci">VectorType::value_type compute_mean_value(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const Quadrature&lt; dim &gt; &amp;quadrature, const VectorType &amp;v, const unsigned int component)</div></div>
</div><!-- fragment --><p><a class="anchor" id="StokesProblemoutput_results"></a> </p><h4>StokesProblem::output_results</h4>
<p>这个函数生成图形输出，就像在 <a class="el" href="step_22.html">step-22</a> 中所做的那样。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">StokesProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> refinement_cycle)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  std::vector&lt;std::string&gt; solution_names(dim, <span class="stringliteral">&quot;velocity&quot;</span>);</div>
<div class="line">  solution_names.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">    data_component_interpretation(</div>
<div class="line">      dim, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">  data_component_interpretation.push_back(</div>
<div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution,</div>
<div class="line">                           solution_names,</div>
<div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                           data_component_interpretation);</div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::ofstream output(</div>
<div class="line">    <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(refinement_cycle, 2) + <span class="stringliteral">&quot;.vtk&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="group__Exceptions.html#gacad99726038e4fca7f605fdffb3317e4">write_vtk</a>(output);</div>
<div class="line">}</div>
<div class="ttc" id="aclassDataOut__DoFData_html_ac1eb26168177faa30ffbcf9cbb9c3cd5"><div class="ttname"><a href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandlerType &amp;)</div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_ace4b76e565ba0701c4d32c26075ed3b9"><div class="ttname"><a href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="data__out__dof__data_8h_source.html#l01087">data_out_dof_data.h:1087</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8h_source.html#l00147">data_out.h:150</a></div></div>
<div class="ttc" id="aclassDataOut_html_a5eb51872b8736849bb7e8d2007fae086"><div class="ttname"><a href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01085">data_out.cc:1085</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gacad99726038e4fca7f605fdffb3317e4"><div class="ttname"><a href="group__Exceptions.html#gacad99726038e4fca7f605fdffb3317e4">DataOutInterface::write_vtk</a></div><div class="ttdeci">void write_vtk(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07177">data_out_base.cc:7177</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a></div><div class="ttdeci">@ component_is_scalar</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00053">data_component_interpretation.h:53</a></div></div>
<div class="ttc" id="anamespaceDataComponentInterpretation_html_a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0"><div class="ttname"><a href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a></div><div class="ttdeci">@ component_is_part_of_vector</div><div class="ttdef"><b>Definition:</b> <a href="data__component__interpretation_8h_source.html#l00059">data_component_interpretation.h:59</a></div></div>
<div class="ttc" id="anamespaceUtilities_html_a6195c5f009ea8c7c536c6ffdf108c32f"><div class="ttname"><a href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></div><div class="ttdeci">std::string int_to_string(const unsigned int value, const unsigned int digits=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00473">utilities.cc:473</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="StokesProblemrun"></a> </p><h4>StokesProblem::run</h4>
<p>．</p>
<p>斯托克斯类的最后一步是，像往常一样，生成初始网格的函数，并按各自的顺序调用其他函数。</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">StokesProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(6 - dim);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_ILU)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Now running with ILU&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_GMG)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Now running with Multigrid&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Now running with UMFPACK&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> refinement_cycle = 0; refinement_cycle &lt; 3;</div>
<div class="line">         ++refinement_cycle)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Refinement cycle &quot;</span> &lt;&lt; refinement_cycle &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (refinement_cycle &gt; 0)</div>
<div class="line">          <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Set-up...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        setup_dofs();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Assembling...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        assemble_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_GMG)</div>
<div class="line">          {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;   Assembling Multigrid...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            assemble_multigrid();</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Solving...&quot;</span> &lt;&lt; std::flush;</div>
<div class="line">        solve();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        compute_errors();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        output_results(refinement_cycle);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <a class="code" href="structUtilities_1_1System_1_1MemoryStats.html">Utilities::System::MemoryStats</a> mem;</div>
<div class="line">        <a class="code" href="namespaceUtilities_1_1System.html#a25db0fc07c298b5bef3d6f738283bd6d">Utilities::System::get_memory_stats</a>(mem);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   VM Peak: &quot;</span> &lt;&lt; mem.<a class="code" href="structUtilities_1_1System_1_1MemoryStats.html#a61f9c5964eabf0f746ae35019042f28a">VmPeak</a> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        computing_timer.print_summary();</div>
<div class="line">        computing_timer.reset();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step56</span></div>
<div class="ttc" id="anamespaceGridGenerator_html_acea0cbcd68e52ce8113d1134b87de403"><div class="ttname"><a href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube</a></div><div class="ttdeci">void hyper_cube(Triangulation&lt; dim, spacedim &gt; &amp;tria, const double left=0., const double right=1., const bool colorize=false)</div></div>
<div class="ttc" id="anamespaceUtilities_1_1System_html_a25db0fc07c298b5bef3d6f738283bd6d"><div class="ttname"><a href="namespaceUtilities_1_1System.html#a25db0fc07c298b5bef3d6f738283bd6d">Utilities::System::get_memory_stats</a></div><div class="ttdeci">void get_memory_stats(MemoryStats &amp;stats)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00970">utilities.cc:970</a></div></div>
<div class="ttc" id="astructUtilities_1_1System_1_1MemoryStats_html"><div class="ttname"><a href="structUtilities_1_1System_1_1MemoryStats.html">Utilities::System::MemoryStats</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2utilities_8h_source.html#l00860">utilities.h:861</a></div></div>
<div class="ttc" id="astructUtilities_1_1System_1_1MemoryStats_html_a61f9c5964eabf0f746ae35019042f28a"><div class="ttname"><a href="structUtilities_1_1System_1_1MemoryStats.html#a61f9c5964eabf0f746ae35019042f28a">Utilities::System::MemoryStats::VmPeak</a></div><div class="ttdeci">unsigned long int VmPeak</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2utilities_8h_source.html#l00865">utilities.h:865</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Themainfunction"></a></p><h3>The main function</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span>Step56;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> degree = 1;</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> dim    = 3;</div>
</div><!-- fragment --><p>SolverType的选项。umfpack fgmres_ilu fgmres_gmg</p>
<div class="fragment"><div class="line">      StokesProblem&lt;dim&gt; flow_problem(degree, SolverType::FGMRES_GMG);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      flow_problem.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Results"></a></p><h1>Results</h1>
<p><a class="anchor" id="Errors"></a></p><h3>Errors </h3>
<p>我们首先运行代码，确认有限元解以混合有限元问题的误差分析所预测的正确速率收敛。给定足够平滑的精确解 \(u\) 和 \(p\) ，Taylor-Hood元素 \(Q_k \times Q_{k-1}\) 的误差应该是</p>
<p class="formulaDsp">
\[ \| u -u_h \|_0 + h ( \| u- u_h\|_1 + \|p - p_h \|_0) \leq C h^{k+1} ( \|u \|_{k+1} + \| p \|_k ) \]
</p>
<p>例如，见Ern/Guermond "有限元的理论与实践"，第4.2.5节第195页。这确实是我们观察到的，以 \(Q_2 \times Q_1\) 元素为例（这就是代码中的做法，但在 <code>main()</code> 中很容易改变）。</p>
<table align="center" class="doxtable">
<tr>
<th>&#160; </th><th>L2 Velocity </th><th>Reduction </th><th>L2 Pressure </th><th>Reduction </th><th>H1 Velocity </th><th>Reduction  </th></tr>
<tr>
<td>3D, 3 global refinements </td><td>0.000670888 </td><td align="center">- </td><td>0.0036533 </td><td align="center">- </td><td>0.0414704 </td><td align="center">-  </td></tr>
<tr>
<td>3D, 4 global refinements </td><td>8.38E-005 </td><td>8.0 </td><td>0.00088494 </td><td>4.1 </td><td>0.0103781 </td><td>4.0  </td></tr>
<tr>
<td>3D, 5 global refinements </td><td>1.05E-005 </td><td>8.0 </td><td>0.000220253 </td><td>4.0 </td><td>0.00259519 </td><td>4.0   </td></tr>
</table>
<p><br  />
</p>
<p><a class="anchor" id="TimingResults"></a></p><h3>Timing Results </h3>
<p>让我们比较一下使用UMFPACK的直接求解方法和我们选择 \(\widetilde {A^{-1}}=A^{-1}\) 和 \(\widetilde{S^{-1}}=S^{-1}\) 的两种方法，用CG求解 \(A,S\) 的线性系统。然后CG的预处理程序是ILU或GMG。下表总结了求解器的迭代、时间和虚拟内存（VM）的峰值使用。</p>
<table align="center" class="doxtable">
<tr>
<th></th><th colspan="3">General </th><th colspan="6">GMG </th><th colspan="6">ILU </th><th colspan="3">UMFPACK  </th></tr>
<tr>
<th></th><th></th><th colspan="2">Timings </th><th colspan="2">Timings </th><th colspan="3">Iterations </th><th></th><th colspan="2">Timings </th><th colspan="3">Iterations </th><th></th><th colspan="2">Timings </th><th></th></tr>
<tr>
<th>Cycle </th><th>DoFs </th><th>Setup </th><th>Assembly </th><th>Setup </th><th>Solve </th><th>Outer </th><th>Inner (A) </th><th>Inner (S) </th><th>VM Peak </th><th>Setup </th><th>Solve </th><th>Outer </th><th>Inner (A) </th><th>Inner (S) </th><th>VM Peak </th><th>Setup </th><th>Solve </th><th>VM Peak  </th></tr>
<tr>
<td>0 </td><td>15468 </td><td>0.1s </td><td>0.3s </td><td>0.3s </td><td>1.3s </td><td>21 </td><td>67 </td><td>22 </td><td>4805 </td><td>0.3s </td><td>0.6s </td><td>21 </td><td>180 </td><td>22 </td><td>4783 </td><td>2.65s </td><td>2.8s </td><td>5054  </td></tr>
<tr>
<td>1 </td><td>112724 </td><td>1.0s </td><td>2.4s </td><td>2.6s </td><td>14s </td><td>21 </td><td>67 </td><td>22 </td><td>5441 </td><td>2.8s </td><td>15.8s </td><td>21 </td><td>320 </td><td>22 </td><td>5125 </td><td>236s </td><td>237s </td><td>11288  </td></tr>
<tr>
<td>2 </td><td>859812 </td><td>9.0s </td><td>20s </td><td>20s </td><td>101s </td><td>20 </td><td>65 </td><td>21 </td><td>10641 </td><td>27s </td><td>268s </td><td>21 </td><td>592 </td><td>22 </td><td>8307 </td><td>- </td><td>- </td><td>-  </td></tr>
</table>
<p><br  />
</p>
<p>从表中可以看出。</p>
<ol type="1">
<li>UMFPACK使用了大量的内存，特别是在3D中。另外，UMFPACK的时序并不随问题大小而变化。</li>
<li>因为我们对 \(A\) 和 \(S\) 使用内部求解器，ILU和GMG需要相同数量的外部迭代。</li>
<li>3. 对于ILU来说， \(A\) 的（内部）迭代次数随着细化而增加，导致求解时间的线性扩展性较差。相比之下， \(A\) 的内部迭代次数在GMG中保持不变，导致求解时间几乎完美的缩放。</li>
<li>GMG需要比ILU多一点的内存来存储水平和界面矩阵。</li>
</ol>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions </h3>
<p><a class="anchor" id="Checkhigherorderdiscretizations"></a></p><h4>Check higher order discretizations </h4>
<p>用更高阶的稳定FE对进行实验，并检查你是否观察到正确的收敛率。</p>
<p><a class="anchor" id="Comparewithcheappreconditioner"></a></p><h4>Compare with cheap preconditioner </h4>
<p>介绍中还概述了另一种对整个系统进行预处理的方案，即我们不选择上表中的 \(\widetilde {A^{-1}}=A^{-1}\) ，而是在 \(\widetilde{A^{-1}}\) 中只分别使用GMG或ILU的单一预处理程序。</p>
<p>这实际上是在代码中实现的。目前，布尔值 <code>use_expensive</code> in <code>solve()</code> 被设置为 <code>true</code>. 上面提到的选项是通过设置为 <code>false</code>. 得到的。</p>
<p>你会发现的是，如果你这样使用GMG，FGMRES的迭代次数在细化中保持不变。这意味着多重网格是最优的，并且不受 \(h\) 的影响。<a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2016 - 2020 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> * Author: Ryan Grove, Clemson University</span></div>
<div class="line"><span class="comment"> *         Timo Heister, Clemson University</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="logstream_8h.html">deal.II/base/logstream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__vector_8h.html">deal.II/lac/block_vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__sparse__matrix_8h.html">deal.II/lac/block_sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="block__sparsity__pattern_8h.html">deal.II/lac/block_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__tools_8h.html">deal.II/grid/grid_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="error__estimator_8h.html">deal.II/numerics/error_estimator.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__direct_8h.html">deal.II/lac/sparse_direct.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__ilu_8h.html">deal.II/lac/sparse_ilu.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step56</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum class</span> <a class="code" href="classSolverType.html">SolverType</a></div>
<div class="line">  {</div>
<div class="line">    FGMRES_ILU,</div>
<div class="line">    FGMRES_GMG,</div>
<div class="line">    UMFPACK</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>Solution : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    Solution()</div>
<div class="line">      : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(dim + 1)</div>
<div class="line">    {}</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a></div>
<div class="line">    <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">gradient</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;&gt;</div>
<div class="line">  <span class="keywordtype">double</span> Solution&lt;2&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;2&gt;</a> &amp;   p,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 2 + 1, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 2 + 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> y = p(1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">      <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;&gt;</div>
<div class="line">  <span class="keywordtype">double</span> Solution&lt;3&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;3&gt;</a> &amp;   p,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 3 + 1, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 3 + 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> y = p(1);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> z = p(2);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">      <span class="keywordflow">return</span> 2.0 * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">      <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">      <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 3)</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;&gt;</div>
<div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, 2&gt;</a> Solution&lt;2&gt;::gradient(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;2&gt;</a> &amp;   p,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 2, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 2 + 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> y = p(1);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, 2&gt;</a> return_value;</div>
<div class="line">    <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">      {</div>
<div class="line">        return_value[0] = <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">        return_value[1] = 0.0;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">      {</div>
<div class="line">        return_value[0] = y * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">        return_value[1] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">      {</div>
<div class="line">        return_value[0] = <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line">        return_value[1] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> return_value;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;&gt;</div>
<div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, 3&gt;</a> Solution&lt;3&gt;::gradient(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;3&gt;</a> &amp;   p,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 3, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 3 + 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> y = p(1);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> z = p(2);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, 3&gt;</a> return_value;</div>
<div class="line">    <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">      {</div>
<div class="line">        return_value[0] = 2 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">        return_value[1] = 0.0;</div>
<div class="line">        return_value[2] = 0.0;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">      {</div>
<div class="line">        return_value[0] = y * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">        return_value[1] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">        return_value[2] = 0.0;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">      {</div>
<div class="line">        return_value[0] = z * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">        return_value[1] = 0.0;</div>
<div class="line">        return_value[2] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 3)</div>
<div class="line">      {</div>
<div class="line">        return_value[0] = <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">        return_value[1] = -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">        return_value[2] = <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> return_value;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    RightHandSide()</div>
<div class="line">      : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(dim + 1)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;&gt;</div>
<div class="line">  <span class="keywordtype">double</span> RightHandSide&lt;2&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;2&gt;</a> &amp;   p,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 2, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 2 + 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">    <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">    <span class="keywordtype">double</span> y = p(1);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) + <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">      <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) - <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;&gt;</div>
<div class="line">  <span class="keywordtype">double</span> RightHandSide&lt;3&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;3&gt;</a> &amp;   p,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component &lt;= 3, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 3 + 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a>;</div>
<div class="line">    <span class="keywordtype">double</span> x = p(0);</div>
<div class="line">    <span class="keywordtype">double</span> y = p(1);</div>
<div class="line">    <span class="keywordtype">double</span> z = p(2);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 0)</div>
<div class="line">      <span class="keywordflow">return</span> 2 * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) +</div>
<div class="line">             <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 1)</div>
<div class="line">      <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) +</div>
<div class="line">             <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * (-1) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 2)</div>
<div class="line">      <span class="keywordflow">return</span> -<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) +</div>
<div class="line">             <a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * z) * <a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * x) * <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">PI</a> * y);</div>
<div class="line">    <span class="keywordflow">if</span> (component == 3)</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> PreconditionerAType, <span class="keyword">class</span> PreconditionerSType&gt;</div>
<div class="line">  <span class="keyword">class </span>BlockSchurPreconditioner : <span class="keyword">public</span> <a class="code" href="classSubscriptor.html">Subscriptor</a></div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    BlockSchurPreconditioner(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> &amp;system_matrix,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> &amp;     schur_complement_matrix,</div>
<div class="line">      <span class="keyword">const</span> PreconditionerAType &amp;      preconditioner_A,</div>
<div class="line">      <span class="keyword">const</span> PreconditionerSType &amp;      preconditioner_S,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span>                       do_solve_A);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> vmult(<a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;dst, <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;src) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">mutable</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_iterations_A;</div>
<div class="line">    <span class="keyword">mutable</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_iterations_S;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> &amp;system_matrix;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> &amp;     schur_complement_matrix;</div>
<div class="line">    <span class="keyword">const</span> PreconditionerAType &amp;      preconditioner_A;</div>
<div class="line">    <span class="keyword">const</span> PreconditionerSType &amp;      preconditioner_S;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_solve_A;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> PreconditionerAType, <span class="keyword">class</span> PreconditionerSType&gt;</div>
<div class="line">  BlockSchurPreconditioner&lt;PreconditionerAType, PreconditionerSType&gt;::</div>
<div class="line">    BlockSchurPreconditioner(</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> &amp;system_matrix,</div>
<div class="line">      <span class="keyword">const</span> <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> &amp;     schur_complement_matrix,</div>
<div class="line">      <span class="keyword">const</span> PreconditionerAType &amp;      preconditioner_A,</div>
<div class="line">      <span class="keyword">const</span> PreconditionerSType &amp;      preconditioner_S,</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span>                       do_solve_A)</div>
<div class="line">    : n_iterations_A(0)</div>
<div class="line">    , n_iterations_S(0)</div>
<div class="line">    , system_matrix(system_matrix)</div>
<div class="line">    , schur_complement_matrix(schur_complement_matrix)</div>
<div class="line">    , preconditioner_A(preconditioner_A)</div>
<div class="line">    , preconditioner_S(preconditioner_S)</div>
<div class="line">    , do_solve_A(do_solve_A)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> PreconditionerAType, <span class="keyword">class</span> PreconditionerSType&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  BlockSchurPreconditioner&lt;PreconditionerAType, PreconditionerSType&gt;::vmult(</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;      dst,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> &amp;src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> utmp(src.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0));</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(1000, 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-6 * src.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1).l2_norm());</div>
<div class="line">      <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">      dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1) = 0.0;</div>
<div class="line">      cg.solve(schur_complement_matrix,</div>
<div class="line">               dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1),</div>
<div class="line">               src.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1),</div>
<div class="line">               preconditioner_S);</div>
<div class="line"> </div>
<div class="line">      n_iterations_S += solver_control.last_step();</div>
<div class="line">      dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1) *= -1.0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      system_matrix.block(0, 1).vmult(utmp, dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(1));</div>
<div class="line">      utmp *= -1.0;</div>
<div class="line">      utmp += src.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (do_solve_A == <span class="keyword">true</span>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classSolverControl.html">SolverControl</a>            solver_control(10000, utmp.l2_norm() * 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-4);</div>
<div class="line">        <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solver_control);</div>
<div class="line"> </div>
<div class="line">        dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0) = 0.0;</div>
<div class="line">        cg.solve(system_matrix.block(0, 0),</div>
<div class="line">                 dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0),</div>
<div class="line">                 utmp,</div>
<div class="line">                 preconditioner_A);</div>
<div class="line"> </div>
<div class="line">        n_iterations_A += solver_control.last_step();</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        preconditioner_A.vmult(dst.<a class="code" href="group__Exceptions.html#gae05a0e26814f032473ed2ef66da018bd">block</a>(0), utmp);</div>
<div class="line">        n_iterations_A += 1;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>StokesProblem</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    StokesProblem(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pressure_degree,</div>
<div class="line">                  <span class="keyword">const</span> <a class="code" href="classSolverType.html">SolverType</a>   solver_type);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_dofs();</div>
<div class="line">    <span class="keywordtype">void</span> assemble_system();</div>
<div class="line">    <span class="keywordtype">void</span> assemble_multigrid();</div>
<div class="line">    <span class="keywordtype">void</span> solve();</div>
<div class="line">    <span class="keywordtype">void</span> compute_errors();</div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> refinement_cycle) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pressure_degree;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classSolverType.html">SolverType</a>   solver_type;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">    <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>      velocity_fe;</div>
<div class="line">    <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>      fe;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    velocity_dof_handler;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classBlockSparsityPattern.html">BlockSparsityPattern</a>      sparsity_pattern;</div>
<div class="line">    <a class="code" href="classBlockSparseMatrix.html">BlockSparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>      pressure_mass_matrix;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> solution;</div>
<div class="line">    <a class="code" href="classBlockVector.html">BlockVector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a>      mg_sparsity_patterns;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_matrices;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_matrices;</div>
<div class="line">    <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a>                   mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimerOutput.html">TimerOutput</a> computing_timer;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  StokesProblem&lt;dim&gt;::StokesProblem(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pressure_degree,</div>
<div class="line">                                    <span class="keyword">const</span> <a class="code" href="classSolverType.html">SolverType</a>   solver_type)</div>
<div class="line"> </div>
<div class="line">    : pressure_degree(pressure_degree)</div>
<div class="line">    , solver_type(solver_type)</div>
<div class="line">    , <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::maximum_smoothing)</div>
<div class="line">    ,</div>
<div class="line">    velocity_fe(<a class="code" href="classFE__Q.html">FE_Q</a>&lt;dim&gt;(pressure_degree + 1), dim)</div>
<div class="line">    ,</div>
<div class="line">    fe(velocity_fe, 1, <a class="code" href="classFE__Q.html">FE_Q</a>&lt;dim&gt;(pressure_degree), 1)</div>
<div class="line">    , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">    , velocity_dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">    , computing_timer(std::cout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::never, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times)</div>
<div class="line">  {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::setup_dofs()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> scope(computing_timer, <span class="stringliteral">&quot;Setup&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    system_matrix.clear();</div>
<div class="line">    pressure_mass_matrix.clear();</div>
<div class="line"> </div>
<div class="line">    dof_handler.distribute_dofs(fe);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned int&gt; block_component(2);</div>
<div class="line">    block_component[0] = 0;</div>
<div class="line">    block_component[1] = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> velocities(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_ILU)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> ilu_specific(computing_timer, <span class="stringliteral">&quot;(ILU specific)&quot;</span>);</div>
<div class="line">        <a class="code" href="namespaceDoFRenumbering.html#a68651164485490b86d901d9ae1fbfc3b">DoFRenumbering::Cuthill_McKee</a>(dof_handler);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a658593cab0e93a92a7d8ce0ffe086518">DoFRenumbering::block_wise</a>(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_GMG)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> multigrid_specific(computing_timer,</div>
<div class="line">                                              <span class="stringliteral">&quot;(Multigrid specific)&quot;</span>);</div>
<div class="line">        <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> setup_multigrid(computing_timer,</div>
<div class="line">                                           <span class="stringliteral">&quot;Setup - Multigrid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        velocity_dof_handler.distribute_dofs(velocity_fe);</div>
<div class="line">        velocity_dof_handler.distribute_mg_dofs();</div>
<div class="line"> </div>
<div class="line">        std::set&lt;types::boundary_id&gt; zero_boundary_ids;</div>
<div class="line">        zero_boundary_ids.insert(0);</div>
<div class="line"> </div>
<div class="line">        mg_constrained_dofs.clear();</div>
<div class="line">        mg_constrained_dofs.initialize(velocity_dof_handler);</div>
<div class="line">        mg_constrained_dofs.make_zero_boundary_constraints(velocity_dof_handler,</div>
<div class="line">                                                           zero_boundary_ids);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_levels = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels();</div>
<div class="line"> </div>
<div class="line">        mg_interface_matrices.resize(0, n_levels - 1);</div>
<div class="line">        mg_matrices.resize(0, n_levels - 1);</div>
<div class="line">        mg_sparsity_patterns.resize(0, n_levels - 1);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> csp(velocity_dof_handler.n_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                                       velocity_dof_handler.n_dofs(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">            <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(velocity_dof_handler, csp, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">            mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].copy_from(csp);</div>
<div class="line"> </div>
<div class="line">            mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">            mg_interface_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::vector&lt;types::global_dof_index&gt; dofs_per_block =</div>
<div class="line">      <a class="code" href="namespaceDoFTools.html#a796721b56b3a90e4e3973c7caae4c3d8">DoFTools::count_dofs_per_fe_block</a>(dof_handler, block_component);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_u = dofs_per_block[0];</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_p = dofs_per_block[1];</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      constraints.clear();</div>
<div class="line">      <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(dof_handler,</div>
<div class="line">                                               0,</div>
<div class="line">                                               Solution&lt;dim&gt;(),</div>
<div class="line">                                               constraints,</div>
<div class="line">                                               fe.component_mask(velocities));</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (solver_type == SolverType::UMFPACK)</div>
<div class="line">        constraints.add_line(n_u);</div>
<div class="line"> </div>
<div class="line">      constraints.close();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\tNumber of active cells: &quot;</span> &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells()</div>
<div class="line">              &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\tNumber of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.n_dofs()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; n_u &lt;&lt; <span class="charliteral">&#39;+&#39;</span> &lt;&lt; n_p &lt;&lt; <span class="charliteral">&#39;)&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classBlockDynamicSparsityPattern.html">BlockDynamicSparsityPattern</a> csp(dofs_per_block, dofs_per_block);</div>
<div class="line">      <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler, csp, constraints, <span class="keyword">false</span>);</div>
<div class="line">      sparsity_pattern.copy_from(csp);</div>
<div class="line">    }</div>
<div class="line">    system_matrix.reinit(sparsity_pattern);</div>
<div class="line"> </div>
<div class="line">    solution.reinit(dofs_per_block);</div>
<div class="line">    system_rhs.reinit(dofs_per_block);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::assemble_system()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> <a class="code" href="namespaceinternal.html#a2b3d48efdf7c94da455dc6a3553bab79">assemble</a>(computing_timer, <span class="stringliteral">&quot;Assemble&quot;</span>);</div>
<div class="line">    system_matrix = 0;</div>
<div class="line">    system_rhs    = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> assemble_pressure_mass_matrix =</div>
<div class="line">      (solver_type == SolverType::UMFPACK) ? <span class="keyword">false</span> : <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(pressure_degree + 2);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(fe,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                              <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = fe.n_dofs_per_cell();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> local_matrix(dofs_per_cell, dofs_per_cell);</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     local_rhs(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> RightHandSide&lt;dim&gt;    right_hand_side;</div>
<div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; rhs_values(n_q_points, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>(dim + 1));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> velocities(0);</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Scalar.html">FEValuesExtractors::Scalar</a> pressure(dim);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt; symgrad_phi_u(dofs_per_cell);</div>
<div class="line">    std::vector&lt;double&gt;                  div_phi_u(dofs_per_cell);</div>
<div class="line">    std::vector&lt;double&gt;                  phi_p(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.active_cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        fe_values.reinit(cell);</div>
<div class="line">        local_matrix = 0;</div>
<div class="line">        local_rhs    = 0;</div>
<div class="line"> </div>
<div class="line">        right_hand_side.vector_value_list(fe_values.get_quadrature_points(),</div>
<div class="line">                                          rhs_values);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">              {</div>
<div class="line">                symgrad_phi_u[k] =</div>
<div class="line">                  fe_values[velocities].symmetric_gradient(k, q);</div>
<div class="line">                div_phi_u[k] = fe_values[velocities].divergence(k, q);</div>
<div class="line">                phi_p[k]     = fe_values[pressure].value(k, q);</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">              {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt;= i; ++j)</div>
<div class="line">                  {</div>
<div class="line">                    local_matrix(i, j) +=</div>
<div class="line">                      (2 * (symgrad_phi_u[i] * symgrad_phi_u[j]) -</div>
<div class="line">                       div_phi_u[i] * phi_p[j] - phi_p[i] * div_phi_u[j] +</div>
<div class="line">                       (assemble_pressure_mass_matrix ? phi_p[i] * phi_p[j] :</div>
<div class="line">                                                        0)) *</div>
<div class="line">                      fe_values.JxW(q);</div>
<div class="line">                  }</div>
<div class="line"> </div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component_i =</div>
<div class="line">                  fe.system_to_component_index(i).first;</div>
<div class="line">                local_rhs(i) += fe_values.shape_value(i, q) *</div>
<div class="line">                                rhs_values[q](component_i) * fe_values.JxW(q);</div>
<div class="line">              }</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + 1; j &lt; dofs_per_cell; ++j)</div>
<div class="line">            local_matrix(i, j) = local_matrix(j, i);</div>
<div class="line"> </div>
<div class="line">        cell-&gt;get_dof_indices(local_dof_indices);</div>
<div class="line">        constraints.distribute_local_to_global(local_matrix,</div>
<div class="line">                                               local_rhs,</div>
<div class="line">                                               local_dof_indices,</div>
<div class="line">                                               system_matrix,</div>
<div class="line">                                               system_rhs);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (solver_type != SolverType::UMFPACK)</div>
<div class="line">      {</div>
<div class="line">        pressure_mass_matrix.reinit(sparsity_pattern.block(1, 1));</div>
<div class="line">        pressure_mass_matrix.copy_from(system_matrix.block(1, 1));</div>
<div class="line">        system_matrix.block(1, 1) = 0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::assemble_multigrid()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> multigrid_specific(computing_timer,</div>
<div class="line">                                          <span class="stringliteral">&quot;(Multigrid specific)&quot;</span>);</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> assemble_multigrid(computing_timer,</div>
<div class="line">                                          <span class="stringliteral">&quot;Assemble Multigrid&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    mg_matrices = 0.;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_formula(pressure_degree + 2);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values(velocity_fe,</div>
<div class="line">                            quadrature_formula,</div>
<div class="line">                            <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> |</div>
<div class="line">                              <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell = velocity_fe.n_dofs_per_cell();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points    = quadrature_formula.size();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(dofs_per_cell, dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; local_dof_indices(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structFEValuesExtractors_1_1Vector.html">FEValuesExtractors::Vector</a> velocities(0);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;SymmetricTensor&lt;2, dim&gt;&gt; symgrad_phi_u(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">      <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels());</div>
<div class="line">    std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_interface_constraints(</div>
<div class="line">      <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels(); ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">      {</div>
<div class="line">        boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">          mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">        boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">          mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">        boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].close();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classIndexSet.html">IndexSet</a> idx = mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>) &amp;</div>
<div class="line">                       mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line"> </div>
<div class="line">        boundary_interface_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(idx);</div>
<div class="line">        boundary_interface_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].close();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : velocity_dof_handler.cell_iterators())</div>
<div class="line">      {</div>
<div class="line">        fe_values.reinit(cell);</div>
<div class="line">        <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a> = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_q_points; ++q)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; dofs_per_cell; ++k)</div>
<div class="line">              symgrad_phi_u[k] = fe_values[velocities].symmetric_gradient(k, q);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt;= i; ++j)</div>
<div class="line">                {</div>
<div class="line">                  <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) +=</div>
<div class="line">                    (symgrad_phi_u[i] * symgrad_phi_u[j]) * fe_values.JxW(q);</div>
<div class="line">                }</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + 1; j &lt; dofs_per_cell; ++j)</div>
<div class="line">            <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) = <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(j, i);</div>
<div class="line"> </div>
<div class="line">        cell-&gt;get_mg_dof_indices(local_dof_indices);</div>
<div class="line"> </div>
<div class="line">        boundary_constraints[cell-&gt;level()].distribute_local_to_global(</div>
<div class="line">          <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>, local_dof_indices, mg_matrices[cell-&gt;level()]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">            <span class="keywordflow">if</span> (!mg_constrained_dofs.at_refinement_edge(cell-&gt;level(),</div>
<div class="line">                                                        local_dof_indices[i]) ||</div>
<div class="line">                mg_constrained_dofs.at_refinement_edge(cell-&gt;level(),</div>
<div class="line">                                                       local_dof_indices[j]))</div>
<div class="line">              <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>(i, j) = 0;</div>
<div class="line"> </div>
<div class="line">        boundary_interface_constraints[cell-&gt;level()]</div>
<div class="line">          .distribute_local_to_global(<a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>,</div>
<div class="line">                                      local_dof_indices,</div>
<div class="line">                                      mg_interface_matrices[cell-&gt;level()]);</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::solve()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> solve(computing_timer, <span class="stringliteral">&quot;Solve&quot;</span>);</div>
<div class="line">    constraints.set_zero(solution);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (solver_type == SolverType::UMFPACK)</div>
<div class="line">      {</div>
<div class="line">        computing_timer.enter_subsection(<span class="stringliteral">&quot;(UMFPACK specific)&quot;</span>);</div>
<div class="line">        computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve - Initialize&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> A_direct;</div>
<div class="line">        A_direct.<a class="code" href="classSparseDirectUMFPACK.html#a25b1d3c7dbb88158a76165a4a56a16d6">initialize</a>(system_matrix);</div>
<div class="line"> </div>
<div class="line">        computing_timer.leave_subsection();</div>
<div class="line">        computing_timer.leave_subsection();</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> solve_backslash(computing_timer,</div>
<div class="line">                                             <span class="stringliteral">&quot;Solve - Backslash&quot;</span>);</div>
<div class="line">          A_direct.<a class="code" href="classSparseDirectUMFPACK.html#adc154e4830b0e16be265f10a5c8b7103">vmult</a>(solution, system_rhs);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        constraints.distribute(solution);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(system_matrix.m(),</div>
<div class="line">                                 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-10 * system_rhs.l2_norm());</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  n_iterations_A;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  n_iterations_S;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> use_expensive = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSolverFGMRES.html">SolverFGMRES&lt;BlockVector&lt;double&gt;</a>&gt; solver(solver_control);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_ILU)</div>
<div class="line">      {</div>
<div class="line">        computing_timer.enter_subsection(<span class="stringliteral">&quot;(ILU specific)&quot;</span>);</div>
<div class="line">        computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve - Set-up Preconditioner&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Computing preconditioner...&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                  &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a> A_preconditioner;</div>
<div class="line">        A_preconditioner.<a class="code" href="group__Preconditioners.html#gae4b56dfaab3fd8820faa1b21160b1acb">initialize</a>(system_matrix.block(0, 0));</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a> S_preconditioner;</div>
<div class="line">        S_preconditioner.<a class="code" href="group__Preconditioners.html#gae4b56dfaab3fd8820faa1b21160b1acb">initialize</a>(pressure_mass_matrix);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> BlockSchurPreconditioner&lt;SparseILU&lt;double&gt;, <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a>&gt;</div>
<div class="line">          preconditioner(system_matrix,</div>
<div class="line">                         pressure_mass_matrix,</div>
<div class="line">                         A_preconditioner,</div>
<div class="line">                         S_preconditioner,</div>
<div class="line">                         use_expensive);</div>
<div class="line"> </div>
<div class="line">        computing_timer.leave_subsection();</div>
<div class="line">        computing_timer.leave_subsection();</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> solve_fmgres(computing_timer, <span class="stringliteral">&quot;Solve - FGMRES&quot;</span>);</div>
<div class="line"> </div>
<div class="line">          solver.solve(system_matrix, solution, system_rhs, preconditioner);</div>
<div class="line">          n_iterations_A = preconditioner.n_iterations_A;</div>
<div class="line">          n_iterations_S = preconditioner.n_iterations_S;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        computing_timer.enter_subsection(<span class="stringliteral">&quot;(Multigrid specific)&quot;</span>);</div>
<div class="line">        computing_timer.enter_subsection(<span class="stringliteral">&quot;Solve - Set-up Preconditioner&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt; mg_transfer(mg_constrained_dofs);</div>
<div class="line">        mg_transfer.build(velocity_dof_handler);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> coarse_matrix;</div>
<div class="line">        coarse_matrix.<a class="code" href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">copy_from</a>(mg_matrices[0]);</div>
<div class="line">        <a class="code" href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder&lt;double, Vector&lt;double&gt;</a>&gt; coarse_grid_solver;</div>
<div class="line">        coarse_grid_solver.<a class="code" href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">initialize</a>(coarse_matrix);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionSOR.html">PreconditionSOR&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line">        <a class="code" href="classmg_1_1SmootherRelaxation.html">mg::SmootherRelaxation&lt;Smoother, Vector&lt;double&gt;</a>&gt; mg_smoother;</div>
<div class="line">        mg_smoother.<a class="code" href="classmg_1_1SmootherRelaxation.html#ae9e03c626c50a1b13dffe338f5f977b0">initialize</a>(mg_matrices);</div>
<div class="line">        mg_smoother.<a class="code" href="classMGSmoother.html#a9976182b6b272aac7800a8fbf18c8ab9">set_steps</a>(2);</div>
<div class="line"> </div>
<div class="line">        mg_smoother.<a class="code" href="classMGSmoother.html#abed2837ee4e224f94c6a98405906df8f">set_symmetric</a>(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_matrix(mg_matrices);</div>
<div class="line">        <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_up(mg_interface_matrices);</div>
<div class="line">        <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_down(mg_interface_matrices);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classMultigrid.html">Multigrid&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">          mg_matrix, coarse_grid_solver, mg_transfer, mg_smoother, mg_smoother);</div>
<div class="line">        <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface_down, mg_interface_up);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, Vector&lt;double&gt;</a>, <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;&gt;</div>
<div class="line">          A_Multigrid(velocity_dof_handler, <a class="code" href="namespacemg.html">mg</a>, mg_transfer);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a> S_preconditioner;</div>
<div class="line">        S_preconditioner.<a class="code" href="group__Preconditioners.html#gae4b56dfaab3fd8820faa1b21160b1acb">initialize</a>(pressure_mass_matrix,</div>
<div class="line">                                    <a class="code" href="group__Preconditioners.html#gae21347f3202a1186060eac36dcb45817">SparseILU&lt;double&gt;::AdditionalData</a>());</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> BlockSchurPreconditioner&lt;</div>
<div class="line">          <a class="code" href="classPreconditionMG.html">PreconditionMG</a>&lt;dim,</div>
<div class="line">                         <a class="code" href="classVector.html">Vector&lt;double&gt;</a>,</div>
<div class="line">                         <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;&gt;,</div>
<div class="line">          <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a>&gt;</div>
<div class="line">          preconditioner(system_matrix,</div>
<div class="line">                         pressure_mass_matrix,</div>
<div class="line">                         A_Multigrid,</div>
<div class="line">                         S_preconditioner,</div>
<div class="line">                         use_expensive);</div>
<div class="line"> </div>
<div class="line">        computing_timer.leave_subsection();</div>
<div class="line">        computing_timer.leave_subsection();</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> solve_fmgres(computing_timer, <span class="stringliteral">&quot;Solve - FGMRES&quot;</span>);</div>
<div class="line">          solver.solve(system_matrix, solution, system_rhs, preconditioner);</div>
<div class="line">          n_iterations_A = preconditioner.n_iterations_A;</div>
<div class="line">          n_iterations_S = preconditioner.n_iterations_S;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line">    std::cout</div>
<div class="line">      &lt;&lt; std::endl</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot;\tNumber of FGMRES iterations: &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">      &lt;&lt; std::endl</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot;\tTotal number of iterations used for approximation of A inverse: &quot;</span></div>
<div class="line">      &lt;&lt; n_iterations_A &lt;&lt; std::endl</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot;\tTotal number of iterations used for approximation of S inverse: &quot;</span></div>
<div class="line">      &lt;&lt; n_iterations_S &lt;&lt; std::endl</div>
<div class="line">      &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> StokesProblem&lt;dim&gt;::compute_errors()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> mean_pressure = <a class="code" href="namespaceVectorTools.html#ad086eb08b8424fd7c853e389a3978a9a">VectorTools::compute_mean_value</a>(</div>
<div class="line">      dof_handler, <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(pressure_degree + 2), solution, dim);</div>
<div class="line">    solution.block(1).add(-mean_pressure);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;   Note: The mean value was adjusted by &quot;</span> &lt;&lt; -mean_pressure</div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a> pressure_mask(dim, dim + 1);</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classComponentSelectFunction.html">ComponentSelectFunction&lt;dim&gt;</a> velocity_mask(std::make_pair(0, dim),</div>
<div class="line">                                                     dim + 1);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;float&gt;</a> difference_per_cell(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells());</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(dof_handler,</div>
<div class="line">                                      solution,</div>
<div class="line">                                      Solution&lt;dim&gt;(),</div>
<div class="line">                                      difference_per_cell,</div>
<div class="line">                                      <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(pressure_degree + 2),</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a>,</div>
<div class="line">                                      &amp;velocity_mask);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> Velocity_L2_error =</div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">                                        difference_per_cell,</div>
<div class="line">                                        <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(dof_handler,</div>
<div class="line">                                      solution,</div>
<div class="line">                                      Solution&lt;dim&gt;(),</div>
<div class="line">                                      difference_per_cell,</div>
<div class="line">                                      <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(pressure_degree + 2),</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a>,</div>
<div class="line">                                      &amp;pressure_mask);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> Pressure_L2_error =</div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">                                        difference_per_cell,</div>
<div class="line">                                        <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1aa3903caf348e2d5dc54d1b49e15c1e8e">VectorTools::L2_norm</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#a676190d2c897ac5da68a9c460fa95832">VectorTools::integrate_difference</a>(dof_handler,</div>
<div class="line">                                      solution,</div>
<div class="line">                                      Solution&lt;dim&gt;(),</div>
<div class="line">                                      difference_per_cell,</div>
<div class="line">                                      <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a>(pressure_degree + 2),</div>
<div class="line">                                      <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a6a4df2311989608627aa7bff3898fd3c">VectorTools::H1_norm</a>,</div>
<div class="line">                                      &amp;velocity_mask);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> Velocity_H1_error =</div>
<div class="line">      <a class="code" href="namespaceVectorTools.html#a21eb62d70953182dcc2b15c4e14dd533">VectorTools::compute_global_error</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">                                        difference_per_cell,</div>
<div class="line">                                        <a class="code" href="namespaceVectorTools.html#a69967cb7a148a7169963126249213db1a6a4df2311989608627aa7bff3898fd3c">VectorTools::H1_norm</a>);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Velocity L2 Error: &quot;</span> &lt;&lt; Velocity_L2_error &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Pressure L2 Error: &quot;</span> &lt;&lt; Pressure_L2_error &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;   Velocity H1 Error: &quot;</span> &lt;&lt; Velocity_H1_error &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span></div>
<div class="line">  StokesProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> refinement_cycle)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    std::vector&lt;std::string&gt; solution_names(dim, <span class="stringliteral">&quot;velocity&quot;</span>);</div>
<div class="line">    solution_names.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt;</div>
<div class="line">      data_component_interpretation(</div>
<div class="line">        dim, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>);</div>
<div class="line">    data_component_interpretation.push_back(</div>
<div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution,</div>
<div class="line">                             solution_names,</div>
<div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>,</div>
<div class="line">                             data_component_interpretation);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    std::ofstream output(</div>
<div class="line">      <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(refinement_cycle, 2) + <span class="stringliteral">&quot;.vtk&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#gacad99726038e4fca7f605fdffb3317e4">write_vtk</a>(output);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">StokesProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>);</div>
<div class="line">    <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(6 - dim);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_ILU)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Now running with ILU&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_GMG)</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Now running with Multigrid&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Now running with UMFPACK&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> refinement_cycle = 0; refinement_cycle &lt; 3;</div>
<div class="line">         ++refinement_cycle)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Refinement cycle &quot;</span> &lt;&lt; refinement_cycle &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (refinement_cycle &gt; 0)</div>
<div class="line">          <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global(1);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Set-up...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        setup_dofs();</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Assembling...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        assemble_system();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (solver_type == SolverType::FGMRES_GMG)</div>
<div class="line">          {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;   Assembling Multigrid...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">            assemble_multigrid();</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   Solving...&quot;</span> &lt;&lt; std::flush;</div>
<div class="line">        solve();</div>
<div class="line"> </div>
<div class="line">        compute_errors();</div>
<div class="line"> </div>
<div class="line">        output_results(refinement_cycle);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="structUtilities_1_1System_1_1MemoryStats.html">Utilities::System::MemoryStats</a> mem;</div>
<div class="line">        <a class="code" href="namespaceUtilities_1_1System.html#a25db0fc07c298b5bef3d6f738283bd6d">Utilities::System::get_memory_stats</a>(mem);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;   VM Peak: &quot;</span> &lt;&lt; mem.<a class="code" href="structUtilities_1_1System_1_1MemoryStats.html#a61f9c5964eabf0f746ae35019042f28a">VmPeak</a> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        computing_timer.print_summary();</div>
<div class="line">        computing_timer.reset();</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step56</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using namespace </span>Step56;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> degree = 1;</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> dim    = 3;</div>
<div class="line">      StokesProblem&lt;dim&gt; flow_problem(degree, SolverType::FGMRES_GMG);</div>
<div class="line"> </div>
<div class="line">      flow_problem.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div><div class="ttdeci">@ value</div></div>
<div class="ttc" id="anamespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaae2b6dfb8a5c48206992d8310d176c37c">internal::EvaluatorQuantity::gradient</a></div><div class="ttdeci">@ gradient</div></div>
<div class="ttc" id="anumbers_8h_html_a02761f62f66f685e954daed42bcb3a1b"><div class="ttname"><a href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">std::cos</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; cos(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05318">vectorization.h:5318</a></div></div>
<div class="ttc" id="anumbers_8h_html_a27989bdc7b4b828564982787d126bd91"><div class="ttname"><a href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">std::sin</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; sin(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05291">vectorization.h:5291</a></div></div>
</div><!-- fragment --><p> 。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
