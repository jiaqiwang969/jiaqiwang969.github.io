<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_63.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-63 tutorial program 。</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="9.3.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 9.3.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The step-63 tutorial program 。 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>本教程取决于 <a class="el" href="step_16.html">step-16</a> 。</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a><a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Equation">Equation</a><a href="#Equation">Equation</a>
      <ul>
        <li><a href="#Streamlinediffusion">Streamline diffusion</a><a href="#Streamlinediffusion">Streamline diffusion</a>
      </ul>
        <li><a href="#Smoothers">Smoothers</a><a href="#Smoothers">Smoothers</a>
        <li><a href="#Testproblem">Test problem</a><a href="#Testproblem">Test problem</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a><a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a><a href="#Includefiles">Include files</a>
        <li><a href="#MeshWorkerdata">MeshWorker data</a><a href="#MeshWorkerdata">MeshWorker data</a>
        <li><a href="#Problemparameters">Problem parameters</a><a href="#Problemparameters">Problem parameters</a>
        <li><a href="#Cellpermutations">Cell permutations</a><a href="#Cellpermutations">Cell permutations</a>
        <li><a href="#Righthandsideandboundaryvalues">Right-hand side and boundary values</a><a href="#Righthandsideandboundaryvalues">Right-hand side and boundary values</a>
        <li><a href="#Streamlinediffusionimplementation">Streamline diffusion implementation</a><a href="#Streamlinediffusionimplementation">Streamline diffusion implementation</a>
        <li><a href="#codeAdvectionProlemcodeclass"><code>AdvectionProlem</code> class</a><a href="#codeAdvectionProlemcodeclass"><code>AdvectionProlem</code> class</a>
      <ul>
        <li><a href="#codeAdvectionProblemsetup_systemcode"><code>AdvectionProblem::setup_system()</code></a><a href="#codeAdvectionProblemsetup_systemcode"><code>AdvectionProblem::setup_system()</code></a>
        <li><a href="#codeAdvectionProblemassemble_cellcode"><code>AdvectionProblem::assemble_cell()</code></a><a href="#codeAdvectionProblemassemble_cellcode"><code>AdvectionProblem::assemble_cell()</code></a>
        <li><a href="#codeAdvectionProblemassemble_system_and_multigridcode"><code>AdvectionProblem::assemble_system_and_multigrid()</code></a><a href="#codeAdvectionProblemassemble_system_and_multigridcode"><code>AdvectionProblem::assemble_system_and_multigrid()</code></a>
        <li><a href="#codeAdvectionProblemsetup_smoothercode"><code>AdvectionProblem::setup_smoother()</code></a> ]<a href="#codeAdvectionProblemsetup_smoothercode"><code>AdvectionProblem::setup_smoother()</code></a>
        <li><a href="#codeAdvectionProblemsolvecode"><code>AdvectionProblem::solve()</code></a><a href="#codeAdvectionProblemsolvecode"><code>AdvectionProblem::solve()</code></a>
        <li><a href="#codeAdvectionProblemoutput_resultscode"><code>AdvectionProblem::output_results()</code></a><a href="#codeAdvectionProblemoutput_resultscode"><code>AdvectionProblem::output_results()</code></a>
        <li><a href="#codeAdvectionProblemruncode"><code>AdvectionProblem::run()</code></a><a href="#codeAdvectionProblemruncode"><code>AdvectionProblem::run()</code></a>
      </ul>
        <li><a href="#Thecodemaincodefunction">The <code>main</code> function</a><a href="#Thecodemaincodefunction">The <code>main</code> function</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a><a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#GMRESIterationNumbers"> GMRES Iteration Numbers </a><a href="#GMRESIterationNumbers"> GMRES Iteration Numbers </a>
      <ul>
        <li><a href="#DoFCellRenumbering"> DoF/Cell Renumbering </a><a href="#DoFCellRenumbering"> DoF/Cell Renumbering </a>
        <li><a href="#Pointvsblocksmoothers"> Point vs. block smoothers </a><a href="#Pointvsblocksmoothers"> Point vs. block smoothers </a>
      </ul>
        <li><a href="#Cost"> Cost </a><a href="#Cost"> Cost </a>
        <li><a href="#Additionalpoints"> Additional points </a><a href="#Additionalpoints"> Additional points </a>
        <li><a href="#Possibilitiesforextensions"> Possibilities for extensions </a><a href="#Possibilitiesforextensions"> Possibilities for extensions </a>
      <ul>
        <li><a href="#ConstantiterationsforQsub5sub"> Constant iterations for Q<sub>5</sub> </a><a href="#ConstantiterationsforQsub5sub"> Constant iterations for Q<sub>5</sub> </a>
        <li><a href="#Effectivenessofrenumberingforchangingepsilon"> Effectiveness of renumbering for changing epsilon </a><a href="#Effectivenessofrenumberingforchangingepsilon"> Effectiveness of renumbering for changing epsilon </a>
        <li><a href="#Meshadaptivity"> Mesh adaptivity </a><a href="#Meshadaptivity"> Mesh adaptivity </a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a><a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
</p>
<p><br  />
 <br  />
</p>
<p><em>This program was contributed by Thomas C. Clevenger and Timo Heister.</em></p>
<p><em>The creation of this tutorial was partially supported by NSF Award DMS-1522191, DMS-1901529, OAC-1835452, by the Computational Infrastructure in Geodynamics initiative (CIG), through the NSF under Award EAR-0949446 and EAR-1550901 and The University of California - Davis. </em></p>
<dl class="section note"><dt>Note</dt><dd>If you use this program as a basis for your own work, please consider citing it in your list of references. The initial version of this work was contributed to the deal.II project by the authors listed in the following citation: <a href="https://doi.org/10.5281/zenodo.3382899"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.3382899.svg" alt="10.5281/zenodo.3382899"/></a>  <br  />
</dd></dl>
<p><a class="anchor" id="Intro"></a> <a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>该程序使用几何多网格(GMG)预处理程序解决一个平流-扩散问题。该预处理程序的基本原理在 <a class="el" href="step_16.html">step-16</a> 中讨论；这里我们讨论非对称PDE所需的必要变化。此外，我们还介绍了块平滑的概念（与 <a class="el" href="step_16.html">step-16</a> 中的点平滑相比），并检查了加法和乘法平滑器的DoF重编号的效果。</p>
<p><a class="anchor" id="Equation"></a></p><h3>Equation</h3>
<p>平流-扩散方程由以下公式给出</p>
<p class="formulaDsp">
\begin{align*} -\varepsilon \Delta u + \boldsymbol{\beta}\cdot \nabla u &amp; = f &amp; \text{ in } \Omega\\ u &amp;= g &amp; \text{ on } \partial\Omega \end{align*}
</p>
<p>其中 \(\varepsilon&gt;0\) ， \(\boldsymbol{\beta}\) 是<em>advection direction</em>， \(f\) 是一个源。有几个注意事项。</p>
<ol type="1">
<li>如果 \(\boldsymbol{\beta}=\boldsymbol{0}\) ，这是 <a class="el" href="step_16.html">step-16</a> 中解决的拉普拉斯方程（以及其他许多地方）。</li>
<li>如果 \(\varepsilon=0\) ，那么这就是 <a class="el" href="step_9.html">step-9</a> 中解决的静止平流方程。</li>
<li>人们可以为这个问题定义一个无量纲数，称为<em>Peclet number</em>。 \(\mathcal{P} \dealcoloneq \frac{\|\boldsymbol{\beta}\| L}{\varepsilon}\) ，其中 \(L\) 是域的长度尺度。它描述了我们所考虑的那种方程的特点。如果 \(\mathcal{P}&gt;1\) ，我们说问题是<em>advection-dominated</em>，否则如果 \(\mathcal{P}&lt;1\) ，我们会说问题是<em>diffusion-dominated</em>。</li>
</ol>
<p>在本教程的讨论中，我们将关注以平流为主的流动。这是很复杂的情况。我们知道，对于扩散主导的问题，标准的Galerkin方法可以很好地工作，我们也知道简单的多网格方法，如 <a class="el" href="step_16.html">step-16</a> 中定义的方法非常有效。另一方面，对于平流主导的问题，标准Galerkin方法会导致振荡和不稳定的离散，简单的求解器往往不是很有效。因此，本教程程序旨在解决这两个问题。</p>
<p><a class="anchor" id="Streamlinediffusion"></a></p><h4>Streamline diffusion</h4>
<p>使用标准的Galerkin有限元方法，对于合适的测试函数 \(v_h\) ，PDE的离散弱形式将为</p>
<p class="formulaDsp">
\begin{align*} a(u_h,v_h) = F(v_h) \end{align*}
</p>
<p>其中</p>
<p class="formulaDsp">
\begin{align*} a(u_h,v_h) &amp;= (\varepsilon \nabla v_h,\, \nabla u_h) + (v_h,\,\boldsymbol{\beta}\cdot \nabla u_h),\\ F(v_h) &amp;= (v_h,\,f). \end{align*}
</p>
<p>不幸的是，用这种方法通常会得到震荡解。事实上，对于这种形式，可以显示出以下误差估计。</p>
<p class="formulaDsp">
\begin{align*} \|\nabla (u-u_h)\| \leq (1+\mathcal{P}) \inf_{v_h} \|\nabla (u-v_h)\|. \end{align*}
</p>
<p>如果精确解足够平滑，右边的下限可以被估计为如下。</p>
<p class="formulaDsp">
\begin{align*} \inf_{v_h} \|\nabla (u-v_h)\|. \le \|\nabla (u-I_h u)\| \le h^k C \|\nabla^k u)\| \end{align*}
</p>
<p>其中 \(k\) 是所用有限元的多项式程度。因此，我们得到的估计是</p>
<p class="formulaDsp">
\begin{align*} \|\nabla (u-u_h)\| \leq (1+\mathcal{P}) C h^k \|\nabla^k u)\|. \end{align*}
</p>
<p>换句话说，数值解会收敛。另一方面，鉴于上述 \(\mathcal{P}\) 的定义，我们不得不期待当 \(\varepsilon \ll \|\boldsymbol{\beta}\| L\) 时，即如果问题只有少量的扩散时，数值解会很差，而且误差很大。</p>
<p>为了解决这个问题，我们将考虑新的弱形式</p>
<p class="formulaDsp">
\begin{align*} a(u_h,\,v_h) + \sum_K (-\varepsilon \Delta u_h + \boldsymbol{\beta}\cdot \nabla u_h-f,\,\delta_K \boldsymbol{\beta}\cdot \nabla v_h)_K = F(v_h) \end{align*}
</p>
<p>其中总和是在所有单元 \(K\) 上进行的，每个单元都有内积， \(\delta_K\) 是定义在 <b>[john2006discontinuity]</b> 中的一个单元常数稳定参数。</p>
<p>从本质上讲，加入离散强形式残差会增强双线性形式 \(a(\cdot,\cdot)\) 的矫顽力，从而增加离散解的稳定性。这种方法通常被称为<em>streamline diffusion</em>或<em>SUPG</em>（流线型上风/Petrov-Galerkin）。</p>
<p><a class="anchor" id="Smoothers"></a></p><h3>Smoothers</h3>
<p>本教程的目标之一是从使用一个简单的（point-wise）Gauss-Seidel（SOR）平滑器扩展到多网格层次结构的每一级（类PreconditionSOR）。术语 "point-wise "传统上用于求解器，表示每次在一个 "网格点 "上求解；对于标量问题，这意味着使用一个求解器，每次更新线性系统的一个未知数，保持所有其他未知数固定不变；然后在问题中的所有未知数上迭代，一旦完成，从第一个未知数重新开始，直到这些 "扫频 "收敛。雅可比、高斯-赛德尔和SOR迭代都可以用这种方式解释。在多网格的背景下，人们不认为这些方法是 "求解器"，而是 "平滑器"。因此，人们对实际解决线性系统不感兴趣。为了使多网格方法发挥作用，只需去除残差的高频部分即可，因为这可以将解限制在更粗的网格上。 因此，我们只需对所有未知数进行少量的、固定数量的 "扫频"。在本教程的代码中，这是由 "平滑步骤 "参数控制的。</p>
<p>但是这些方法作为求解器使用时，已知收敛速度相当慢。虽然作为多网格平滑器，它们出乎意料地好，但它们也可以被改进。特别是，我们在这里也考虑 "基于单元 "的平滑器。这些方法一次解决一个单元上的所有未知数，保持所有其他未知数的固定；然后它们转到下一个单元，如此反复。我们可以把它们看作是雅可比（Jacobi）、高斯-赛德尔（Gauss-Seidel）或SOR的 "区块 "版本，但由于自由度是在多个单元中共享的，这些区块是重叠的，这些方法实际上最好在加法和乘法施瓦兹方法的框架内解释。</p>
<p>与 <a class="el" href="step_16.html">step-16</a> 不同的是，我们的测试问题包含一个平流项。特别是在扩散常数较小的情况下 \(\varepsilon\) ，信息是沿着给定的平流方向的流线传输的。这意味着，如果平滑器允许信息在单一平滑器应用中沿下游方向传播，那么平滑器可能会更有效。如果我们想按照这些未知数（或未知数块）的列举顺序一次解决一个未知数（或未知数块），那么这个信息传播特性需要相应地重新排列自由度或单元（对于基于单元的平滑器），以便更上游的自由度被提前处理（指数较低），更下游的自由度被推迟处理（指数较大）。排序的影响将在结果部分可见。</p>
<p>现在让我们简单定义一下本教程中使用的平滑器。关于更详细的介绍，我们参考 <b>[KanschatNotesIterative]</b> 以及书籍 <b>[smith2004domain]</b> 和 <b>[toselli2006domain]</b> 。施瓦兹预处理器需要一个分解</p>
<p class="formulaDsp">
\begin{align*} V = \sum_{j=1}^J V_j \end{align*}
</p>
<p>我们的有限元空间 \(V\) 的分解。每个子问题 \(V_j\) 也有一个基于双线性形式 \(a(\cdot,\cdot)\) 的里兹投影 \(P_j: V \rightarrow V_j\) 。这个投影为每个子问题 \(V_j\) 诱导出一个局部算子 \(A_j\) 。如果 \(\Pi_j:V\rightarrow V_j\) 是对 \(V_j\) 的正交投影，就可以表明 \(A_jP_j=\Pi_j^TA\) 。</p>
<p>由此，我们可以为算子 \(A\) 定义一个<em>additive Schwarz preconditioner</em>作为</p>
<p class="formulaDsp">
\begin{align*} B^{-1} = \sum_{j=1}^J P_j A^{-1} = \sum_{j=1}^J A_j^{-1} \Pi_j^T. \end{align*}
</p>
<p>换句话说，我们将我们的解决方案投射到每个子问题中，应用子问题 \(A_j\) 的逆，并将所有 \(j\) 的贡献相加。</p>
<p>请注意，通过为每个自由度定义一个子问题 \(V_j\) ，我们可以将逐点（一次一个未知数）的雅可比方法解释为加法施瓦茨方法。然后， \(A_j^{-1}\) 成为与 \(A\) 的对角线项的逆的乘法。</p>
<p>对于本教程中使用的 "Block Jacobi "方法，我们为当前层次上的网格的每个单元定义一个子问题 \(V_j\) 。注意，我们使用的是连续有限元，所以这些块是重叠的，因为两个单元之间的界面上的自由度都属于两个子问题。对子问题（在deal.II中它们被称为 "块"）进行操作的施瓦茨算子的逻辑在RelaxationBlock类中实现。块状雅可比 "方法是在RelaxationBlockJacobi类中实现的。该类的许多方面（例如如何定义块以及如何反转局部子问题 \(A_j\) ）可以在平滑器数据中配置，详见 <a class="el" href="classRelaxationBlock_1_1AdditionalData.html">RelaxationBlock::AdditionalData</a> 和 <a class="el" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches()</a> 。</p>
<p>到目前为止，我们讨论了加法平滑器，其中更新可以独立应用，并且在单一平滑器应用中没有信息流动。一个<em>multiplicative Schwarz preconditioner</em>解决了这个问题，其定义为</p>
<p class="formulaDsp">
\begin{align*} B^{-1} = \left( I- \prod_{j=1}^J \left(I-P_j\right) \right) A^{-1}. \end{align*}
</p>
<p>与上述相反，子问题 \(V_j\) 上的更新是按顺序应用的。这意味着在颠倒子问题 \(A_j\) 时得到的更新立即被用于 \(A_{j+1}\) 。这在写出项目的时候就可以看到。</p>
<p class="formulaDsp">
\begin{align*} B^{-1} = \left( I - \left(I-P_1\right)\left(I-P_2\right)\cdots\left(I-P_J\right) \right) A^{-1} = A^{-1} - \left[ \left(I-P_1\right) \left[ \left(I-P_2\right)\cdots \left[\left(I-P_J\right) A^{-1}\right] \cdots \right] \right] \end{align*}
</p>
<p>当把子空间 \(V_j\) 定义为整个自由度块时，这个方法在RelaxationBlockSOR类中实现，并在本教程中选择 "块SOR "时使用。RelaxationBlockSOR类也是从RelaxationBlock派生的。因此，加法和乘法的施瓦兹方法都在一个统一的框架内实现。</p>
<p>最后，让我们注意到，标准的Gauss-Seidel（或SOR）方法可以被看作是一个乘法施瓦兹方法，每个DoF都有一个子问题。</p>
<p><a class="anchor" id="Testproblem"></a></p><h3>Test problem</h3>
<p>我们将考虑以下测试问题： \(\Omega = [-1,\,1]\times[-1,\,1]\backslash B_{0.3}(0)\) ，即一个以原点为圆心的半径为0.3的正方形被移除。此外，我们使用 \(\varepsilon=0.005\) , \(\boldsymbol{\beta} = [-\sin(\pi/6),\,\cos(\pi/6)]\) , \(f=0\) , 和迪里切特边界值</p>
<p class="formulaDsp">
\begin{align*} g = \left\{\begin{array}{ll} 1 &amp; \text{if } x=-1 \text{ or } y=-1,\,x\geq 0.5 \\ 0 &amp; \text{otherwise} \end{array}\right. \end{align*}
</p>
<p>下面的数字描述了有（左）和无（右）流线扩散的解决方案。在没有流线扩散的情况下，我们看到边界层周围有很大的振荡，这表明标准Galerkin有限元方法对这个问题的不稳定性。</p>
<table width="60%" align="center">
<tr>
<td align="center"><img src="https://www.dealii.org/images/steps/developer/step-63-solution.png" alt="" class="inline"/>  </td><td align="center"><img src="https://www.dealii.org/images/steps/developer/step-63-solution-no-sd.png" alt="" class="inline"/>   </td></tr>
</table>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p>标准deal.II需要的典型文件。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tensor__function_8h.html">deal.II/base/tensor_function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="relaxation__block_8h.html">deal.II/lac/relaxation_block.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mapping__q_8h.html">deal.II/fe/mapping_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="ttc" id="aaffine__constraints_8h_html"><div class="ttname"><a href="affine__constraints_8h.html">affine_constraints.h</a></div></div>
<div class="ttc" id="adof__renumbering_8h_html"><div class="ttname"><a href="dof__renumbering_8h.html">dof_renumbering.h</a></div></div>
<div class="ttc" id="adof__tools_8h_html"><div class="ttname"><a href="dof__tools_8h.html">dof_tools.h</a></div></div>
<div class="ttc" id="adofs_2dof__handler_8h_html"><div class="ttname"><a href="dofs_2dof__handler_8h.html">dof_handler.h</a></div></div>
<div class="ttc" id="adynamic__sparsity__pattern_8h_html"><div class="ttname"><a href="dynamic__sparsity__pattern_8h.html">dynamic_sparsity_pattern.h</a></div></div>
<div class="ttc" id="afe_2fe__values_8h_html"><div class="ttname"><a href="fe_2fe__values_8h.html">fe_values.h</a></div></div>
<div class="ttc" id="afe__q_8h_html"><div class="ttname"><a href="fe__q_8h.html">fe_q.h</a></div></div>
<div class="ttc" id="afull__matrix_8h_html"><div class="ttname"><a href="full__matrix_8h.html">full_matrix.h</a></div></div>
<div class="ttc" id="afunction_8h_html"><div class="ttname"><a href="function_8h.html">function.h</a></div></div>
<div class="ttc" id="agrid_2grid__refinement_8h_html"><div class="ttname"><a href="grid_2grid__refinement_8h.html">grid_refinement.h</a></div></div>
<div class="ttc" id="agrid_2manifold__lib_8h_html"><div class="ttname"><a href="grid_2manifold__lib_8h.html">manifold_lib.h</a></div></div>
<div class="ttc" id="agrid_2tria_8h_html"><div class="ttname"><a href="grid_2tria_8h.html">tria.h</a></div></div>
<div class="ttc" id="agrid__generator_8h_html"><div class="ttname"><a href="grid__generator_8h.html">grid_generator.h</a></div></div>
<div class="ttc" id="agrid__out_8h_html"><div class="ttname"><a href="grid__out_8h.html">grid_out.h</a></div></div>
<div class="ttc" id="amapping__q_8h_html"><div class="ttname"><a href="mapping__q_8h.html">mapping_q.h</a></div></div>
<div class="ttc" id="amatrix__tools_8h_html"><div class="ttname"><a href="matrix__tools_8h.html">matrix_tools.h</a></div></div>
<div class="ttc" id="anumerics_2data__out_8h_html"><div class="ttname"><a href="numerics_2data__out_8h.html">data_out.h</a></div></div>
<div class="ttc" id="aparameter__handler_8h_html"><div class="ttname"><a href="parameter__handler_8h.html">parameter_handler.h</a></div></div>
<div class="ttc" id="aprecondition_8h_html"><div class="ttname"><a href="precondition_8h.html">precondition.h</a></div></div>
<div class="ttc" id="aquadrature__lib_8h_html"><div class="ttname"><a href="quadrature__lib_8h.html">quadrature_lib.h</a></div></div>
<div class="ttc" id="arelaxation__block_8h_html"><div class="ttname"><a href="relaxation__block_8h.html">relaxation_block.h</a></div></div>
<div class="ttc" id="asolver__gmres_8h_html"><div class="ttname"><a href="solver__gmres_8h.html">solver_gmres.h</a></div></div>
<div class="ttc" id="asparse__matrix_8h_html"><div class="ttname"><a href="sparse__matrix_8h.html">sparse_matrix.h</a></div></div>
<div class="ttc" id="atensor__function_8h_html"><div class="ttname"><a href="tensor__function_8h.html">tensor_function.h</a></div></div>
<div class="ttc" id="atimer_8h_html"><div class="ttname"><a href="timer_8h.html">timer.h</a></div></div>
<div class="ttc" id="avector_8h_html"><div class="ttname"><a href="vector_8h.html">vector.h</a></div></div>
<div class="ttc" id="avector__tools_8h_html"><div class="ttname"><a href="vector__tools_8h.html">vector_tools.h</a></div></div>
</div><!-- fragment --><p>包括所有相关的多层次文件。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="ttc" id="amg__coarse_8h_html"><div class="ttname"><a href="mg__coarse_8h.html">mg_coarse.h</a></div></div>
<div class="ttc" id="amg__constrained__dofs_8h_html"><div class="ttname"><a href="mg__constrained__dofs_8h.html">mg_constrained_dofs.h</a></div></div>
<div class="ttc" id="amg__matrix_8h_html"><div class="ttname"><a href="mg__matrix_8h.html">mg_matrix.h</a></div></div>
<div class="ttc" id="amg__smoother_8h_html"><div class="ttname"><a href="mg__smoother_8h.html">mg_smoother.h</a></div></div>
<div class="ttc" id="amg__tools_8h_html"><div class="ttname"><a href="mg__tools_8h.html">mg_tools.h</a></div></div>
<div class="ttc" id="amg__transfer_8h_html"><div class="ttname"><a href="mg__transfer_8h.html">mg_transfer.h</a></div></div>
<div class="ttc" id="amultigrid_8h_html"><div class="ttname"><a href="multigrid_8h.html">multigrid.h</a></div></div>
</div><!-- fragment --><p>C++:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
</div><!-- fragment --><p>我们将使用 <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a> 功能来组装矩阵。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mesh__loop_8h.html">deal.II/meshworker/mesh_loop.h</a>&gt;</span></div>
<div class="ttc" id="amesh__loop_8h_html"><div class="ttname"><a href="mesh__loop_8h.html">mesh_loop.h</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="MeshWorkerdata"></a> </p><h3><a class="el" href="namespaceMeshWorker.html">MeshWorker</a> data</h3>
<p>像往常一样，我们将把所有与这个程序相关的东西放到一个自己的命名空间中。</p>
<p>由于我们将使用MeshWorker框架，第一步是定义以下由 <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop()</a>: 使用的assemble_cell()函数所需要的结构 <code>ScratchData</code>包含一个FEValues对象，这是组装一个单元的局部贡献所需要的，而<code>CopyData</code>包含一个单元的局部贡献的输出以及复制到全局系统的必要信息。它们的目的在WorkStream类的文档中也有解释）。</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Step63</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>ScratchData</div>
<div class="line">  {</div>
<div class="line">    ScratchData(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe,</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        quadrature_degree)</div>
<div class="line">      : fe_values(fe,</div>
<div class="line">                  <a class="code" href="classQGauss.html">QGauss</a>&lt;dim&gt;(quadrature_degree),</div>
<div class="line">                  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    ScratchData(<span class="keyword">const</span> ScratchData&lt;dim&gt; &amp;scratch_data)</div>
<div class="line">      : fe_values(scratch_data.fe_values.get_fe(),</div>
<div class="line">                  scratch_data.fe_values.get_quadrature(),</div>
<div class="line">                  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span>CopyData</div>
<div class="line">  {</div>
<div class="line">    CopyData() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line">  };</div>
<div class="ttc" id="aclassFEValues_html"><div class="ttname"><a href="classFEValues.html">FEValues</a></div><div class="ttdef"><b>Definition:</b> <a href="fe_2fe__values_8h_source.html#l03905">fe_values.h:3906</a></div></div>
<div class="ttc" id="aclassFiniteElement_html"><div class="ttname"><a href="classFiniteElement.html">FiniteElement</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2fe_2fe_8h_source.html#l00645">fe.h:646</a></div></div>
<div class="ttc" id="aclassFullMatrix_html"><div class="ttname"><a href="classFullMatrix.html">FullMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassQGauss_html"><div class="ttname"><a href="classQGauss.html">QGauss</a></div><div class="ttdef"><b>Definition:</b> <a href="quadrature__lib_8h_source.html#l00038">quadrature_lib.h:39</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a></div><div class="ttdeci">@ update_hessians</div><div class="ttdoc">Second derivatives of shape functions.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00090">fe_update_flags.h:90</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a></div><div class="ttdeci">@ update_values</div><div class="ttdoc">Shape function values.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00078">fe_update_flags.h:78</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a></div><div class="ttdeci">@ update_JxW_values</div><div class="ttdoc">Transformed quadrature weights.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00129">fe_update_flags.h:129</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a></div><div class="ttdeci">@ update_gradients</div><div class="ttdoc">Shape function gradients.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00084">fe_update_flags.h:84</a></div></div>
<div class="ttc" id="afe__update__flags_8h_html_aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a"><div class="ttname"><a href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a></div><div class="ttdeci">@ update_quadrature_points</div><div class="ttdoc">Transformed quadrature points.</div><div class="ttdef"><b>Definition:</b> <a href="fe__update__flags_8h_source.html#l00122">fe_update_flags.h:122</a></div></div>
<div class="ttc" id="agrid__out_8cc_html_a9082f945c1d289684d0bcd51ee08e11e"><div class="ttname"><a href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a></div><div class="ttdeci">unsigned int level</div><div class="ttdef"><b>Definition:</b> <a href="grid__out_8cc_source.html#l04590">grid_out.cc:4590</a></div></div>
<div class="ttc" id="anamespaceLocalIntegrators_1_1Advection_html_a8bc7b8136646134f73a4193adefe15f8"><div class="ttname"><a href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">LocalIntegrators::Advection::cell_matrix</a></div><div class="ttdeci">void cell_matrix(FullMatrix&lt; double &gt; &amp;M, const FEValuesBase&lt; dim &gt; &amp;fe, const FEValuesBase&lt; dim &gt; &amp;fetest, const ArrayView&lt; const std::vector&lt; double &gt;&gt; &amp;velocity, const double factor=1.)</div><div class="ttdef"><b>Definition:</b> <a href="advection_8h_source.html#l00075">advection.h:75</a></div></div>
<div class="ttc" id="anamespacedealii_html"><div class="ttname"><a href="namespacedealii.html">dealii</a></div><div class="ttdef"><b>Definition:</b> <a href="namespace__dealii_8h_source.html#l00025">namespace_dealii.h:26</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Problemparameters"></a> </p><h3>Problem parameters</h3>
<p>第二步是定义处理要从输入文件中读取的运行时参数的类。 <br  />
</p>
<p>我们将使用ParameterHandler在运行时传入参数。结构<code>Settings</code>解析并存储整个程序要查询的参数。</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">enum</span> DoFRenumberingStrategy</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">none</a>,</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">downstream</a>,</div>
<div class="line">    upstream,</div>
<div class="line">    <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">random</a></div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span>                 <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a338a944a393875e2dd499457d1055841">epsilon</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           fe_degree;</div>
<div class="line">  std::string            smoother_type;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           smoothing_steps;</div>
<div class="line">  DoFRenumberingStrategy dof_renumbering;</div>
<div class="line">  <span class="keywordtype">bool</span>                   with_streamline_diffusion;</div>
<div class="line">  <span class="keywordtype">bool</span>                   output;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Settings::get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* First declare the parameters... */</span></div>
<div class="line">  <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;0.005&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                    <span class="stringliteral">&quot;Diffusion parameter&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                    <span class="stringliteral">&quot;Finite Element degree&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;block SOR&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;SOR|Jacobi|block SOR|block Jacobi&quot;</span>),</div>
<div class="line">                    <span class="stringliteral">&quot;Select smoother: SOR|Jacobi|block SOR|block Jacobi&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                    <span class="stringliteral">&quot;Number of smoothing steps&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">    <span class="stringliteral">&quot;DoF renumbering&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;downstream&quot;</span>,</div>
<div class="line">    <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;none|downstream|upstream|random&quot;</span>),</div>
<div class="line">    <span class="stringliteral">&quot;Select DoF renumbering: none|downstream|upstream|random&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Enable streamline diffusion stabilization: true|false&quot;</span>);</div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Output&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                    <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                    <span class="stringliteral">&quot;Generate graphical output: true|false&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* ...and then try to read their values from the input file: */</span></div>
<div class="line">  <span class="keywordflow">if</span> (prm_filename.empty())</div>
<div class="line">    {</div>
<div class="line">      prm.<a class="code" href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">print_parameters</a>(std::cout, <a class="code" href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827ae4d13a4598073bfcb69cd0cf4c1f8365">ParameterHandler::Text</a>);</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(</div>
<div class="line">        <span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Please pass a .prm file as the first argument!&quot;</span>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(prm_filename);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a338a944a393875e2dd499457d1055841">epsilon</a>         = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>);</div>
<div class="line">  fe_degree       = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>);</div>
<div class="line">  smoother_type   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>);</div>
<div class="line">  smoothing_steps = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string renumbering = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;DoF renumbering&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (renumbering == <span class="stringliteral">&quot;none&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">DoFRenumberingStrategy::none</a>;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (renumbering == <span class="stringliteral">&quot;downstream&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumberingStrategy::downstream</a>;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (renumbering == <span class="stringliteral">&quot;upstream&quot;</span>)</div>
<div class="line">    dof_renumbering = DoFRenumberingStrategy::upstream;</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (renumbering == <span class="stringliteral">&quot;random&quot;</span>)</div>
<div class="line">    dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumberingStrategy::random</a>;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;The &lt;DoF renumbering&gt; parameter has &quot;</span></div>
<div class="line">                           <span class="stringliteral">&quot;an invalid value.&quot;</span>));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  with_streamline_diffusion = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>);</div>
<div class="line">  output                    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Output&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="aclassParameterHandler_html"><div class="ttname"><a href="classParameterHandler.html">ParameterHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8h_source.html#l00840">parameter_handler.h:841</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a0ddaa05c5463c6c0b7701e18005717a9"><div class="ttname"><a href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">ParameterHandler::parse_input</a></div><div class="ttdeci">virtual void parse_input(std::istream &amp;input, const std::string &amp;filename=&quot;input file&quot;, const std::string &amp;last_line=&quot;&quot;, const bool skip_undefined=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00399">parameter_handler.cc:399</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a4ac3a8b19ade16e96e8ea25906daf23a"><div class="ttname"><a href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">ParameterHandler::print_parameters</a></div><div class="ttdeci">std::ostream &amp; print_parameters(std::ostream &amp;out, const OutputStyle style) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01250">parameter_handler.cc:1250</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a61fa98fdc0c52980a5b1de0ee1fc5bb2"><div class="ttname"><a href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">ParameterHandler::get_integer</a></div><div class="ttdeci">long int get_integer(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01025">parameter_handler.cc:1025</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6bb45dc67787e3fab7882461929b5fbe"><div class="ttname"><a href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">ParameterHandler::get_bool</a></div><div class="ttdeci">bool get_bool(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01113">parameter_handler.cc:1113</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a6d65f458be69e23a348221cb67fc411d"><div class="ttname"><a href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">ParameterHandler::declare_entry</a></div><div class="ttdeci">void declare_entry(const std::string &amp;entry, const std::string &amp;default_value, const Patterns::PatternBase &amp;pattern=Patterns::Anything(), const std::string &amp;documentation=&quot;&quot;, const bool has_to_be_set=false)</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00796">parameter_handler.cc:796</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_a91cfbaca954f444047302446a4e87125"><div class="ttname"><a href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">ParameterHandler::get</a></div><div class="ttdeci">std::string get(const std::string &amp;entry_string) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l00987">parameter_handler.cc:987</a></div></div>
<div class="ttc" id="aclassParameterHandler_html_aeaf3c7846747695b1f327677e3716ec5"><div class="ttname"><a href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">ParameterHandler::get_double</a></div><div class="ttdeci">double get_double(const std::string &amp;entry_name) const</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8cc_source.html#l01068">parameter_handler.cc:1068</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Bool_html"><div class="ttname"><a href="classPatterns_1_1Bool.html">Patterns::Bool</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00981">patterns.h:982</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Double_html"><div class="ttname"><a href="classPatterns_1_1Double.html">Patterns::Double</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00292">patterns.h:293</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Integer_html"><div class="ttname"><a href="classPatterns_1_1Integer.html">Patterns::Integer</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00189">patterns.h:190</a></div></div>
<div class="ttc" id="aclassPatterns_1_1Selection_html"><div class="ttname"><a href="classPatterns_1_1Selection.html">Patterns::Selection</a></div><div class="ttdef"><b>Definition:</b> <a href="patterns_8h_source.html#l00382">patterns.h:383</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga8364dda711b93753c6809eefe2a8e827ae4d13a4598073bfcb69cd0cf4c1f8365"><div class="ttname"><a href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827ae4d13a4598073bfcb69cd0cf4c1f8365">ParameterHandler::Text</a></div><div class="ttdeci">@ Text</div><div class="ttdef"><b>Definition:</b> <a href="parameter__handler_8h_source.html#l00889">parameter_handler.h:889</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1"><div class="ttname"><a href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">DataOutBase::none</a></div><div class="ttdeci">@ none</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01555">data_out_base.h:1555</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_gae9a45f517af1401c50811a11083f9114"><div class="ttname"><a href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">StandardExceptions::ExcMessage</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcMessage(std::string arg1)</div></div>
<div class="ttc" id="agroup__Exceptions_html_gafc0ca7ad85b3ebd64e8e51689ac85caf"><div class="ttname"><a href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a></div><div class="ttdeci">#define AssertThrow(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01583">exceptions.h:1583</a></div></div>
<div class="ttc" id="anamespaceDoFRenumbering_html_a59c1a183ef6288e6bb061eb738b84380"><div class="ttname"><a href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a></div><div class="ttdeci">void downstream(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const Tensor&lt; 1, spacedim &gt; &amp;direction, const bool dof_wise_renumbering=false)</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l01741">dof_renumbering.cc:1741</a></div></div>
<div class="ttc" id="anamespaceDoFRenumbering_html_abbd608826acd7c01f91db401a3728e25"><div class="ttname"><a href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumbering::random</a></div><div class="ttdeci">void random(DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler)</div><div class="ttdef"><b>Definition:</b> <a href="dof__renumbering_8cc_source.html#l02088">dof_renumbering.cc:2088</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a338a944a393875e2dd499457d1055841"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a338a944a393875e2dd499457d1055841">Physics::Elasticity::Kinematics::epsilon</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; epsilon(const Tensor&lt; 2, dim, Number &gt; &amp;Grad_u)</div></div>
<div class="ttc" id="anamespaceTriangulationDescription_html_aa1531298eb0a267d9ceca5eb46ada8e0"><div class="ttname"><a href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">TriangulationDescription::Settings</a></div><div class="ttdeci">Settings</div><div class="ttdef"><b>Definition:</b> <a href="tria__description_8h_source.html#l00254">tria_description.h:255</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="Cellpermutations"></a> </p><h3>Cell permutations</h3>
<p><br  />
</p>
<p>单元和自由度被遍历的顺序将对乘法的收敛速度起作用。在这里，我们定义了一些函数，这些函数返回单元的特定排序，供块平滑器使用。 <br  />
</p>
<p>对于每种类型的单元排序，我们定义了一个适用于活动网格的函数和一个适用于水平网格的函数（即适用于多网格层次结构中的某一层的单元）。虽然求解系统所需的唯一重新排序是在水平网格上进行的，但我们在output_results()中包含了主动网格的重新排序，以达到可视化的目的。 <br  />
</p>
<p>对于两个下游排序函数，我们首先创建一个包含所有相关单元的数组，然后使用一个 "比较器 "对象在下游方向进行排序。然后，函数的输出是一个简单的数组，包含了刚刚计算出的排序中的单元格的索引。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line">create_downstream_cell_ordering(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   direction,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>))</div>
<div class="line">    ordered_cells.push_back(cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">    CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator, dim&gt;</div>
<div class="line">      comparator(direction);</div>
<div class="line">  std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned&gt; ordered_indices;</div>
<div class="line">  ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : ordered_cells)</div>
<div class="line">    ordered_indices.push_back(cell-&gt;index());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line">create_downstream_cell_ordering(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   direction)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    ordered_cells.push_back(cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">    CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator, dim&gt;</div>
<div class="line">      comparator(direction);</div>
<div class="line">  std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">  ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : ordered_cells)</div>
<div class="line">    ordered_indices.push_back(cell-&gt;index());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">}</div>
<div class="ttc" id="aclassDoFHandler_html"><div class="ttname"><a href="classDoFHandler.html">DoFHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="dofs_2dof__handler_8h_source.html#l00314">dof_handler.h:315</a></div></div>
<div class="ttc" id="aclassDoFHandler_html_a7797f796c0be511fbc7f230ccc22532e"><div class="ttname"><a href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">DoFHandler::get_triangulation</a></div><div class="ttdeci">const Triangulation&lt; dim, spacedim &gt; &amp; get_triangulation() const</div></div>
<div class="ttc" id="aclassTensor_html"><div class="ttname"><a href="classTensor.html">Tensor&lt; 1, dim &gt;</a></div></div>
<div class="ttc" id="aclassTriangulation_html_a5ea5c9957dbb566a562bbe2c0f3971e9"><div class="ttname"><a href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">Triangulation::n_active_cells</a></div><div class="ttdeci">unsigned int n_active_cells() const</div></div>
<div class="ttc" id="aclassTriangulation_html_abea687f123f3f5a8b09d7485cf03be72"><div class="ttname"><a href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">Triangulation::n_cells</a></div><div class="ttdeci">unsigned int n_cells() const</div></div>
<div class="ttc" id="agroup__CPP11_html_ga8c046284df67198c2d82c25950ea1ea3"><div class="ttname"><a href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">DoFHandler::cell_iterators_on_level</a></div><div class="ttdeci">IteratorRange&lt; cell_iterator &gt; cell_iterators_on_level(const unsigned int level) const</div></div>
<div class="ttc" id="agroup__CPP11_html_gaace8c98aca00e7e48a619bb5e08084aa"><div class="ttname"><a href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">DoFHandler::active_cell_iterators</a></div><div class="ttdeci">IteratorRange&lt; active_cell_iterator &gt; active_cell_iterators() const</div></div>
</div><!-- fragment --><p>产生随机排序的函数在精神上是相似的，它们首先将所有单元格的信息放入一个数组。但是，它们不是对它们进行排序，而是利用C++提供的生成随机数的设施对元素进行随机洗牌。这样做的方式是在数组的所有元素上进行迭代，为之前的另一个元素抽取一个随机数，然后交换这些元素。其结果是对数组中的元素进行随机洗牌。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line">create_random_cell_ordering(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>))</div>
<div class="line">    ordered_cells.push_back(cell-&gt;index());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::mt19937 random_number_generator;</div>
<div class="line">  std::shuffle(ordered_cells.begin(),</div>
<div class="line">               ordered_cells.end(),</div>
<div class="line">               random_number_generator);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">std::vector&lt;unsigned int&gt;</div>
<div class="line">create_random_cell_ordering(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler)</div>
<div class="line">{</div>
<div class="line">  std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">  ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">    ordered_cells.push_back(cell-&gt;index());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::mt19937 random_number_generator;</div>
<div class="line">  std::shuffle(ordered_cells.begin(),</div>
<div class="line">               ordered_cells.end(),</div>
<div class="line">               random_number_generator);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Righthandsideandboundaryvalues"></a> </p><h3>Right-hand side and boundary values</h3>
<p>本教程中解决的问题是对<a href="https://global.oup.com/academic/product/finite-elements-and-fast-iterative-solvers-9780199678808">Finite Elements and Fast Iterative Solvers: with Applications in Incompressible Fluid Dynamics by Elman, Silvester, and Wathen</a>第118页上的例3.1.3的改编。主要区别在于我们在域的中心添加了一个洞，其边界条件为零的迪里希特。 <br  />
</p>
<p>为了进行完整的描述，我们需要首先实现零右手边的类（当然我们可以直接使用 <a class="el" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction</a>): <br  />
</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points,</div>
<div class="line">                          std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> RightHandSide&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">  (void)component;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0.0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> RightHandSide&lt;dim&gt;::value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points,</div>
<div class="line">                                    std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>.size() == points.size(),</div>
<div class="line">         <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>.size(), points.size()));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; points.size(); ++i)</div>
<div class="line">    <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>[i] = RightHandSide&lt;dim&gt;::value(points[i], component);</div>
<div class="line">}</div>
<div class="ttc" id="aclassFunction_html"><div class="ttname"><a href="classFunction.html">Function</a></div><div class="ttdef"><b>Definition:</b> <a href="function_8h_source.html#l00150">function.h:153</a></div></div>
<div class="ttc" id="aclassFunction_html_a562fc1114e95e702e6696721f71528db"><div class="ttname"><a href="classFunction.html#a562fc1114e95e702e6696721f71528db">Function::value_list</a></div><div class="ttdeci">virtual void value_list(const std::vector&lt; Point&lt; dim &gt;&gt; &amp;points, std::vector&lt; RangeNumberType &gt; &amp;values, const unsigned int component=0) const</div></div>
<div class="ttc" id="aclassFunction_html_acbfcab66b2fc63bfea59268f40772bb4"><div class="ttname"><a href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">Function::value</a></div><div class="ttdeci">virtual RangeNumberType value(const Point&lt; dim &gt; &amp;p, const unsigned int component=0) const</div></div>
<div class="ttc" id="aclassPoint_html"><div class="ttname"><a href="classPoint.html">Point</a></div><div class="ttdef"><b>Definition:</b> <a href="base_2point_8h_source.html#l00110">point.h:111</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga0d685aad996180f9851183ae3e29019a"><div class="ttname"><a href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">StandardExceptions::ExcIndexRange</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcIndexRange(int arg1, int arg2, int arg3)</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga6060b2304b8600f5efa0d31eeda0207d"><div class="ttname"><a href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">StandardExceptions::ExcDimensionMismatch</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcDimensionMismatch(std::size_t arg1, std::size_t arg2)</div></div>
<div class="ttc" id="agroup__Exceptions_html_ga70a0bb353656e704acf927945277bbc6"><div class="ttname"><a href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a></div><div class="ttdeci">#define Assert(cond, exc)</div><div class="ttdef"><b>Definition:</b> <a href="include_2deal_8II_2base_2exceptions_8h_source.html#l01473">exceptions.h:1473</a></div></div>
<div class="ttc" id="anamespaceEvaluationFlags_html_a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58"><div class="ttname"><a href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a></div><div class="ttdeci">@ values</div><div class="ttdef"><b>Definition:</b> <a href="evaluation__flags_8h_source.html#l00051">evaluation_flags.h:51</a></div></div>
</div><!-- fragment --><p>我们还有Dirichlet边界条件。在外部正方形边界的连接部分，我们将数值设置为1，而在其他地方（包括内部圆形边界），我们将数值设置为0。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>BoundaryValues : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classFunction.html#a562fc1114e95e702e6696721f71528db">value_list</a>(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points,</div>
<div class="line">                          std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>,</div>
<div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> BoundaryValues&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">  (void)component;</div>
</div><!-- fragment --><p>如果 \(x=1\) ，或者如果 \(x&gt;0.5\) 和 \(y=-1\) ，将边界设置为1。</p>
<p><a class="anchor" id="Streamlinediffusionimplementation"></a> </p><h3>Streamline diffusion implementation</h3>
<p>流线扩散法有一个稳定常数，我们需要能够计算出来。这个参数如何计算的选择来自于<a href="https://link.springer.com/chapter/10.1007/978-3-540-34288-5_27">On Discontinuity-Capturing Methods for Convection-Diffusion Equations by Volker John and Petr Knobloch</a>。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">double</span> compute_stabilization_delta(<span class="keyword">const</span> <span class="keywordtype">double</span>         hk,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>         <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acf35b7afd6a85044d32320355fbaabfe">eps</a>,</div>
<div class="line">                                   <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> dir,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">double</span>         pk)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> Peclet = dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * hk / (2.0 * <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acf35b7afd6a85044d32320355fbaabfe">eps</a> * pk);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> =</div>
<div class="line">    (1.0 + <a class="code" href="numbers_8h.html#a372e01cd9d1d07fdf136f4f40975d5cf">std::exp</a>(-2.0 * Peclet)) / (1.0 - std::exp(-2.0 * Peclet));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> hk / (2.0 * dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * pk) * (<a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> - 1.0 / Peclet);</div>
<div class="line">}</div>
<div class="ttc" id="aclassTensor_html_afd0934b4edd71063f66a9c67540e79fc"><div class="ttname"><a href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">Tensor::norm</a></div><div class="ttdeci">numbers::NumberTraits&lt; Number &gt;::real_type norm() const</div></div>
<div class="ttc" id="agroup__Exceptions_html_gaa3cbced9f1d4ae661f13018f4c980aa1acf35b7afd6a85044d32320355fbaabfe"><div class="ttname"><a href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acf35b7afd6a85044d32320355fbaabfe">DataOutBase::eps</a></div><div class="ttdeci">@ eps</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8h_source.html#l01580">data_out_base.h:1580</a></div></div>
<div class="ttc" id="anamespaceDifferentiation_1_1SD_html_a66e76f1c4fdb9a31f4fabef8abee5f28"><div class="ttname"><a href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">Differentiation::SD::coth</a></div><div class="ttdeci">Expression coth(const Expression &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="symengine__math_8cc_source.html#l00217">symengine_math.cc:217</a></div></div>
<div class="ttc" id="anumbers_8h_html_a372e01cd9d1d07fdf136f4f40975d5cf"><div class="ttname"><a href="numbers_8h.html#a372e01cd9d1d07fdf136f4f40975d5cf">std::exp</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; exp(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05362">vectorization.h:5362</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProlemcodeclass"></a> </p><h3><code>AdvectionProlem</code> class</h3>
<p>这是程序的主类，看起来应该与 <a class="el" href="step_16.html">step-16</a> 非常相似。主要的区别是，由于我们是在运行时定义我们的多网格平滑器，我们选择定义一个函数<code>create_smoother()</code>和一个类对象<code>mg_smoother</code>，这是一个 <code>std::unique_ptr</code> 派生自MGSmoother的平滑器。请注意，对于从RelaxationBlock派生的平滑器，我们必须为每个级别包括一个<code>smoother_data</code>对象。这将包含关于单元格排序和单元格矩阵倒置方法的信息。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>AdvectionProblem</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  AdvectionProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;settings);</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">  <span class="keywordtype">void</span> assemble_cell(<span class="keyword">const</span> IteratorType &amp;cell,</div>
<div class="line">                     ScratchData&lt;dim&gt; &amp;  scratch_data,</div>
<div class="line">                     CopyData &amp;          copy_data);</div>
<div class="line">  <span class="keywordtype">void</span> assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> setup_smoother();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> solve();</div>
<div class="line">  <span class="keywordtype">void</span> refine_grid();</div>
<div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>     fe;</div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classMappingQ.html">MappingQ&lt;dim&gt;</a> mapping;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      sparsity_pattern;</div>
<div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> solution;</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_sparsity_patterns;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_interface_sparsity_patterns;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_matrices;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_in;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_out;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_matrix;</div>
<div class="line">  <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_in;</div>
<div class="line">  <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_out;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::unique_ptr&lt;MGSmoother&lt;Vector&lt;double&gt;&gt;&gt; mg_smoother;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> SmootherType =</div>
<div class="line">    <a class="code" href="classRelaxationBlock.html">RelaxationBlock&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classdouble.html">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">  <span class="keyword">using</span> SmootherAdditionalDataType = SmootherType::AdditionalData;</div>
<div class="line">  <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SmootherAdditionalDataType&gt;</a> smoother_data;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> advection_direction;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> settings;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">AdvectionProblem&lt;dim&gt;::AdvectionProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;settings)</div>
<div class="line">  : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::limit_level_difference_at_vertices)</div>
<div class="line">  , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">  , fe(settings.fe_degree)</div>
<div class="line">  , mapping(settings.fe_degree)</div>
<div class="line">  , settings(settings)</div>
<div class="line">{</div>
<div class="line">  advection_direction[0] = -<a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">std::sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">  <span class="keywordflow">if</span> (dim &gt;= 2)</div>
<div class="line">    advection_direction[1] = <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">std::cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">  <span class="keywordflow">if</span> (dim &gt;= 3)</div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">}</div>
<div class="ttc" id="aclassAffineConstraints_html"><div class="ttname"><a href="classAffineConstraints.html">AffineConstraints&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassFE__Q_html"><div class="ttname"><a href="classFE__Q.html">FE_Q</a></div><div class="ttdef"><b>Definition:</b> <a href="fe__q_8h_source.html#l00548">fe_q.h:549</a></div></div>
<div class="ttc" id="aclassMGConstrainedDoFs_html"><div class="ttname"><a href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__constrained__dofs_8h_source.html#l00046">mg_constrained_dofs.h:47</a></div></div>
<div class="ttc" id="aclassMGLevelObject_html"><div class="ttname"><a href="classMGLevelObject.html">MGLevelObject&lt; SparsityPattern &gt;</a></div></div>
<div class="ttc" id="aclassMappingQ_html"><div class="ttname"><a href="classMappingQ.html">MappingQ</a></div><div class="ttdef"><b>Definition:</b> <a href="mapping__q_8h_source.html#l00080">mapping_q.h:81</a></div></div>
<div class="ttc" id="aclassRelaxationBlock_html"><div class="ttname"><a href="classRelaxationBlock.html">RelaxationBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="relaxation__block_8h_source.html#l00057">relaxation_block.h:58</a></div></div>
<div class="ttc" id="aclassSparseMatrix_html"><div class="ttname"><a href="classSparseMatrix.html">SparseMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassSparsityPattern_html"><div class="ttname"><a href="classSparsityPattern.html">SparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="sparsity__pattern_8h_source.html#l00868">sparsity_pattern.h:869</a></div></div>
<div class="ttc" id="aclassTriangulation_html"><div class="ttname"><a href="classTriangulation.html">Triangulation</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8h_source.html#l01127">tria.h:1128</a></div></div>
<div class="ttc" id="aclassdouble_html"><div class="ttname"><a href="classdouble.html">double</a></div></div>
<div class="ttc" id="aclassmg_1_1Matrix_html"><div class="ttname"><a href="classmg_1_1Matrix.html">mg::Matrix</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__matrix_8h_source.html#l00044">mg_matrix.h:45</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga7b52b286796c23ef9ff178faf7a4b68f"><div class="ttname"><a href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">StandardExceptions::ExcNotImplemented</a></div><div class="ttdeci">static ::ExceptionBase &amp; ExcNotImplemented()</div></div>
<div class="ttc" id="anamespaceWorkStream_1_1internal_1_1tbb__no__coloring_html_a8673698a405bf47aa24002aeb6d76d70"><div class="ttname"><a href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">WorkStream::internal::tbb_no_coloring::run</a></div><div class="ttdeci">void run(const Iterator &amp;begin, const typename identity&lt; Iterator &gt;::type &amp;end, Worker worker, Copier copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const unsigned int queue_length, const unsigned int chunk_size)</div><div class="ttdef"><b>Definition:</b> <a href="work__stream_8h_source.html#l00691">work_stream.h:691</a></div></div>
<div class="ttc" id="anamespacenumbers_html_a3e24f194a9cb9b6ff4442b8a7a877d4a"><div class="ttname"><a href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a></div><div class="ttdeci">static constexpr double PI</div><div class="ttdef"><b>Definition:</b> <a href="numbers_8h_source.html#l00231">numbers.h:231</a></div></div>
<div class="ttc" id="anumbers_8h_html_a02761f62f66f685e954daed42bcb3a1b"><div class="ttname"><a href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">std::cos</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; cos(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05318">vectorization.h:5318</a></div></div>
<div class="ttc" id="anumbers_8h_html_a27989bdc7b4b828564982787d126bd91"><div class="ttname"><a href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">std::sin</a></div><div class="ttdeci">::VectorizedArray&lt; Number, width &gt; sin(const ::VectorizedArray&lt; Number, width &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="vectorization_8h_source.html#l05291">vectorization.h:5291</a></div></div>
<div class="ttc" id="ap4est__wrappers_8cc_html_ace00f2f80d9780ef9aa1007e1c22c6a4"><div class="ttname"><a href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a></div><div class="ttdeci">const ::parallel::distributed::Triangulation&lt; dim, spacedim &gt; * triangulation</div><div class="ttdef"><b>Definition:</b> <a href="p4est__wrappers_8cc_source.html#l00069">p4est_wrappers.cc:69</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemsetup_systemcode"></a> </p><h4><code>AdvectionProblem::setup_system()</code></h4>
<p>在这里，我们首先为活动和多网格级网格设置DoFHandler、AffineConstraints和SparsityPattern对象。 <br  />
</p>
<p>我们可以用DoFRenumbering类对活动DoF进行重新编号，但是平滑器只作用于多网格层，因此，这对计算并不重要。相反，我们将对每个多网格层次上的DoFs进行重新编号。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_system()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_levels = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  system_rhs.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  constraints.clear();</div>
<div class="line">  <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">    mapping, dof_handler, 0, BoundaryValues&lt;dim&gt;(), constraints);</div>
<div class="line">  <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">    mapping, dof_handler, 1, BoundaryValues&lt;dim&gt;(), constraints);</div>
<div class="line">  constraints.close();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">  <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                  dsp,</div>
<div class="line">                                  constraints,</div>
<div class="line">                                  <span class="comment">/*keep_constrained_dofs = */</span> <span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  sparsity_pattern.copy_from(dsp);</div>
<div class="line">  system_matrix.reinit(sparsity_pattern);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="ttc" id="aclassDoFHandler_html_a553ca864aaf70330d9be86bc78f36d1e"><div class="ttname"><a href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">DoFHandler::distribute_dofs</a></div><div class="ttdeci">void distribute_dofs(const FiniteElement&lt; dim, spacedim &gt; &amp;fe)</div></div>
<div class="ttc" id="aclassDoFHandler_html_a9aed31323cbd7619edac310c47e7a7ad"><div class="ttname"><a href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">DoFHandler::distribute_mg_dofs</a></div><div class="ttdeci">void distribute_mg_dofs()</div></div>
<div class="ttc" id="aclassDoFHandler_html_aa5b8d3c4b9deb0774dde5c2851e07e1e"><div class="ttname"><a href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">DoFHandler::n_dofs</a></div><div class="ttdeci">types::global_dof_index n_dofs() const</div></div>
<div class="ttc" id="aclassDynamicSparsityPattern_html"><div class="ttname"><a href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamic__sparsity__pattern_8h_source.html#l00318">dynamic_sparsity_pattern.h:319</a></div></div>
<div class="ttc" id="agroup__constraints_html_ga3b4ea7dfd313e388d868c4e4aa685799"><div class="ttname"><a href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a></div><div class="ttdeci">void make_hanging_node_constraints(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, AffineConstraints&lt; number &gt; &amp;constraints)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__constraints_8cc_source.html#l01787">dof_tools_constraints.cc:1787</a></div></div>
<div class="ttc" id="agroup__constraints_html_gaf78e864edbfba7e0a7477457bfb96b26"><div class="ttname"><a href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity_pattern, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true, const types::subdomain_id subdomain_id=numbers::invalid_subdomain_id)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools__sparsity_8cc_source.html#l00064">dof_tools_sparsity.cc:64</a></div></div>
<div class="ttc" id="anamespaceVectorTools_html_ab2562d41bb26f362043f9719a8cd9b87"><div class="ttname"><a href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a></div><div class="ttdeci">void interpolate_boundary_values(const Mapping&lt; dim, spacedim &gt; &amp;mapping, const DoFHandler&lt; dim, spacedim &gt; &amp;dof, const std::map&lt; types::boundary_id, const Function&lt; spacedim, number &gt; * &gt; &amp;function_map, std::map&lt; types::global_dof_index, number &gt; &amp;boundary_values, const ComponentMask &amp;component_mask=ComponentMask())</div></div>
</div><!-- fragment --><p>在列举了全局自由度以及（上面最后一行）层次自由度之后，让我们对层次自由度进行重新编号，以获得一个更好的平滑器，正如介绍中所解释的那样。 如果需要的话，下面的第一个区块会对下游或上游方向的每个层次的自由度进行重新编号。这只对点平滑器（SOR和Jacobi）有必要，因为块平滑器是在单元上操作的（见<code>create_smoother()</code>）。然后下面的块也实现了随机编号。</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span> || settings.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (settings.dof_renumbering ==</div>
<div class="line">          <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a> ||</div>
<div class="line">        settings.dof_renumbering ==</div>
<div class="line">          Settings::DoFRenumberingStrategy::upstream)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> direction =</div>
<div class="line">          (settings.dof_renumbering ==</div>
<div class="line">               Settings::DoFRenumberingStrategy::upstream ?</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">             -1.0 :</div>
<div class="line">             1.0) *</div>
<div class="line">          advection_direction;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">          <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a>(dof_handler,</div>
<div class="line">                                     <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                     direction,</div>
<div class="line">                                     <span class="comment">/*dof_wise_renumbering = */</span> <span class="keyword">true</span>);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.dof_renumbering ==</div>
<div class="line">             <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">          <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumbering::random</a>(dof_handler, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  }</div>
</div><!-- fragment --><p>该函数的其余部分只是设置了数据结构。下面代码的最后几行与其他GMG教程不同，因为它同时设置了接口输入和输出矩阵。我们需要这样做，因为我们的问题是非对称性的。</p>
<div class="fragment"><div class="line">  mg_constrained_dofs.clear();</div>
<div class="line">  mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  mg_constrained_dofs.make_zero_boundary_constraints(dof_handler, {0, 1});</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  mg_matrices.resize(0, n_levels - 1);</div>
<div class="line">  mg_matrices.clear_elements();</div>
<div class="line">  mg_interface_in.resize(0, n_levels - 1);</div>
<div class="line">  mg_interface_in.clear_elements();</div>
<div class="line">  mg_interface_out.resize(0, n_levels - 1);</div>
<div class="line">  mg_interface_out.clear_elements();</div>
<div class="line">  mg_sparsity_patterns.resize(0, n_levels - 1);</div>
<div class="line">  mg_interface_sparsity_patterns.resize(0, n_levels - 1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">    {</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                                   dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">        <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">        mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].copy_from(dsp);</div>
<div class="line">        mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">      }</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                                   dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">        <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                 mg_constrained_dofs,</div>
<div class="line">                                                 dsp,</div>
<div class="line">                                                 <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">        mg_interface_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].copy_from(dsp);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        mg_interface_in[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">        mg_interface_out[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceMGTools_html_a19ba9ee4a2b65235c8bb3fb65ea8f4e0"><div class="ttname"><a href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a></div><div class="ttdeci">void make_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, SparsityPatternType &amp;sparsity, const unsigned int level, const AffineConstraints&lt; number &gt; &amp;constraints=AffineConstraints&lt; number &gt;(), const bool keep_constrained_dofs=true)</div><div class="ttdef"><b>Definition:</b> <a href="mg__tools_8cc_source.html#l00593">mg_tools.cc:593</a></div></div>
<div class="ttc" id="anamespaceMGTools_html_a8c677f65f8f1d21fb1f4c55cb90079e0"><div class="ttname"><a href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a></div><div class="ttdeci">void make_interface_sparsity_pattern(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const MGConstrainedDoFs &amp;mg_constrained_dofs, SparsityPatternType &amp;sparsity, const unsigned int level)</div><div class="ttdef"><b>Definition:</b> <a href="mg__tools_8cc_source.html#l01052">mg_tools.cc:1052</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemassemble_cellcode"></a> </p><h4><code>AdvectionProblem::assemble_cell()</code></h4>
<p>这里我们定义了每个单元上的线性系统的装配，以便被下面的Mesh_loop()函数使用。这个函数为活动单元或水平单元装配单元矩阵（不管它的第一个参数是什么），并且只有在调用活动单元时才装配右手边。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_cell(<span class="keyword">const</span> IteratorType &amp;cell,</div>
<div class="line">                                          ScratchData&lt;dim&gt; &amp;  scratch_data,</div>
<div class="line">                                          CopyData &amp;          copy_data)</div>
<div class="line">{</div>
<div class="line">  copy_data.level = cell-&gt;level();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell =</div>
<div class="line">    scratch_data.fe_values.get_fe().n_dofs_per_cell();</div>
<div class="line">  copy_data.dofs_per_cell = dofs_per_cell;</div>
<div class="line">  copy_data.cell_matrix.reinit(dofs_per_cell, dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points =</div>
<div class="line">    scratch_data.fe_values.get_quadrature().size();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (cell-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">    copy_data.cell_rhs.reinit(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  copy_data.local_dof_indices.resize(dofs_per_cell);</div>
<div class="line">  cell-&gt;get_active_or_mg_dof_indices(copy_data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  scratch_data.fe_values.reinit(cell);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  RightHandSide&lt;dim&gt;  right_hand_side;</div>
<div class="line">  std::vector&lt;double&gt; rhs_values(n_q_points);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  right_hand_side.value_list(scratch_data.fe_values.get_quadrature_points(),</div>
<div class="line">                             rhs_values);</div>
</div><!-- fragment --><p>如果我们使用流线扩散，我们必须将其贡献添加到单元矩阵和单元右手边。如果我们不使用流线扩散，设置 \(\delta=0\) 就会否定下面的贡献，我们就只能使用标准的Galerkin有限元组合。</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> delta = (settings.with_streamline_diffusion ?</div>
<div class="line">                        compute_stabilization_delta(cell-&gt;diameter(),</div>
<div class="line">                                                    settings.epsilon,</div>
<div class="line">                                                    advection_direction,</div>
<div class="line">                                                    settings.fe_degree) :</div>
<div class="line">                        0.0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">        {</div>
</div><!-- fragment --><p>局部矩阵的组装有两个部分。首先是Galerkin贡献。</p>
<div class="fragment"><div class="line">copy_data.cell_matrix(i, j) +=</div>
<div class="line">  (settings.epsilon *</div>
<div class="line">   scratch_data.fe_values.shape_grad(i, q_point) *</div>
<div class="line">   scratch_data.fe_values.shape_grad(j, q_point) *</div>
<div class="line">   scratch_data.fe_values.JxW(q_point)) +</div>
<div class="line">  (scratch_data.fe_values.shape_value(i, q_point) *</div>
<div class="line">   (advection_direction *</div>
<div class="line">    scratch_data.fe_values.shape_grad(j, q_point)) *</div>
<div class="line">   scratch_data.fe_values.JxW(q_point))</div>
</div><!-- fragment --><p>然后是流线扩散贡献。</p>
<div class="fragment"><div class="line">      + delta *</div>
<div class="line">          (advection_direction *</div>
<div class="line">           scratch_data.fe_values.shape_grad(j, q_point)) *</div>
<div class="line">          (advection_direction *</div>
<div class="line">           scratch_data.fe_values.shape_grad(i, q_point)) *</div>
<div class="line">          scratch_data.fe_values.JxW(q_point) -</div>
<div class="line">      delta * settings.epsilon *</div>
<div class="line">        <a class="code" href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">trace</a>(scratch_data.fe_values.shape_hessian(j, q_point)) *</div>
<div class="line">        (advection_direction *</div>
<div class="line">         scratch_data.fe_values.shape_grad(i, q_point)) *</div>
<div class="line">        scratch_data.fe_values.JxW(q_point);</div>
<div class="line">  }</div>
<div class="line"><span class="keywordflow">if</span> (cell-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">  {</div>
<div class="ttc" id="aclassSymmetricTensor_html_a9137b6052702150e8e5b1188d1971906"><div class="ttname"><a href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">SymmetricTensor::trace</a></div><div class="ttdeci">constexpr Number trace(const SymmetricTensor&lt; 2, dim, Number &gt; &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="symmetric__tensor_8h_source.html#l02680">symmetric_tensor.h:2680</a></div></div>
</div><!-- fragment --><p>这同样适用于右手边。首先是Galerkin贡献。</p>
<div class="fragment"><div class="line">copy_data.cell_rhs(i) +=</div>
<div class="line">  scratch_data.fe_values.shape_value(i, q_point) *</div>
<div class="line">    rhs_values[q_point] * scratch_data.fe_values.JxW(q_point)</div>
</div><!-- fragment --><p>然后是流线扩散贡献。</p>
<div class="fragment"><div class="line">              + delta * rhs_values[q_point] * advection_direction *</div>
<div class="line">                  scratch_data.fe_values.shape_grad(i, q_point) *</div>
<div class="line">                  scratch_data.fe_values.JxW(q_point);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemassemble_system_and_multigridcode"></a> </p><h4><code>AdvectionProblem::assemble_system_and_multigrid()</code></h4>
<p>在这里，我们采用 <a class="el" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop()</a> 来翻阅单元格，为我们组装system_matrix、system_rhs和所有mg_matrices。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_system_and_multigrid()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_active =</div>
<div class="line">    [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>()) &amp;cell,</div>
<div class="line">        ScratchData&lt;dim&gt; &amp;                          scratch_data,</div>
<div class="line">        CopyData &amp;                                  copy_data) {</div>
<div class="line">      this-&gt;assemble_cell(cell, scratch_data, copy_data);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> copier_active = [&amp;](<span class="keyword">const</span> CopyData &amp;copy_data) {</div>
<div class="line">    constraints.distribute_local_to_global(copy_data.cell_matrix,</div>
<div class="line">                                           copy_data.cell_rhs,</div>
<div class="line">                                           copy_data.local_dof_indices,</div>
<div class="line">                                           system_matrix,</div>
<div class="line">                                           system_rhs);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>(),</div>
<div class="line">                        dof_handler.<a class="code" href="classDoFHandler.html#a042c4bf0f59fef5e72dbcfbdd56b2782">end</a>(),</div>
<div class="line">                        cell_worker_active,</div>
<div class="line">                        copier_active,</div>
<div class="line">                        ScratchData&lt;dim&gt;(fe, fe.degree + 1),</div>
<div class="line">                        CopyData(),</div>
<div class="line">                        <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa">MeshWorker::assemble_own_cells</a>);</div>
<div class="ttc" id="aclassDoFHandler_html_a042c4bf0f59fef5e72dbcfbdd56b2782"><div class="ttname"><a href="classDoFHandler.html#a042c4bf0f59fef5e72dbcfbdd56b2782">DoFHandler::end</a></div><div class="ttdeci">cell_iterator end() const</div></div>
<div class="ttc" id="aclassDoFHandler_html_a9a3bef554c6d22abe312e10e9475eecf"><div class="ttname"><a href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">DoFHandler::begin_active</a></div><div class="ttdeci">active_cell_iterator begin_active(const unsigned int level=0) const</div></div>
<div class="ttc" id="agroup__MeshWorker_html_ga76ec61fbd188fb320fe8ca166a79b322"><div class="ttname"><a href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a></div><div class="ttdeci">void mesh_loop(const CellIteratorType &amp;begin, const CellIteratorType &amp;end, const CellWorkerFunctionType &amp;cell_worker, const CopierType &amp;copier, const ScratchData &amp;sample_scratch_data, const CopyData &amp;sample_copy_data, const AssembleFlags flags=assemble_own_cells, const BoundaryWorkerFunctionType &amp;boundary_worker=BoundaryWorkerFunctionType(), const FaceWorkerFunctionType &amp;face_worker=FaceWorkerFunctionType(), const unsigned int queue_length=2 *MultithreadInfo::n_threads(), const unsigned int chunk_size=8)</div><div class="ttdef"><b>Definition:</b> <a href="mesh__loop_8h_source.html#l00282">mesh_loop.h:282</a></div></div>
<div class="ttc" id="anamespaceMeshWorker_html_ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa"><div class="ttname"><a href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa">MeshWorker::assemble_own_cells</a></div><div class="ttdeci">@ assemble_own_cells</div><div class="ttdef"><b>Definition:</b> <a href="assemble__flags_8h_source.html#l00048">assemble_flags.h:48</a></div></div>
</div><!-- fragment --><p>与活动层的约束不同，我们选择为这个函数的每个多网格层创建约束对象，因为它们在程序的其他地方不需要。</p>
<div class="fragment"><div class="line">std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">  <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels());</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div>
<div class="line">     ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classIndexSet.html">IndexSet</a> locally_owned_level_dof_indices;</div>
<div class="line">    <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(</div>
<div class="line">      dof_handler, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, locally_owned_level_dof_indices);</div>
<div class="line">    boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(locally_owned_level_dof_indices);</div>
<div class="line">    boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">      mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">    boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">      mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">    boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].close();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_mg =</div>
<div class="line">  [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>()) &amp;cell,</div>
<div class="line">      ScratchData&lt;dim&gt; &amp;                      scratch_data,</div>
<div class="line">      CopyData &amp;                              copy_data) {</div>
<div class="line">    this-&gt;assemble_cell(cell, scratch_data, copy_data);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> copier_mg = [&amp;](<span class="keyword">const</span> CopyData &amp;copy_data) {</div>
<div class="line">  boundary_constraints[copy_data.level].distribute_local_to_global(</div>
<div class="line">    copy_data.cell_matrix,</div>
<div class="line">    copy_data.local_dof_indices,</div>
<div class="line">    mg_matrices[copy_data.level]);</div>
<div class="ttc" id="aclassDoFHandler_html_a52af463de3283318bd4c651df7d35d24"><div class="ttname"><a href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">DoFHandler::begin_mg</a></div><div class="ttdeci">level_cell_iterator begin_mg(const unsigned int level=0) const</div></div>
<div class="ttc" id="aclassIndexSet_html"><div class="ttname"><a href="classIndexSet.html">IndexSet</a></div><div class="ttdef"><b>Definition:</b> <a href="index__set_8h_source.html#l00072">index_set.h:73</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a1fef7be07cf379b661646e39b9354e17"><div class="ttname"><a href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a></div><div class="ttdeci">void extract_locally_relevant_level_dofs(const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const unsigned int level, IndexSet &amp;dof_set)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l01252">dof_tools.cc:1252</a></div></div>
</div><!-- fragment --><p>如果 \((i,j)\) 是一个<code>interface_out</code> dof对，那么 \((j,i)\) 是一个<code>interface_in</code> dof对。注意：对于 "interface_in"，我们加载接口条目的转置，即，dof对 \((j,i)\) 的条目被存储在 "interface_in(i,j)"。这是对对称情况的优化，允许在solve()中设置边缘矩阵时只使用一个矩阵。然而，在这里，由于我们的问题是非对称的，我们必须同时存储<code>interface_in</code>和<code>interface_out</code>矩阵。</p>
<div class="fragment"><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; copy_data.dofs_per_cell; ++i)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; copy_data.dofs_per_cell; ++j)</div>
<div class="line">        <span class="keywordflow">if</span> (mg_constrained_dofs.is_interface_matrix_entry(</div>
<div class="line">              copy_data.level,</div>
<div class="line">              copy_data.local_dof_indices[i],</div>
<div class="line">              copy_data.local_dof_indices[j]))</div>
<div class="line">          {</div>
<div class="line">            mg_interface_out[copy_data.level].add(</div>
<div class="line">              copy_data.local_dof_indices[i],</div>
<div class="line">              copy_data.local_dof_indices[j],</div>
<div class="line">              copy_data.cell_matrix(i, j));</div>
<div class="line">            mg_interface_in[copy_data.level].add(</div>
<div class="line">              copy_data.local_dof_indices[i],</div>
<div class="line">              copy_data.local_dof_indices[j],</div>
<div class="line">              copy_data.cell_matrix(j, i));</div>
<div class="line">          }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>(),</div>
<div class="line">                        dof_handler.<a class="code" href="classDoFHandler.html#aaa2300cc9a5f93532400af2752d948f6">end_mg</a>(),</div>
<div class="line">                        cell_worker_mg,</div>
<div class="line">                        copier_mg,</div>
<div class="line">                        ScratchData&lt;dim&gt;(fe, fe.degree + 1),</div>
<div class="line">                        CopyData(),</div>
<div class="line">                        <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa">MeshWorker::assemble_own_cells</a>);</div>
<div class="line">}</div>
<div class="ttc" id="aclassDoFHandler_html_aaa2300cc9a5f93532400af2752d948f6"><div class="ttname"><a href="classDoFHandler.html#aaa2300cc9a5f93532400af2752d948f6">DoFHandler::end_mg</a></div><div class="ttdeci">level_cell_iterator end_mg(const unsigned int level) const</div></div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemsetup_smoothercode"></a></p><h4><code>AdvectionProblem::setup_smoother()</code></h4>
<p>接下来，我们根据&lt;tt&gt;.prm文件中的设置来设置平滑器。两个重要的选项是多网格v周期每一级的平滑前和平滑后步骤的数量以及松弛参数。</p>
<p>由于乘法方法往往比加法方法更强大，所以需要较少的平滑步骤来看到收敛，与网格大小无关。块平滑器比点平滑器的情况也是如此。这反映在下面对每种平滑器的平滑步骤数的选择上。</p>
<p>点平滑器的松弛参数是在试验和错误的基础上选择的，它反映了在我们细化网格时保持GMRES求解的迭代次数不变（或尽可能接近）的必要值。在&lt;tt&gt;.prm文件中给 "Jacobi "和 "SOR "的两个值是针对1度和3度有限元的。如果用户想改成其他度数，他们可能需要调整这些数字。对于块平滑器，这个参数有一个更直接的解释，即对于二维的加法，一个DoF可以有多达4个单元的重复贡献，因此我们必须将这些方法放松0.25来补偿。对于乘法来说，这不是一个问题，因为每个单元的逆向应用都会给其所有的DoF带来新的信息。</p>
<p>最后，如上所述，点平滑器只对DoF进行操作，而块平滑器对单元进行操作，因此只有块平滑器需要被赋予有关单元排序的信息。点平滑器的DoF排序已经在<code>setup_system()</code>中得到了处理。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_smoother()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionSOR.html">PreconditionSOR&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keyword">auto</span> smoother =</div>
<div class="line">        std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                Smoother,</div>
<div class="line">                                                <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">      smoother-&gt;initialize(mg_matrices,</div>
<div class="line">                           Smoother::AdditionalData(fe.degree == 1 ? 1.0 :</div>
<div class="line">                                                                     0.62));</div>
<div class="line">      smoother-&gt;set_steps(settings.smoothing_steps);</div>
<div class="line">      mg_smoother = std::move(smoother);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionJacobi.html">PreconditionJacobi&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line">      <span class="keyword">auto</span> smoother =</div>
<div class="line">        std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                Smoother,</div>
<div class="line">                                                <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">      smoother-&gt;initialize(mg_matrices,</div>
<div class="line">                           Smoother::AdditionalData(fe.degree == 1 ? 0.6667 :</div>
<div class="line">                                                                     0.47));</div>
<div class="line">      smoother-&gt;set_steps(settings.smoothing_steps);</div>
<div class="line">      mg_smoother = std::move(smoother);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ||</div>
<div class="line">           settings.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">    {</div>
<div class="line">      smoother_data.resize(0, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels() - 1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels(); ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches</a>(smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].block_list,</div>
<div class="line">                                      dof_handler,</div>
<div class="line">                                      <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].relaxation =</div>
<div class="line">            (settings.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ? 1.0 : 0.25);</div>
<div class="line">          smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].inversion = <a class="code" href="classPreconditionBlockBase.html">PreconditionBlockBase&lt;double&gt;::svd</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">          <span class="keywordflow">switch</span> (settings.dof_renumbering)</div>
<div class="line">            {</div>
<div class="line">              <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">                ordered_indices =</div>
<div class="line">                  create_downstream_cell_ordering(dof_handler,</div>
<div class="line">                                                  advection_direction,</div>
<div class="line">                                                  <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">                ordered_indices =</div>
<div class="line">                  create_downstream_cell_ordering(dof_handler,</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">                                                  -1.0 * advection_direction,</div>
<div class="line">                                                  <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">                ordered_indices =</div>
<div class="line">                  create_random_cell_ordering(dof_handler, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">default</span>:</div>
<div class="line">                <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">          smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].order =</div>
<div class="line">            std::vector&lt;std::vector&lt;unsigned int&gt;&gt;(1, ordered_indices);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">auto</span> smoother = std::make_unique&lt;<a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a>&lt;</div>
<div class="line">            <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">            <a class="code" href="classRelaxationBlockSOR.html">RelaxationBlockSOR&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classdouble.html">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">            <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">          smoother-&gt;initialize(mg_matrices, smoother_data);</div>
<div class="line">          smoother-&gt;set_steps(settings.smoothing_steps);</div>
<div class="line">          mg_smoother = std::move(smoother);</div>
<div class="line">        }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">auto</span> smoother = std::make_unique&lt;</div>
<div class="line">            <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                   <a class="code" href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                                         <a class="code" href="classdouble.html">double</a>,</div>
<div class="line">                                                         <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">                                   <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">          smoother-&gt;initialize(mg_matrices, smoother_data);</div>
<div class="line">          smoother-&gt;set_steps(settings.smoothing_steps);</div>
<div class="line">          mg_smoother = std::move(smoother);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">}</div>
<div class="ttc" id="aclassMGSmootherPrecondition_html"><div class="ttname"><a href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__smoother_8h_source.html#l00444">mg_smoother.h:445</a></div></div>
<div class="ttc" id="aclassPreconditionBlockBase_html"><div class="ttname"><a href="classPreconditionBlockBase.html">PreconditionBlockBase</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition__block__base_8h_source.html#l00058">precondition_block_base.h:59</a></div></div>
<div class="ttc" id="aclassPreconditionJacobi_html"><div class="ttname"><a href="classPreconditionJacobi.html">PreconditionJacobi</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00497">precondition.h:498</a></div></div>
<div class="ttc" id="aclassPreconditionSOR_html"><div class="ttname"><a href="classPreconditionSOR.html">PreconditionSOR</a></div><div class="ttdef"><b>Definition:</b> <a href="precondition_8h_source.html#l00583">precondition.h:584</a></div></div>
<div class="ttc" id="aclassRelaxationBlockJacobi_html"><div class="ttname"><a href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi</a></div><div class="ttdef"><b>Definition:</b> <a href="relaxation__block_8h_source.html#l00287">relaxation_block.h:290</a></div></div>
<div class="ttc" id="aclassRelaxationBlockSOR_html"><div class="ttname"><a href="classRelaxationBlockSOR.html">RelaxationBlockSOR</a></div><div class="ttdef"><b>Definition:</b> <a href="relaxation__block_8h_source.html#l00383">relaxation_block.h:386</a></div></div>
<div class="ttc" id="anamespaceDoFTools_html_a43ee44769769065bc594d1730477a4b9"><div class="ttname"><a href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches</a></div><div class="ttdeci">void make_cell_patches(SparsityPattern &amp;block_list, const DoFHandler&lt; dim, spacedim &gt; &amp;dof_handler, const unsigned int level, const std::vector&lt; bool &gt; &amp;selected_dofs={}, const types::global_dof_index offset=0)</div><div class="ttdef"><b>Definition:</b> <a href="dof__tools_8cc_source.html#l02515">dof_tools.cc:2515</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemsolvecode"></a> </p><h4><code>AdvectionProblem::solve()</code></h4>
<p>在求解系统之前，我们必须首先设置多网格预处理程序。这需要设置各级之间的转换、粗略矩阵求解器和平滑器。这个设置几乎与 <a class="el" href="step_16.html">step-16</a> 相同，主要区别在于上面定义的各种平滑器，以及由于我们的问题是非对称性的，所以我们需要不同的界面边缘矩阵。实际上，在本教程中，这些接口矩阵是空的，因为我们只使用全局细化，因此没有细化边。然而，我们在这里仍然包括了这两个矩阵，因为如果人们简单地切换到自适应细化方法，程序仍然可以正确运行）。)</p>
<p>最后要注意的是，由于我们的问题是非对称的，我们必须使用适当的Krylov子空间方法。我们在这里选择使用GMRES，因为它提供了在每次迭代中减少残差的保证。GMRES的主要缺点是，每次迭代，存储的临时向量的数量都会增加一个，而且还需要计算与之前存储的所有向量的标量积。这是很昂贵的。通过使用重启的GMRES方法可以放松这一要求，该方法对我们在任何时候需要存储的向量数量设置了上限（这里我们在50个临时向量后重启，即48次迭代）。这样做的缺点是我们失去了在整个迭代过程中收集的信息，因此我们可以看到收敛速度较慢。因此，在哪里重启是一个平衡内存消耗、CPU工作量和收敛速度的问题。然而，本教程的目标是通过使用强大的GMG预处理程序来实现非常低的迭代次数，所以我们选择了重启长度，使下面显示的所有结果在重启发生之前就能收敛，因此我们有一个标准的GMRES方法。如果用户有兴趣，在deal.II中提供的另一种合适的方法是BiCGStab。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::solve()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iters       = 200;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       solve_tolerance = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8 * system_rhs.l2_norm();</div>
<div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a>      solver_control(max_iters, solve_tolerance, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">  solver_control.enable_history_data();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> Transfer = <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">  Transfer mg_transfer(mg_constrained_dofs);</div>
<div class="line">  mg_transfer.build(dof_handler);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> coarse_matrix;</div>
<div class="line">  coarse_matrix.<a class="code" href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">copy_from</a>(mg_matrices[0]);</div>
<div class="line">  <a class="code" href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder&lt;double, Vector&lt;double&gt;</a>&gt; coarse_grid_solver;</div>
<div class="line">  coarse_grid_solver.<a class="code" href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">initialize</a>(coarse_matrix);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  setup_smoother();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  mg_matrix.initialize(mg_matrices);</div>
<div class="line">  mg_interface_matrix_in.initialize(mg_interface_in);</div>
<div class="line">  mg_interface_matrix_out.initialize(mg_interface_out);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classMultigrid.html">Multigrid&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">    mg_matrix, coarse_grid_solver, mg_transfer, *mg_smoother, *mg_smoother);</div>
<div class="line">  <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface_matrix_out, mg_interface_matrix_in);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, Vector&lt;double&gt;</a>, Transfer&gt; preconditioner(dof_handler,</div>
<div class="line">                                                               <a class="code" href="namespacemg.html">mg</a>,</div>
<div class="line">                                                               mg_transfer);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;     Solving with GMRES to tol &quot;</span> &lt;&lt; solve_tolerance &lt;&lt; <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="classSolverGMRES.html">SolverGMRES&lt;Vector&lt;double&gt;</a>&gt; solver(</div>
<div class="line">    solver_control, <a class="code" href="classSolverGMRES.html">SolverGMRES</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;::AdditionalData(50, <span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classTimer.html">Timer</a> time;</div>
<div class="line">  time.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
<div class="line">  solver.solve(system_matrix, solution, system_rhs, preconditioner);</div>
<div class="line">  time.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;          converged in &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; iterations&quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; time.<a class="code" href="classTimer.html#aba22973498b0e4c2b4d64bf799e95ba8">last_wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; seconds &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  mg_smoother.release();</div>
<div class="line">}</div>
<div class="ttc" id="aclassFullMatrix_html_ae9e8fbf00e15c7b66d527a5de4b31404"><div class="ttname"><a href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">FullMatrix::copy_from</a></div><div class="ttdeci">void copy_from(const MatrixType &amp;)</div></div>
<div class="ttc" id="aclassMGCoarseGridHouseholder_html"><div class="ttname"><a href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__coarse_8h_source.html#l00175">mg_coarse.h:176</a></div></div>
<div class="ttc" id="aclassMGCoarseGridHouseholder_html_a07bd76dc7f6f66cb22d3e7951a558f50"><div class="ttname"><a href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">MGCoarseGridHouseholder::initialize</a></div><div class="ttdeci">void initialize(const FullMatrix&lt; number &gt; &amp;A)</div></div>
<div class="ttc" id="aclassMGTransferPrebuilt_html"><div class="ttname"><a href="classMGTransferPrebuilt.html">MGTransferPrebuilt</a></div><div class="ttdef"><b>Definition:</b> <a href="mg__transfer_8h_source.html#l00636">mg_transfer.h:637</a></div></div>
<div class="ttc" id="aclassMultigrid_html"><div class="ttname"><a href="classMultigrid.html">Multigrid</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_8h_source.html#l00152">multigrid.h:153</a></div></div>
<div class="ttc" id="aclassPreconditionMG_html"><div class="ttname"><a href="classPreconditionMG.html">PreconditionMG</a></div><div class="ttdef"><b>Definition:</b> <a href="multigrid_8h_source.html#l00467">multigrid.h:468</a></div></div>
<div class="ttc" id="aclassSolverControl_html"><div class="ttname"><a href="classSolverControl.html">SolverControl</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__control_8h_source.html#l00065">solver_control.h:66</a></div></div>
<div class="ttc" id="aclassSolverGMRES_html"><div class="ttname"><a href="classSolverGMRES.html">SolverGMRES</a></div><div class="ttdef"><b>Definition:</b> <a href="solver__gmres_8h_source.html#l00175">solver_gmres.h:176</a></div></div>
<div class="ttc" id="aclassTimer_html"><div class="ttname"><a href="classTimer.html">Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00118">timer.h:119</a></div></div>
<div class="ttc" id="aclassTimer_html_a3a8b5272198d029779dc9302a54305a8"><div class="ttname"><a href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">Timer::start</a></div><div class="ttdeci">void start()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00177">timer.cc:177</a></div></div>
<div class="ttc" id="aclassTimer_html_a988f79aa183d9d5473c13106f5babe48"><div class="ttname"><a href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">Timer::stop</a></div><div class="ttdeci">double stop()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00194">timer.cc:194</a></div></div>
<div class="ttc" id="aclassTimer_html_aba22973498b0e4c2b4d64bf799e95ba8"><div class="ttname"><a href="classTimer.html#aba22973498b0e4c2b4d64bf799e95ba8">Timer::last_wall_time</a></div><div class="ttdeci">double last_wall_time() const</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cc_source.html#l00280">timer.cc:280</a></div></div>
<div class="ttc" id="anamespacePhysics_1_1Elasticity_1_1Kinematics_html_a9587d5229555daa5b1fa1ba2f8a40adb"><div class="ttname"><a href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">Physics::Elasticity::Kinematics::e</a></div><div class="ttdeci">SymmetricTensor&lt; 2, dim, Number &gt; e(const Tensor&lt; 2, dim, Number &gt; &amp;F)</div></div>
<div class="ttc" id="anamespacemg_html"><div class="ttname"><a href="namespacemg.html">mg</a></div><div class="ttdef"><b>Definition:</b> <a href="mg_8h_source.html#l00081">mg.h:82</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemoutput_resultscode"></a></p><h4><code>AdvectionProblem::output_results()</code></h4>
<p>最后一个感兴趣的功能是生成图形输出。这里我们以.vtu格式输出解决方案和单元格排序。</p>
<p>在该函数的顶部，我们为每个单元生成一个索引，以可视化平滑器使用的排序。请注意，我们只对活动单元而不是平滑器实际使用的层次做这个处理。对于点平滑器，我们对DoFs而不是单元进行重新编号，所以这只是对现实中发生的情况的一种近似。最后，随机排序不是我们实际使用的随机排序（见<code>create_smoother()</code>）。 <br  />
</p>
<p>然后，单元格的（整数）排序被复制到一个（浮点）矢量，用于图形输出。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a> = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells();</div>
<div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_indices(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">    <span class="keywordflow">switch</span> (settings.dof_renumbering)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">          ordered_indices =</div>
<div class="line">            create_downstream_cell_ordering(dof_handler, advection_direction);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">          ordered_indices =</div>
<div class="line">            create_downstream_cell_ordering(dof_handler,</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">                                            -1.0 * advection_direction);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">          ordered_indices = create_random_cell_ordering(dof_handler);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">          ordered_indices.resize(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++i)</div>
<div class="line">            ordered_indices[i] = i;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++i)</div>
<div class="line">      cell_indices(ordered_indices[i]) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(i);</div>
<div class="line">  }</div>
<div class="ttc" id="anamespaceinternal_1_1TriangulationImplementation_html_a3344398031a9e10cb9eef0784f8da1be"><div class="ttname"><a href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">internal::TriangulationImplementation::n_active_cells</a></div><div class="ttdeci">unsigned int n_active_cells(const internal::TriangulationImplementation::NumberCache&lt; 1 &gt; &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="grid_2tria_8cc_source.html#l12658">tria.cc:12658</a></div></div>
</div><!-- fragment --><p>然后，考虑到以前的教程程序，函数的其余部分就很简单了。</p>
<div class="fragment"><div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(cell_indices, <span class="stringliteral">&quot;cell_index&quot;</span>);</div>
<div class="line">  data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> std::string filename =</div>
<div class="line">    <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(cycle) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line">  std::ofstream output(filename.c_str());</div>
<div class="line">  data_out.<a class="code" href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div>
<div class="line">}</div>
<div class="ttc" id="aclassDataOut__DoFData_html_ac1eb26168177faa30ffbcf9cbb9c3cd5"><div class="ttname"><a href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">DataOut_DoFData::attach_dof_handler</a></div><div class="ttdeci">void attach_dof_handler(const DoFHandlerType &amp;)</div></div>
<div class="ttc" id="aclassDataOut__DoFData_html_ace4b76e565ba0701c4d32c26075ed3b9"><div class="ttname"><a href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">DataOut_DoFData::add_data_vector</a></div><div class="ttdeci">void add_data_vector(const VectorType &amp;data, const std::vector&lt; std::string &gt; &amp;names, const DataVectorType type=type_automatic, const std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt; &amp;data_component_interpretation=std::vector&lt; DataComponentInterpretation::DataComponentInterpretation &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="data__out__dof__data_8h_source.html#l01087">data_out_dof_data.h:1087</a></div></div>
<div class="ttc" id="aclassDataOut_html"><div class="ttname"><a href="classDataOut.html">DataOut</a></div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8h_source.html#l00147">data_out.h:150</a></div></div>
<div class="ttc" id="aclassDataOut_html_a5eb51872b8736849bb7e8d2007fae086"><div class="ttname"><a href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">DataOut::build_patches</a></div><div class="ttdeci">virtual void build_patches(const unsigned int n_subdivisions=0)</div><div class="ttdef"><b>Definition:</b> <a href="numerics_2data__out_8cc_source.html#l01085">data_out.cc:1085</a></div></div>
<div class="ttc" id="agroup__Exceptions_html_ga93c780f93105e0daaa76c6c43694b4ae"><div class="ttname"><a href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">DataOutInterface::write_vtu</a></div><div class="ttdeci">void write_vtu(std::ostream &amp;out) const</div><div class="ttdef"><b>Definition:</b> <a href="data__out__base_8cc_source.html#l07188">data_out_base.cc:7188</a></div></div>
<div class="ttc" id="anamespaceUtilities_html_a6195c5f009ea8c7c536c6ffdf108c32f"><div class="ttname"><a href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a></div><div class="ttdeci">std::string int_to_string(const unsigned int value, const unsigned int digits=numbers::invalid_unsigned_int)</div><div class="ttdef"><b>Definition:</b> <a href="base_2utilities_8cc_source.html#l00473">utilities.cc:473</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="codeAdvectionProblemruncode"></a> </p><h4><code><a class="el" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">AdvectionProblem::run()</a></code></h4>
<p>和大多数教程一样，这个函数创建/细化网格并调用上面定义的各种函数来设置、装配、求解和输出结果。</p>
<p>在第0个循环中，我们在正方形 <code>[-1,1]^dim</code> 上生成网格，半径为3/10单位的洞以原点为中心。对于<code>manifold_id</code>等于1的对象（即与洞相邻的面），我们指定一个球面流形。</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">AdvectionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle = 0; cycle &lt; (settings.fe_degree == 1 ? 7 : 5);</div>
<div class="line">         ++cycle)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  Cycle &quot;</span> &lt;&lt; cycle &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cycle == 0)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">                                                            0.3,</div>
<div class="line">                                                            1.0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a> manifold_description(<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0, 0));</div>
<div class="line">            <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.set_manifold(1, manifold_description);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels() &lt;&lt; <span class="stringliteral">&quot; levels)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of degrees of freedom: &quot;</span></div>
<div class="line">                  &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        solve();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (settings.output)</div>
<div class="line">          output_results(cycle);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step63</span></div>
<div class="ttc" id="aclassSphericalManifold_html"><div class="ttname"><a href="classSphericalManifold.html">SphericalManifold</a></div><div class="ttdef"><b>Definition:</b> <a href="grid_2manifold__lib_8h_source.html#l00236">manifold_lib.h:237</a></div></div>
<div class="ttc" id="anamespaceGridGenerator_html_add14cab546d033c1eaacc9234c64ebcd"><div class="ttname"><a href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a></div><div class="ttdeci">void hyper_cube_with_cylindrical_hole(Triangulation&lt; dim &gt; &amp;triangulation, const double inner_radius=.25, const double outer_radius=.5, const double L=.5, const unsigned int repetitions=1, const bool colorize=false)</div></div>
</div><!-- fragment --><p><a class="anchor" id="Thecodemaincodefunction"></a></p><h3>The <code>main</code> function</h3>
<p>最后，主函数与大多数教程一样。唯一有趣的一点是，我们要求用户传递一个&lt;tt&gt;.prm文件作为唯一的命令行参数。如果没有给出参数文件，程序将把所有默认值的样本参数文件的内容输出到屏幕上，然后用户可以复制并粘贴到自己的&lt;tt&gt;.prm文件中。</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Step63::Settings</a> settings;</div>
<div class="line">      settings.get_parameters((argc &gt; 1) ? (argv[1]) : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      Step63::AdvectionProblem&lt;2&gt; advection_problem_2d(settings);</div>
<div class="line">      advection_problem_2d.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="Results"></a></p><h1>Results</h1>
<p><a class="anchor" id="GMRESIterationNumbers"></a></p><h3>GMRES Iteration Numbers </h3>
<p>GMG的主要优势在于它是一种 \(\mathcal{O}(n)\) 方法，也就是说，问题的复杂性随着问题的大小而线性增加。为了证明本教程中介绍的线性求解器实际上是 \(\mathcal{O}(n)\) ，我们只需要证明GMRES求解的迭代次数在我们细化网格时保持大致不变。</p>
<p>以下各表给出了GMRES的迭代次数，以减少初始残差的系数 \(10^8\) 。我们选择了足够数量的平滑步骤（基于方法），以获得独立于网格大小的迭代数。从下面的表格可以看出，该方法确实是 \(\mathcal{O}(n)\) 。</p>
<p><a class="anchor" id="DoFCellRenumbering"></a></p><h4>DoF/Cell Renumbering </h4>
<p>逐点平滑器（"Jacobi "和 "SOR"）是按照每层的DoFs编号顺序来应用的。我们可以使用DoFRenumbering命名空间来影响这一点。块平滑器的应用是基于我们在<code>setup_smoother()</code>中设置的顺序。我们可以直观地看到这个编号。下面的图片显示了在下游、随机和上游编号的活动单元格的编号（从左到右）。</p>
<p><img src="https://www.dealii.org/images/steps/developer/step-63-cell-order.png" alt="" class="inline"/> <br  />
</p>
<p>让我们从加法平滑器开始。下表显示了从GMRES获得收敛所需的迭代次数。</p>
<table align="center" class="doxtable">
<tr>
<th></th><th></th><th colspan="1">\(Q_1\) </th><th colspan="7">Smoother (smoothing steps)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Jacobi (6) </th><th></th><th colspan="3">Block Jacobi (3)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Renumbering Strategy </th><th></th><th colspan="3">Renumbering Strategy  </th></tr>
<tr>
<th>Cells </th><th></th><th>DoFs </th><th>Downstream </th><th>Random </th><th>Upstream </th><th></th><th>Downstream </th><th>Random </th><th>Upstream  </th></tr>
<tr>
<th>32 </th><th></th><th>48 </th><td>3 </td><td>3 </td><td>3 </td><th></th><td>3 </td><td>3 </td><td>3  </td></tr>
<tr>
<th>128 </th><th></th><th>160 </th><td>6 </td><td>6 </td><td>6 </td><th></th><td>6 </td><td>6 </td><td>6  </td></tr>
<tr>
<th>512 </th><th></th><th>576 </th><td>11 </td><td>11 </td><td>11 </td><th></th><td>9 </td><td>9 </td><td>9  </td></tr>
<tr>
<th>2048 </th><th></th><th>2176 </th><td>15 </td><td>15 </td><td>15 </td><th></th><td>13 </td><td>13 </td><td>13  </td></tr>
<tr>
<th>8192 </th><th></th><th>8448 </th><td>18 </td><td>18 </td><td>18 </td><th></th><td>15 </td><td>15 </td><td>15  </td></tr>
<tr>
<th>32768 </th><th></th><th>33280 </th><td>20 </td><td>20 </td><td>20 </td><th></th><td>16 </td><td>16 </td><td>16  </td></tr>
<tr>
<th>131072 </th><th></th><th>132096 </th><td>20 </td><td>20 </td><td>20 </td><th></th><td>16 </td><td>16 </td><td>16  </td></tr>
</table>
<p><br  />
</p>
<p>我们看到，重新编号DoFs/单元对收敛速度没有影响。这是因为这些平滑器独立计算每个DoF（点平滑器）或单元（块平滑器）的操作，并将结果相加。由于我们可以将这些平滑器定义为矩阵之和的应用，而矩阵加法是换元的，所以我们对不同组件进行加法的顺序不会影响最终结果。</p>
<p>另一方面，乘法平滑器的情况则不同。</p>
<table align="center" class="doxtable">
<tr>
<th></th><th></th><th colspan="1">\(Q_1\) </th><th colspan="7">Smoother (smoothing steps)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">SOR (3) </th><th></th><th colspan="3">Block SOR (1)  </th></tr>
<tr>
<th></th><th></th><th></th><th colspan="3">Renumbering Strategy </th><th></th><th colspan="3">Renumbering Strategy  </th></tr>
<tr>
<th>Cells </th><th></th><th>DoFs </th><th>Downstream </th><th>Random </th><th>Upstream </th><th></th><th>Downstream </th><th>Random </th><th>Upstream  </th></tr>
<tr>
<th>32 </th><th></th><th>48 </th><td>2 </td><td>2 </td><td>3 </td><th></th><td>2 </td><td>2 </td><td>3  </td></tr>
<tr>
<th>128 </th><th></th><th>160 </th><td>5 </td><td>5 </td><td>7 </td><th></th><td>5 </td><td>5 </td><td>7  </td></tr>
<tr>
<th>512 </th><th></th><th>576 </th><td>7 </td><td>9 </td><td>11 </td><th></th><td>7 </td><td>7 </td><td>12  </td></tr>
<tr>
<th>2048 </th><th></th><th>2176 </th><td>10 </td><td>12 </td><td>15 </td><th></th><td>8 </td><td>10 </td><td>17  </td></tr>
<tr>
<th>8192 </th><th></th><th>8448 </th><td>11 </td><td>15 </td><td>19 </td><th></th><td>10 </td><td>11 </td><td>20  </td></tr>
<tr>
<th>32768 </th><th></th><th>33280 </th><td>12 </td><td>16 </td><td>20 </td><th></th><td>10 </td><td>12 </td><td>21  </td></tr>
<tr>
<th>131072 </th><th></th><th>132096 </th><td>12 </td><td>16 </td><td>19 </td><th></th><td>11 </td><td>12 </td><td>21  </td></tr>
</table>
<p><br  />
</p>
<p>在这里，我们可以通过在平流方向上对DoF/单元进行重新编号来加速收敛，同样，如果我们在相反的方向上进行重新编号，我们可以减缓收敛。这是因为平流主导的问题有一个信息流的方向性（平流方向），如果对DoFs/单元进行正确的重新编号，乘法就能抓住这个方向。</p>
<p>然而，乘法的这一特点取决于 \(\varepsilon\) 的值。当我们增加 \(\varepsilon\) ，问题变得更加以扩散为主时，我们在网格上的信息传播更加均匀，在平流方向上重新编号的优势就会减弱。相反，在 \(\varepsilon=0\) 的极端情况下（仅有平流），我们有一个一阶PDE，具有正确重编号的乘法成为有效的求解器。正确的下游编号可能导致方法只需要一次迭代，因为信息可以从流入边界向下游传播，而没有相反方向的信息传输。然而，请注意，在 \(\varepsilon=0\) 的情况下，必须对这种情况下的边界条件给予特别关注）。</p>
<p><a class="anchor" id="Pointvsblocksmoothers"></a></p><h4>Point vs. block smoothers </h4>
<p>我们将把结果限制在使用下游重新编号的运行上。下面是对 \(Q_1\) 和 \(Q_3\) 两个元素的所有四个平滑器的交叉比较。</p>
<table align="center" class="doxtable">
<tr>
<th></th><td></td><th colspan="1">\(Q_1\) </th><th colspan="4">Smoother (smoothing steps) </th><th></th><th colspan="1">\(Q_3\) </th><th colspan="4">Smoother (smoothing steps)  </th></tr>
<tr>
<th colspan="1">Cells </th><td></td><th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1) </th><th></th><th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1)  </th></tr>
<tr>
<th>32 </th><td></td><th>48 </th><td>3 </td><td>3 </td><td>2 </td><td>2 </td><td></td><th>336 </th><td>15 </td><td>14 </td><td>15 </td><td>6  </td></tr>
<tr>
<th>128 </th><td></td><th>160 </th><td>6 </td><td>6 </td><td>5 </td><td>5 </td><td></td><th>1248 </th><td>23 </td><td>18 </td><td>21 </td><td>9  </td></tr>
<tr>
<th>512 </th><td></td><th>576 </th><td>11 </td><td>9 </td><td>7 </td><td>7 </td><td></td><th>4800 </th><td>29 </td><td>21 </td><td>28 </td><td>9  </td></tr>
<tr>
<th>2048 </th><td></td><th>2176 </th><td>15 </td><td>13 </td><td>10 </td><td>8 </td><td></td><th>18816 </th><td>33 </td><td>22 </td><td>32 </td><td>9  </td></tr>
<tr>
<th>8192 </th><td></td><th>8448 </th><td>18 </td><td>15 </td><td>11 </td><td>10 </td><td></td><th>74496 </th><td>35 </td><td>22 </td><td>34 </td><td>10  </td></tr>
<tr>
<th>32768 </th><td></td><th>33280 </th><td>20 </td><td>16 </td><td>12 </td><td>10 </td><td></td></tr>
<tr>
<th>131072 </th><td></td><th>132096 </th><td>20 </td><td>16 </td><td>12 </td><td>11 </td><td></td></tr>
</table>
<p><br  />
</p>
<p>我们看到，对于 \(Q_1\) ，两个乘法平滑器需要的平滑步骤和迭代次数的组合都比加法平滑器小。然而，当我们将度数增加到 \(Q_3\) 元素时，在平滑步骤和迭代次数方面，块平滑器有明显的优势。具体来说，块状SOR平滑器在度数上给出了恒定的迭代次数，而块状Jacobi平滑器的迭代次数只增加了约38，而Jacobi和SOR的迭代次数分别为75和183。</p>
<p><a class="anchor" id="Cost"></a></p><h3>Cost </h3>
<p>迭代次数并不能完全说明一种平滑器比另一种平滑器的最优性。很明显，我们必须检查迭代的成本。块状平滑器在这里处于不利地位，因为它们必须为每个单元构建和反转一个单元矩阵。下面是一个具有74,496个DoF的 \(Q_3\) 元素的求解时间的比较。</p>
<table align="center" class="doxtable">
<tr>
<th colspan="1">\(Q_3\) </th><th colspan="4">Smoother (smoothing steps)  </th></tr>
<tr>
<th colspan="1">DoFs </th><th colspan="1">Jacobi (6) </th><th colspan="1">Block Jacobi (3) </th><th colspan="1">SOR (3) </th><th colspan="1">Block SOR (1)  </th></tr>
<tr>
<th>74496 </th><td>0.68s </td><td>5.82s </td><td>1.18s </td><td>1.02s  </td></tr>
</table>
<p><br  />
</p>
<p>需要最多迭代的平滑器（Jacobi）实际上需要最短的时间（大约是下一个最快方法的2/3）。这是因为应用Jacobi平滑步骤所需要的只是乘以一个对角线矩阵，这是非常便宜的。另一方面，虽然SOR比块SOR需要超过3倍的迭代（每个迭代有3倍的平滑步骤），但时间大致相当，这意味着块SOR的一个平滑步骤比SOR的一个平滑步骤大约慢9倍。最后，Jacobi块比SOR块的成本高6倍，这从每个方法的1个步骤具有相同的成本（反转单元格矩阵并将其相加或相乘），而Jacobi块每次迭代的平滑步骤数是2次迭代的3倍，这在直觉上是合理的。</p>
<p><a class="anchor" id="Additionalpoints"></a></p><h3>Additional points </h3>
<p>还有几个重要的点要提到。</p>
<ol>
<li>
<p class="startli">对于平行分布的网格，乘法不能在整个领域内执行。这是因为它们一次操作一个单元，下游的单元只有在上游的单元已经完成后才能被处理。这在单个处理器上是没有问题的。处理器只是一个接一个地浏览单元的列表。然而，在并行的情况下，这将意味着一些处理器是空闲的，因为上游处理器还没有完成对当前处理器所拥有的上游单元的工作。一旦上游处理器完成，下游处理器就可以开始工作，但那时上游处理器已经没有工作了。换句话说，在这些平稳的步骤中，大部分时间，大多数处理器实际上是空闲的。这不是获得良好的并行可扩展性的方法!</p>
<p class="interli">我们可以使用一种混合方法，即在每个子域上应用乘法平滑器，但是当你增加子域的数量时，该方法接近于加法的行为。这是这些方法的一个主要缺点。  <br  />
</p>
<p class="endli"></p>
</li>
<li>
目前对块平滑器的研究表明，很快我们将能够计算单元矩阵的逆，比目前在deal.II里面做的要便宜得多。这项研究是基于快速对角线化方法（可追溯到20世纪60年代），并在光谱界使用了约20年（见，例如，<a href="https://doi.org/10.1007/s10915-004-4787-3">Hybrid Multigrid/Schwarz Algorithms for the Spectral Element Method by Lottes and Fischer</a>）。目前，人们正在努力将这些方法推广到DG，并使其更加稳健。此外，人们似乎应该能够利用无矩阵实现的优势，以及在域的内部，单元矩阵往往看起来非常相似的事实，允许更少的矩阵逆计算。  </li>
</ol>
<p>。</p>
<p>结合1.和2.给出了一个很好的理由，期望像块状雅可比这样的方法在未来会变得非常强大，尽管目前对这些例子来说它是相当慢的。</p>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions </h3>
<p><a class="anchor" id="ConstantiterationsforQsub5sub"></a></p><h4>Constant iterations for Q<sub>5</sub> </h4>
<p>改变平滑步骤的数量和平滑器松弛参数（在 <code>Smoother::AdditionalData()</code> 中设置在 <code>create_smoother()</code> 里面，只对点平滑器有必要），以便我们对一个 \(Q_5\) 元素保持恒定的迭代次数。</p>
<p><a class="anchor" id="Effectivenessofrenumberingforchangingepsilon"></a></p><h4>Effectiveness of renumbering for changing epsilon </h4>
<p>增加/减少乘法的<code>.prm</code>文件中的参数 "Epsilon"，观察哪些数值的重新编号不再影响收敛速度。</p>
<p><a class="anchor" id="Meshadaptivity"></a></p><h4>Mesh adaptivity </h4>
<p>该代码已被设置为能在自适应细化的网格中正常工作（界面矩阵已创建并设置）。设计一个合适的细化标准或尝试KellyErrorEstimator类。<a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"><span class="comment">/* ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2018 - 2020 by the deal.II authors</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is part of the deal.II library.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute</span></div>
<div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General</span></div>
<div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at</span></div>
<div class="line"><span class="comment"> * the top level directory of deal.II.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * ---------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Authors: Thomas C. Clevenger, Clemson University</span></div>
<div class="line"><span class="comment"> *          Timo Heister, Clemson University and University of Utah</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tensor__function_8h.html">deal.II/base/tensor_function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector_8h.html">deal.II/lac/vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="full__matrix_8h.html">deal.II/lac/full_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="relaxation__block_8h.html">deal.II/lac/relaxation_block.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2manifold__lib_8h.html">deal.II/grid/manifold_lib.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__out_8h.html">deal.II/grid/grid_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mapping__q_8h.html">deal.II/fe/mapping_q.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__constrained__dofs_8h.html">deal.II/multigrid/mg_constrained_dofs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multigrid_8h.html">deal.II/multigrid/multigrid.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__transfer_8h.html">deal.II/multigrid/mg_transfer.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__tools_8h.html">deal.II/multigrid/mg_tools.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__coarse_8h.html">deal.II/multigrid/mg_coarse.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__smoother_8h.html">deal.II/multigrid/mg_smoother.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mg__matrix_8h.html">deal.II/multigrid/mg_matrix.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mesh__loop_8h.html">deal.II/meshworker/mesh_loop.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Step63</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">struct </span>ScratchData</div>
<div class="line">  {</div>
<div class="line">    ScratchData(<span class="keyword">const</span> <a class="code" href="classFiniteElement.html">FiniteElement&lt;dim&gt;</a> &amp;fe,</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        quadrature_degree)</div>
<div class="line">      : fe_values(fe,</div>
<div class="line">                  <a class="code" href="classQGauss.html">QGauss</a>&lt;dim&gt;(quadrature_degree),</div>
<div class="line">                  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    ScratchData(<span class="keyword">const</span> ScratchData&lt;dim&gt; &amp;scratch_data)</div>
<div class="line">      : fe_values(scratch_data.fe_values.get_fe(),</div>
<div class="line">                  scratch_data.fe_values.get_quadrature(),</div>
<div class="line">                  <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa378cbcddbdf54fb3f9f0acf47b1c4719">update_hessians</a> |</div>
<div class="line">                    <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="fe__update__flags_8h.html#aa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_values;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span>CopyData</div>
<div class="line">  {</div>
<div class="line">    CopyData() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   <a class="code" href="namespaceLocalIntegrators_1_1Advection.html#a8bc7b8136646134f73a4193adefe15f8">cell_matrix</a>;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       cell_rhs;</div>
<div class="line">    std::vector&lt;types::global_dof_index&gt; local_dof_indices;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a></div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">enum</span> DoFRenumberingStrategy</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">none</a>,</div>
<div class="line">      <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">downstream</a>,</div>
<div class="line">      upstream,</div>
<div class="line">      <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">random</a></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span>                 <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a338a944a393875e2dd499457d1055841">epsilon</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           fe_degree;</div>
<div class="line">    std::string            smoother_type;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           smoothing_steps;</div>
<div class="line">    DoFRenumberingStrategy dof_renumbering;</div>
<div class="line">    <span class="keywordtype">bool</span>                   with_streamline_diffusion;</div>
<div class="line">    <span class="keywordtype">bool</span>                   output;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> Settings::get_parameters(<span class="keyword">const</span> std::string &amp;prm_filename)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">/* First declare the parameters... */</span></div>
<div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm;</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;0.005&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0),</div>
<div class="line">                      <span class="stringliteral">&quot;Diffusion parameter&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;1&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                      <span class="stringliteral">&quot;Finite Element degree&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;block SOR&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;SOR|Jacobi|block SOR|block Jacobi&quot;</span>),</div>
<div class="line">                      <span class="stringliteral">&quot;Select smoother: SOR|Jacobi|block SOR|block Jacobi&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;2&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1),</div>
<div class="line">                      <span class="stringliteral">&quot;Number of smoothing steps&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(</div>
<div class="line">      <span class="stringliteral">&quot;DoF renumbering&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;downstream&quot;</span>,</div>
<div class="line">      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;none|downstream|upstream|random&quot;</span>),</div>
<div class="line">      <span class="stringliteral">&quot;Select DoF renumbering: none|downstream|upstream|random&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Enable streamline diffusion stabilization: true|false&quot;</span>);</div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Output&quot;</span>,</div>
<div class="line">                      <span class="stringliteral">&quot;true&quot;</span>,</div>
<div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(),</div>
<div class="line">                      <span class="stringliteral">&quot;Generate graphical output: true|false&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ...and then try to read their values from the input file: */</span></div>
<div class="line">    <span class="keywordflow">if</span> (prm_filename.empty())</div>
<div class="line">      {</div>
<div class="line">        prm.<a class="code" href="classParameterHandler.html#a4ac3a8b19ade16e96e8ea25906daf23a">print_parameters</a>(std::cout, <a class="code" href="group__Exceptions.html#ga8364dda711b93753c6809eefe2a8e827ae4d13a4598073bfcb69cd0cf4c1f8365">ParameterHandler::Text</a>);</div>
<div class="line">        <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(</div>
<div class="line">          <span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Please pass a .prm file as the first argument!&quot;</span>));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(prm_filename);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a338a944a393875e2dd499457d1055841">epsilon</a>         = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Epsilon&quot;</span>);</div>
<div class="line">    fe_degree       = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Fe degree&quot;</span>);</div>
<div class="line">    smoother_type   = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Smoother type&quot;</span>);</div>
<div class="line">    smoothing_steps = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Smoothing steps&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string renumbering = prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;DoF renumbering&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (renumbering == <span class="stringliteral">&quot;none&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">DoFRenumberingStrategy::none</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (renumbering == <span class="stringliteral">&quot;downstream&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumberingStrategy::downstream</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (renumbering == <span class="stringliteral">&quot;upstream&quot;</span>)</div>
<div class="line">      dof_renumbering = DoFRenumberingStrategy::upstream;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (renumbering == <span class="stringliteral">&quot;random&quot;</span>)</div>
<div class="line">      dof_renumbering = <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumberingStrategy::random</a>;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>,</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;The &lt;DoF renumbering&gt; parameter has &quot;</span></div>
<div class="line">                             <span class="stringliteral">&quot;an invalid value.&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    with_streamline_diffusion = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;With streamline diffusion&quot;</span>);</div>
<div class="line">    output                    = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;Output&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  create_downstream_cell_ordering(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   direction,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>))</div>
<div class="line">      ordered_cells.push_back(cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">      CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::level_cell_iterator, dim&gt;</div>
<div class="line">        comparator(direction);</div>
<div class="line">    std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned&gt; ordered_indices;</div>
<div class="line">    ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : ordered_cells)</div>
<div class="line">      ordered_indices.push_back(cell-&gt;index());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  create_downstream_cell_ordering(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a>   direction)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      ordered_cells.push_back(cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> DoFRenumbering::</div>
<div class="line">      CompareDownstream&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator, dim&gt;</div>
<div class="line">        comparator(direction);</div>
<div class="line">    std::sort(ordered_cells.begin(), ordered_cells.end(), comparator);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">    ordered_indices.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : ordered_cells)</div>
<div class="line">      ordered_indices.push_back(cell-&gt;index());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_indices;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  create_random_cell_ordering(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#abea687f123f3f5a8b09d7485cf03be72">n_cells</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#ga8c046284df67198c2d82c25950ea1ea3">cell_iterators_on_level</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>))</div>
<div class="line">      ordered_cells.push_back(cell-&gt;index());</div>
<div class="line"> </div>
<div class="line">    std::mt19937 random_number_generator;</div>
<div class="line">    std::shuffle(ordered_cells.begin(),</div>
<div class="line">                 ordered_cells.end(),</div>
<div class="line">                 random_number_generator);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  std::vector&lt;unsigned int&gt;</div>
<div class="line">  create_random_cell_ordering(<span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler)</div>
<div class="line">  {</div>
<div class="line">    std::vector&lt;unsigned int&gt; ordered_cells;</div>
<div class="line">    ordered_cells.reserve(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>().<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler.<a class="code" href="group__CPP11.html#gaace8c98aca00e7e48a619bb5e08084aa">active_cell_iterators</a>())</div>
<div class="line">      ordered_cells.push_back(cell-&gt;index());</div>
<div class="line"> </div>
<div class="line">    std::mt19937 random_number_generator;</div>
<div class="line">    std::shuffle(ordered_cells.begin(),</div>
<div class="line">                 ordered_cells.end(),</div>
<div class="line">                 random_number_generator);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ordered_cells;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>RightHandSide : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points,</div>
<div class="line">                            std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> RightHandSide&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">    (void)component;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> RightHandSide&lt;dim&gt;::value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points,</div>
<div class="line">                                      std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>,</div>
<div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>.size() == points.size(),</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>.size(), points.size()));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; points.size(); ++i)</div>
<div class="line">      <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>[i] = RightHandSide&lt;dim&gt;::value(points[i], component);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>BoundaryValues : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points,</div>
<div class="line">                            std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>,</div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> BoundaryValues&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p,</div>
<div class="line">                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(component == 0, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(component, 0, 1));</div>
<div class="line">    (void)component;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(p[0] - 1) &lt; 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8 ||</div>
<div class="line">        (<a class="code" href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">std::fabs</a>(p[1] + 1) &lt; 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8 &amp;&amp; p[0] &gt;= 0.5))</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">return</span> 1.0;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">return</span> 0.0;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> BoundaryValues&lt;dim&gt;::value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points,</div>
<div class="line">                                       std::vector&lt;double&gt; &amp;          <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>,</div>
<div class="line">                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>.size() == points.size(),</div>
<div class="line">           <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>.size(), points.size()));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; points.size(); ++i)</div>
<div class="line">      <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">values</a>[i] = BoundaryValues&lt;dim&gt;::value(points[i], component);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">double</span> compute_stabilization_delta(<span class="keyword">const</span> <span class="keywordtype">double</span>         hk,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acf35b7afd6a85044d32320355fbaabfe">eps</a>,</div>
<div class="line">                                     <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> dir,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">double</span>         pk)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> Peclet = dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * hk / (2.0 * <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1acf35b7afd6a85044d32320355fbaabfe">eps</a> * pk);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> =</div>
<div class="line">      (1.0 + <a class="code" href="numbers_8h.html#a372e01cd9d1d07fdf136f4f40975d5cf">std::exp</a>(-2.0 * Peclet)) / (1.0 - std::exp(-2.0 * Peclet));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> hk / (2.0 * dir.<a class="code" href="classTensor.html#afd0934b4edd71063f66a9c67540e79fc">norm</a>() * pk) * (<a class="code" href="namespaceDifferentiation_1_1SD.html#a66e76f1c4fdb9a31f4fabef8abee5f28">coth</a> - 1.0 / Peclet);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">class </span>AdvectionProblem</div>
<div class="line">  {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    AdvectionProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;settings);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_system();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">    <span class="keywordtype">void</span> assemble_cell(<span class="keyword">const</span> IteratorType &amp;cell,</div>
<div class="line">                       ScratchData&lt;dim&gt; &amp;  scratch_data,</div>
<div class="line">                       CopyData &amp;          copy_data);</div>
<div class="line">    <span class="keywordtype">void</span> assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setup_smoother();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> solve();</div>
<div class="line">    <span class="keywordtype">void</span> refine_grid();</div>
<div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>;</div>
<div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>    dof_handler;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a>     fe;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classMappingQ.html">MappingQ&lt;dim&gt;</a> mapping;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a> constraints;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a>      sparsity_pattern;</div>
<div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> system_matrix;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> solution;</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a> system_rhs;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_sparsity_patterns;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparsityPattern&gt;</a> mg_interface_sparsity_patterns;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_matrices;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_in;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SparseMatrix&lt;double&gt;</a>&gt; mg_interface_out;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_matrix;</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_in;</div>
<div class="line">    <a class="code" href="classmg_1_1Matrix.html">mg::Matrix&lt;Vector&lt;double&gt;</a>&gt; mg_interface_matrix_out;</div>
<div class="line"> </div>
<div class="line">    std::unique_ptr&lt;MGSmoother&lt;Vector&lt;double&gt;&gt;&gt; mg_smoother;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> SmootherType =</div>
<div class="line">      <a class="code" href="classRelaxationBlock.html">RelaxationBlock&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classdouble.html">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">    <span class="keyword">using</span> SmootherAdditionalDataType = SmootherType::AdditionalData;</div>
<div class="line">    <a class="code" href="classMGLevelObject.html">MGLevelObject&lt;SmootherAdditionalDataType&gt;</a> smoother_data;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMGConstrainedDoFs.html">MGConstrainedDoFs</a> mg_constrained_dofs;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> advection_direction;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> settings;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  AdvectionProblem&lt;dim&gt;::AdvectionProblem(<span class="keyword">const</span> <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Settings</a> &amp;settings)</div>
<div class="line">    : <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>(<a class="code" href="classTriangulation.html">Triangulation</a>&lt;dim&gt;::limit_level_difference_at_vertices)</div>
<div class="line">    , dof_handler(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>)</div>
<div class="line">    , fe(settings.fe_degree)</div>
<div class="line">    , mapping(settings.fe_degree)</div>
<div class="line">    , settings(settings)</div>
<div class="line">  {</div>
<div class="line">    advection_direction[0] = -<a class="code" href="numbers_8h.html#a27989bdc7b4b828564982787d126bd91">std::sin</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">    <span class="keywordflow">if</span> (dim &gt;= 2)</div>
<div class="line">      advection_direction[1] = <a class="code" href="numbers_8h.html#a02761f62f66f685e954daed42bcb3a1b">std::cos</a>(<a class="code" href="namespacenumbers.html#a3e24f194a9cb9b6ff4442b8a7a877d4a">numbers::PI</a> / 6.0);</div>
<div class="line">    <span class="keywordflow">if</span> (dim &gt;= 3)</div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_system()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_levels = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels();</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe);</div>
<div class="line"> </div>
<div class="line">    solution.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    system_rhs.reinit(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line"> </div>
<div class="line">    constraints.clear();</div>
<div class="line">    <a class="code" href="group__constraints.html#ga3b4ea7dfd313e388d868c4e4aa685799">DoFTools::make_hanging_node_constraints</a>(dof_handler, constraints);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">      mapping, dof_handler, 0, BoundaryValues&lt;dim&gt;(), constraints);</div>
<div class="line">    <a class="code" href="namespaceVectorTools.html#ab2562d41bb26f362043f9719a8cd9b87">VectorTools::interpolate_boundary_values</a>(</div>
<div class="line">      mapping, dof_handler, 1, BoundaryValues&lt;dim&gt;(), constraints);</div>
<div class="line">    constraints.close();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>());</div>
<div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                    dsp,</div>
<div class="line">                                    constraints,</div>
<div class="line">                                    <span class="comment">/*keep_constrained_dofs = */</span> <span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">    sparsity_pattern.copy_from(dsp);</div>
<div class="line">    system_matrix.reinit(sparsity_pattern);</div>
<div class="line"> </div>
<div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a9aed31323cbd7619edac310c47e7a7ad">distribute_mg_dofs</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span> || settings.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (settings.dof_renumbering ==</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a> ||</div>
<div class="line">            settings.dof_renumbering ==</div>
<div class="line">              Settings::DoFRenumberingStrategy::upstream)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> direction =</div>
<div class="line">              (settings.dof_renumbering ==</div>
<div class="line">                   Settings::DoFRenumberingStrategy::upstream ?</div>
<div class="line">                 -1.0 :</div>
<div class="line">                 1.0) *</div>
<div class="line">              advection_direction;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">DoFRenumbering::downstream</a>(dof_handler,</div>
<div class="line">                                         <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>,</div>
<div class="line">                                         direction,</div>
<div class="line">                                         <span class="comment">/*dof_wise_renumbering = */</span> <span class="keyword">true</span>);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.dof_renumbering ==</div>
<div class="line">                 <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">              <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">DoFRenumbering::random</a>(dof_handler, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    mg_constrained_dofs.clear();</div>
<div class="line">    mg_constrained_dofs.initialize(dof_handler);</div>
<div class="line"> </div>
<div class="line">    mg_constrained_dofs.make_zero_boundary_constraints(dof_handler, {0, 1});</div>
<div class="line"> </div>
<div class="line">    mg_matrices.resize(0, n_levels - 1);</div>
<div class="line">    mg_matrices.clear_elements();</div>
<div class="line">    mg_interface_in.resize(0, n_levels - 1);</div>
<div class="line">    mg_interface_in.clear_elements();</div>
<div class="line">    mg_interface_out.resize(0, n_levels - 1);</div>
<div class="line">    mg_interface_out.clear_elements();</div>
<div class="line">    mg_sparsity_patterns.resize(0, n_levels - 1);</div>
<div class="line">    mg_interface_sparsity_patterns.resize(0, n_levels - 1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; n_levels; ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">      {</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                                     dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">          <a class="code" href="namespaceMGTools.html#a19ba9ee4a2b65235c8bb3fb65ea8f4e0">MGTools::make_sparsity_pattern</a>(dof_handler, dsp, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">          mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].copy_from(dsp);</div>
<div class="line">          mg_matrices[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>),</div>
<div class="line">                                     dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">          <a class="code" href="namespaceMGTools.html#a8c677f65f8f1d21fb1f4c55cb90079e0">MGTools::make_interface_sparsity_pattern</a>(dof_handler,</div>
<div class="line">                                                   mg_constrained_dofs,</div>
<div class="line">                                                   dsp,</div>
<div class="line">                                                   <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">          mg_interface_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].copy_from(dsp);</div>
<div class="line"> </div>
<div class="line">          mg_interface_in[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">          mg_interface_out[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(mg_interface_sparsity_patterns[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>]);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> IteratorType&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_cell(<span class="keyword">const</span> IteratorType &amp;cell,</div>
<div class="line">                                            ScratchData&lt;dim&gt; &amp;  scratch_data,</div>
<div class="line">                                            CopyData &amp;          copy_data)</div>
<div class="line">  {</div>
<div class="line">    copy_data.level = cell-&gt;level();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dofs_per_cell =</div>
<div class="line">      scratch_data.fe_values.get_fe().n_dofs_per_cell();</div>
<div class="line">    copy_data.dofs_per_cell = dofs_per_cell;</div>
<div class="line">    copy_data.cell_matrix.reinit(dofs_per_cell, dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points =</div>
<div class="line">      scratch_data.fe_values.get_quadrature().size();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (cell-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">      copy_data.cell_rhs.reinit(dofs_per_cell);</div>
<div class="line"> </div>
<div class="line">    copy_data.local_dof_indices.resize(dofs_per_cell);</div>
<div class="line">    cell-&gt;get_active_or_mg_dof_indices(copy_data.local_dof_indices);</div>
<div class="line"> </div>
<div class="line">    scratch_data.fe_values.reinit(cell);</div>
<div class="line"> </div>
<div class="line">    RightHandSide&lt;dim&gt;  right_hand_side;</div>
<div class="line">    std::vector&lt;double&gt; rhs_values(n_q_points);</div>
<div class="line"> </div>
<div class="line">    right_hand_side.value_list(scratch_data.fe_values.get_quadrature_points(),</div>
<div class="line">                               rhs_values);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> delta = (settings.with_streamline_diffusion ?</div>
<div class="line">                            compute_stabilization_delta(cell-&gt;diameter(),</div>
<div class="line">                                                        settings.epsilon,</div>
<div class="line">                                                        advection_direction,</div>
<div class="line">                                                        settings.fe_degree) :</div>
<div class="line">                            0.0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q_point = 0; q_point &lt; n_q_points; ++q_point)</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dofs_per_cell; ++i)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dofs_per_cell; ++j)</div>
<div class="line">            {</div>
<div class="line">              copy_data.cell_matrix(i, j) +=</div>
<div class="line">                (settings.epsilon *</div>
<div class="line">                 scratch_data.fe_values.shape_grad(i, q_point) *</div>
<div class="line">                 scratch_data.fe_values.shape_grad(j, q_point) *</div>
<div class="line">                 scratch_data.fe_values.JxW(q_point)) +</div>
<div class="line">                (scratch_data.fe_values.shape_value(i, q_point) *</div>
<div class="line">                 (advection_direction *</div>
<div class="line">                  scratch_data.fe_values.shape_grad(j, q_point)) *</div>
<div class="line">                 scratch_data.fe_values.JxW(q_point))</div>
<div class="line">                + delta *</div>
<div class="line">                    (advection_direction *</div>
<div class="line">                     scratch_data.fe_values.shape_grad(j, q_point)) *</div>
<div class="line">                    (advection_direction *</div>
<div class="line">                     scratch_data.fe_values.shape_grad(i, q_point)) *</div>
<div class="line">                    scratch_data.fe_values.JxW(q_point) -</div>
<div class="line">                delta * settings.epsilon *</div>
<div class="line">                  <a class="code" href="classSymmetricTensor.html#a9137b6052702150e8e5b1188d1971906">trace</a>(scratch_data.fe_values.shape_hessian(j, q_point)) *</div>
<div class="line">                  (advection_direction *</div>
<div class="line">                   scratch_data.fe_values.shape_grad(i, q_point)) *</div>
<div class="line">                  scratch_data.fe_values.JxW(q_point);</div>
<div class="line">            }</div>
<div class="line">          <span class="keywordflow">if</span> (cell-&gt;is_level_cell() == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">              copy_data.cell_rhs(i) +=</div>
<div class="line">                scratch_data.fe_values.shape_value(i, q_point) *</div>
<div class="line">                  rhs_values[q_point] * scratch_data.fe_values.JxW(q_point)</div>
<div class="line">                + delta * rhs_values[q_point] * advection_direction *</div>
<div class="line">                    scratch_data.fe_values.shape_grad(i, q_point) *</div>
<div class="line">                    scratch_data.fe_values.JxW(q_point);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::assemble_system_and_multigrid()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_active =</div>
<div class="line">      [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>()) &amp;cell,</div>
<div class="line">          ScratchData&lt;dim&gt; &amp;                          scratch_data,</div>
<div class="line">          CopyData &amp;                                  copy_data) {</div>
<div class="line">        this-&gt;assemble_cell(cell, scratch_data, copy_data);</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> copier_active = [&amp;](<span class="keyword">const</span> CopyData &amp;copy_data) {</div>
<div class="line">      constraints.distribute_local_to_global(copy_data.cell_matrix,</div>
<div class="line">                                             copy_data.cell_rhs,</div>
<div class="line">                                             copy_data.local_dof_indices,</div>
<div class="line">                                             system_matrix,</div>
<div class="line">                                             system_rhs);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a9a3bef554c6d22abe312e10e9475eecf">begin_active</a>(),</div>
<div class="line">                          dof_handler.<a class="code" href="classDoFHandler.html#a042c4bf0f59fef5e72dbcfbdd56b2782">end</a>(),</div>
<div class="line">                          cell_worker_active,</div>
<div class="line">                          copier_active,</div>
<div class="line">                          ScratchData&lt;dim&gt;(fe, fe.degree + 1),</div>
<div class="line">                          CopyData(),</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa">MeshWorker::assemble_own_cells</a>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;AffineConstraints&lt;double&gt;&gt; boundary_constraints(</div>
<div class="line">      <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_global_levels();</div>
<div class="line">         ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classIndexSet.html">IndexSet</a> locally_owned_level_dof_indices;</div>
<div class="line">        <a class="code" href="namespaceDoFTools.html#a1fef7be07cf379b661646e39b9354e17">DoFTools::extract_locally_relevant_level_dofs</a>(</div>
<div class="line">          dof_handler, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, locally_owned_level_dof_indices);</div>
<div class="line">        boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].reinit(locally_owned_level_dof_indices);</div>
<div class="line">        boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">          mg_constrained_dofs.get_refinement_edge_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">        boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].add_lines(</div>
<div class="line">          mg_constrained_dofs.get_boundary_indices(<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>));</div>
<div class="line">        boundary_constraints[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].close();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> cell_worker_mg =</div>
<div class="line">      [&amp;](<span class="keyword">const</span> decltype(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>()) &amp;cell,</div>
<div class="line">          ScratchData&lt;dim&gt; &amp;                      scratch_data,</div>
<div class="line">          CopyData &amp;                              copy_data) {</div>
<div class="line">        this-&gt;assemble_cell(cell, scratch_data, copy_data);</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> copier_mg = [&amp;](<span class="keyword">const</span> CopyData &amp;copy_data) {</div>
<div class="line">      boundary_constraints[copy_data.level].distribute_local_to_global(</div>
<div class="line">        copy_data.cell_matrix,</div>
<div class="line">        copy_data.local_dof_indices,</div>
<div class="line">        mg_matrices[copy_data.level]);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; copy_data.dofs_per_cell; ++i)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; copy_data.dofs_per_cell; ++j)</div>
<div class="line">          <span class="keywordflow">if</span> (mg_constrained_dofs.is_interface_matrix_entry(</div>
<div class="line">                copy_data.level,</div>
<div class="line">                copy_data.local_dof_indices[i],</div>
<div class="line">                copy_data.local_dof_indices[j]))</div>
<div class="line">            {</div>
<div class="line">              mg_interface_out[copy_data.level].add(</div>
<div class="line">                copy_data.local_dof_indices[i],</div>
<div class="line">                copy_data.local_dof_indices[j],</div>
<div class="line">                copy_data.cell_matrix(i, j));</div>
<div class="line">              mg_interface_in[copy_data.level].add(</div>
<div class="line">                copy_data.local_dof_indices[i],</div>
<div class="line">                copy_data.local_dof_indices[j],</div>
<div class="line">                copy_data.cell_matrix(j, i));</div>
<div class="line">            }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__MeshWorker.html#ga76ec61fbd188fb320fe8ca166a79b322">MeshWorker::mesh_loop</a>(dof_handler.<a class="code" href="classDoFHandler.html#a52af463de3283318bd4c651df7d35d24">begin_mg</a>(),</div>
<div class="line">                          dof_handler.<a class="code" href="classDoFHandler.html#aaa2300cc9a5f93532400af2752d948f6">end_mg</a>(),</div>
<div class="line">                          cell_worker_mg,</div>
<div class="line">                          copier_mg,</div>
<div class="line">                          ScratchData&lt;dim&gt;(fe, fe.degree + 1),</div>
<div class="line">                          CopyData(),</div>
<div class="line">                          <a class="code" href="namespaceMeshWorker.html#ac7a9db8b34d398d7d398d1e8809874aaa44a76e905b1d4cd80af387b5fac4d8aa">MeshWorker::assemble_own_cells</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::setup_smoother()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;SOR&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionSOR.html">PreconditionSOR&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> smoother =</div>
<div class="line">          std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                  Smoother,</div>
<div class="line">                                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">        smoother-&gt;initialize(mg_matrices,</div>
<div class="line">                             Smoother::AdditionalData(fe.degree == 1 ? 1.0 :</div>
<div class="line">                                                                       0.62));</div>
<div class="line">        smoother-&gt;set_steps(settings.smoothing_steps);</div>
<div class="line">        mg_smoother = std::move(smoother);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">using</span> Smoother = <a class="code" href="classPreconditionJacobi.html">PreconditionJacobi&lt;SparseMatrix&lt;double&gt;</a>&gt;;</div>
<div class="line">        <span class="keyword">auto</span> smoother =</div>
<div class="line">          std::make_unique&lt;MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;,</div>
<div class="line">                                                  Smoother,</div>
<div class="line">                                                  <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">        smoother-&gt;initialize(mg_matrices,</div>
<div class="line">                             Smoother::AdditionalData(fe.degree == 1 ? 0.6667 :</div>
<div class="line">                                                                       0.47));</div>
<div class="line">        smoother-&gt;set_steps(settings.smoothing_steps);</div>
<div class="line">        mg_smoother = std::move(smoother);</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ||</div>
<div class="line">             settings.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">      {</div>
<div class="line">        smoother_data.resize(0, <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels() - 1);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = 0; <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> &lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels(); ++<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceDoFTools.html#a43ee44769769065bc594d1730477a4b9">DoFTools::make_cell_patches</a>(smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].block_list,</div>
<div class="line">                                        dof_handler,</div>
<div class="line">                                        <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line"> </div>
<div class="line">            smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].relaxation =</div>
<div class="line">              (settings.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span> ? 1.0 : 0.25);</div>
<div class="line">            smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].inversion = <a class="code" href="classPreconditionBlockBase.html">PreconditionBlockBase&lt;double&gt;::svd</a>;</div>
<div class="line"> </div>
<div class="line">            std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">            <span class="keywordflow">switch</span> (settings.dof_renumbering)</div>
<div class="line">              {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    create_downstream_cell_ordering(dof_handler,</div>
<div class="line">                                                    advection_direction,</div>
<div class="line">                                                    <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    create_downstream_cell_ordering(dof_handler,</div>
<div class="line">                                                    -1.0 * advection_direction,</div>
<div class="line">                                                    <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">                  ordered_indices =</div>
<div class="line">                    create_random_cell_ordering(dof_handler, <a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>);</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">                  <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line"> </div>
<div class="line">            smoother_data[<a class="code" href="grid__out_8cc.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>].order =</div>
<div class="line">              std::vector&lt;std::vector&lt;unsigned int&gt;&gt;(1, ordered_indices);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;block SOR&quot;</span>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">auto</span> smoother = std::make_unique&lt;<a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition</a>&lt;</div>
<div class="line">              <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">              <a class="code" href="classRelaxationBlockSOR.html">RelaxationBlockSOR&lt;SparseMatrix&lt;double&gt;</a>, <a class="code" href="classdouble.html">double</a>, <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">              <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">            smoother-&gt;initialize(mg_matrices, smoother_data);</div>
<div class="line">            smoother-&gt;set_steps(settings.smoothing_steps);</div>
<div class="line">            mg_smoother = std::move(smoother);</div>
<div class="line">          }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.smoother_type == <span class="stringliteral">&quot;block Jacobi&quot;</span>)</div>
<div class="line">          {</div>
<div class="line">            <span class="keyword">auto</span> smoother = std::make_unique&lt;</div>
<div class="line">              <a class="code" href="classMGSmootherPrecondition.html">MGSmootherPrecondition&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                     <a class="code" href="classRelaxationBlockJacobi.html">RelaxationBlockJacobi&lt;SparseMatrix&lt;double&gt;</a>,</div>
<div class="line">                                                           <a class="code" href="classdouble.html">double</a>,</div>
<div class="line">                                                           <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;,</div>
<div class="line">                                     <a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;&gt;();</div>
<div class="line">            smoother-&gt;initialize(mg_matrices, smoother_data);</div>
<div class="line">            smoother-&gt;set_steps(settings.smoothing_steps);</div>
<div class="line">            mg_smoother = std::move(smoother);</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::solve()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iters       = 200;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       solve_tolerance = 1<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>-8 * system_rhs.l2_norm();</div>
<div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a>      solver_control(max_iters, solve_tolerance, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">    solver_control.enable_history_data();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> Transfer = <a class="code" href="classMGTransferPrebuilt.html">MGTransferPrebuilt&lt;Vector&lt;double&gt;</a>&gt;;</div>
<div class="line">    Transfer mg_transfer(mg_constrained_dofs);</div>
<div class="line">    mg_transfer.build(dof_handler);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a> coarse_matrix;</div>
<div class="line">    coarse_matrix.<a class="code" href="classFullMatrix.html#ae9e8fbf00e15c7b66d527a5de4b31404">copy_from</a>(mg_matrices[0]);</div>
<div class="line">    <a class="code" href="classMGCoarseGridHouseholder.html">MGCoarseGridHouseholder&lt;double, Vector&lt;double&gt;</a>&gt; coarse_grid_solver;</div>
<div class="line">    coarse_grid_solver.<a class="code" href="classMGCoarseGridHouseholder.html#a07bd76dc7f6f66cb22d3e7951a558f50">initialize</a>(coarse_matrix);</div>
<div class="line"> </div>
<div class="line">    setup_smoother();</div>
<div class="line"> </div>
<div class="line">    mg_matrix.initialize(mg_matrices);</div>
<div class="line">    mg_interface_matrix_in.initialize(mg_interface_in);</div>
<div class="line">    mg_interface_matrix_out.initialize(mg_interface_out);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classMultigrid.html">Multigrid&lt;Vector&lt;double&gt;</a>&gt; <a class="code" href="namespacemg.html">mg</a>(</div>
<div class="line">      mg_matrix, coarse_grid_solver, mg_transfer, *mg_smoother, *mg_smoother);</div>
<div class="line">    <a class="code" href="namespacemg.html">mg</a>.set_edge_matrices(mg_interface_matrix_out, mg_interface_matrix_in);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classPreconditionMG.html">PreconditionMG&lt;dim, Vector&lt;double&gt;</a>, Transfer&gt; preconditioner(dof_handler,</div>
<div class="line">                                                                 <a class="code" href="namespacemg.html">mg</a>,</div>
<div class="line">                                                                 mg_transfer);</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;     Solving with GMRES to tol &quot;</span> &lt;&lt; solve_tolerance &lt;&lt; <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">    <a class="code" href="classSolverGMRES.html">SolverGMRES&lt;Vector&lt;double&gt;</a>&gt; solver(</div>
<div class="line">      solver_control, <a class="code" href="classSolverGMRES.html">SolverGMRES</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;::AdditionalData(50, <span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classTimer.html">Timer</a> time;</div>
<div class="line">    time.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
<div class="line">    solver.solve(system_matrix, solution, system_rhs, preconditioner);</div>
<div class="line">    time.<a class="code" href="classTimer.html#a988f79aa183d9d5473c13106f5babe48">stop</a>();</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;          converged in &quot;</span> &lt;&lt; solver_control.last_step()</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; iterations&quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; time.<a class="code" href="classTimer.html#aba22973498b0e4c2b4d64bf799e95ba8">last_wall_time</a>() &lt;&lt; <span class="stringliteral">&quot; seconds &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    constraints.distribute(solution);</div>
<div class="line"> </div>
<div class="line">    mg_smoother.release();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> AdvectionProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a> = <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells();</div>
<div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>     cell_indices(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">    {</div>
<div class="line">      std::vector&lt;unsigned int&gt; ordered_indices;</div>
<div class="line">      <span class="keywordflow">switch</span> (settings.dof_renumbering)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#a59c1a183ef6288e6bb061eb738b84380">Settings::DoFRenumberingStrategy::downstream</a>:</div>
<div class="line">            ordered_indices =</div>
<div class="line">              create_downstream_cell_ordering(dof_handler, advection_direction);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> Settings::DoFRenumberingStrategy::upstream:</div>
<div class="line">            ordered_indices =</div>
<div class="line">              create_downstream_cell_ordering(dof_handler,</div>
<div class="line">                                              -1.0 * advection_direction);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="namespaceDoFRenumbering.html#abbd608826acd7c01f91db401a3728e25">Settings::DoFRenumberingStrategy::random</a>:</div>
<div class="line">            ordered_indices = create_random_cell_ordering(dof_handler);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">case</span> <a class="code" href="group__Exceptions.html#gaa3cbced9f1d4ae661f13018f4c980aa1aa6f1f99c613aeb81b8d8e598b5567ce1">Settings::DoFRenumberingStrategy::none</a>:</div>
<div class="line">            ordered_indices.resize(<a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>);</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++i)</div>
<div class="line">              ordered_indices[i] = i;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">default</span>:</div>
<div class="line">            <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespaceinternal_1_1TriangulationImplementation.html#a3344398031a9e10cb9eef0784f8da1be">n_active_cells</a>; ++i)</div>
<div class="line">        cell_indices(ordered_indices[i]) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(i);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out;</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ac1eb26168177faa30ffbcf9cbb9c3cd5">attach_dof_handler</a>(dof_handler);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(solution, <span class="stringliteral">&quot;solution&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#ace4b76e565ba0701c4d32c26075ed3b9">add_data_vector</a>(cell_indices, <span class="stringliteral">&quot;cell_index&quot;</span>);</div>
<div class="line">    data_out.<a class="code" href="classDataOut.html#a5eb51872b8736849bb7e8d2007fae086">build_patches</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string filename =</div>
<div class="line">      <span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(cycle) + <span class="stringliteral">&quot;.vtu&quot;</span>;</div>
<div class="line">    std::ofstream output(filename.c_str());</div>
<div class="line">    data_out.<a class="code" href="group__Exceptions.html#ga93c780f93105e0daaa76c6c43694b4ae">write_vtu</a>(output);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">AdvectionProblem&lt;dim&gt;::run</a>()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cycle = 0; cycle &lt; (settings.fe_degree == 1 ? 7 : 5);</div>
<div class="line">         ++cycle)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  Cycle &quot;</span> &lt;&lt; cycle &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cycle == 0)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="namespaceGridGenerator.html#add14cab546d033c1eaacc9234c64ebcd">GridGenerator::hyper_cube_with_cylindrical_hole</a>(<a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>,</div>
<div class="line">                                                            0.3,</div>
<div class="line">                                                            1.0);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classSphericalManifold.html">SphericalManifold&lt;dim&gt;</a> manifold_description(<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>(0, 0));</div>
<div class="line">            <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.set_manifold(1, manifold_description);</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.refine_global();</div>
<div class="line"> </div>
<div class="line">        setup_system();</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of active cells:       &quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_active_cells() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span></div>
<div class="line">                  &lt;&lt; <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>.n_levels() &lt;&lt; <span class="stringliteral">&quot; levels)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;     Number of degrees of freedom: &quot;</span></div>
<div class="line">                  &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        assemble_system_and_multigrid();</div>
<div class="line"> </div>
<div class="line">        solve();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (settings.output)</div>
<div class="line">          output_results(cycle);</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// namespace Step63</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="namespaceTriangulationDescription.html#aa1531298eb0a267d9ceca5eb46ada8e0">Step63::Settings</a> settings;</div>
<div class="line">      settings.get_parameters((argc &gt; 1) ? (argv[1]) : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      Step63::AdvectionProblem&lt;2&gt; advection_problem_2d(settings);</div>
<div class="line">      advection_problem_2d.run();</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">      std::cerr &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span></div>
<div class="line">                &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceDifferentiation_1_1SD_html_a592560ee80355620422a86087f11b9df"><div class="ttname"><a href="namespaceDifferentiation_1_1SD.html#a592560ee80355620422a86087f11b9df">Differentiation::SD::fabs</a></div><div class="ttdeci">Expression fabs(const Expression &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="symengine__math_8cc_source.html#l00273">symengine_math.cc:273</a></div></div>
<div class="ttc" id="anamespaceinternal_html_aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804"><div class="ttname"><a href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa2063c1608d6e0baf80249c42e2be5804">internal::EvaluatorQuantity::value</a></div><div class="ttdeci">@ value</div></div>
</div><!-- fragment --><p> 。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
