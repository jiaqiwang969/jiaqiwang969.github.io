<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>nsCouette-未完。。。 | DEAL-II-Fluid</title><meta name="description" content="nsCouette介绍The Taylor-Couette (TC) set-up is one of the most famous paradigmatic systems for wall-bounded shear flows in general and maybe the most important one if you are interested in rotating shea"><meta name="keywords" content="nsCouette"><meta name="author" content="Jiaqi"><meta name="copyright" content="Jiaqi"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://deal-ii.com/post/c48f8ba7/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta property="og:type" content="article"><meta property="og:title" content="nsCouette-未完。。。"><meta property="og:url" content="http://deal-ii.com/post/c48f8ba7/"><meta property="og:site_name" content="DEAL-II-Fluid"><meta property="og:description" content="nsCouette介绍The Taylor-Couette (TC) set-up is one of the most famous paradigmatic systems for wall-bounded shear flows in general and maybe the most important one if you are interested in rotating shea"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Jiaqi-knight/imgBase@main/taylorCouette.png"><meta property="article:published_time" content="2020-11-23T14:23:34.000Z"><meta property="article:modified_time" content="2021-01-29T07:25:51.498Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="谱方法-未完。。。" href="http://deal-ii.com/post/44c06f35/"><link rel="next" title="着色器开篇" href="http://deal-ii.com/post/c62f4587/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-01-29 15:25:51'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><link rel="stylesheet" href="/gitcalendar/css/gitcalendar.css"/><meta name="generator" content="Hexo 5.3.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/Jiaqi-knight/imgBase@main/me.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">32</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">14</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 索引</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/x-swirlflow/"><i class="fa-fw fa fa-book"></i><span> swirlflow</span></a></li><li><a class="site-page" href="/x-codepen/"><i class="fa-fw fa fa-magic"></i><span> codepen</span></a></li><li><a class="site-page" href="/x-gallery/"><i class="fa-fw fa fa-beer"></i><span> gallery</span></a></li><li><a class="site-page" href="/x-shadertoy/"><i class="fa-fw fa fa-star"></i><span> shadertoy</span></a></li><li><a class="site-page" href="/x-webgl1/"><i class="fa-fw fa fa-camera-retro"></i><span> webgl1</span></a></li><li><a class="site-page" href="/x-webgl2/"><i class="fa-fw fa fa-camera-retro"></i><span> webgl2</span></a></li><li><a class="site-page" href="/x-markdown/"><i class="fa-fw fa fa-tree"></i><span> Vditor</span></a></li><li><a class="site-page" href="/x-DNN/"><i class="fa-fw fa fa-heartbeat"></i><span> DNN</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nsCouette%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">nsCouette介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Governing-equation-and-geometry1"><span class="toc-number">2.</span> <span class="toc-text">Governing equation and geometry1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Start-from-N-S-function2"><span class="toc-number">2.1.</span> <span class="toc-text">Start from N-S function2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Material-Derivative"><span class="toc-number">2.1.1.</span> <span class="toc-text">Material Derivative</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cauchy-stress-tensor3"><span class="toc-number">2.1.2.</span> <span class="toc-text">Cauchy stress tensor3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Incompressible-N-S-equation"><span class="toc-number">2.2.</span> <span class="toc-text">Incompressible N-S equation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Numerical-simulation"><span class="toc-number">3.</span> <span class="toc-text">Numerical simulation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E7%A6%BB%E6%95%A3"><span class="toc-number">3.1.</span> <span class="toc-text">空间离散</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%99%84%E5%BD%951-%EF%BC%9A"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">附录1 ：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Boundary-condition"><span class="toc-number">3.2.</span> <span class="toc-text">Boundary condition</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install"><span class="toc-number">4.</span> <span class="toc-text">Install</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nsCouette-gpu%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-%E7%B1%BB%E4%BC%BCC%E8%AF%AD%E8%A8%80-%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">nsCouette-gpu环境配置(类似C语言)：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">代码解析</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/Jiaqi-knight/imgBase@main/taylorCouette.png)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">DEAL-II-Fluid</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 索引</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/x-swirlflow/"><i class="fa-fw fa fa-book"></i><span> swirlflow</span></a></li><li><a class="site-page" href="/x-codepen/"><i class="fa-fw fa fa-magic"></i><span> codepen</span></a></li><li><a class="site-page" href="/x-gallery/"><i class="fa-fw fa fa-beer"></i><span> gallery</span></a></li><li><a class="site-page" href="/x-shadertoy/"><i class="fa-fw fa fa-star"></i><span> shadertoy</span></a></li><li><a class="site-page" href="/x-webgl1/"><i class="fa-fw fa fa-camera-retro"></i><span> webgl1</span></a></li><li><a class="site-page" href="/x-webgl2/"><i class="fa-fw fa fa-camera-retro"></i><span> webgl2</span></a></li><li><a class="site-page" href="/x-markdown/"><i class="fa-fw fa fa-tree"></i><span> Vditor</span></a></li><li><a class="site-page" href="/x-DNN/"><i class="fa-fw fa fa-heartbeat"></i><span> DNN</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">nsCouette-未完。。。</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-11-23 22:23:34"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-11-23</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-01-29 15:25:51"><i class="fas fa-history fa-fw"></i> 更新于 2021-01-29</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E5%92%8C%E9%A2%86%E6%82%9F/">算法学习和领悟</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="nsCouette介绍"><a href="#nsCouette介绍" class="headerlink" title="nsCouette介绍"></a>nsCouette介绍</h2><p>The Taylor-Couette (TC) set-up is one of the most famous paradigmatic systems for wall-bounded shear flows in general and maybe the most important one if you are interested in rotating shear flows in particular. For understanding the following chapters of this documentation, it might help to acquaint yourself with a bit of crucial terminology and basic concepts of the TC system as well as with the notation we will use throughout this documentation and in the source code of nsCouette.</p>
<ul>
<li>代码来源：</li>
</ul>
<p>John F. Gibson提出Plane Couette算法 <a target="_blank" rel="noopener" href="http://channelflow.org/dokuwiki/doku.php?id=docs">http://channelflow.org/dokuwiki/doku.php?id=docs</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/epfl-ecps/channelflow">https://github.com/epfl-ecps/channelflow</a></p>
<ul>
<li>参考AVILA<a target="_blank" rel="noopener" href="https://www.zarm.uni-bremen.de/en/research/fluid-dynamics/fluid-simulation-and-modeling/team-members.html">课题组</a>： </li>
</ul>
<p>NONLINEAR DYNAMICS OF MODE COMPETITION IN ANNULAR FLOWS- 2008-MARC AVILA-phd-thesis</p>
<p>Direct Numerical Simulation of Transition to Turbulence and Turbulence Control in Pipe Flow- Baofang Song-phd-thesis</p>
<h2 id="Governing-equation-and-geometry1"><a href="#Governing-equation-and-geometry1" class="headerlink" title="Governing equation and geometry1"></a>Governing equation and geometry<sup><a href="#fn_1" id="reffn_1">1</a></sup></h2><h3 id="Start-from-N-S-function2"><a href="#Start-from-N-S-function2" class="headerlink" title="Start from N-S function2"></a>Start from N-S function<sup><a href="#fn_2" id="reffn_2">2</a></sup></h3><p>The naiver-Stoke model are very similar to the corresponding equation of the Euler equation. The different is additional terms that take into count the effect of internal friction and heat conduction in the fluid.</p>
<p>The momentum equation in this model is of the form of the Cauchy momentum equation:</p>
<script type="math/tex; mode=display">
{D \vec{u}\over Dt} = {1\over \rho} {\partial \sigma_{\alpha \beta} \over \partial x_\beta} + \vec{g}</script><p>$\sigma$ is the stress tensor, g contains all the body forces per unit mass.</p>
<p>  Write in terms of equation in cylindrical coordinates:</p>
<script type="math/tex; mode=display">
\vec{u}(r,\theta, z, t)= u_r (r,\theta,z,t) \vec{e_r} + u_\theta(r,\theta,z,t)\vec{e_\theta} + u_z(r,\theta,z,t)\vec{e_z}</script><p>where $vec{e}$ is a right-handed triad of unit vectors.</p>
<h4 id="Material-Derivative"><a href="#Material-Derivative" class="headerlink" title="Material Derivative"></a>Material Derivative</h4><script type="math/tex; mode=display">
{D \vec{u}\over Dt} = \partial_t \vec{u} + \vec{u} \cdot \nabla \vec{u}</script><h4 id="Cauchy-stress-tensor3"><a href="#Cauchy-stress-tensor3" class="headerlink" title="Cauchy stress tensor3"></a>Cauchy stress tensor<sup><a href="#fn_3" id="reffn_3">3</a></sup></h4><script type="math/tex; mode=display">
\sigma = -p \vec{I} +\sigma'\\\\
\sigma_{\alpha\beta}'=\mu({\partial u_\beta \over \partial x_\alpha}+{\partial u_\alpha\over x_\beta}-{2\over 3} \sigma_{\alpha\beta}{\partial u_\gamma \over \partial x_\gamma}) + \mu_B \sigma_{\alpha\beta}{\partial u_\gamma \over \partial x_\gamma}</script><script type="math/tex; mode=display">
\nu={\mu \over \rho}</script><p>其中，$\sigma$ is the tensor.</p>
<script type="math/tex; mode=display">
\nabla \vec{u}=[{\partial u_\beta \over \partial x_\alpha}]=\vec{u} \otimes \nabla=(u_r \vec{e_r}+u_\theta \vec{e_\theta}+ u_z \vec{e_z})\otimes (\vec{e_r} {\partial \over \partial r} + \vec{e_\theta}{1\over r}{\partial \over \partial \theta} + \vec{e_\theta}{\partial \over \partial z})</script><p>one term for example:</p>
<script type="math/tex; mode=display">
{\partial \vec{e_r}\over \partial r}= {\partial \vec{e_\theta}\over \partial r} ={\partial \vec{e_z}\over \partial r}=0\\\\
{\partial \vec{e_r} \over \partial \theta} =\vec{e_\theta}\\\\
{\partial \vec{e_\theta} \over \partial \theta} =-\vec{e_r}</script><script type="math/tex; mode=display">
{1\over r}{\partial \over \partial \theta} (u_r \vec{e_r}) \otimes  \vec{e_\theta} = {1\over r}{\partial u_r \over \partial \theta} \vec{e_r} \otimes {\vec{e_\theta}} + {u_r \over r} {\partial \vec{e_r}\over \partial \theta} \otimes \vec{e_\theta}= {1\over r}{\partial u_r \over \partial \theta} \vec{e_r} \otimes {\vec{e_\theta}} + {u_r \over r} \vec{e_\theta} \otimes \vec{e_\theta}</script><p>The final result, expressed as a tensor, is</p>
<script type="math/tex; mode=display">
\nabla \vec{u}=\begin{bmatrix}
{\partial u_r\over \partial r} & {1\over r}{\partial u_r \over \partial \theta}-{u_\theta\over r} & {\partial u_r \over \partial z} \\
{\partial u_\theta \over \partial r} & {1\over r}{\partial u_\theta \over \partial \theta}+{u_r\over r} & {\partial u_\theta \over \partial z} \\
{\partial u_z\over \partial r} & {1\over r}{\partial u_\theta \over \partial \theta} & {\partial u_z\over \partial z} \\
\end{bmatrix}</script><p>Thus, </p>
<script type="math/tex; mode=display">
\nabla \vec{u}+\nabla \vec{u}^T=[{\partial u_\beta \over \partial x_\alpha}+{\partial u_\alpha\over x_\beta}]_{tensor}=\begin{bmatrix}
2{\partial u_r\over \partial r} & {1\over r}{\partial u_r \over \partial \theta}-{u_\theta\over r}+{\partial u_\theta \over \partial r} & {\partial u_r \over \partial z} + {\partial u_z\over \partial r}\\
{1\over r}{\partial u_r \over \partial \theta}-{u_\theta\over r}+{\partial u_\theta \over \partial r}  & 2({1\over r}{\partial u_\theta \over \partial \theta}+{u_r\over r}) & {\partial u_\theta \over \partial z} + {1\over r}{\partial u_\theta \over \partial \theta} \\
{\partial u_r \over \partial z} + {\partial u_z\over \partial r} & {\partial u_\theta \over \partial z} + {1\over r}{\partial u_\theta \over \partial \theta}& 2{\partial u_z\over \partial z} \\
\end{bmatrix}</script><p>最后， 可以简化stress term$\nabla \cdot \sigma$ in N-S equation:<sup><a href="#fn_3" id="reffn_3">3</a></sup></p>
<script type="math/tex; mode=display">
\nabla \cdot \sigma_{tensor}= ({\sigma_{rr}\over r}+{\partial \sigma_{rr}\over\partial r}+ {1\over r}{\partial \sigma_{r\theta}\over \partial \theta}+ {\partial \sigma_{rz}\over \partial z}-{\sigma_{\theta\theta}\over r})\vec{e_r}\\\\
+({2 \sigma_{r\theta}\over r}+{\partial \sigma_{r\theta}\over \partial r}+ {1\over r}{\partial \sigma_{\theta\theta}\over \partial\theta}+{\partial \sigma_{\theta z}\over\partial z})\vec{e_\theta} \\\\
+ ({\partial \sigma_{rz}\over r}+ {\partial \sigma_{r z}\over \partial r}+{1\over r}{\partial \sigma_{\theta z}\over \partial \theta}+{\partial \sigma_{zz}\over \partial z})\vec{e_z}</script><p>带入上面的公式，</p>
<p>第一项-这里有一大堆整理，参考<sup><a href="#fn_3" id="reffn_3">3</a></sup></p>
<script type="math/tex; mode=display">
({\sigma_{rr}\over r}+{\partial \sigma_{rr}\over\partial r}+ {1\over r}{\partial \sigma_{r\theta}\over \partial \theta}+ {\partial \sigma_{rz}\over \partial z}-{\sigma_{\theta\theta}\over r})\vec{e_r} \\\\
= -{\partial p \over \partial r} + \mu （-{u_r \over r^2}+{\partial \over \partial r }[{1\over r}{\partial (r u_r)\over \partial r}+{1\over r}{\partial u_\theta \over \partial \theta}+{\partial u_z \over \partial z}]+{1\over r}{\partial \over \partial r}(r{\partial u_r \over \partial r})+{1\over r^2}{\partial ^2 u_r \over \partial \theta^2}+ {\partial^2 u_r \over\partial z^2}-{2\over r^2}{\partial u_\theta \over \partial \theta}）\vec{e_r}</script><p>For an incompressible fluid, the term in the square brackets is equal to zero because of continuity equation.</p>
<p>同理，第二项，第三项</p>
<h3 id="Incompressible-N-S-equation"><a href="#Incompressible-N-S-equation" class="headerlink" title="Incompressible N-S equation"></a>Incompressible N-S equation</h3><p>In may subfields of fluid mechanics, the fluid is often considered to be incompressible, meaning that the density $\rho$ is constant. This assumption satisfied the mass conservation equation to:</p>
<script type="math/tex; mode=display">
\nabla \cdot \vec{u}=0</script><p>Consequently, the bulk viscosity in N-S equation becomes irrelevant, as its terms is zero. For this reason, bulk viscosity is often neglected in fluid mechanics. Still, it relevant in acoustics and high-velocity compressible flow.</p>
<p>同时，2/3那一项也忽略掉。</p>
<p>建立不可压N-S方程, 这里假设$\rho$ is constant</p>
<script type="math/tex; mode=display">
\partial_t \vec{u} + \vec{u} \cdot \nabla \vec{u} = -{1\over \rho}\nabla p^h +\nu \nabla \cdot({\partial u_\beta \over \partial x_\alpha}+{\partial u_\alpha \over \partial x_\beta}）</script><p>其中，$\vec{u}(\vec{r},t)$ 是速度场， $p^h$ 是hydrodynamic pressure. 雷诺数$Re= \Omega r d/ \nu$, $d= r_0-r_i$, $\eta= r_i / r_o$, the length-to-gap aspect ratio $\Gamma = L_z/d$, $L_z$ 为柱子的高度。</p>
<p>—》由上面的详细推导过程，阐述了 $\nabla \cdot \sigma$的详细推导过程：</p>
<p>因此，公式最终可以整理成不可压的形式为（一些细节和约化参见附录1）：</p>
<script type="math/tex; mode=display">
{\partial u_r \over \partial t} + u_r {\partial u_r \over \partial r} +{u_\theta \over r}{\partial u_r \over \partial \theta} - {u_\theta^2 \over r}+u_z{\partial u_r \over \partial z}=\\\\
-{1\over\rho}{\partial  p \over \partial r} + {\mu\over \rho}(-{u_r \over r^2}+ {1\over r}{\partial \over \partial r}(r{\partial u_r \over \partial r})+{1\over r^2}{\partial^2 u_r \over \partial \theta^2}+ {\partial^2 u_r \over \partial z^2} - {2\over r^2}{\partial u_\theta \over \partial \theta}) + g_r</script><script type="math/tex; mode=display">
{\partial u_\theta \over \partial t} + u_r {\partial u_\theta \over \partial r} +{u_\theta \over r}{\partial u_\theta \over \partial \theta} + {u_r u_\theta \over r}+u_z{\partial u_\theta \over \partial z}=\\\\
-{1\over r \rho}{\partial  p \over \partial \theta} + {\mu\over \rho}(-{u_\theta\over r^2}+ {1\over r}{\partial \over \partial r}(r{\partial u_\theta \over \partial r})+{1\over r^2}{\partial^2 u_\theta \over \partial \theta^2}+{\partial^2 u_\theta \over \partial z^2}+ {2\over r^2}{\partial u_r \over \partial \theta}) + g_\theta</script><script type="math/tex; mode=display">
{\partial u_z \over \partial t} + u_r {\partial u_z \over \partial r} +{u_\theta \over r}{\partial u_z \over \partial \theta} +u_z{\partial u_\theta \over \partial z}=\\\\
-{1\over\rho}{\partial  p \over \partial z} + {\mu\over \rho}({1\over r }{\partial \over \partial r}(r {\partial u_z \over \partial r})+{1\over r^2}{\partial^2 u_z \over \partial \theta^2}+{\partial^2 u_z \over \partial z^2}) + g_z</script><p>进一步，我们对其作dimensionless处理，通过d约化，$\tau=d^2/\nu$, 和 $\nu^2 / d^2$ 作为空间，时间的计量单位，压力通过$p=p^h / \rho$. 这样上述方程转化为，即为文献<sup><a href="#fn_1" id="reffn_1">1</a></sup>中的公式（3）：</p>
<script type="math/tex; mode=display">
\partial_t \vec{u} + (\vec{u} \cdot \nabla) \vec{u} =-\nabla p + \nabla \cdot \sigma \\\\
\nabla \cdot \vec{u} =0</script><script type="math/tex; mode=display">
{\partial u_r \over \partial t} + u_r {\partial u_r \over \partial r} +{u_\theta \over r}{\partial u_r \over \partial \theta} - {u_\theta^2 \over r}+u_z{\partial u_r \over \partial z}=\\\\
-{\partial  p \over \partial r} + (-{u_r \over r^2}+ {1\over r}{\partial \over \partial r}(r{\partial u_r \over \partial r})+{1\over r^2}{\partial^2 u_r \over \partial \theta^2}+ {\partial^2 u_r \over \partial z^2} - {2\over r^2}{\partial u_\theta \over \partial \theta}) + g_r</script><script type="math/tex; mode=display">
{\partial u_\theta \over \partial t} + u_r {\partial u_\theta \over \partial r} +{u_\theta \over r}{\partial u_\theta \over \partial \theta} + {u_r u_\theta \over r}+u_z{\partial u_\theta \over \partial z}=\\\\
-{1\over r}{\partial  p \over \partial \theta} + (-{u_\theta\over r^2}+ {1\over r}{\partial \over \partial r}(r{\partial u_\theta \over \partial r})+{1\over r^2}{\partial^2 u_\theta \over \partial \theta^2}+{\partial^2 u_\theta \over \partial z^2}  +{2\over r^2}{\partial u_r \over \partial \theta}) + g_\theta</script><script type="math/tex; mode=display">
{\partial u_z \over \partial t} + u_r {\partial u_z \over \partial r} +{u_\theta \over r}{\partial u_z \over \partial \theta} +u_z{\partial u_\theta \over \partial z}=\\\\
-{\partial  p \over \partial z} + ({1\over r }{\partial \over \partial r}(r {\partial u_z \over \partial r})+{1\over r^2}{\partial^2 u_z \over \partial \theta^2}+{\partial^2 u_z \over \partial z^2}) + g_z</script><ul>
<li>备注：后续可进一步简化为轴对称，去掉$\theta$ direction. 不再进行赘述。</li>
</ul>
<h2 id="Numerical-simulation"><a href="#Numerical-simulation" class="headerlink" title="Numerical simulation"></a>Numerical simulation</h2><h3 id="空间离散"><a href="#空间离散" class="headerlink" title="空间离散"></a>空间离散</h3><ol>
<li>Fourier-Galerkin method: 相当于每个时间步下，都要求解一次方程，算出不同l、n模态或者波数下所对应的r方向的chebshev系数。<ul>
<li><em>备注</em>：这里面也许可以做一些文章。稳定性问题判定，通过eigenvalue。</li>
</ul>
</li>
</ol>
<script type="math/tex; mode=display">
\vec{u}(r,\theta, z)=\sum_{l=-L}^L \sum_{n=-N}^N \hat{u}(r)e^{i (lk_z z+n k_\theta \theta)}\\\\
\vec{p}(r,\theta, z)=\sum_{l=-L}^L \sum_{n=-N}^N \hat{p}(r)e^{i (lk_z z+n k_\theta \theta)}\\\\</script><p>其中， $k<em>z$ 是最小波数， $k</em>\theta$ 是简化的周期数。</p>
<script type="math/tex; mode=display">
\Gamma=2\pi/k_z\\\\
L_0=2\pi / k_\theta</script><p>将上面的离散形式带入到最终的推导公式，转化到每个(l,n)：</p>
<script type="math/tex; mode=display">
\partial_t \hat{u}_t + \hat{N}_r = -\partial_r \hat{p} + \hat{\triangle} \hat{u}_r - \hat{u}_r/r^2 - 2inlk_\theta\hat{u}_\theta/r^2\\\\
\partial_t \hat{u}_\theta  + \hat{N}_\theta = -ink_\theta \hat{p}/r +\hat{\triangle}\hat{u}_\theta -\hat{u}_\theta/r^2 - 2ink_\theta \hat{u}_r/r^2 \\\\
\partial_t \hat{u}_z +\hat{N}= -ilk_z \hat{p} + \hat{\triangle} \hat{u}_z</script><p>其中，非线性项包含$u\cdot u$和$ u^2$项。</p>
<script type="math/tex; mode=display">
\hat{\triangle}=\partial_r/r +\partial_{rr}-n^2k_\theta^2/r^2-l^2k_z^2</script><p>接下来做的是解耦径向和周向速度：</p>
<p>带入：</p>
<script type="math/tex; mode=display">
\hat{u}_+=\hat{u}_r + i\hat{u}_\theta\\\\
\hat{u}_+=\hat{u}_r - i\hat{u}_\theta</script><p>得到：</p>
<script type="math/tex; mode=display">
\partial_t \hat{u}_+(r)+\hat{N}_+(r)= -\partial_r \hat{p}(r)+ nk_\theta \hat{p}(r)/r +(\hat{\triangle}-1/r^2 -2nk_\theta/r^2)\hat{u}_+ \\\\
\partial_t \hat{u}_-(r)+\hat{N}_-(r)= -\partial_r \hat{p}(r)- nk_\theta \hat{p}(r)/r +(\hat{\triangle}-1/r^2  +2nk_\theta/r^2)\hat{u}_- \\\\
\partial_t \hat{u}_z +\hat{N}= -ilk_z \hat{p} + \hat{\triangle} \hat{u}_z</script><script type="math/tex; mode=display">
\hat{N}_{\pm}= \hat{N}_r \pm i \hat{N}_\theta</script><ol>
<li>finite-difference method in r方向的Chebyshev离散<sup><a href="#fn_5" id="reffn_5">5</a></sup></li>
</ol>
<p>Use a standard high-order, central finite-difference method to approximate the radial derivatives.</p>
<script type="math/tex; mode=display">
r_j={1+\eta\over 2(1-\eta)}+{sin^{-1}(-\alpha cos(\pi j/M))\over 2 sin^{-1}\alpha}, j=0,...,M</script><ol>
<li><p>时间离散格式-Adams-Bashforth back-ward-difference</p>
<script type="math/tex; mode=display">
{3u^{i+1}-4u^i + u^{i-1}\over 2\triangle t} + 2 N^i(u) - N^{i-1}(u) = -\nabla p^{i+1}+\triangle u^{i+1}</script><ul>
<li><p>计算频域的非线性项系数$\hat{N}^i(u)$, 通过3/2-dealiasing rule:</p>
<ul>
<li>Do matrix-vector multiplication to calculate $\partial_r\hat{u}^i$ (FD method) - chebfun: diff</li>
<li>??Compute dot product in Fourier space to calculate $\partial_\theta \hat{u}^i$ and $\partial_z \hat{u}^i$</li>
<li>Perform Fourier transform of $\partial_{r,\theta,z}\hat{u}^i$ and $\hat{u}^i$ to obtain the velocity field and all its derivatives in physical space. </li>
<li>Calculate N^i(u)=u^i\cdot \triangle u^i$.</li>
<li>Perform inverse Fourier transform to obtain the spectral coefficients $\hat{N}^i(u)$.</li>
</ul>
</li>
<li><p>Obtain the pressure prediction, $\hat{p}*$: solve the Possion equation, with consistent Neumann boundary condition.</p>
<script type="math/tex; mode=display">
\triangle \hat{p}*= \nabla \cdot [-2 \hat{N}^i(u)+\hat{N}^{i-1}(u)]</script></li>
<li><p>Obtain the velocity prediction, $\hat{u}*$: solve the three three Helmholtz equations</p>
<script type="math/tex; mode=display">
{3\hat{u}*-4\hat{u}^i+ \hat{u}^{i-1}\over 2\triangle t}+ 2\hat{N}^i(u) -\hat{N}^{i-1}(u)=-\nabla\hat{p}* + \triangle 
\hat{u}*</script><p>with Dirichlet boundary conditions.</p>
</li>
<li><p>Correct via an intermediate variable $\phi=2\triangle t (\hat{p}^{i+1}-\hat{p}*)/3$. The incompressibility condition $\nabla\cdot \hat{u}^{i+1}=0$ leads to a Possion equation for $\phi$ with homogeneous Neumann boundary conditions:</p>
<script type="math/tex; mode=display">
\triangle\phi =\nabla \cdot \hat{u}*\\\\
\partial_r \phi_{r_{i,o}}=0</script></li>
<li><p>Compute pressure and velocity correction, $\hat{p}^{i+1}$ and $\hat{u}^{i+1}$:</p>
<script type="math/tex; mode=display">
\hat{p}^{i+1}=\hat{p}* + 3\phi /(2\triangle t)\\\\
\hat{u}^{i+1}=\hat{u}*-\nabla\phi</script></li>
<li><p>Go back to step 1</p>
</li>
</ul>
<p>The Navier-Stokes equations are thus advanced in time by solving five systems of linear euqation, of Possion or Helmholtz type, for each Fourier mode. </p>
</li>
</ol>
<h5 id="附录1-："><a href="#附录1-：" class="headerlink" title="附录1 ："></a>附录1 ：</h5><p>在柱坐标系下：</p>
<script type="math/tex; mode=display">
h_r=1, h_\theta=r; h_z=1,  \\\\
\vec{u}=[u_r; u_\theta; u_z;]</script><p>令：</p>
<script type="math/tex; mode=display">
\nabla \cdot \vec{u}={1\over h_1 h_2 h_3}[{\partial(v_1 h_2 h_3)\over \partial w_1}+{\partial(v_2 h_3 h_1)\over \partial w_2}+{\partial(v_3 h_1 h_2)\over \partial w_3}] \\\\
= {1\over r}[{\partial u_z r \over \partial z} + {\partial (u_r r) \over \partial r} + {\partial u_\theta\over \partial \theta}]={\partial u_z  \over \partial z} + {\partial u_r  \over \partial r} + {u_r \over r}+ {1\over r}{\partial u_\theta\over \partial \theta}\\\\</script><script type="math/tex; mode=display">
D={v_1\over{h_1}}{\partial \over {\partial \xi_1}}+{v_2\over{h_2}}{\partial \over {\partial \xi_2}}+{v_3\over{h_3}}{\partial \over {\partial \xi_3}}=u_r {\partial  \over {\partial r}}+{u_\theta \over r}{\partial \over {\partial \theta}}+u_z{\partial \over {\partial z}}</script><p>因:</p>
<script type="math/tex; mode=display">
(\vec{u}\cdot\nabla)\vec{u}=\begin{cases}
term1:D v_1+{v_2\over{h_2h_1}}(v_1{\partial h_1\over \partial \xi_2}-v_2{\partial h_2\over \partial \xi_1})+{v_3\over{h_3h_1}}(v_1{\partial h_1\over \partial \xi_3}-v_2{\partial h_3\over \partial \xi_1})\\
term2:D v_2+{v_3\over h_3h_2}(v_2{\partial h_2 \over \partial \xi_3}-v_3{\partial h_3 \over \partial \xi_2})+{v_1\over h_1h_2}(v_2{\partial h_2 \over \partial \xi_1}-v_1{\partial h_1 \over \partial \xi_2})\\
term3:D v_3+{v_1\over h_1h_3 }(v_3{\partial h_3 \over \partial \xi_1}-v_1{ \partial h_1 \over \partial \xi_3})+{v_2\over h_2h_3}(v_3{\partial h_3\over \partial \xi_2}-v_3{\partial h_2 \over \partial \xi_3})\\
\end{cases} \\\\</script><p>得：</p>
<script type="math/tex; mode=display">
(\vec{u}\cdot\nabla)\vec{u}=\begin{cases}
term1: u_r {\partial u_r \over {\partial r}}+{u_\theta \over r}{\partial u_r \over {\partial \theta}}+u_z{\partial u_r \over {\partial z}}  - u_\theta^2 / r\\
term2:u_r {\partial u_\theta \over {\partial r}}+{u_\theta \over r}{\partial u_\theta \over {\partial \theta}}+u_z{\partial u_\theta \over {\partial z}} + u_ru_\theta / r
\\
term3:u_r {\partial u_z  \over {\partial r}}+{u_\theta \over r}{\partial u_z \over {\partial \theta}}+u_z{\partial u_z \over {\partial z}} +0
\\
\end{cases} \\\\</script><p>最终得到：</p>
<script type="math/tex; mode=display">
(\partial_t + \vec{u}\cdot \nabla )u_r - u_\theta ^2 / r=-\partial_r p + \triangle u_r - u_r / r^2 -2 \partial_\theta u_\theta / r^2 \\\\
(\partial_t + \vec{u}\cdot \nabla) u_\theta + u_\theta u_r /r = -\partial_\theta p/ r +\triangle u_\theta - u_\theta /r^2 + 2 \partial_\theta u_r /r^2 \\\\
(\partial_t + \vec{u}\cdot \nabla)u_z = -\partial_z p + \triangle u_z \\\\
u_r/r +\partial_r u_r +\partial_\theta u_r +\partial_zu_z =0</script><script type="math/tex; mode=display">
\nabla p = \partial_r p \vec{e_r} + {1\over r}\partial_\theta p \vec{e_\theta} +\partial_z p \vec{e_z}</script><h3 id="Boundary-condition"><a href="#Boundary-condition" class="headerlink" title="Boundary condition"></a>Boundary condition</h3><script type="math/tex; mode=display">
u_\theta (r_{i,o},\theta,z)=Re_{i,o}\\\\
u_{r,z}(r_{i,o},\theta,z)=0\\\\
\vec{u}(r,\theta,z)=\vec{u}(r,\theta+L_\theta,z)\\\\
\vec{u}(r,\theta,z)=\vec{u}(r,\theta,z+\Gamma)\\\\</script><p>压力项可以用Possion方程进行近似处理：</p>
<script type="math/tex; mode=display">
\triangle p =- \nabla\cdot N(u), where N(u)=\vec{u} \cdot \nabla \vec{u}</script><p>需要满足一定的边界条件：<sup><a href="#fn_4" id="reffn_4">4</a></sup></p>
<script type="math/tex; mode=display">
\partial_n p_{r_{i,o}}=\vec{n}\cdot [-\partial_t \vec{u}-N(\vec{u})+\nabla\cdot \sigma]</script><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p>环境：ubuntu 20.04</p>
<p>软件有三个branch，其中nsCouette-gpu 通过GPU计算，支持nivida的cuda-c。</p>
<p>具体操作是，主要需要按照库fftw，hdf5，libblas3, liblapack-dev</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> http://github.com/dfeldmann/nsCouette.git</span><br><span class="line">$ git <span class="built_in">clone</span> -b nsPipe-1.0 https://github.com/dfeldmann/nsCouette.git</span><br><span class="line">$ git <span class="built_in">clone</span> -b nsCouette-gpu https://github.com/dfeldmann/nsCouette.git</span><br><span class="line">$ <span class="built_in">cd</span> nsCouette</span><br><span class="line">$ sudo apt install libblas3 liblapack-dev</span><br><span class="line">$ sudo apt install libhdf5-openmpi-dev</span><br><span class="line">$ sudo apt install libfftw3-dev</span><br><span class="line"><span class="comment"># 需要进入ARCH文件夹中，修改make.arch.gcc-linux中hdf5的路径，</span></span><br><span class="line"><span class="comment"># LIBHDF5 = -L/usr/lib/x86_64-linux-gnu/hdf5/openmpi -lhdf5_fortran -lhdf5 -lz //-L表示lib库</span></span><br><span class="line"><span class="comment"># INCLUDES = -I/usr/include/hdf5/openmpi //-I表示include</span></span><br><span class="line">$ make ARCH=gcc-linux</span><br><span class="line">$ <span class="built_in">cd</span> gcc-linux &amp;&amp; ./nsCouette.x</span><br></pre></td></tr></table></figure>
<h3 id="nsCouette-gpu环境配置-类似C语言-："><a href="#nsCouette-gpu环境配置-类似C语言-：" class="headerlink" title="nsCouette-gpu环境配置(类似C语言)："></a>nsCouette-gpu环境配置(类似C语言)：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先得有Nivida的显卡，安装好cuda环境</span></span><br><span class="line"><span class="comment"># 修改Makefile</span></span><br><span class="line"><span class="comment"># all: $(GPU_OBJECTS)</span></span><br><span class="line"><span class="comment">#        $(NVCC) -o taylorC $(GPU_OBJECTS) $(LIBS) -L/usr/lib/x86_64-linux-gnu/hdf5/openmpi </span></span><br><span class="line"><span class="comment">#$ (GPU_OBJECTS): %.o: %.cu</span></span><br><span class="line"><span class="comment">#        $(NVCC) -c   $&lt; -o $@  -I/usr/include/hdf5/openmpi -I/usr/lib/x86_64-linux-gnu/openmpi/include</span></span><br><span class="line"><span class="comment"># 该修改根据自己openmpi和hdf5的安装路径进行选择，如果按照上面库的安装，该路径如上所示。</span></span><br><span class="line"><span class="comment"># 本机只有一个独立显卡，因此还需要修改main.cu 函数的”dev=0“。</span></span><br><span class="line">$ make clean &amp;&amp; make </span><br></pre></td></tr></table></figure>
<h3 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cu 代码</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&quot;TayC.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n+++++++++++++++++++++++++++&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nStarting GPU Taylor-Couette&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n+++++++++++++++++++++++++++&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">int</span> dev=<span class="number">0</span>; <span class="comment">//根据自己主机的GPU数目来定</span></span><br><span class="line">  <span class="keyword">double</span> time;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nSetting device: %d&quot;</span>,dev);</span><br><span class="line">  CHECK_CUDART(cudaSetDevice(dev));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Timing variables</span></span><br><span class="line">  <span class="keyword">clock_t</span> start, end;</span><br><span class="line">  <span class="keyword">double</span> gpu_time_used;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set up</span></span><br><span class="line">  size_p sizes;</span><br><span class="line">    </span><br><span class="line">  sizes.Nr=NR; <span class="comment">//R方向的模态数</span></span><br><span class="line">  sizes.Nt=NT; <span class="comment">//theta方向的模态数</span></span><br><span class="line">  sizes.Nz=NZ; <span class="comment">//z方向的模态数</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">//Initialize the mesh  </span></span><br><span class="line">  <span class="keyword">double</span>* grid_mesh=(<span class="keyword">double</span>*)<span class="built_in">malloc</span>(NR*<span class="keyword">sizeof</span>(<span class="keyword">double</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> r_i = <span class="number">1.0</span>;         <span class="comment">//ETA/(1.0-ETA);</span></span><br><span class="line">  <span class="keyword">double</span> r_o = <span class="number">1.0</span>/ETA;     <span class="comment">//1.0/(1.0-ETA); </span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Chebyshev mesh in r</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;NR;j++)&#123;</span><br><span class="line">      <span class="comment">//grid_mesh[j]=2.0*(double)j/(double)(NR-1)+1.0;</span></span><br><span class="line">        grid_mesh[j]= (r_i+r_o)/<span class="number">2.0</span> - <span class="built_in">cos</span>(PI2/<span class="number">2.0</span>*j/(NR<span class="number">-1</span>))/<span class="number">2.0</span>;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Write mesh</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//Set modules</span></span><br><span class="line">  setImplic_7_exp(grid_mesh,sizes);</span><br><span class="line">  setDeriv_9_exp(grid_mesh,sizes);</span><br><span class="line">  setBoundary(grid_mesh);</span><br><span class="line">  setNonlinear(grid_mesh);</span><br><span class="line">  setFft(sizes);</span><br><span class="line">  setCublas();</span><br><span class="line">  setIntegrator(sizes);</span><br><span class="line">  setLinear(grid_mesh);</span><br><span class="line">  setStatistics(grid_mesh);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Allocate memory buffers</span></span><br><span class="line">  vfield u, uw, rhs, rhsw;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">size_t</span> size_p=NR*NT*NZ*<span class="keyword">sizeof</span>(double2);</span><br><span class="line"></span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;u.r,size_p));</span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;u.t,size_p));</span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;u.z,size_p));</span><br><span class="line">  </span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;uw.r,size_p));</span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;uw.t,size_p));</span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;uw.z,size_p));</span><br><span class="line">  </span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;rhs.r,size_p));</span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;rhs.t,size_p));</span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;rhs.z,size_p));</span><br><span class="line">  </span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;rhsw.r,size_p));</span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;rhsw.t,size_p));</span><br><span class="line">  CHECK_CUDART(cudaMalloc(&amp;rhsw.z,size_p));</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Start initial field</span></span><br><span class="line">  initField(u, grid_mesh);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Or read check point</span></span><br><span class="line">  <span class="comment">//readCheckpoint(u,grid_mesh,&amp;time,&quot;./checkpoint.h5&quot;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//Time-step</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nParameter&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nr_o,r_i=%e,%e&quot;</span>,r_o,r_i);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nRe_i,Re_o=%e,%e&quot;</span>,REYNOLDS_OUTER,REYNOLDS_INNER);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">double</span> U_i=REYNOLDS_OUTER*r_o;</span><br><span class="line">  <span class="keyword">double</span> U_o=REYNOLDS_INNER*r_i;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">double</span> t_i=PI2*r_i/NT/U_i;</span><br><span class="line">  <span class="keyword">double</span> t_o=PI2*r_o/NT/U_o;</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nt_i,t_o=%e,%e&quot;</span>,t_o,t_i);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">double</span> dt=<span class="number">0.1</span>*min(<span class="built_in">abs</span>(t_i),<span class="built_in">abs</span>(t_o));</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(VARIABLE_DT)&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nRunning with fixed Courant number=%e&quot;</span>,COURANT);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nRunning with fixed Dt=%e&quot;</span>,dt);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TayC.h 代码块</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cublas_v2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cufft&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;hdf5.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;hdf5_hl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CHECK_CUDART(x) do &#123; \</span></span><br><span class="line">  cudaError_t res = (x); \</span><br><span class="line">  <span class="keyword">if</span>(res != cudaSuccess) &#123; \</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot; CUDART: %s = %d (%s) at (%s:%d)\n&quot;</span>,  <span class="meta">#x, res, cudaGetErrorString(res),__FILE__,__LINE__); \</span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>); \</span><br><span class="line">  &#125; \</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NZ 65 <span class="comment">//Number of grid points in real space is 2*(NZ-1)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NT 64 <span class="comment">//Number of grid points in real space is NT</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NR 64 <span class="comment">//Number of grid points in real space is NR</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ETA (0.5) <span class="comment">//eta=inner_radius/outer_radius, eta&lt;1</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NZP (3*(NZ-1)/2+1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NTP (3*NT/2)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REYNOLDS_INNER (-700.0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REYNOLDS_OUTER ( 700.0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI2 6.283185307179586</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LT PI2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LZ (PI2/2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Number of steps to perform non-linear convolution: save memory</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NSTEPS_CONV 1 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Size of the influence matrix</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAT 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Parameter of the implicit time-integrator</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_IMPLICIT (0.51)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Variable dt </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VARIABLE_DT 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXDT 0.01</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COURANT 0.25</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TOLERANCE_DTERR 5e-5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> struct &#123; double2* r;double2* t;double2* z;&#125; vfield;</span><br><span class="line"><span class="keyword">typedef</span> struct &#123; <span class="keyword">int</span> Nr; <span class="keyword">int</span> Nt; <span class="keyword">int</span> Nz; <span class="keyword">double</span> Lt ; <span class="keyword">double</span> Lz;&#125; size_p;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Globals</span></span><br><span class="line"><span class="keyword">extern</span> double2* AUX_T;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">double</span> Cfl_r, Cfl_z, Cfl_th;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Finite differences</span></span><br><span class="line"><span class="keyword">void</span> fd_weigths(<span class="keyword">double</span> x0,<span class="keyword">double</span>* x,<span class="keyword">int</span> n,<span class="keyword">double</span>* L1,<span class="keyword">double</span>*L2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Cublas</span></span><br><span class="line"><span class="keyword">void</span> setCublas(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">void</span> transpose_A(double2* u_2,double2* u_1);</span><br><span class="line"><span class="keyword">void</span> transpose_B(double2* u_2,double2* u_1);</span><br><span class="line"><span class="keyword">void</span> transpose_infbackward(<span class="keyword">double</span>* u_2,<span class="keyword">double</span>* u_1,<span class="keyword">int</span> mr);</span><br><span class="line"><span class="keyword">void</span> transpose_infforward(<span class="keyword">double</span>* u_2,<span class="keyword">double</span>* u_1,<span class="keyword">int</span> mr);</span><br><span class="line"><span class="keyword">void</span> invert_infmatrix(<span class="keyword">double</span>* src);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Derivatives compact 3-3</span></span><br><span class="line"><span class="keyword">void</span> setDeriv_3_comp(<span class="keyword">double</span>* mesh,size_p sizes);</span><br><span class="line"><span class="keyword">void</span> deriv_R_3C(double2* u,double2* aux);</span><br><span class="line"><span class="keyword">void</span> deriv_RR_3C(double2* u, double2* aux);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Derivatives explicit 9</span></span><br><span class="line"><span class="keyword">void</span> setDeriv_9_exp(<span class="keyword">double</span>* mesh,size_p sizes);</span><br><span class="line"><span class="keyword">void</span> deriv_R_9E(double2* u);</span><br><span class="line"><span class="keyword">void</span> deriv_RR_9E(double2* u);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Implicit steps explicit 7</span></span><br><span class="line"><span class="keyword">void</span> setImplic_7_exp(<span class="keyword">double</span>* mesh,size_p sizes);</span><br><span class="line"><span class="keyword">void</span> implicit_step(double2* u, double2* aux1,<span class="keyword">double</span>* aux2, <span class="keyword">double</span>* aux3, <span class="keyword">double</span>* aux4, </span><br><span class="line">                   <span class="keyword">double</span> d_implicit,<span class="keyword">double</span> dt,<span class="keyword">int</span> flag);</span><br><span class="line"><span class="keyword">void</span> calcPressure(double2* p, vfield u, double2* dr,</span><br><span class="line">                   double2* aux1,<span class="keyword">double</span>* aux2, <span class="keyword">double</span>* aux3, <span class="keyword">double</span>* aux4);</span><br><span class="line"><span class="keyword">void</span> deriv_R_7E(double2* u);</span><br><span class="line"></span><br><span class="line"><span class="comment">//IO</span></span><br><span class="line"><span class="keyword">void</span> writeBufferBinary(<span class="keyword">double</span>* w,<span class="keyword">const</span> <span class="keyword">char</span>* file,<span class="keyword">size_t</span> elsize, <span class="keyword">size_t</span> elements);</span><br><span class="line"><span class="keyword">void</span> writeBufferBinary(<span class="keyword">double</span>* w,<span class="keyword">const</span> <span class="keyword">char</span>* file,<span class="keyword">size_t</span> elsize, <span class="keyword">size_t</span> elements);</span><br><span class="line"><span class="keyword">void</span> writeBufferBinaryGPU(<span class="keyword">double</span>* w,<span class="keyword">const</span> <span class="keyword">char</span>* file,<span class="keyword">size_t</span> elsize,<span class="keyword">size_t</span> elements);</span><br><span class="line"><span class="keyword">void</span> writeCheckpoint(vfield u, <span class="keyword">double</span>* grid_mesh,<span class="keyword">double</span>* time,<span class="keyword">char</span>* fileName);</span><br><span class="line"><span class="keyword">void</span> readCheckpoint(vfield u, <span class="keyword">double</span>* grid_mesh,<span class="keyword">double</span>* time,<span class="keyword">char</span>* fileName);</span><br><span class="line"><span class="keyword">void</span> writeFieldVis(vfield u, <span class="keyword">double</span>* grid_mesh,<span class="keyword">double</span>* time,<span class="keyword">char</span>* fileName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//fft</span></span><br><span class="line"><span class="keyword">void</span> setFft(size_p sizes);</span><br><span class="line"><span class="keyword">void</span> fftDestroy(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">void</span> fftForward(double2* buffer);</span><br><span class="line"><span class="keyword">void</span> fftBackward(double2* buffer);</span><br><span class="line"><span class="keyword">void</span> fftForward_reduced(double2* buffer);</span><br><span class="line"><span class="keyword">void</span> fftBackward_reduced(double2* buffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Utils</span></span><br><span class="line"><span class="keyword">void</span> copyVfield(vfield u1, vfield u2);</span><br><span class="line"><span class="keyword">void</span> onesGPU(double2* u1, <span class="keyword">size_t</span> elements);</span><br><span class="line"><span class="keyword">void</span> normalize(double2* u, <span class="keyword">double</span> norm, <span class="keyword">size_t</span> elements);</span><br><span class="line"><span class="keyword">void</span> decoupleForward(vfield u);</span><br><span class="line"><span class="keyword">void</span> decoupleBackward(vfield u);</span><br><span class="line"><span class="keyword">void</span> copyBuffer(double2* u1, double2* u2);</span><br><span class="line"><span class="keyword">void</span> updateNonlinear(vfield n1, vfield n2, <span class="keyword">double</span> d_implicit);</span><br><span class="line"><span class="keyword">void</span> calcnorm(double2* u_out, double2* u_in);</span><br><span class="line"><span class="keyword">void</span> setZeromode(double2* u);</span><br><span class="line"><span class="keyword">void</span> initField(vfield u, <span class="keyword">double</span>* mesh);</span><br><span class="line"><span class="keyword">void</span> writeBufferBinaryGPUreal(<span class="keyword">double</span>* w,<span class="keyword">const</span> <span class="keyword">char</span>* file,</span><br><span class="line">                              <span class="keyword">size_t</span> elsize,<span class="keyword">size_t</span> elements);</span><br><span class="line"><span class="keyword">void</span> zerosGPU(double2* u1, <span class="keyword">size_t</span> elements);</span><br><span class="line"><span class="keyword">void</span> diffAbs(double2* u_diff, double2* u);</span><br><span class="line"><span class="keyword">void</span> fieldAbs(double2* u_diff, double2* u);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Non-linear</span></span><br><span class="line"><span class="keyword">void</span> setNonlinear(<span class="keyword">double</span>* mesh);</span><br><span class="line"><span class="keyword">void</span> nonLinear(vfield u, vfield dur,<span class="keyword">int</span> flag, <span class="keyword">double</span> time);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Check routines</span></span><br><span class="line"><span class="keyword">void</span> checkDerivatives(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">void</span> checkNonlinear(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">void</span> checkImplicit(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">void</span> checkPressure(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">void</span> checkLaplacian(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">void</span> checkTranspose(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">void</span> checkBoundaries(<span class="keyword">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Linear </span></span><br><span class="line"><span class="keyword">void</span> setLinear(<span class="keyword">double</span>* mesh);</span><br><span class="line"><span class="keyword">void</span> pressureProject(vfield rhs);</span><br><span class="line"><span class="keyword">void</span> implictStep(vfield u, vfield rhs, <span class="keyword">double</span> d_implicit, <span class="keyword">double</span> dt);</span><br><span class="line"><span class="keyword">void</span> calcLaplacian(vfield rhs, vfield u, <span class="keyword">double</span> d_implicit, <span class="keyword">double</span> dt);</span><br><span class="line"><span class="keyword">void</span> calcPressure_hom(double2* u,double2* aux1,<span class="keyword">double</span>* aux2, <span class="keyword">double</span>* aux3, <span class="keyword">double</span>* aux4</span><br><span class="line">                      ,double2 Bci, double2 Bco);</span><br><span class="line"><span class="keyword">void</span> implicit_step_hom(double2* u, double2* aux1,<span class="keyword">double</span>* aux2, <span class="keyword">double</span>* aux3, </span><br><span class="line">                        <span class="keyword">double</span>* aux4, <span class="keyword">double</span> d_implicit,<span class="keyword">double</span> dt,<span class="keyword">int</span> flag,double2 Bci, double2 Bco);</span><br><span class="line"><span class="keyword">void</span> calcDivergence(double2* div, vfield u);</span><br><span class="line"><span class="keyword">void</span> calcVorticity(vfield vor, vfield u);</span><br><span class="line"><span class="keyword">void</span> forcing(double2* uz);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Boundary conditions</span></span><br><span class="line"><span class="keyword">void</span> setBoundary(<span class="keyword">double</span>* mesh);</span><br><span class="line"><span class="keyword">void</span> calcHsol(<span class="keyword">double</span>* M, vfield hsolu_i, vfield hsolu_o, vfield hsolp_i, vfield hsolp_o,</span><br><span class="line">              <span class="keyword">double</span> d_implicit, <span class="keyword">double</span> dt);</span><br><span class="line"><span class="keyword">void</span> imposeBoundarycond(vfield u, vfield hsolu_i, vfield hsolu_o, vfield hsolp_i,</span><br><span class="line">                        vfield hsolp_o, <span class="keyword">double</span>* M);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Time integrator</span></span><br><span class="line"><span class="keyword">void</span> integrate(vfield u, vfield u_w, vfield rhs, vfield rhs_w,</span><br><span class="line">               <span class="keyword">int</span> nsteps, <span class="keyword">double</span> dt,<span class="keyword">double</span>* time);</span><br><span class="line"><span class="keyword">void</span> setIntegrator(size_p sizes);</span><br><span class="line"><span class="keyword">void</span> check_convergence(<span class="keyword">int</span>* iter, <span class="keyword">double</span> dt);</span><br><span class="line"><span class="keyword">void</span> new_step(<span class="keyword">double</span>* dt);</span><br><span class="line"><span class="keyword">void</span> measurecorr(vfield up, vfield um);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Statistics</span></span><br><span class="line"><span class="keyword">void</span> setStatistics(<span class="keyword">double</span>* mesh);</span><br><span class="line"><span class="keyword">void</span> readTorq(double2* ut,double2* utdr,<span class="keyword">double</span> time);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Non-linear</span></span><br><span class="line"><span class="keyword">void</span> padForward(double2* aux,double2* u);</span><br><span class="line"><span class="keyword">void</span> padBackward(double2* u,double2* aux);</span><br><span class="line"><span class="keyword">void</span> calcDut(vfield u, vfield du);</span><br><span class="line"><span class="keyword">void</span> calcDuz(vfield u, vfield du);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Check cublas</span></span><br><span class="line"><span class="keyword">void</span> cublasCheck(cublasStatus_t error, <span class="keyword">const</span> <span class="keyword">char</span>* function);                                                               </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote id="fn_1">
<sup>1</sup>.  A hybrid MPI-OpenMP parallel implementation for pseudo-spectral simulations with application to Taylor-Couette flow<a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_2">
<sup>2</sup>. The lattice Boltzmann method: Fundamentals and acoustcis<a href="#reffn_2" title="Jump back to footnote [2] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_3">
<sup>3</sup>. <a target="_blank" rel="noopener" href="https://github.com/demichie/NS_cylindrical/blob/master/NS_.cylindrical.pdf">https://github.com/demichie/NS_cylindrical/blob/master/NS_.cylindrical.pdf</a><a href="#reffn_3" title="Jump back to footnote [3] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_4">
<sup>4</sup>. ON PRESSURE BOUNDARY CONDITIONS FOR THE INCOMPRESSIBLE NAVIER-STOKES EQUATIONS* <a href="#reffn_4" title="Jump back to footnote [4] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_5">
<sup>5</sup>.  A Practical Guide to Pseudospectral Methods; Cambridge<a href="#reffn_5" title="Jump back to footnote [5] in the text."> &#8617;</a>
</blockquote>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Jiaqi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://deal-ii.com/post/c48f8ba7/">http://deal-ii.com/post/c48f8ba7/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://deal-ii.com" target="_blank">DEAL-II-Fluid</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/flow-instability/">flow instability</a><a class="post-meta__tags" href="/tags/taylor-vortex/">taylor vortex</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/12/22/d7YjSwNqreOA91K.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/44c06f35/"><img class="prev-cover" data-src="https://cdn.jsdelivr.net/gh/Jiaqi-knight/imgBase@main/logo.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">谱方法-未完。。。</div></div></a></div><div class="next-post pull-right"><a href="/post/c62f4587/"><img class="next-cover" data-src="https://cdn.jsdelivr.net/gh/Jiaqi-knight/imgBase@main/cover-blog-shader.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">着色器开篇</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div class="comments-items-1" data-name="Valine"><div class="vcomment" id="vcomment"></div><script>function loadvaline () {  
  var requestSetting = function (from,set) {
    var from = from
    var setting = set.split(',').filter(function(item){
    return from.indexOf(item) > -1
    });
    setting = setting.length == 0 ? from :setting;
    return setting
  }

  var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
  var requiredFields = requestSetting(['nick','mail'],'nick,mail')

  function initValine () {
    window.valine = new Valine({
      el:'#vcomment',
      appId: 'lJ3vEzEWaeVa6HpWNNbPrauw-gzGzoHsz',
      appKey: '16FI6zgDXwvw71g04yhHnnW0',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: guestInfo,
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      requiredFields: requiredFields
    });
  }
  loadScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || false) {
  window.addEventListener('load', loadvaline)
}
else {
  function loadOtherComment () {
    loadvaline()
  }
}</script></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Jiaqi</div><div class="framework-info"><span>驱动 </span><a target="_blank" rel="noopener" href="https://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="/gitcalendar/js/gitcalendar.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":120,"height":260},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>